/*!CK:1817281669!*//*1450441933,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["hC18Y"]); }

__d("FaceboxSourceConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SNOWLIFT_SUGGEST:"snowlift_suggest",SNOWLIFT_DISMISS:"photo_snowlift_unit_suggestions",PERMALINK_SUGGEST:"permalink_suggest",PERMALINK_DISMISS:"photo_permalink_suggestions",UPLOADER_SUGGEST:"uploader_suggest",UPLOADER_DISMISS:"album_uploader_suggestions"};},null);
__d('PhotoTagApproval',['Arbiter','CSS','DOM','Event','Parent','PhotosConst','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(p){'use strict';this.viewer=p;this.units=[];this.currentUnit=0;var q=p.getVersionConst();if(q==m.VIEWER_SNOWLIFT){this._root=n('fbPhotoSnowliftTagApproval');}else this._root=n('fbPhotoPageTagApproval');h.subscribe(p.getEventString('DATA_CHANGE'),this.restartTagApproval.bind(this));h.subscribe('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',this.pendingTagPhotoClick.bind(this));k.listen(this._root,'click',this.handleClick.bind(this));k.listen(this._root,'mousemove',(function(r){this.hiliteCurrentPendingTag();k.kill(r);}).bind(this));this.restartTagApproval();}o.prototype.handleClick=function(event){'use strict';var p=event.getTarget();if(i.hasClass(p,'nextPager')&&i.hasClass(p,'enabled')){this.showNextUnit();}else if(i.hasClass(p,'prevPager')&&i.hasClass(p,'enabled')){this.showPrevUnit();}else if(l.byClass(p,'fbPhotoApprovalPendingButtons')){var q=this.units[this.currentUnit],r=this.getTagNameID(q);if(r){var s=l.byClass(p,'approve');h.inform('PhotoTagApproval.UPDATE_TAG_BOX',{id:r,approve:s,version:this.viewer.getVersionConst()});}setTimeout(this.removeSelectedUnit.bind(this),0);}return true;};o.prototype.loadUnits=function(p){'use strict';this.units=j.scry(this._root,'div.fbPhotoApprovalUnit');if(this.units.length){i.show(this._root);this.showUnit(p);i.conditionClass(this._root,'hidePagers',this.units.length==1);}else{i.hide(this._root);h.inform('PhotoTagApproval.HILITE_TAG',{tag:null,version:this.viewer.getVersionConst()});}};o.prototype.restartTagApproval=function(){'use strict';this.loadUnits(0);};o.prototype.pendingTagPhotoClick=function(p,q){'use strict';if(q.version!==m.VIEWER_PERMALINK&&q.version!==m.VIEWER_SNOWLIFT)return true;var r='approve:'+q.id;for(var s=0;s<this.units.length;s++)if(this.units[s].id===r){this.showUnit(s);return false;}return true;};o.prototype.removeSelectedUnit=function(){'use strict';var p=this.units[this.currentUnit];j.remove(p);this.loadUnits(this.currentUnit);};o.prototype.showNextUnit=function(){'use strict';this.showUnit(this.currentUnit+1);};o.prototype.showPrevUnit=function(){'use strict';this.showUnit(this.currentUnit-1);};o.prototype.getTagNameID=function(p){'use strict';var q=p.id.indexOf(':');return p.id.slice(q+1);};o.prototype.showUnit=function(p){'use strict';this.units.forEach(i.hide);this.currentUnit=(p+this.units.length)%this.units.length;var q=this.units[this.currentUnit];i.show(q);this.hiliteCurrentPendingTag();i.conditionClass(j.find(this._root,'a.prevPager'),'enabled',this.currentUnit>0);i.conditionClass(j.find(this._root,'a.nextPager'),'enabled',this.currentUnit<this.units.length-1);};o.prototype.hiliteCurrentPendingTag=function(){'use strict';var p=this.units[this.currentUnit],q=this.getTagNameID(p);h.inform('PhotoTagApproval.HILITE_TAG',{tag:q,version:this.viewer.getVersionConst()});};f.exports=o;},null);
__d('legacy:photo-tag-approval',['PhotoTagApproval'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();b.PhotoTagApproval=c('PhotoTagApproval');},3);
__d("XFamilyBulkTagAddAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/family\/bulk_tag_save\/",{subject:{type:"Int"},save_tags:{type:"String"}});},null);
__d('PhotoTagStore',['AsyncRequest','XFamilyBulkTagAddAsyncController','isEmpty'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){'use strict';this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};k.instance=this;}k.prototype.getPhotoTags=function(l){'use strict';return this._tagList[l]||{};};k.prototype.photoHasTags=function(l){'use strict';return !j(this.getPhotoTags(l));};k.prototype.clear=function(){'use strict';this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};};k.prototype.addTag=function(l,m,n,o){'use strict';l[m]=l[m]||{};var p=l[m][n]||[];p.push(o);l[m][n]=p;};k.prototype.revert=function(l){'use strict';var m=this._tagList,n=this._originalTagList;for(var o in m)if(j(n[o][l])){m[o][l]=[];}else m[o][l]=n[o][l];this._dirtyPhotosByUid={};};k.prototype.hasNewTags=function(){'use strict';return !j(this._tagList)||!j(this._textTagList);};k.prototype.userHasDirtyTags=function(l){'use strict';return !j(this._dirtyPhotosByUid[l]);};k.prototype.userDirtyTagsCount=function(l){'use strict';return Object.keys(this._dirtyPhotosByUid[l]).length;};k.prototype.handleTagFetch=function(l){'use strict';for(var m in l)this.loadTagInfo(m,l[m]);};k.prototype.saveAlbumTagsForUser=function(l,m){'use strict';var n=arguments.length<=2||arguments[2]===undefined?false:arguments[2],o={},p=[],q=this._dirtyPhotosByUid[l]||{};for(var r in q){var s=this._tagList[r][l];if(j(s)){p[p.length]=r;continue;}s.forEach(function(v){o[r]={x:v.x,y:v.y};});}var t={subject:l,action:'save',save_tags:o},u='/ajax/photos/album/tags.php';if(n){t={subject:l,save_tags:JSON.stringify(o)};u=i.getURIBuilder().getURI();}new h().setURI(u).setData(t).setHandler(function(v){m(v.payload);}).setAllowCrossPageTransition(true).send();delete this._dirtyPhotosByUid[l];};k.prototype.getTagsFromList=function(l){'use strict';var m=[];for(var n in l)if(l.hasOwnProperty(n))for(var o in l[n])if(l[n].hasOwnProperty(o))l[n][o].forEach(function(p){return m.push(p);});return m;};k.prototype.getAllTags=function(){'use strict';var l=this.getTagsFromList(this._tagList),m=this.getTagsFromList(this._textTagList);return l.concat(m);};k.prototype.removeTag=function(l,m){'use strict';var n=this._tagList[l],o=this._originalTagList[l]||{};if(o[m]){this._dirtyPhotosByUid[m]=this._dirtyPhotosByUid[m]||{};this._dirtyPhotosByUid[m][l]=true;}else delete this._dirtyPhotosByUid[m][l];for(var p in n)if(p==m){var q=this._tagList[l][p];delete this._tagList[l][p];if(j(this._tagList[l]))delete this._tagList[l];return q;}};k.prototype.removeTextTag=function(l,m){'use strict';var n=this._textTagList[l];if(!j(n[m])){var o=this._textTagList[l][m];this._textTagList[l][m]=[];if(j(this._textTagList[l]))delete this._textTagList[l];return o;}return [];};k.prototype.removeAllNewTagsOfUser=function(l){'use strict';var m=[];if(!this.userHasDirtyTags(l))return m;var n=this._dirtyPhotosByUid[l];for(var o in n)m=m.concat(this.removeTag(o,l));return m;};k.prototype.removeAllTagsFromPhoto=function(l){'use strict';var m=[];if(!j(this._tagList[l]))for(var n in this._tagList[l]){if(!this._tagList[l].hasOwnProperty(n))continue;m=m.concat(this.removeTag(l,n));}if(!j(this._textTagList[l]))for(var o in this._textTagList[l]){if(!this._textTagList[l].hasOwnProperty(o))continue;m=m.concat(this.removeTextTag(l,o));}return m;};k.prototype.storeTag=function(l,m,n,o,p){'use strict';this.storeTagWithOptions(l,m,n,o,{can_remove:p});};k.prototype.storeTagWithOptions=function(l,m,n,o,p){'use strict';this._dirtyPhotosByUid[m]=this._dirtyPhotosByUid[m]||{};this._dirtyPhotosByUid[m][l]=true;var q={x:n,y:o};Object.assign(q,p);if(!m){this.addTag(this._textTagList,l,q.name,q);}else this.addTag(this._tagList,l,m,q);};k.prototype.loadTagInfo=function(l,m){'use strict';this._tagList[l]={};this._originalTagList[l]={};for(var n=0;n<m.length;n++){var o=m[n];this.addTag(this._tagList,l,o.subject,o);this.addTag(this._originalTagList,l,o.subject,o);}};k.getInstance=function(){'use strict';if(k.instance===null)new k();return k.instance;};k.instance=null;f.exports=k;},null);
__d("PhotosTaggingWaterfall",["AsyncSignal"],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){i._queueName=j||i._queueName;}Object.assign(i,{BEGIN:"begin",TAG_FACE:"tag_face",HOVER_TAG_FACE:"hover_tag_face",SHOW_SUGGEST:"show_suggest",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:'type_name',SELECT_NAME:'select_name',_queueName:null,sendSignal:function(j,k){new h('/ajax/photos/tag_waterfall.php',{data:JSON.stringify(j)}).setHandler(k).send();}});f.exports=i;},null);
__d('Hovercard',['AccessibleLayer','Arbiter','AsyncRequest','ContextualDialog','ContextualDialogXUITheme','ContextualThing','DOM','Event','JSXDOM','LayerAutoFocus','LayerRefocusOnHide','Parent','Style','Vector','clickRefAction','csx','cx','fbt','getInlineBoundingRect'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa={},ba={},ca=null,da=null,ea=null,fa=null,ga=150,ha=700,ia=1000,ja=250,ka=50,la=null,ma=null,na=null,oa=null;function pa(eb){da=eb;if(!qa(eb)){var fb;if(!eb||!(fb=ra(eb))||bb(eb)){ba.moveToken&&ba.moveToken.remove();ba={};return false;}if(ba.node!=eb){ba.moveToken&&ba.moveToken.remove();ba={node:eb,endpoint:fb,pos:null};}}return true;}function qa(eb){return eb&&ca&&ba.node==eb;}function ra(eb){return eb.getAttribute('data-hovercard');}function sa(eb){var fb=n.scry(eb,"^._5jmm ._2orz").length;if(fb)return;if(!eb.leaveToken){var gb=o.listen(eb,'mouseleave',function(){clearTimeout(la);clearTimeout(ma);gb.remove();eb.leaveToken=null;da=null;if(!db.contains(eb))db.hide();});eb.leaveToken=gb;}if(!ba.moveToken)ba.moveToken=o.listen(eb,'mousemove',function(event){ba.pos=u.getEventPosition(event);});clearTimeout(la);clearTimeout(ma);clearTimeout(oa);oa=null;var hb=ga,ib=ca?ja:ha;if(eb.getAttribute('data-hovercard-instant'))hb=ib=ka;la=setTimeout(wa.bind(null,eb),hb);ma=setTimeout(ta.bind(null,eb),ib);}function ta(eb,fb){if(ba.node!=eb)return;var gb=aa[ra(eb)];if(gb){va(gb);}else if(fb){va(za());}else{var hb=ca?ja:ha;na=setTimeout(ta.bind(null,eb,true),ia-hb);}}function ua(){db.hide(true);clearTimeout(ma);}function va(eb){var fb=ba.node,gb=ca,hb=gb!=fb,ib=fb.getAttribute('data-hovercard-position');ib&&eb.setPosition(ib);if(fa){var jb=fa.getContentRoot();if(!m.containsIncludingLayers(jb,fb))fa.hide();}if(!n.contains(document.body,fb)){db.hide(true);return;}ca=fb;fa=eb;eb.setContextWithBounds(fb,z(fb,ba.pos)).show();i.inform('Hovercard/show');if(hb)setTimeout(function(){v('himp',ca,null,'FORCE',{ft:{evt:39}});},0);}function wa(eb){if(eb.id&&aa[eb.id]!=null)return;var fb=ra(eb);if(aa[fb]!=null)return;xa(fb);var gb=function(){db.dirty(fb);ua();};new j(fb).setData({endpoint:fb}).setMethod('GET').setReadOnly(true).setErrorHandler(gb).setTransportErrorHandler(gb).send();}function xa(eb){aa[eb]=false;}function ya(eb){var fb=ba.node.getAttribute('data-hovercard-offset-x')||0;eb.setOffsetX(parseInt(fb,10));var gb=ba.node.getAttribute('data-hovercard-offset-y')||0;eb.setOffsetY(parseInt(gb,10));}var za=function(){if(!ea){ea=new k({width:275,theme:l},p.div({className:"_7lk"},y._("Loading...")));ea.disableBehavior(h).disableBehavior(q).disableBehavior(r);ab(ea);}var eb=ba.node.getAttribute('data-hovercard-position');ea.setPosition(eb);ya(ea);return ea;};function ab(eb){var fb=[eb.subscribe('mouseenter',function(){clearTimeout(oa);oa=null;da=ba.node;}),eb.subscribe('mouseleave',function(){eb.hide();da=null;}),eb.subscribe('destroy',function(){while(fb.length)fb.pop().unsubscribe();fb=null;})];}function bb(eb){return s.bySelector(eb,"._7lu")!==null;}var cb=true,db={hide:function(eb){if(!ca)return;if(eb){clearTimeout(oa);oa=null;if(fa)fa.hide();da=null;ca=null;fa=null;}else{var fb=ba.node.getAttribute('data-hovercard-instant')?ka:ja;if(oa===null)oa=setTimeout(db.hide.bind(null,true),fb);}},setDialog:function(eb,fb){fb.disableBehavior(h).disableBehavior(q).disableBehavior(r);aa[eb]=fb;ab(fb);if(ba.endpoint==eb&&da==ba.node){za().hide();ya(fb);va(fb);}},getDialog:function(eb){return aa[eb];},contains:function(eb){if(fa)return m.containsIncludingLayers(fa.getContentRoot(),eb);return false;},dirty:function(eb){var fb=aa[eb];if(fb){fb.destroy();delete aa[eb];}},dirtyAll:function(){for(var eb in aa){var fb=aa[eb];fb&&db.dirty(eb);}i.inform('Hovercard/dirty');},processNode:function(eb){if(eb&&pa(eb)){sa(eb);return true;}return false;},setDirtyAllOnPageTransition:function(eb){cb=eb;},getLoadingDelay:function(){return ia;},getHideDelay:function(){return ja;}};(function(){o.listen(window,'scroll',function(){if(ca&&t.isFixed(ca))db.hide(true);});i.subscribe('page_transition',function(){ua();cb&&db.dirtyAll();},i.SUBSCRIBE_NEW);})();f.exports=db;},null);
__d('PhotoTagger',['Arbiter','AsyncRequest','CSS','DOM','DOMQuery','Event','FaceboxSourceConstants','Hovercard','Keys','Parent','PhotosConst','PhotosTaggingWaterfall','PhotosUtils','PhotoTagStore','Style','URI','Vector','AsyncResponse','csx','getElementPosition','removeFromArray'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){if(c.__markCompiled)c.__markCompiled();function ca(ea,fa){return (ea%fa+fa)%fa;}function da(ea){'use strict';this.viewer=ea;this.version=ea.getVersionConst();this.datasources={};this.photoData={};this.tagRects={};this.ajaxURIs={tagsInit:'/ajax/photos/photo/tags/tags_init.php',tagsAlbum:'/ajax/photos/photo/tags/tags_album.php',fetchDatasource:'/ajax/photos/photo/tags/fetch_datasource.php',tagAction:'/ajax/photo_tagging_ajax.php',tagWithAction:'/ajax/with_tagging_ajax.php'};this.recognizedUsers=[];this.addedSuggestions=[];this.featuredSuggestions=[];this.albumSuggestions=[];this.friendSuggestions=[];this.suggestionAlbum=-1;da.instances[this.version]=this;}da.prototype.initSnowlift=function(ea,fa,ga){'use strict';this._init(ea,fa,ga,this.viewer.container);};da.prototype.initPermalink=function(ea,fa,ga){'use strict';this._init(ea,fa,ga,this.viewer.actionList);};da.prototype._init=function(ea,fa,ga,ha){'use strict';this.root=this.viewer.getRoot();this.tagger=ea;this.tokenizer=fa;this._qn=null;this.typeahead=fa.getTypeahead();this.userId=ga;this.makeProfilePicMenuContainer=ha;this.faceboxes=[];this.tags=[];this.currentFacebox=null;this.revokedFaceboxes=[];this.requestFaceboxNextTag=false;this.clickState=k.find(this.root,'div.stageActions');this.newTagBox=k.find(this.clickState,'div.newTagBox');this.addTagLink=k.find(this.root,this.elemNames[this.version].addTagLink);this.overlayActions=k.find(this.root,this.elemNames[this.version].overlayActions);this.setupHandlers();this.hideNewTagTimer=null;this.needAlbumSuggestionsFetch=true;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());this.updateFaceboxes();this.tagAccumulating=false;return this;};da.prototype.setTagAccumulator=function(ea){'use strict';this.tagAccumulating=ea;};da.prototype.fetchTaggingSuggestions=function(ea){'use strict';var fa=new w(this.ajaxURIs.tagsInit).setSubdomain('www');new i().setAllowCrossPageTransition(true).setAllowCrossOrigin(true).setURI(fa).setData(ea).setOption('retries',1).setHandler((function(ha){var ia=ha.getPayload();this.featuredSuggestions=ia.featuredTaggees;this.friendSuggestions=ia.friendTaggees;this.updateTypeaheadSuggestions();}).bind(this)).send();var ga=this.typeahead.subscribe('bootstrap',(function(ha,ia){if(ia&&!ia.bootstrapping){if(this.taggingMode)this.updateWithSuggestions();this.typeahead.unsubscribe(ga);this.typeahead.subscribe('focus',(function(){if(this.taggingMode)this.updateWithSuggestions();}).bind(this));this.typeahead.subscribe('click',(function(){if(!this.taggingMode)this.updateWithSuggestions();}).bind(this));this.tokenizer.subscribe('removeToken',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('addToken',this.addSuggestion.bind(this));this.typeahead.subscribe('respond',(function(ja,ka){if(this.taggingMode&&ka&&!ka.results.length)this.updateWithSuggestions();}).bind(this));}}).bind(this));};da.prototype.fetchAlbumTaggingSuggestions=function(){'use strict';new i().setURI(this.ajaxURIs.tagsAlbum).setData({cachedAlbum:this.suggestionAlbum,photo:this.photoData.fbid}).setOption('retries',1).setAllowCrossPageTransition(true).setHandler((function(ea){this.needAlbumSuggestionsFetch=false;var fa=ea.getPayload();if(fa.length===0)return;this.suggestionAlbum=fa.album;this.albumSuggestions=fa.taggees;this.updateTypeaheadSuggestions();}).bind(this)).send();};da.prototype.resetAlbumTaggingSuggestions=function(){'use strict';this.needAlbumSuggestionsFetch=true;this.updateTypeaheadSuggestions();};da.prototype.updateTypeaheadSuggestions=function(){'use strict';this.typeahead.getView().setSuggestions(this.addedSuggestions.concat(this.recognizedUsers,this.featuredSuggestions,this.needAlbumSuggestionsFetch?[]:this.albumSuggestions,this.friendSuggestions));};da.prototype.saveClickPosition=function(ea,fa){'use strict';var ga=x.getElementPosition(ea),ha=x.getElementDimensions(ea);this.clickPercentToPhoto=new x((fa.x-ga.x)/ha.x,(fa.y-ga.y)/ha.y);};da.prototype.getCalculatedClickPosition=function(ea){'use strict';var fa=x.getElementPosition(ea),ga=x.getElementDimensions(ea);if(ga.x===0||ga.y===0)return null;return new x(this.clickPercentToPhoto.x*ga.x+fa.x,this.clickPercentToPhoto.y*ga.y+fa.y,'document');};da.prototype.repositionTagger=function(){'use strict';if(this.clickPercentToPhoto){var ea=this.viewer.getImage(),fa=this.getCalculatedClickPosition(ea);if(!fa)return;this.addTagFromClickPos(fa);}};da.prototype.setupHandlers=function(){'use strict';this.handlers=[m.listen(this.clickState,'click',this.addTag.bind(this)),m.listen(this.addTagLink,'click',this.checkActions.bind(this)),m.listen(this.overlayActions,'click',this.checkActions.bind(this))];m.listen(document.documentElement,'keydown',(function(event){if(!this.taggingMode)return;var ea=m.getKeyCode(event);if(ea===p.ESC){this.deactivateTagging();}else if(ea===p.TAB)this.addNextTagFromFacebox(event.shiftKey?-1:1);}).bind(this));this.subscriptions=[h.subscribe(this.viewer.getEventString('PAGE'),this.restartTagging.bind(this)),h.subscribe(this.viewer.getEventString('DATA_CHANGE'),this.setPhotoData.bind(this)),h.subscribe(this.viewer.getEventString('EXTRA_DATA_CHANGE'),this.setExtraData.bind(this)),h.subscribe(this.viewer.getEventString('CLOSE'),this.deactivateTagging.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};da.prototype.updateWithSuggestions=function(ea,fa){'use strict';var ga=this.typeahead.getData().buildUids(' ',this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!ga.length)return;var ha=this.typeahead.getData().respond('',ga);for(var ia=0;ia<ha.length;ia++)ha[ia].index=-1000+ia;};da.prototype.addSuggestion=function(ea,fa){'use strict';var ga=fa.info&&fa.info.uid;if(ga){this.addedSuggestions.unshift(ga);this.updateTypeaheadSuggestions();}};da.prototype.setQueueName=function(ea){'use strict';this._qn=ea;return this;};da.prototype._sendWaterfallLogSignal=function(ea){'use strict';s.sendSignal({qn:this._qn,source:this.viewer.getSourceString(),step:ea,pid:this.photoData.pid});};da.prototype._sendFaceboxSuggestionLogSignal=function(ea,fa){'use strict';s.sendSignal({step:s.SHOW_SUGGEST,photo_owner:this.photoData.owner,tagee:ea,is_first:true,source:fa});};da.prototype._bumpQueueName=function(){'use strict';if(this._qn)this._qn+=1;};da.prototype.activateTagging=function(){'use strict';h.inform('PhotoTagger.ACTIVATE_TAGGING');if(this.getDataSource()){this.dataSourceFetched(this.getDataSource());}else new i(this.ajaxURIs.fetchDatasource).setData({fbid:this.photoData.fbid,version:this.version}).send();if(this.needAlbumSuggestionsFetch)this.fetchAlbumTaggingSuggestions();};da.prototype.restartTagging=function(){'use strict';this.hideNewTag();this.hideTagger();this.revokedFaceboxes=[];this.setCurrentFacebox(null);if(this.taggingMode){this.requestFaceboxNextTag=true;this.activateTagging();}};da.prototype.getDataSource=function(){'use strict';return this.datasources[this.getDataSourceKey()];};da.prototype.getDataSourceKey=function(){'use strict';if(this.photoData.ownertype=='user'&&!this.photoData.obj_id)return 'friends';return this.photoData.obj_id||this.photoData.owner;};da.prototype.setDataSource=function(ea){'use strict';if(this.typeahead.getData()!=ea)this.typeahead.swapData(ea);this.datasources[this.getDataSourceKey()]=ea;};da.prototype.dataSourceFetched=function(ea){'use strict';this.taggingMode=true;j.addClass(this.root,'taggingMode');this._hidePivots();h.inform('PhotoTagger.ACTIVATED_TAGGING');this._bumpQueueName();this._sendWaterfallLogSignal(s.BEGIN);this.setDataSource(ea);};da.prototype.deactivateTagging=function(){'use strict';if(this.taggingMode===true)this._sendWaterfallLogSignal(s.FINISH);this.taggingMode=false;this.hideNewTag();this.hideTagger();this.setCurrentFacebox(null);this._showPivots();j.removeClass(this.root,'taggingMode');h.inform('PhotoTagger.DEACTIVATED_TAGGING');};da.prototype._hidePivots=function(){'use strict';var ea=l.scry(this.root,'.tag');for(var fa=0;fa<ea.length;fa++)j.hide(ea[fa]);};da.prototype._showPivots=function(){'use strict';var ea=l.scry(this.root,'.tag');for(var fa=0;fa<ea.length;fa++)j.show(ea[fa]);};da.prototype.checkActions=function(event){'use strict';var ea=event.getTarget();if(q.byClass(ea,'fbPhotosPhotoActionsTag'))if(this.taggingMode){this.deactivateTagging();}else{this.activateTagging();this.addNextTagFromFacebox(1);}};da.prototype.hideTagger=function(){'use strict';j.hide(this.tagger);this.clickPercentToPhoto=null;var ea=k.scry(this.tagger,'input.textInput')[0];if(ea)ea.blur();};da.prototype.showTagger=function(){'use strict';var ea=k.find(this.tagger,'.typeaheadContainer'),fa=k.find(ea,'.arrow .nub'),ga=3;v.set(ea,'margin-left',0);v.set(fa,'margin-left',0);var ha=aa(ea);j.show(this.tagger);if(ha.x<=0)if(!j.hasClass(this.tagger,'fbPhotoTaggerFlipped')){v.set(ea,'margin-left',-2*ha.x+'px');v.set(fa,'margin-left',ha.x-ga+'px');}setTimeout((function(){k.find(this.tagger,'input.textInput').focus();}).bind(this),0);this.hideNewTag();h.inform('reflow');};da.prototype.showNewTag=function(ea){'use strict';if(!this.newTagBox)return;k.setContent(k.find(this.newTagBox,'div.tagName'),k.create('span',null,ea));j.show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3000);};da.prototype.hideNewTag=function(){'use strict';if(!this.newTagBox)return;if(this.hideNewTagTimer!==null){clearTimeout(this.hideNewTagTimer);this.hideNewTagTimer=null;}j.hide(this.newTagBox);};da.prototype.getTaggerPositioningOrigin=function(){'use strict';return x.getElementPosition(this.clickState,'document');};da.prototype.setClickPosAndFacebox=function(ea){'use strict';var fa=this.viewer.getImage();this.saveClickPosition(fa,ea);var ga=t.absoluteToNormalizedPosition(fa,ea);this.setCurrentFacebox(this.findNearestFacebox(ga));};da.prototype.addTagFromClickPos=function(ea){'use strict';if(this.currentFacebox){this.addTagFromFaceboxDontSave(this.currentFacebox);}else{this.removeSuggestionFromTagger();j.removeClass(k.find(this.tagger,'.faceBox'),'faceBoxHidden');this.addTagFromPosition(ea,this.TAG_BOX_SIZE);}};da.prototype.addTag=function(event){'use strict';var ea=event.getTarget(),fa=q.byClass(ea,'fbPhotosPhotoButtons');if(!this.taggingMode||fa&&ea!==fa||q.byClass(ea,'fbPhotosPhotoActions')||q.byClass(ea,'faceboxSuggestion')||q.byClass(ea,'photoTagTypeahead'))return;var ga=x.getEventPosition(event);this.setClickPosAndFacebox(ga);this.addTagFromClickPos(ga);};da.prototype._findNearest=function(ea,fa){'use strict';var ga=Infinity,ha=null;ea.forEach(function(ia){if(ia.rect.contains(fa)){var ja=fa.distanceTo(ia.rect.getCenter());if(ja<ga){ga=ja;ha=ia;}}});return ha;};da.prototype.findNearestFacebox=function(ea){'use strict';return this._findNearest(this.faceboxes,ea);};da.prototype.findNearestTag=function(ea){'use strict';return this._findNearest(this.tags,ea);};da.prototype.addNextTagFromFacebox=function(ea){'use strict';if(this.faceboxes.length===0)return;if(!this.currentFacebox){this.setCurrentFacebox(this.faceboxes[0]);}else{var fa=this.faceboxes.indexOf(this.currentFacebox),ga=ca(fa+ea,this.faceboxes.length);if(ga===fa)return;this.setCurrentFacebox(this.faceboxes[ga]);}this.addTagFromFacebox(this.currentFacebox);};da.prototype.addTagFromFaceboxDontSave=function(ea){'use strict';j.addClass(ea.node,'active');j.addClass(k.find(this.tagger,'.faceBox'),'faceBoxHidden');var fa=ea.rect.getCenter(),ga=this.viewer.getImage(),ha=t.normalizedToAbsolutePosition(ga,fa),ia=ea.rect.w()/100*x.getElementDimensions(ga).x;if(ea.rect.w()>this.HUGE_FACE_THRESH&&ea.rect.h()>this.HUGE_FACE_THRESH)ia*=this.HUGE_FACE_SHRINK_FACTOR;var ja=this.getFaceboxSuggestionFromFaceboxElem(ea.node);if(ja){var ka=this.version===r.VIEWER_PERMALINK?n.PERMALINK_DISMISS:n.SNOWLIFT_DISMISS;this.addSuggestionToTagger(ea,ja);this._sendFaceboxSuggestionLogSignal(ja.getAttribute('data-id'),ka);}else this.removeSuggestionFromTagger();this.addTagFromPosition(ha,ia);return ha;};da.prototype.getFaceboxSuggestionFromFaceboxElem=function(ea){'use strict';return k.scry(ea,"._570u")[0];};da.prototype.addSuggestionToTagger=function(ea,fa){'use strict';this.removeSuggestionFromTagger();j.addClass(this.tagger,'suggestionActive');var ga=k.find(this.tagger,'.typeaheadContainer'),ha=fa.cloneNode(true);this.stripReactID(ha);k.appendContent(ga,ha);this.setupFaceboxSuggestionHandlers(ea,ha);};da.prototype.stripReactID=function(ea){'use strict';ea.removeAttribute('data-reactid');for(var fa=0;fa<ea.children.length;fa++)this.stripReactID(ea.children[fa]);};da.prototype.removeSuggestionFromTagger=function(){'use strict';j.removeClass(this.tagger,'suggestionActive');var ea=k.scry(this.tagger,'.faceboxSuggestion');ea&&ea.forEach(function(fa){k.remove(fa);});};da.prototype.dismissFaceboxSuggestion=function(ea,fa,ga,ha){'use strict';new i().setURI('/ajax/dismiss_tag_suggest.php').setMethod('POST').setData({facebox_logs:[{facebox:ea,log_data:{photo_owner:ga,tagee:fa,is_first:true}}],closing_source:ha,closing_action:'no'}).setAllowCrossPageTransition(true).send();};da.prototype.addTagFromFacebox=function(ea){'use strict';var fa=this.addTagFromFaceboxDontSave(ea),ga=this.viewer.getImage();this.saveClickPosition(ga,fa);};da.prototype.addTagFromPosition=function(ea,fa){'use strict';var ga=this.viewer.getImage(),ha=this.calcTaggerPosition(ga,ea,fa);this.calcClickPoint(ga,ea);if(!ha){this.hideTagger();return;}ha.setElementPosition(this.tagger);if(this.newTagBox){ha.setElementPosition(this.newTagBox);new x(fa,fa).setElementDimensions(this.newTagBox);}var ia=x.getElementPosition(ga),ja=x.getElementDimensions(ga),ka=this.typeahead.getView();if(ea.y>ia.y+ja.y*3/4){j.addClass(this.tagger,'fbPhotoTaggerFlipped');ka.addTypeaheadFlip('fbPhotoTaggerFlipped');if(ea.x>ia.x+ja.x*1/2){this.flipRules('fbPhotoTaggerRight','fbPhotoTaggerLeft',ka);}else this.flipRules('fbPhotoTaggerLeft','fbPhotoTaggerRight',ka);}else{j.removeClass(this.tagger,'fbPhotoTaggerFlipped');j.removeClass(this.tagger,'fbPhotoTaggerLeft');j.removeClass(this.tagger,'fbPhotoTaggerRight');ka.removeTypeaheadFlip('fbPhotoTaggerFlipped');ka.removeTypeaheadFlip('fbPhotoTaggerLeft');ka.removeTypeaheadFlip('fbPhotoTaggerRight');}this.showTagger();if(this.taggingMode){this._sendWaterfallLogSignal(s.TAG_FACE);}else this._sendWaterfallLogSignal(s.HOVER_TAG_FACE);};da.prototype.flipRules=function(ea,fa,ga){'use strict';j.addClass(this.tagger,ea);j.removeClass(this.tagger,fa);ga.addTypeaheadFlip(ea);ga.removeTypeaheadFlip(fa);};da.prototype.calcTaggerPosition=function(ea,fa,ga,ha){'use strict';ha=ha||ga;var ia=x.getElementPosition(ea),ja=x.getElementDimensions(ea),ka=new x(ga/2,ha/2),la=fa.sub(ia);for(var ma in {x:1,y:1}){if(fa[ma]<ia[ma]||fa[ma]>ia[ma]+ja[ma])return null;var na=ma==='x'?ga:ha;if(la[ma]<na/2){ka[ma]=la[ma];}else if(ja[ma]<la[ma]+na/2)ka[ma]=na-(ja[ma]-la[ma]);}var oa=3,pa=k.find(this.tagger,'.faceBox');v.set(pa,'width',ga-oa*2+'px');v.set(pa,'height',ha-oa*2+'px');var qa=fa.sub(this.getTaggerPositioningOrigin());return qa.sub(ka.x,ka.y);};da.prototype.calcClickPoint=function(ea,fa){'use strict';var ga=x.getElementDimensions(ea),ha=x.getElementPosition(ea),ia=fa.sub(ha);this.clickPoint={x:ia.x/ga.x,y:ia.y/ga.y};};da.prototype.getTaggingDataForSave=function(ea,fa){'use strict';var ga=this.getTaggingData('add',ea.isFreeform()?'':ea.getValue(),ea.getText(),fa);ga.x=this.clickPoint.x*100;ga.y=this.clickPoint.y*100;ga.from_facebox=!!this.currentFacebox;ga.tagging_mode=!!this.taggingMode;return ga;};da.prototype.saveTag=function(ea,fa,ga){'use strict';var ha=this.getTaggingDataForSave(fa,ga);if(this.tagAccumulating){u.getInstance().storeTagWithOptions(this.photoData.fbid,ha.subject,ha.x,ha.y,ha);}else new i().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(ha).setAllowCrossPageTransition(true).setHandler(this.tagsChangeHandler.bind(this)).setErrorHandler(this.checkError.bind(this,fa)).send();var ia=this.userId===ha.subject;if(ia){var ja=k.scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(ja.length===1){var ka=ja[0];j.removeClass(ka,'hide');}}this.showNewTag(fa.getText());this.hideTagger();var la=this.currentFacebox;if(la){if(this.taggingMode)this.addNextTagFromFacebox(1);this.removeFacebox(la);}h.inform('PhotoTagger.ADDING_TAG',{subject:ha.subject,text:fa.getText()});h.inform('PhotoTagger.SAVE_TAG',{photo_fbid:this.photoData.fbid,self_tag:ia});};da.prototype.getTaggingData=function(ea,fa,ga,ha){'use strict';return {cs_ver:this.version,pid:this.photoData.pid,fbid:this.photoData.fbid,id:this.photoData.owner,subject:fa,name:ga,action:ea,source:ha?ha:this.viewer.getSourceString(),qn:this._qn,position:this.getPosition(),slsource:this.viewer.getViewerSource(),slset:this.viewer.getViewerSet()};};da.prototype.getPosition=function(){'use strict';return this.viewer.getPosition();};da.prototype.tagsChangeHandler=function(ea){'use strict';};da.prototype.checkError=function(ea,fa){'use strict';if(fa.getPayload()&&fa.getPayload().clear_tag){ea.already_untagged=true;this.tokenizer.removeToken(ea);}y.defaultErrorHandler(fa);};da.prototype.removeTag=function(ea,fa,ga){'use strict';if(fa.already_untagged)return;var ha='remove';if(k.scry(fa.element,'a.pending')[0])ha='retract';if(fa.blockUser)ha='remove_block';if(this.tagAccumulating){if(fa.isFreeform()){u.getInstance().removeTextTag(this.photoData.fbid,fa.getInfo().text);}else u.getInstance().removeTag(this.photoData.fbid,fa.getInfo().uid);}else new i().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(this.getTaggingData(ha,fa.isFreeform()?'':fa.getInfo().uid,fa.getInfo().text)).setHandler((function(ka){this.tagsChangeHandler(ka);ga&&ga();}).bind(this)).setAllowCrossPageTransition(true).send();if(this.userId===parseInt(fa.getValue(),10)&&this.userId!==this.viewer.getCurrentPhotoInfo().owner){var ia=k.scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(ia.length===1){var ja=ia[0];j.addClass(ja,'hide');}h.inform('PhotoTagger.REMOVED_MAKE_PROFILE_PIC_OPTION');}};da.prototype.removeTagByID=function(ea,fa,ga){'use strict';var ha=this.tokenizer.tokens;for(var ia=0;ia<ha.length;ia++)if(ha[ia].info.uid==fa)return this.removeTag(null,ha[ia],ga);};da.prototype.removeTagByIDFromHovercardLink=function(ea,fa,ga){'use strict';this.removeTagByID(ea,fa,function(){if(o.contains(ga))o.hide(true);});};da.prototype.removeWithTag=function(ea,fa){'use strict';new i().setURI(this.ajaxURIs.tagWithAction).setMethod('POST').setData({action:'remove_with',taggee:fa,tag:ea,version:this.version,fbid:this.photoData.fbid}).setHandler((function(ga){this.tagsChangeHandler(ga);o.hide(true);}).bind(this)).setAllowCrossPageTransition(true).send();};da.prototype.setPhotoData=function(ea,fa){'use strict';this.clickPercentToPhoto=null;this.photoData=fa;return this;};da.prototype.setExtraData=function(ea,fa){'use strict';this.tagRects=fa.tagRects;this.updateFaceboxes();this._setInitialFaceboxFromID(fa);if(fa.openTag)setTimeout((function(){this.activateTagging();this._setInitialFaceboxFromID(fa);if(this.faceboxes.length===1){this.addTagFromFacebox(this.currentFacebox);}else this.addNextTagFromFacebox(1);}).bind(this),0);return this;};da.prototype._setInitialFaceboxFromID=function(ea){'use strict';if(ea.initialFaceboxID!==null&&this.faceboxes.length!==0){var fa=this.getFacebox(ea.initialFaceboxID);if(fa!==null){var ga=this.faceboxes.indexOf(fa);ga=ca(ga-1,this.faceboxes.length);this.setCurrentFacebox(this.faceboxes[ga]);}}};da.prototype.markTagAsSpam=function(ea,fa){'use strict';new i().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(this.getTaggingData('mark_as_spam',fa,null)).send();};da.prototype.removeFacebox=function(ea){'use strict';if(ea===null)return;this.revokedFaceboxes.push(ea.rect.getCenter());ba(this.faceboxes,ea);k.remove(ea.node);if(ea===this.currentFacebox)this.setCurrentFacebox(null);};da.prototype.setCurrentFacebox=function(ea){'use strict';if(this.currentFacebox)j.removeClass(this.currentFacebox.node,'active');this.currentFacebox=ea;if(ea){this.recognizedUsers=JSON.parse(ea.node.getAttribute('data-recognizeduids'));this.updateTypeaheadSuggestions();}};da.prototype.updateRevokedFaceboxes=function(){'use strict';this.revokedFaceboxes=this.revokedFaceboxes.filter((function(ea){for(var fa=0;fa<this.faceboxes.length;++fa){var ga=this.faceboxes[fa],ha=ea.distanceTo(ga.rect.getCenter());if(ha<this.EPSILON)return true;}return false;}).bind(this));this.revokedFaceboxes.forEach((function(ea){var fa=this.findNearestFacebox(ea);ba(this.faceboxes,fa);k.remove(fa.node);}).bind(this));};da.prototype.updateFaceboxes=function(){'use strict';this.faceboxes=[];this.tags=[];for(var ea in this.tagRects){var fa;if(t.isFacebox(ea)){fa=this.faceboxes;}else if(t.isTag(ea))fa=this.tags;if(fa){var ga='container';if(this.version===r.VIEWER_PERMALINK)ga='root';var ha=k.scry(this.viewer[ga],'#'+ea);if(ha.length>0)fa.push({node:ha[0],id:ea,rect:this.tagRects[ea]});}}this.updateRevokedFaceboxes();this.faceboxes.sort(function(ja,ka){return ja.rect.getCenter().x-ka.rect.getCenter().x;});if(this.currentFacebox){var ia=this.currentFacebox.rect.getCenter();this.setCurrentFacebox(this.findNearestFacebox(ia));j.addClass(this.currentFacebox.node,'active');}if(this.requestFaceboxNextTag){this.addNextTagFromFacebox(1);this.requestFaceboxNextTag=false;}};da.prototype.getFacebox=function(ea){'use strict';for(var fa=0;fa<this.faceboxes.length;++fa)if(this.faceboxes[fa].id===ea)return this.faceboxes[fa];return null;};da.prototype.setupFaceboxSuggestionHandlers=function(ea,fa){'use strict';var ga=k.find(fa,"a._570w"),ha=k.find(fa,"a._570x");this.handlers.push(m.listen(ga,'click',(function(ia){var ja=this._getCurrentFaceboxID(),ka=this.version===r.VIEWER_PERMALINK?n.PERMALINK_DISMISS:n.SNOWLIFT_DISMISS;this.dismissFaceboxSuggestion(ea.id.replace('face:',''),fa.getAttribute('data-id'),this.photoData.owner,ka);this.removeSuggestionFromTagger();this.hideTagger();k.remove(this.getFaceboxSuggestionFromFaceboxElem(ea.node));h.inform('PhotoTagger.TAG_SUGGESTION_REJECTED/'+ja);}).bind(this)),m.listen(ha,'click',(function(ia){var ja=this._getCurrentFaceboxID(),ka={uid:fa.getAttribute('data-id'),text:fa.getAttribute('data-text')},la=this.tokenizer.createToken(ka),ma=this.version===r.VIEWER_PERMALINK?n.PERMALINK_SUGGEST:n.SNOWLIFT_SUGGEST;this.saveTag(null,la,ma);h.inform('PhotoTagger.TAG_SUGGESTION_CONFIRMED/'+ja);}).bind(this)));};da.prototype._getCurrentFaceboxID=function(){'use strict';return this.currentFacebox&&this.currentFacebox.id.substring(5);};da.getInstance=function(ea){'use strict';return da.instances[ea];};da.resetAlbumTaggingSuggestions=function(ea){'use strict';var fa=da.getInstance(ea);fa&&fa.resetAlbumTaggingSuggestions();};Object.assign(da,{instances:{}});Object.assign(da.prototype,{TAG_BOX_SIZE:100,EPSILON:.0025,HUGE_FACE_THRESH:90,HUGE_FACE_SHRINK_FACTOR:.6,elemNames:{6:{addTagLink:'div.fbPhotosPhotoOwnerButtons',overlayActions:'div.snowliftOverlayBar'}}});f.exports=da;},null);
__d('PhotoPermalink',['$','Arbiter','Assert','AsyncRequest','Bootloader','CSS','DOM','Event','KeyEventController','Keys','PageTransitions','Parent','PhotoPermalinkURI','PhotosConst','PhotoSessionLog','PhotoStreamCache','PhotosUtils','PhotoTagger','PhotoTagSearchPivotLogger','PhotoViewer','PhotoWarningScreen','PhotoWarningScreenMixin','Scroll','Style','Vector','classWithMixins','csx','emptyFunction','ge','goURI','mixin','PhotoWarningScreenConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){if(c.__markCompiled)c.__markCompiled();var ma,na,oa=c('PhotoWarningScreenConfig').GraphicEvents;ma=babelHelpers.inherits(pa,ga(aa,la(ca)));na=ma&&ma.prototype;function pa(){'use strict';na.constructor.call(this);this._uriStack=[];this.replaceUrl=false;this.payloadInitialized=false;this._seenTags={};}pa.prototype.init=function(qa){'use strict';this.stream=new w();this.stream.init(u.VIEWER_PERMALINK,'PhotoViewerPagelet','pagelet_photo_viewer');this.reset();this.root=h('fbPhotoPageContainer');this.header=h('fbPhotoPageHeader');this.stageWrapper=n.find(this.root,'.stageContainer');this.videoStage=n.find(this.stageWrapper,'div.videoStage');this.buttonActions=n.find(this.root,'div.stageButtons');this.viewLargerLink=n.scry(this.root,'a.fbPhotoViewLarger').pop();this.feedback=ja('fbPhotoPageFeedback');this.image=ja('fbPhotoImage');this.errorBox=ja('fbPhotoPageError');this.actionList=ja('fbPhotoPageActions');this.stageActions=n.find(this.root,'div.stageActions');this.photoContentContainer=h('fbxPhotoContentContainer');this.photoImageStage=n.find(this.root,'.fbPhotoImageStage');this.existingPhotoWarning=n.scry(this.root,"._2v00").pop();this.initGraphicWarningDOM(this.existingPhotoWarning||qa.graphic_warning_markup);this._canSeeGraphicWarning=!!qa.can_see_graphic_warning;this.showingTypeaheadSuggestions=false;this.loadingStates={image:false,html:false};this.unhiliteTimer=null;this.source=null;if(this.image)this.imageLoadListener=o.listen(this.image,'load',this.adjustForNewData.bind(this));this.pageHandlers=[o.listen(this.root,'mouseout',this.mouseOutListener.bind(this)),o.listen(this.root,'mousemove',this.mouseMoveListener.bind(this)),o.listen(this.stageWrapper,'click',this.stageClickListener.bind(this)),o.listen(this.buttonActions,'click',this.buttonListener.bind(this)),o.listen(this.actionList,'click',this.rotateListener.bind(this)),o.listen(this.feedback,'click',(function(event){var ra=event.getTarget();if(s.byClass(ra,'like_link')||s.byClass(ra,'UFILikeLink')&&s.byClass(ra,'UIActionLinks'))m.toggleClass(n.find(this.buttonActions,'div.likeCommentGroup'),'viewerLikesThis');}).bind(this))];r.registerHandler(this.transitionHandler.bind(this));p.registerKey('LEFT',this.goNav.bind(this));p.registerKey('RIGHT',this.goNav.bind(this));v.initLogging(v.PERMALINK);this._showHover=qa.pivot_hover;i.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));i.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));this.adjustForNewData();};pa.prototype.getEventPrefix=function(){'use strict';return 'PhotoPermalink';};pa.prototype.getSourceString=function(){'use strict';return 'permalink';};pa.prototype.getViewerSource=function(){'use strict';return this.source;};pa.prototype.getViewerSet=function(){'use strict';return this.stream.getPhotoSet();};pa.prototype.getVersionConst=function(){'use strict';return u.VIEWER_PERMALINK;};pa.prototype.getGraphicWarningContainer=function(){'use strict';return this.photoContentContainer;};pa.prototype.getGraphicWarningHiddenContent=function(){'use strict';return this.photoImageStage;};pa.prototype.saveTagsFromPayload=function(qa){'use strict';this.storeFromData(qa);if('data' in qa&&this.stream.getCursor() in qa.data)this.swapData();};pa.prototype.goNav=function(event){'use strict';var qa=o.getKeyCode(event)||event.getTarget(),ra=event.type==='click'&&s.byClass(qa,'stageWrapper')&&!s.byClass(qa,'tagBoxPending')&&!s.byClass(qa,'tagBoxPendingResponse')&&!s.byClass(qa,'uiButtonGroup');if(ra&&m.hasClass(this.root,'taggingMode'))return false;if(qa==q.LEFT){this.page(-1);}else if(qa==q.RIGHT||ra)this.page(1);return false;};pa.prototype.pagerClick=function(qa){'use strict';if(qa=='prev'){this.page(-1);}else if(qa=='next')this.page(1);return false;};pa.prototype.setLoadingState=function(qa,ra){'use strict';switch(qa){case pa.STATE_IMAGE_DATA:this.loadingStates[qa]=ra;m.conditionClass(this.root,'imageLoading',ra);break;case pa.STATE_HTML:this.loadingStates[qa]=ra;m.conditionClass(this.root,'dataLoading',ra);break;}};pa.prototype.checkState=function(qa){'use strict';if(qa!=pa.STATE_ERROR&&!this.loadingStates[qa])return;switch(qa){case pa.STATE_IMAGE_DATA:var ra=this.stream.getCurrentImageData();if(ra){if(ra.url){this.switchImage(ra.url,true);}else if(ra.video)this.switchVideo(ra.video,true);this.setLoadingState(qa,false);}break;case pa.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(qa,false);}break;default:if(this.stream.errorInCurrent()){if(this.image)m.hide(this.image);m.show(this.errorBox);}break;}};pa.prototype.reHilitePendingTag=function(){'use strict';var qa=ja(this.hilitedTag);if(qa&&m.hasClass(qa,'showPendingTagName'))return;var ra=n.scry(this.root,'div.tagsWrapper div.showPendingTagName')[0];if(ra)this.switchHilitedTags(ra.id);};pa.prototype.setReachedLeftEnd=function(){'use strict';this.stream.setReachedLeftEnd();};pa.prototype.setReachedRightEnd=function(){'use strict';this.stream.setReachedRightEnd();};pa.prototype.isPagingAllowed=function(qa){'use strict';return this.stream.isValidMovement(qa)&&!m.hasClass(this.root,'croppingMode');};pa.prototype.page=function(qa,ra){'use strict';if(!this.isPagingAllowed(qa)||!this.stream.nonCircularPhotoSetCanPage(qa))return;this._seenTags={};this.unhiliteAllTags();var sa=this.getVideoOnStage();if(sa)this.switchVideo(sa,false);this.recacheData();this.stream.moveCursor(qa);if(this.image)m.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(pa.STATE_HTML,true);m.show(this.errorBox);return;}var ta=this.stream.getCurrentImageData();if(ta){if(ta.url){if(qa!==0)if(ta.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();ba.logGraphic(oa.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();ba.logGraphic(oa.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(ta.url,true);if(this.viewLargerLink)this.viewLargerLink.setAttribute('href',ta.info.permalink);}else if(ta.video)this.switchVideo(ta.video,true);if(!ra){this.replaceUrl=true;ka(ta.info.permalink);}}else{this.waitForLoadCount++;this.setLoadingState(pa.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(pa.STATE_HTML,true);i.inform('PhotoPermalink.PAGE');};pa.prototype.transitionHandler=function(qa){'use strict';if(!t.isValid(qa))return false;var ra=qa.getQualifiedURI().toString();if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(ra);r.transitionComplete();return true;}var sa=this._uriStack.length;if(sa>=2&&this._uriStack[sa-2]===ra)this._uriStack.pop();var ta=this.stream.getCursorForURI(qa.getUnqualifiedURI().toString());if(ta){var ua=this.stream.getRelativeMovement(ta);this.page(ua,true);r.transitionComplete();return true;}return false;};pa.prototype.recacheData=function(qa){'use strict';if(!this.loadingStates.html){var ra=this.stream.getCurrentHtml();for(var sa in ra){var ta=ja(sa);if(ta)ra[sa]=Array.from(ta.childNodes);if(qa!==true&&sa!=='fbPhotoPageHeader'&&ta)n.empty(h(sa));}}};pa.prototype.getCurrentPhotoInfo=function(){'use strict';var qa=this.stream.getCurrentImageData();return qa&&qa.info;};pa.prototype.getVideoOnStage=function(){'use strict';var qa=this.stream.getCurrentImageData();return qa&&qa.video;};pa.prototype.switchImage=function(qa,ra){'use strict';m.hide(this.image);m.hide(this.errorBox);var sa=this.stream&&this.stream.getCurrentImageData();if(sa){v.addPhotoView(sa.info);if(this._showHover){var ta=this.stream.getCurrentExtraData();if(ta)z.logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(ta.tagRects));}}var ua=n.create('img',{id:'fbPhotoImage',className:'fbPhotoImage',alt:'',src:qa});n.replace(this.image,ua);this.image=ua;if(this.imageLoadListener)this.imageLoadListener.remove();this.imageLoadListener=o.listen(this.image,'load',this.adjustForNewData.bind(this));if(ra)this.stream.preloadImages();};pa.prototype.switchVideo=function(qa,ra){'use strict';var sa='swf_'+qa;if(ra){m.addClass(this.stageWrapper,'showVideo');this.videoStage.id=qa;if(window[sa]&&!ja(sa))window[sa].write(qa);}else{this.videoStage.id='fbPageVideoStage';window[sa].addVariable('video_autoplay',0);n.empty(this.videoStage);m.removeClass(this.stageWrapper,'showVideo');}};pa.prototype.swapData=function(){'use strict';if(this.dataLoadTimer){this.setLoadingState(pa.STATE_HTML,true);clearTimeout(this.dataLoadTimer);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,true),100);return;}var qa,ra=this.stream.getCurrentHtml();if(ra){for(var sa in ra){var ta=ra[sa];if(Array.isArray(ta)&&ta.length===1&&ta[0]===undefined)continue;qa=ja(sa);qa&&n.setContent(qa,ra[sa]);}i.inform('PhotoPermalink.DATA_CHANGE',this.stream.getCurrentImageData().info,i.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData()){i.inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),i.BEHAVIOR_STATE);var ua=this.stream.getCurrentExtraData();if(ua&&ua.source!==undefined){this.source=ua.source;v.setSource(this.source);}}this.setLoadingState(pa.STATE_HTML,false);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,false),100);}this.adjustForNewData();};pa.prototype.clearTimer=function(qa){'use strict';this.dataLoadTimer=false;qa&&this.swapData();};pa.prototype.adjustForNewData=function(){'use strict';if(!this.image)return;var qa=n.scry(this.stageWrapper,'div.tagsWrapper')[0],ra=fa.getElementDimensions(this.image);if(qa){ea.set(qa,'width',ra.x+'px');ea.set(qa,'height',ra.y+'px');}};pa.prototype.fetchInitBucket=function(qa){'use strict';if(!this.stream.isLoaded())return;this.stream.fetch(qa,true);};pa.prototype.addPhotoFbids=function(qa,ra,sa){'use strict';var ta=this.stream.getCursor()===null;this.stream.attachToFbidsList(qa,ra,sa);if(sa&&ta)this.page(0);};pa.prototype.attachTagger=function(qa){'use strict';n.appendContent(this.stageActions,qa);};pa.prototype.storeFromData=function(qa){'use strict';var ra=this.stream.storeToCache(qa);if('init' in qa){v.setPhotoSet(this.stream.getPhotoSet());v.setLogFbids(true);v.addPhotoView(this.stream.getCurrentImageData().info);if(this._showHover){var sa=this.stream.getCurrentExtraData();if(sa)z.logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(sa.tagRects));}}if('error' in ra){this.checkState(pa.STATE_ERROR);return;}if('image' in ra)this.checkState(pa.STATE_IMAGE_DATA);if('data' in ra)this.checkState(pa.STATE_HTML);if(!this.payloadInitialized&&this.stream.getCurrentExtraData()){this.payloadInitialized=true;i.inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),i.BEHAVIOR_STATE);}};pa.prototype.handleServerError=function(qa,ra){'use strict';n.setContent(this.errorBox,qa);this.storeFromData(ra);};pa.prototype.updateTotalCount=function(qa,ra,sa){'use strict';var ta=ja('fbPhotoPagePositionAndCount');ta&&n.setContent(ta,sa);this.stream.setTotalCount(qa);this.stream.setFirstCursorIndex(ra);};pa.prototype.buttonListener=function(event){'use strict';var qa=event.getTarget();if(s.byClass(qa,'likeButton')){var ra=n.scry(this.feedback,'button.like_link')[0];if(!ra)ra=n.scry(this.feedback,'a.UFILikeLink')[0];ra&&ra.click();}else if(s.byClass(qa,'commentButton')){var sa=n.scry(this.feedback,'div.commentBox textarea')[0];if(!sa)sa=n.scry(this.feedback,'li.UFIAddComment textarea')[0];if(sa){sa.focus();da.setTop(this.root,this.root.scrollHeight);}}};pa.prototype.rotateListener=function(event){'use strict';var qa=event.getTarget();if(s.byClass(qa,'rotateRight')){this.rotate('right');}else if(s.byClass(qa,'rotateLeft'))this.rotate('left');};pa.prototype.stageClickListener=function(event){'use strict';var qa=event.getTarget(),ra=m.hasClass(qa,'faceBox'),sa=s.byClass(qa,'fbPhotoTagApprovalBox')||s.byClass(qa,'faceboxSuggestion')||s.byClass(qa,'videoStage')||s.byClass(qa,'tag')||s.byClass(qa,'typeaheadWrapper')||s.byClass(qa,'photoTagLink')||s.byClass(qa,'photoTagTypeahead')||s.byClass(qa,'fbPhotoViewLarger')||ra;if(ra){if(!this.showingTypeaheadSuggestions){var ta=this.getTagger();ta.updateWithSuggestions();setTimeout((function(){n.find(ta.tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;}if(sa){return true;}else this.goNav(event);};pa.prototype.rotate=function(qa){'use strict';var ra=this.stream.getCursor();if(this.getVideoOnStage()){var sa=qa=='left'?270:90;j.isTruthy(this.videoRotateURI,"Video rotate URI not set.");l.loadModules(["VideoRotate"],(function(ua){new ua(ra,this.videoRotateURI).motionRotate(sa);}).bind(this));return;}var ta=babelHelpers._extends({fbid:ra,opaquecursor:this.stream.getOpaqueCursor(ra),cs_ver:u.VIEWER_PERMALINK},this.stream.getPhotoSetQuery());ta[qa]=1;this.setLoadingState(pa.STATE_IMAGE_DATA,true);m.hide(this.image);new k('/ajax/photos/photo/rotate/').setMethod('POST').setAllowCrossPageTransition(true).setReadOnly(false).setData(ta).setFinallyHandler(this.rotateComplete.bind(this,ra)).send();};pa.prototype.rotateComplete=function(qa,ra){'use strict';if(qa==this.stream.getCursor()){this.setLoadingState(pa.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}};pa.prototype.mouseOutListener=function(event){'use strict';var qa=event.getTarget(),ra=event.getRelatedTarget(),sa=s.byClass(qa,'stageActions'),ta=s.byClass(qa,'stageWrapper'),ua=s.byClass(ra,'stageActions'),va=s.byClass(ra,'stageWrapper'),wa=s.byClass(ra,'uiContextualLayer'),xa=!va&&!wa&&(ta&&!ua)||sa&&!va;if(xa)this.unhiliteAllTags(true);};pa.prototype.mouseMoveListener=function(event){'use strict';var qa=event.getTarget(),ra=s.byClass(qa,'faceboxSuggestion')||s.byClass(qa,'tagPointer')||s.byClass(qa,'typeaheadWrapper')||s.byClass(qa,'photoTagTypeahead')||s.byClass(qa,'arrow');if(!s.byClass(qa,'stageActions')&&!s.byClass(qa,'stageWrapper')||ra)return;this.hiliteTagsOnMouseMove(event);};pa.prototype.unhiliteAllTags=function(qa,event){'use strict';n.scry(this.stageWrapper,'div.tagsWrapper div.hover').forEach(function(sa){if(qa&&m.hasClass(sa,'tagBoxPending'))return;m.removeClass(sa,'hover');});if(qa)return;n.scry(this.stageWrapper,'div.tagsWrapper div.otherActive').forEach(function(sa){m.removeClass(sa,'otherActive');});if(this.unhiliteTimer!==null){clearTimeout(this.unhiliteTimer);this.unhiliteTimer=null;}this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!m.hasClass(this.root,'taggingMode')){var ra=this.getTagger();if(ra){ra.hideTagger();ra.setCurrentFacebox(null);}}};pa.prototype.getTagger=function(){'use strict';return y.getInstance(u.VIEWER_PERMALINK);};pa.prototype.switchHilitedTags=function(qa,ra){'use strict';this.unhiliteAllTags();this.hiliteAllBoxes();var sa=ja(qa);if(sa){this.hilitedTag=qa;if(!m.hasClass(this.root,'taggingMode')&&x.isFacebox(this.hilitedTag)){var ta=this.getTagger();if(ta){m.addClass(sa,'hover');var ua=ta.getFacebox(qa);ta.setCurrentFacebox(ua);if(ua)ta.addTagFromFacebox(ua);}}else m.addClass(sa,'hover');if(m.hasClass(sa,'tagBoxPending')&&!m.hasClass(sa,'showPendingTagName')&&ra===true){n.scry(this.stageWrapper,'div.tagsWrapper div.showPendingTagName').forEach(function(va){m.removeClass(va,'showPendingTagName');});m.addClass(sa,'showPendingTagName');}}};pa.prototype.hiliteTagsOnMouseMove=function(event){'use strict';if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.unhiliteTimer!==null)return;var qa=event.getTarget();if(s.byClass(qa,'fbPhotoPageTagApproval')||s.byClass(qa,'tagPointer'))return;var ra=s.byClass(qa,'tagBoxPending'),sa=false;if(this.hilitedTag){var ta=ja(this.hilitedTag);sa=ta&&m.hasClass(ta,'tagBoxPending');}var ua=!this.hilitedTag&&ra||!sa&&ra;if(ua){this.switchHilitedTags(ra.id);return;}if(ra&&ra.id==this.hilitedTag)return;var va=250,wa=x.absoluteToNormalizedPosition(this.image,fa.getEventPosition(event)),xa=x.getNearestBox(this.stream.getCurrentExtraData().tagRects,wa);if(!xa){if(!sa){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var ya=null;if(sa){var za={};za[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];ya=x.getNearestBox(za,wa);}if(ya!==null&&sa)return;if(this.hilitedTag!=xa)if(sa){this.unhiliteTimer=setTimeout(this.unhiliteAllTags.bind(this,false,event),va);}else{if(this._showHover&&!this._seenTags[xa]){this._seenTags[xa]=true;z.logPivotImpression('permalnk','pivot_impression',xa);}this.switchHilitedTags(xa);}};pa.prototype.updateTagBox=function(qa,ra){'use strict';this.unhiliteAllTags();var sa=ja(qa);if(!sa)return;m.addClass(sa,'tagBox');m.addClass(sa,'tagBoxPendingResponse');m.removeClass(sa,'tagBoxPending');m.hide(n.find(sa,'span.tagForm'));if(ra){m.show(n.find(sa,'span.tagApproved'));}else m.show(n.find(sa,'span.tagIgnored'));};pa.prototype.reset=function(){'use strict';while(this.pageHandlers&&this.pageHandlers.length)this.pageHandlers.pop().remove();if(this.imageLoadListener){this.imageLoadListener.remove();this.imageLoadListener=null;}p.getInstance().resetHandlers();};pa.prototype.onHiliteTag=function(qa,ra){'use strict';if(ra.version!=u.VIEWER_PERMALINK)return;var sa=ra.tag;if(sa){this.switchHilitedTags(sa,true);}else this.unhiliteAllTags();};pa.prototype.onUpdateTagBox=function(qa,ra){'use strict';if(ra.version==u.VIEWER_PERMALINK)this.updateTagBox(ra.id,ra.approve);};pa.prototype.setHasLocation=function(qa){'use strict';m.conditionClass(this.root,'hasLocation',qa);};pa.getInstance=function(){'use strict';if(!pa._instance)pa._instance=new pa();return pa._instance;};pa.addPhotoFbids=function(qa,ra,sa){'use strict';pa.getInstance().addPhotoFbids(qa,ra,sa);};pa.setReachedLeftEnd=function(){'use strict';pa.getInstance().setReachedLeftEnd();};pa.setReachedRightEnd=function(){'use strict';pa.getInstance().setReachedRightEnd();};pa.attachTagger=function(qa){'use strict';pa.getInstance().attachTagger(qa);};pa.disableAjaxPipeForVideo=function(){'use strict';var qa=pa.getInstance();if(qa.stream)qa.stream.setUseAjaxPipe(false);};pa.init=function(qa){'use strict';pa.getInstance().init(qa||{});};pa.recacheData=function(qa){'use strict';pa.getInstance().recacheData(qa);};pa.saveTagsFromPayload=function(qa){'use strict';pa.getInstance().saveTagsFromPayload(qa);};pa.saveTagsFromPayloadDelayed=function(qa){'use strict';setTimeout(pa.saveTagsFromPayload.bind(null,qa),2000);};pa.handleServerError=function(qa,ra){'use strict';pa.getInstance().handleServerError(qa,ra);};pa.setHasLocation=function(qa){'use strict';pa.getInstance().setHasLocation(qa);};pa.storeFromData=function(qa){'use strict';pa.getInstance().storeFromData(qa);};pa.swapData=function(){'use strict';pa.getInstance().swapData();};pa.updateTotalCount=function(qa,ra,sa){'use strict';pa.getInstance().updateTotalCount(qa,ra,sa);};pa.setVideoRotateURI=function(qa){'use strict';pa.getInstance().videoRotateURI=qa;};Object.assign(pa,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_DATA:'image',MIN_TAG_DISTANCE:80,_instance:null,touchMarkup:ia});f.exports=pa;},null);
__d('PhotoPermalinkTagger',['Arbiter','Event','PhotoPermalink','PhotoTagger','$'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;m=babelHelpers.inherits(o,k);n=m&&m.prototype;function o(p){'use strict';n.constructor.call(this,j.getInstance(),true);this.photoData=p;}o.prototype.setupHandlers=function(){'use strict';var p=l('imagestage'),q=l('fbPhotoPageTagBoxes');this.handlers=[i.listen(this.clickState,'click',this.addTag.bind(this)),i.listen(p,'click',this.addTag.bind(this)),i.listen(q,'click',this.addTag.bind(this)),i.listen(this.addTagLink,'click',this.checkActions.bind(this)),i.listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[h.subscribe('PhotoPermalink.PAGE',this.restartTagging.bind(this)),h.subscribe('PhotoPermalink.DATA_CHANGE',this.setPhotoData.bind(this)),h.subscribe('PhotoPermalink.EXTRA_DATA_CHANGE',this.setExtraData.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};o.prototype.setDataForTokenizer=function(){'use strict';this.tokenizer.setup(null,this.photoData);return this;};Object.assign(o.prototype,{elemNames:{0:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons'}}});f.exports=o;},null);
__d('legacy:PhotoPermalinkTagger',['PhotoPermalinkTagger'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();b.PhotoPermalinkTagger=c('PhotoPermalinkTagger');},3);
__d('legacy:fb-photos-permalink-js',['PhotoPermalink'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();b.PhotoPermalink=c('PhotoPermalink');},3);
__d('PhotoTags',['Arbiter','CSS','DOM','Event','Parent','PhotosConst','cx','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(q,r,s){'use strict';this.tagTargets=q;this.tagBox=r;this.version=s||m.VIEWER_PERMALINK;this.handlers=[];this.tagTargets.forEach((function(t){this.handlers.push(k.listen(t,{mouseover:this.showTag.bind(this),mouseout:this.hideTags.bind(this)}));}).bind(this));this.subscriptions=[];if(this.version==m.VIEWER_SNOWLIFT)this.subscriptions.push(h.subscribe("PhotoSnowlift.PAGE",this.hideTags.bind(this)));}p.prototype.showTag=function(event){'use strict';var q=event.getTarget(),r=i.hasClass(q,'taggee'),s=i.hasClass(q,"_54ru"),t=null;if(r){t=q.getAttribute('data-tag');}else if(s){var u=l.byTag(q,'a');t=u&&u.getAttribute('data-tag');}if(!t){q=l.byClass(q,'taggee');if(q)t=q.getAttribute('data-tag');}var v=this.version==m.VIEWER_PERMALINK?'perm:tag:'+t:'tag:'+t,w=v&&o(v);if(w){i.addClass(w,'showTag');i.addClass(this.tagBox,'showingTag');}};p.prototype.hideTags=function(){'use strict';i.removeClass(this.tagBox,'showingTag');j.scry(this.tagBox,'div.showTag').forEach(function(q){i.removeClass(q,'showTag');});};p.prototype.destroy=function(){'use strict';for(var q in this.handlers)this.handlers[q].remove();this.subscriptions.forEach(h.unsubscribe.bind(h));};f.exports=p;},null);
__d('legacy:PhotoTags',['PhotoTags'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();b.PhotoTags=c('PhotoTags');},3);
__d('TagToken',['DOM','Token'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;j=babelHelpers.inherits(l,i);k=j&&j.prototype;function l(m){'use strict';k.constructor.call(this,m,'tag');}l.prototype.createElement=function(){'use strict';var m=this.isFreeform(),n=h.create('span',{className:'separator'},', '),o=h.create(m?'span':'a',{className:'taggee','data-tag':this.getValue()},this.getText());if(!m)o.href=this.getInfo().path;return h.create('span',{className:'tagItem'},[n,o]);};f.exports=l;},null);
__d('TagTokenizer',['Arbiter','CSS','DOM','Parent','TagToken','Tokenizer','createObjectFrom','ge','getElementText','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s;r=babelHelpers.inherits(t,m);s=r&&r.prototype;function t(u,v,w,x,y){'use strict';s.constructor.call(this,w,x,y);h.subscribe('PhotoInlineEditor.CANCEL_INLINE_EDITING',this.updateTokenareaVisibility.bind(this),h.SUBSCRIBE_NEW);this.appphoto=v;h.subscribe(u.getInstance().getEventString('DATA_CHANGE'),this.setup.bind(this),h.SUBSCRIBE_NEW);}t.prototype.setup=function(u,v){'use strict';this.appphoto=v.byapp;this.byowner=v.isowner;return this.reset();};t.prototype.reset=function(){'use strict';var u=this.getTokenElements().map(this.getTokenDataFromTag.bind(this));this.withTagKeys={};var v=this.getWithTagTokenElements().map((function(w){return this._tokenKey(this.getTokenDataFromTag(w));}).bind(this));this.withTagKeys=n(v);return s.reset.call(this,u);};t.prototype.processEvents=function(event,u,v){'use strict';if(k.byClass(u,'remove')){var w=this.getTokenFromElement(v);w=this.addTokenData(w,u);this.removeToken(w);event.kill();}};t.prototype.insertToken=function(u){'use strict';return null;};t.prototype.removeToken=function(u){'use strict';if(this.appphoto){return this.replaceToken(u);}else{this.inform('removeToken',u);h.inform('Form/change',{node:this.element});}};t.prototype.addTokenData=function(u,v){'use strict';if(k.byClass(v,'blockuser'))u.blockUser=true;return u;};t.prototype.getTokenDataFromTag=function(u){'use strict';return {uid:j.find(u,'input').value,text:p(j.find(u,'.taggee'))};};t.prototype.getTokenElementFromTarget=function(u){'use strict';return k.byClass(u,'tagItem');};t.prototype.getTokenElements=function(){'use strict';return j.scry(this.tokenarea,'span.tagItem').filter(this.filterNonTokenElements.bind(this));};t.prototype.getWithTagTokenElements=function(){'use strict';return j.scry(this.tokenarea,'span.withTagItem');};t.prototype.filterNonTokenElements=function(u){'use strict';return !i.hasClass(u,'markasspam')&&!i.hasClass(u,'reported')&&!i.hasClass(u,'withTagItem');};t.prototype.createToken=function(u,v){'use strict';var w=this.getToken(this._tokenKey(u));w=w||new l(u);v&&w.setElement(v);return w;};t.prototype.updateTokenareaVisibility=function(){'use strict';var u=this.getTokenElements().filter(function(x){return i.shown(x);}),v=this.getWithTagTokenElements(),w=j.scry(this.tokenarea,'span.ogTagItem');i.conditionShow(this.tokenarea,u.length!==0||v.length!==0||w.length!==0);};t.prototype.replaceToken=function(u){'use strict';if(!u)return;var v=this.tokens.indexOf(u);if(v<0)return;this.tokens.splice(this.tokens.indexOf(u),1);delete this.unique[this._tokenKey(u.getInfo())];var w=o('tagspam'+u.getValue());w&&j.remove(w);var x=[' [',q._("Tag removed."),' '];x.push(j.create('a',{onclick:this.markAsSpam.bind(this,u.getValue())},q._("Mark tag as spam")));x.push('] ');var y=j.create('span',{className:'fbPhotosTaglistTag tagItem markasspam',id:'tagspam'+u.getValue()},x);j.replace(u.getElement(),y);this.updateTokenarea();this.inform('removeToken',u);h.inform('Form/change',{node:this.element});};t.prototype.markAsSpam=function(u){'use strict';var v=o('tagspam'+u),w=[' [',q._("Tag reported"),'] '],x=j.create('span',{className:'fbPhotosTaglistTag tagItem reported',id:'tagspam'+u},w);j.replace(v,x);this.inform('markTagAsSpam',u);};f.exports=t;},null);
__d('TagTypeaheadView',['AsyncRequest','ContextualTypeaheadView','CSS','DOM','Parent','FamilyTaggingConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;n=babelHelpers.inherits(p,i);o=n&&n.prototype;function p(q,r){'use strict';o.constructor.call(this,q,r);this.hintText=r.hintText;this.userEd=r.userEd;this.origAutoSelect=r.autoSelect;this.setSuggestions(r.suggestions);}p.prototype.init=function(){'use strict';j.addClass(this.element,'uiTagTypeaheadView');o.init.call(this);};p.prototype.buildResults=function(q){'use strict';if(!this.value&&this.hintText)q.unshift({subtext:this.hintText,type:'hintText'});if(this.userEd){new h().setURI('/ajax/fof/user_education.php').setData({increment:1}).send();q.unshift({subtext:this.userEd,type:'userEdText'});}if(m.gk){var r=[],s=[];for(var t=0;t<q.length;t++)if(q[t].type!=='family_tags'&&q[t].index!=-1000&&q[t].type!=='hintText'){r.push(q[t]);}else s.push(q[t]);q=s.concat(r);o.updateResults.call(this,q);}var u=o.buildResults.call(this,q);if(this.userEd)q.shift();if(!this.value)q.shift();return u;};p.prototype.show=function(){'use strict';var q=k.scry(this.context,'.typeaheadBackdrop');if(q.length>0)j.addClass(q[0],'resultsPresent');return o.show.call(this);};p.prototype.hide=function(){'use strict';var q=k.scry(this.context,'.typeaheadBackdrop');if(q.length>0)j.removeClass(q[0],'resultsPresent');return o.hide.call(this);};p.prototype.render=function(q,r,s){'use strict';this.autoSelect=this.origAutoSelect&&q.length;this.disableAutoSelect=q.length===0;o.render.call(this,q,r,s);};p.prototype.getItems=function(){'use strict';var q=o.getItems.call(this);if(!this.value)q.shift();if(this.userEd)q.shift();return q;};p.prototype.getSuggestions=function(){'use strict';return this.suggestions;};p.prototype.setSuggestions=function(q){'use strict';this.suggestions=q?q.map(String):[];this.visible=!!this.suggestions.length;};p.prototype.addSuggestion=function(q){'use strict';this.suggestions.unshift(q);};p.prototype.addTypeaheadFlip=function(q){'use strict';j.addClass(this.element,q);};p.prototype.removeTypeaheadFlip=function(q){'use strict';j.removeClass(this.element,q);};p.prototype.getContext=function(){'use strict';var q=l.byClass(this.element,'typeaheadContainer');if(q){return q;}else return o.getContext.call(this);};f.exports=p;},null);
__d('MakeProfilePicInit',['ProfilePicCropViewerInit','URI'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={handleOptimus:function(k,l,m){m.prevent();var n=new i(l.getAttribute('ajaxify')||l.href).getQueryData();h.loadID(n.fbid,n.profile_id,{source:n.pp_source,stickerID:n.sticker_id});}};f.exports=j;},null);
__d('FreeformTokenizerBehavior',['Event','Input','Keys'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l,m){var n=m.matcher&&new RegExp(m.matcher,'i'),o=m.splitter&&new RegExp(m.splitter),p=m.tokenize_on_blur!==false,q=m.tokenize_on_paste!==false,r=m.split_on_check===true,s=m.select_on_comma!==false,t=m.select_on_space===true,u=m.never_submit===true;function v(event){var w=i.getValue(l.getInput()).trim();if(o&&event&&event.type=='paste'){w=w.split(o);}else if(o&&r){w=w.split(o);}else w=[w];var x=false;for(var y=0;y<w.length;y++){var z=w[y].trim();if(z&&(!n||n.test(z))){var aa={uid:z,text:z,freeform:true};l.addToken(l.createToken(aa));x=true;}}if(event&&x){l.getTypeahead().getCore().afterSelect();event.kill();}}l.subscribe('keydown',function(w,x){var event=x.event,y=h.getKeyCode(event);if(y==j.RETURN||s&&y==j.COMMA||t&&y==j.SPACE){var z=l.getTypeahead().getView();if(z.getSelection()){z.select();event.kill();}else v(event);}if(y==j.RETURN&&u)event.kill();});l.subscribe('paste',function(w,x){if(q)setTimeout(v.bind(null,x.event),20);});l.subscribe('blur',function(w,x){if(p)v();l.getTypeahead().getCore().reset();});}f.exports=k;},null);
__d('TypeaheadHintText',['emptyFunction'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){'use strict';this._typeahead=j;}i.prototype.enable=function(){'use strict';this._typeahead.getCore().resetOnKeyup=false;};Object.assign(i.prototype,{disable:h});f.exports=i;},null);
__d('legacy:HintTextTypeaheadBehavior',['TypeaheadHintText'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.hintText=function(i){i.enableBehavior(h);};},3);
__d('CovercardArrow',['ContextualDialogArrow','CSS','DOMQuery','Locale','Style','csx','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=-45,p=45,q=9;if(k.isRTL()){o=-o;p=-p;}function r(t){'use strict';this._layer=t;}r.prototype.enable=function(){'use strict';this._layer.enableBehavior(h);var t=this._layer.getContentRoot();this._arrowWrapper=j.scry(t,"._7lh")[0];if(!this._arrowWrapper)return;this._arrowShadow=j.scry(this._arrowWrapper,"._7li")[0];if(!this._arrowShadow)return;var u=null;if(s(this._arrowWrapper))u=this._renderArrowWithRotate.bind(this);if(!u)return;if(k.isRTL())i.addClass(t,"_7lf");this._subscription=this._layer.subscribe('reposition',function(v,w){var x=w.getPosition()=='below';i.conditionClass(t,"_53ih",x);x&&u(w);});};r.prototype.disable=function(){'use strict';this._subscription&&this._subscription.unsubscribe();this._subscription=null;};r.prototype._calculateArrowOffset=function(t){'use strict';var u=h.getOffsetPercent(t),v=h.getOffset(t,u,this._layer),w=l.get(this._layer.getContentRoot(),'width');return parseInt(w,10)*(u/100)+v;};r.prototype._renderArrowWithRotate=function(t){'use strict';var u=j.scry(this._arrowWrapper,"._7lj")[0];if(!u){var v=this._layer.getContentRoot();i.addClass(v,"_4nfk");}var w=j.scry(this._arrowWrapper,"._1ubp")[0];if(!w)return;var x=s(this._arrowWrapper);if(!x)return;var y=this._calculateArrowOffset(t),z=q+y,aa=-q;if(k.isRTL()){z=-z;aa=-aa;}this._arrowWrapper.style[x]='translate('+z+'px, -'+q+'px) '+'rotate('+p+'deg)';if(u)u.style[x]='rotate('+o+'deg) '+'translate('+ -z+'px, '+(q-12)+'px)';w.style[x]='rotate('+o+'deg) '+'translate('+aa+'px, 0)';};function s(t){if(!t)t=document.body;var u=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],v;while(v=u.shift())if(t.style[v]!==undefined)return v;return null;}f.exports=r;},null);
__d('VideoChainingToken',['Base64'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){'use strict';this.$VideoChainingToken1=j;}i.prototype.decode=function(){'use strict';return JSON.parse(h.decode(this.$VideoChainingToken1));};f.exports=i;},null);