/*!CK:393625854!*//*1451977669,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["RCdCs"]); }

__d("MessagesViewerSetID",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};},null);
__d("StickerAssetType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={IMAGE:"BestEffortImage",SPRITE:"SpriteImage",PADDED_SPRITE:"PaddedSpriteImage"};},null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(t,u,v){this.xhr=n();if(!(u instanceof l))u=new l(u);if(v&&t=='GET'){u.setQueryData(v);}else this._params=v;this.method=t;this.uri=u;this.xhr.open(t,u);}var q=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();p.supportsCORS=function(){return q;};p.ERROR='ar:error';p.TIMEOUT='ar:timeout';p.PROXY_ERROR='ar:proxy error';p.TRANSPORT_ERROR='ar:transport error';p.SERVER_ERROR='ar:http error';p.PARSE_ERROR='ar:parse error';p.SERVICE_UNAVAILABLE='ar:noservice';p._inflight=[];function r(){var t=p._inflight;p._inflight=[];t.forEach(function(u){u.abort();});}function s(t){t.onJSON=t.onError=t.onSuccess=null;clearTimeout(t._timer);if(t.xhr&&t.xhr.readyState<4){t.xhr.abort();t.xhr=null;}p._inflight=p._inflight.filter(function(u){return u&&u!=t&&u.xhr&&u.xhr.readyState<4;});}Object.assign(p.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(t){if(this[t])this[t](this);},_parseStatus:function(){var t;try{this.status=this.xhr.status;t=this.xhr.statusText;}catch(u){if(this.xhr.readyState>=4){this.errorType=p.TRANSPORT_ERROR;this.errorText=u.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=p.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=p.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=p.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=p.SERVER_ERROR;}else if(this.status===503){this.errorType=p.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=p.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=p.TRANSPORT_ERROR;}else{t='unrecognized status code: '+this.status;this.errorType=p.ERROR;}if(!this.errorText)this.errorText=t;},_parseResponse:function(){var t,u=this.xhr.readyState;try{t=this.xhr.responseText||'';}catch(v){if(u>=4){this.errorType=p.ERROR;this.errorText='responseText not available - '+v.message;}return;}while(this.xhr){var w=this._eol+1,x=this.streamMode?t.indexOf('\n',w):t.length;if(x<0&&u==4)x=t.length;if(x<=this._eol)break;var y=t;if(this.streamMode)y=t.substr(w,x-w).replace(/^\s*|\s*$/g,'');if(w===0&&this.prelude)if(this.prelude.test(y))y=y.replace(this.prelude,'');this._eol=x;if(y){try{this.json=JSON.parse(y);}catch(v){var z=/(<body[\S\s]+?<\/body>)/i.test(t)&&RegExp.$1,aa={message:v.message,'char':w,excerpt:(w===0&&z||y).substr(512)};this.errorType=p.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(aa);return;}h.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var t=this.xhr&&this.xhr.readyState||0;if(this.status==null&&t>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(t==3&&this.streamMode||t==4)this._parseResponse();if(this.errorType||t==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');s(this);}},send:function(t){this.xhr.onreadystatechange=k.guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var u=this.timeout;if(u)this._timer=o((function(){this.errorType=p.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');s(this);}).bind(this),u);p._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(t?j.serialize(t):'');},abort:function(){s(this);},toString:function(){var t='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)t+=' errorType='+this.errorType+' ('+this.errorText+')';return t+']';},toJSON:function(){var t={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)t.uri=this.uri;for(var u in t)if(t[u]==null)delete t[u];return t;}});if(window.addEventListener&&m.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',r);f.exports=p;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','setTimeoutAcrossTransitions','LogHistory','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('LogHistory').getInstance('channel'),m=c('WebStorage').getLocalStorage(),n=i.create('channel'),o='channel_sub:',p=7,q=100*1000,r=null,s;function t(){if(s){clearTimeout(s);s=null;}if(m&&r!=null)m.removeItem(o+r);r=null;}function u(v,w,x){var y=(v-1)*p;if(x){if(s)clearTimeout(s);r=s=null;}if(w==null)w=Math.floor(Math.random()*y);if(r==null)if(m){var z=[];for(var aa=0;aa<m.length;aa++){var ba=m.key(aa);if(ba.indexOf(o)===0){var ca=parseInt(ba.substr(o.length),10);z[ca]=parseInt(m.getItem(ba),10);}}var da=Date.now()-q;for(aa=0;aa<y;aa++){var ea=(aa+w)%y;if(!z[ea]||z[ea]<da){r=ea;break;}}if(r!=null){var fa=function(){try{m.setItem(o+r,Date.now());}catch(ga){l.warn('subdomain set failed',ga.message);}s=k(fa,q/2);};fa();}else{l.warn('no channel subdomain',z);n.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){h.listen(window,'pagehide',t);}else j.onUnload(t);}else r=w;return r==null?null:r%p;}f.exports={allocate:u,clear:t};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_apis:{},_dispatch:function(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(i._apis.hasOwnProperty(j.api)){var m=i._apis[j.api];if(m[j.method])k=h.applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function(j,k){i._apis[k]=j;},proxy:function(j,k,l){var m={};l.forEach(function(n){m[n]=function(){var o={api:k,method:n,args:Array.prototype.slice.call(arguments)},p;try{if(j.closed)throw new Error('DocRPC window closed');p=j.DocRPC._dispatch(JSON.stringify(o));}catch(q){h.reportError(q);return;}if(typeof p=='string')try{p=JSON.parse(p);}catch(q){throw new Error('DocRPC '+k+'.'+n+' unparsable return: "'+p+'"');}return p;};});return m;}};f.exports=b.DocRPC=i;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.getInstance('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(ba,ca){var da=ba.subdomain;da=da===null?'':da+'-';var ea=ba.host;ea=ea===null||ea===undefined?'edge-chat':ba.host;var fa=new m(ca).setDomain(da+ea+'.'+ba.domain).setPort(ba.port).setSecure(new m(window.location.href).isSecure());return fa;}function s(ba){var ca={partition:ba.partition,cb:q(),failure:ba.pingFailuresOnSubdomain};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;var da=r(ba,'/p').setQueryData(ca);p.log('start_p',{uri:da.toString()});var ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;var fa=function(ga){p.log('finish_p',{xhr:ga.toJSON?ga.toJSON():ga,subdomain:ba.subdomain,fullHost:ba.fullHost});};ea.onError=function(ga){fa(ga);if(ba.subdomain===null)return;ba.pingFailuresOnSubdomain++;ba.subdomain++;if(ba.subdomain>6)ba.subdomain=0;};ea.timeout=ba.P_TIMEOUT;ea.onSuccess=fa;ea.send();}function t(ba,ca,da){var ea=new Image(),fa=0,ga=function(ja){ea.abort();return ja?ca():da();};ea.onload=l.guard(function(){p.log('ping_ok',{duration:Date.now()-fa});ga(true);},'ChannelTransport image.onload');ea.onerror=l.guard(function(){s(ba);ga(false);},'ChannelTransport image.onerror');var ha=o(ea.onerror,10000);ea.abort=function(){if(ha){clearTimeout(ha);ha=null;}ea.onload=ea.onerror=null;};var ia={partition:ba.partition,cb:q()};if(ba.sticky_token)ia.sticky_token=ba.sticky_token;if(ba.sticky_pool)ia.sticky_pool=ba.sticky_pool;if(ba.lastRequestErrorReason){ia.reason=ba.lastRequestErrorReason;ba.lastRequestErrorReason=null;}if(ba.uid&&ba.viewerUid){ia.uid=ba.uid;ia.viewer_uid=ba.viewerUid;}if(ba.watchdog&&ba.watchdog.enabled)ia.wtc=ba.watchdog.doSerialize();fa=Date.now();ea.src=r(ba,'/ping').setQueryData(ia);return ea;}function u(ba,ca){var da={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)da.sticky_token=ba.sticky_token;if(ba.sticky_pool)da.sticky_pool=ba.sticky_pool;if(ba.profile)da.profile=ba.profile;if(ba.capabilities)da.cap=ba.capabilities;da.id=ca;var ea=r(ba,'/add_bud').setQueryData(da),fa=new h('GET',ea);if(h.supportsCORS())fa.xhr.withCredentials=true;fa.onError=function(ga){p.warn('add_buddy_error');};fa.onSuccess=function(ga){p.log('add_buddy_ok');};fa.timeout=ba.P_TIMEOUT;fa.send();}function v(ba){var ca={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;if(ba.is_offline||ba.shouldSuppressPresence){ca.state='offline';}else ca.state='active';if(ca.state===ba.lastPresenceState)return;ba.lastPresenceState=ca.state;if(ba.profile)ca.profile=ba.profile;if(ba.capabilities)ca.cap=ba.capabilities;var da=r(ba,'/active_ping').setQueryData(ca),ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;ea.onError=function(fa){p.warn('active_ping_error');};ea.onSuccess=function(fa){p.log('active_ping_ok');};ea.timeout=ba.P_TIMEOUT;ea.send();}function w(ba,ca,da,ea){var fa=new Date(),ga=-1;if(ba.userActive>0){ga=(fa-ba.userActive)/1000|0;if(ga<0)p.warn('idle_regression',{idleTime:ga,now:fa.getTime(),userActive:ba.userActive});}var ha={channel:ba.user_channel,seq:ba.seq,partition:ba.partition,clientid:ba.sessionID,cb:q(),idle:ga,qp:'y',cap:0};if(!!ba.watchdog&&ba.watchdog.enabled)ha.wtc=ba.watchdog.doSerialize();if(ba.ready)if(ba.seqTurSentAt==-1||ba.seqTurSentAt==ba.seq){ha.tur=ba.timeUntilReady;ha.qpmade=ba.queueMade;ba.seqTurSentAt=ba.seq;}if(ba.sequenceId>0)ha.isq=ba.sequenceId;ha.msgs_recv=ba.estimatedReceived;if(ba.uid&&ba.viewerUid){ha.uid=ba.uid;ha.viewer_uid=ba.viewerUid;}if(ba.sticky_token){ha.sticky_token=ba.sticky_token;}else{if(ba.requestBatchedPull)ha.request_batch=1;if(ba.msgr_region)ha.msgr_region=ba.msgr_region;}if(ba.sticky_pool)ha.sticky_pool=ba.sticky_pool;if('trace_id' in ba)ha.traceid=ba.trace_id;if(ba.is_offline||ba.shouldSuppressPresence){ha.state='offline';}else if(ba.userActive>0&&ga<60)ha.state='active';ba.lastPresenceState=ha.state;if(ba.streamingCapable){ha.mode='stream';ha.format='json';}if(ba.profile)ha.profile=ba.profile;if(ba.capabilities)ha.cap=ba.capabilities;var ia=r(ba,'/pull').setQueryData(ha),ja=ba.fantail_enabled?'POST':'GET',ka=new h(ja,ia);if(h.supportsCORS())ka.xhr.withCredentials=true;ka.timeout=ba.streamingCapable?ba.STREAMING_TIMEOUT:ba.LONGPOLL_TIMEOUT;ka.onJSON=ca;ka.onSuccess=da;ka.onError=function(){var na=this.status==12002&&this._time>=ba.MIN_12002_TIMEOUT||this.status==504&&this._time>=ba.MIN_504_TIMEOUT,oa=na?da:ea;return oa&&oa.apply(this,arguments);};if(ba.fantail_logs&&ba.fantail_logs.length>0){var la={};for(var ma=0;ma<ba.fantail_logs.length;ma++)Object.assign(la,ba.fantail_logs[ma]);ka.send(la);ba.fantail_logs=[];}else ka.send();ba.inStreaming=ba.streamingCapable;return ka;}function x(ba){this.manager=ba;this.init&&this.init();}function y(ba){x.apply(this,arguments);}Object.assign(y.prototype,{logName:'CORS',enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='init')o(n(this.manager,'exitState',{status:i.OK,stateId:ca.stateId}),ca.fullReloadAsSuccess?0:3000);if(!/pull|ping/.test(ba))return;var da=this.manager;if(ba=='ping'){this._request=t(ca,n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(da,'_processTransportData',ca.stateId),n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});function z(ba){p.log('iframe_init_constructor');x.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);j.publish(this,'outerTransport');}Object.assign(z.prototype,{logName:'iframe',_initIframe:function(ba){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return ba.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(ba){this._iframeURI=r(ba,ba.path);if(ba.resources){var ca=this._iframeURI.getDomain();ba.resources=ba.resources.map(function(fa){var ga=new m(fa);if(ga.getPath().startsWith('/intern/rsrc.php')&&ga.getQueryData().origin!==undefined)return ga.addQueryData('origin',ca).toString();return fa;});}if(ba.bustIframe){var da={partition:ba.partition,cb:q()};this._iframeURI.setQueryData(da);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ea){p.error('iframe_uri_set_error',ea);this.exitState({status:i.ERROR,stateId:ba.stateId},ea+'');}},enterState:function(ba,ca){if(ba=='init'){this._initIframe(ca);}else if(/idle|ping|pull/.test(ba)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(ba!='idle')this.exitState({status:i.ERROR,stateId:ca.stateId},'iframe not yet loaded');}else if(ba=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(ba){if(this.manager.state=='init'&&ba.status==i.OK)this._iframeProxy=j.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function aa(){this.init=this.init.bind(this);x.apply(this,arguments);}Object.assign(aa.prototype,{logName:'iframe(inner)',init:function(){j.publish(this,'innerTransport');try{var ca=j.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,ca);this.exitState({status:i.OK,stateId:1e+06});}catch(ba){p.error('iframe_inner_init_error',ba);}},enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='ping'){this._request=t(ca,n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(this,'_processTransportData',ca.stateId),n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});f.exports={getURI:r,Transport:x,CORSTransport:y,IframeTransport:z,IframeInnerTransport:aa,sendActivePing:v,sendAdditionalBuddyRequest:u};},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l,m){m=babelHelpers._extends({},i(k),m);var n=new h(k,l,m);n.streamMode=false;var o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=h.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}o.apply(this,arguments);};n.ajaxReqSend=n.send;n.send=function(p){this.ajaxReqSend(babelHelpers._extends({},p,m));};return n;}f.exports=j;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('RTISession',['URI','AjaxRequest','invariant','ErrorUtils'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){!n?j(0):undefined;!q?j(0):undefined;!r?j(0):undefined;this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){!n?j(0):undefined;!o?j(0):undefined;!q?j(0):undefined;var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)!!o[x]?j(0):undefined;Object.assign(w,o);var y=new h(n).setDomain(u).setPort(this.port).setSecure(new h(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new i(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};f.exports=m;},null);
__d('ChannelManager',['AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatConfig','ChatVisibility','DTSG','Env','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','Run','SystemEvents','URI','UserActivity','errorCode','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){if(c.__markCompiled)c.__markCompiled();var ma,na=w.create('channel'),oa=x.getInstance('channel_manager'),pa=null;function qa(eb){pa=eb;}var ra={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},sa={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,estimatedReceived:0,fantail_logs:[],sessionID:k.getID(),capabilities:u.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:ba.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},ta={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var eb=this.accumulatedPullTimeMillis,fb=Date.now();if(this.pullStartTimeMillis>0&&fb-this.pullStartTimeMillis<=sa.LONGPOLL_TIMEOUT)eb+=fb-this.pullStartTimeMillis;var gb=eb/1000;if(gb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return gb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(eb,fb){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=Date.now()-this.pullStartTimeMillis;if(eb){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(eb){return eb.indexOf('pull')===0||eb.indexOf('init')===0||eb.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var eb=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)eb+=Date.now()-this.timeInGoodStatesStartMillis;return eb/1000;},clientEnteredState:function(eb){if(!this.enabled)return;var fb=this.isGoodState(eb);if(fb&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!fb&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(eb){if(!this.enabled)return;if(eb.indexOf('pull')===0){this.reportPullSent();}else if(eb.indexOf('ping')===0&&sa.lastRequestErrorReason!==l.SYS_TIMETRAVEL&&sa.lastRequestErrorReason!==l.SYS_ONLINE&&sa.lastRequestErrorReason!==l.SYS_OWNER&&sa.lastRequestErrorReason!==l.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return '';return this.getTimeSinceFirstPullSentSeconds().toFixed(0)+','+this.getAccumulatedPullTimeSeconds().toFixed(0)+','+this.getPingToPullRatio().toFixed(3)+','+this.getUptimeSeconds().toFixed(0)+','+this.getTotalTimeInGoodStatesSeconds().toFixed(0);}},ua=1,va={},wa=0;function xa(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function ya(){var eb={};if(ma.getConfig('host'))eb[ma.getConfig('user_channel')]=ma.getConfig('seq',0);return eb;}function za(){var eb=Date.now(),fb=Date.now(),gb={total:0},hb='idle',ib=false;fa.subscribe([fa.USER,fa.ONLINE,fa.TIME_TRAVEL],function(lb,mb){bb(true);fb=null;ma.lastPullTime=Date.now();var nb;switch(lb){case fa.USER:nb=fa.isPageOwner()?l.SYS_OWNER:l.SYS_NONOWNER;break;case fa.ONLINE:nb=mb?l.SYS_ONLINE:l.SYS_OFFLINE;break;case fa.TIME_TRAVEL:nb=l.SYS_TIMETRAVEL;break;}ma.exitState({status:nb,stateId:ua});});var jb=function(lb,mb){var nb=Date.now(),ob=null;if(mb){eb=nb;ob=mb.nextState||mb.state;}else ob=hb;fa.checkTimeTravel();if(fb){var pb=Math.round((nb-fb)/1000);if(pb>0){gb[hb]=(gb[hb]||0)+pb;gb.total+=pb;}}hb=ob;fb=nb;if(!lb){gb.lastSuccessTime=xa();gb.online=fa.isOnline();oa.log('rollup',gb);}};i.subscribe(l.ON_ENTER_STATE,jb);ka(jb,60000);i.subscribe(w.DUMP_EVENT,function(lb,mb){mb.channelRollup=gb;});var kb=function(){if(ma.isShutdown()||ma.shouldIdle())return;fa.checkTimeTravel();var lb=Date.now()-(ma.lastPullTime||s.start);if(!ib&&lb>sa.STALL_THRESHOLD){var mb=xa();oa.error('stall',{lastSuccessTime:mb,rollupState:hb});ib=true;}var nb=Date.now()-eb;if(ma.state=='pull'&&nb>sa.JUMPSTART_THRESHOLD){eb=null;oa.warn('jumpstart',{state:ma.state,dormant:nb});ma.enterState('init');}};ka(kb,10000);}function ab(){var eb=Date.now(),fb=1;function gb(){la(gb,fb*1000);var lb=ma.state;if(lb=='idle'&&ma.shouldIdle())return;na.bump('conn_t',fb);if(lb=='pull')na.bump('conn_t_pull',fb);}gb();var hb=[15,30,60,120,240],ib=false,jb=false;function kb(lb){la(function(){na.rate('pullenter_'+lb,ib);na.rate('pullexit_'+lb,jb);},lb*1000);}while(hb.length)kb(hb.shift());i.subscribe(l.ON_ENTER_STATE,function(lb,mb){if(mb.state=='pull')ib=true;eb=Date.now();});i.subscribe(l.ON_EXIT_STATE,function(lb,mb){if(mb.state!='pull'||!eb)return;var nb='other';if(mb.status==l.OK){jb=true;nb='ok';}else if(mb.xhr&&mb.xhr.errorType){nb=/ar:(\w+)/.test(mb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(mb.status))return;var ob=(Date.now()-eb)/1000;if(ob<0){return;}else if(ob>3600)ob=3600;na.bump('conn_num');na.bump('conn_exit',ob);na.bump('conn_num_'+nb);na.bump('conn_exit_'+nb,ob);});}function bb(eb){if(eb){wa=0;va={};}else wa++;}function cb(){var eb=!h.supportsCORS()||sa.forceIframe;if(sa.subdomain===null||eb){sa.fullHost=sa.host;}else sa.fullHost=sa.subdomain+'-'+sa.host;}ma={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:qa,backoff:false,sessionRegistered:false,init:function(eb,fb){this.init=function(){};i.subscribe(l.GET_RTI_SESSION_REQUEST,(function(event,jb){this.informCurrentSession();}).bind(this));ja((function(){this._logFantail('client initialized',l.FANTAIL_INFO);this._logFantail('using session id: '+sa.sessionID+' at seq: '+sa.sequenceId+' with sticky:'+sa.sticky_token+'/'+sa.sticky_pool,l.FANTAIL_INFO);ta.enabled=!!sa.watchdog_enabled;sa.watchdog=ta;ha.subscribe(function(){sa.userActive=Date.now();o.sendActivePing(sa);});}).bind(this));aa.register('ch',ya);var gb=this.getConfig('max_conn',2);sa.subdomain=n.allocate(gb);this._transportRate=new z(30000);var hb=h.supportsCORS()&&!sa.forceIframe?'CORSTransport':'IframeTransport';this.transport=new o[hb](this);if(eb)this.enterState(eb,fb);ja((function(){i.subscribe(w.DUMP_EVENT,(function(event,jb){jb.transportRate=this._transportRate.tally();jb.transportType=hb;jb.transportVersion=2;}).bind(this));za();ab();}).bind(this));if(ma.getConfig('tryStreaming')&&ma.getConfig('host')&&h.supportsCORS()&&!sa.forceIframe){var ib=sa.MIN_INIT_PROBE_DELAY+Math.random()*sa.INIT_PROBE_DELAY_RANDOMIZE_RANGE;la(this._probeTest,ib);}},configure:function(){for(var eb=arguments.length,fb=Array(eb),gb=0;gb<eb;gb++)fb[gb]=arguments[gb];oa.log('configure',fb);fb.forEach(function(hb){return Object.assign(sa,hb);});cb();i.inform(l.ON_CONFIG,this);},getConfig:function(eb,fb){return eb in sa?sa[eb]:fb;},getCompleteConfig:function(){return sa;},informCurrentSession:function(){var eb=null;if(this.sessionRegistered&&sa&&sa.fullHost&&sa.sticky_token&&sa.uid)eb=new da(sa.fullHost,sa.port,sa.sticky_pool,sa.sticky_token,sa.uid,sa.viewerUid,sa.profile,sa.sessionID,sa.capabilities);i.inform(l.RTI_SESSION,eb);},getWatchdog:function(){return ta;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(fa.isPageOwner()&&fa.isOnline());},_sendIframeError:function(eb){var fb=new j().setURI('/ajax/presence/reconnect.php').setData({reason:eb,fb_dtsg:r.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);fb.specifiesWriteRequiredParams()&&fb.send();},_getDelay:function(){var eb=Math.min(sa.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,wa-1)),sa.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in sa)eb=sa.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(eb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)oa.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(eb){this._inEnterState=false;throw eb;}},_enterState:function(eb){if((eb.indexOf('pull')===0||eb.indexOf('ping')===0||eb.indexOf('shutdown')===0)&&!!sa.active_config_refresh){var fb=Date.now(),gb=(fb-sa.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in sa&&sa.config_refresh_seconds>0&&gb>sa.config_refresh_seconds){eb='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',l.FANTAIL_DEBUG);}}if(eb.indexOf('reconnect')===0)sa.reconnectOverrideTimeMillis=Date.now();var hb=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+eb,l.FANTAIL_WARN);return;}if(eb!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',l.FANTAIL_WARN);return;}ua++;sa.stateId=ua;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(eb)){var ib=this._transportRate.tally().timeAverage,jb=ma.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(ib>=jb){if(!this._throttled){this._throttled=true;oa.warn('throttled');}na.bump('throttle');hb=1000/jb;}}else if(!(/#$/.test(eb)))hb=this._getDelay();eb=eb.replace(/\W*$/,'');if(!ra[eb]){this._logFantail('invalid state: '+eb,l.FANTAIL_ERROR);throw new Error('invalid state:'+eb);}var kb=Array.from(arguments),lb;if(hb<=0){lb={state:eb};this._transportRate.add(1);this.state=eb;var mb=this['_enter_'+this.state];if(mb){kb.shift();mb.apply(this,kb);}if(/init|idle|pull|ping/.test(this.state)){if(sa.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];ta.transportEnteredState(eb);ta.clientEnteredState(eb);sa.is_offline=!q.isOnline();sa.capabilities=u.getCapabilities();this._logFantail('entering transport state: '+this.state,l.FANTAIL_INFO);this.transport.enterState(this.state,sa);if(this.state=='ping'){lb.url=o.getURI(sa).toString();lb.port=sa.port||'undefined';}}}else{this.state='idle';this.nextState=eb;lb={state:this.state,delay:hb,nextState:eb};kb[0]=eb+'#';this._deferredTransition=la((function(){this._deferredTransition=null;this.enterState.apply(this,kb);}).bind(this),hb);}if(/pull/.test(eb)){lb.client_id=sa.sessionID;lb.streaming=sa.inStreaming;}i.inform(l.ON_ENTER_STATE,lb);},exitState:function(eb,fb){var gb=eb.stateId,hb=eb.status;if((hb==l.SYS_TIMETRAVEL||hb==l.SYS_ONLINE||hb==l.SYS_NONOWNER||hb==l.SYS_OWNER)&&ta)ta.initialize();if(this.isShutdown()||gb<ua)return;var ib=this.state,jb=Array.from(arguments);jb[0]=eb.status;var kb={state:ib,status:hb};if(/pull/.test(ib)){kb.client_id=sa.sessionID;kb.streaming=sa.inStreaming;}if(/ping/.test(ib)&&hb!=l.OK)kb.url=o.getURI(sa).toString();if(this.nextState)kb.nextState=this.nextState;if(fb&&fb.errorType){sa.lastRequestErrorReason=fb.errorType;kb.xhr=fb.toJSON?fb.toJSON():fb;if(fb.errorType==h.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',l.FANTAIL_ERROR);this.proxyDown=true;}delete kb.xhr.json;}else if(hb!=l.OK)sa.lastRequestErrorReason=hb;if(fb&&fb.json){if(fb.json.t)kb.t=fb.json.t;if(fb.json.reason)kb.reason=fb.json.reason;if(fb.json.seq)kb.seq=fb.json.seq;}i.inform(l.ON_EXIT_STATE,kb);var lb=this['_exit_'+ib];if(lb)hb=lb.apply(this,jb)||hb;if(hb!=l.OK){bb();va[ib]=(va[ib]||0)+1;}var mb=ra[this.nextState||ib][hb]||ra._all[hb],nb=mb&&mb.replace(/!*$/,'');if(!nb){oa.error('terminal_transition',kb);this._shutdownHint=l.HINT_INVALID_STATE;mb='shutdown!';this._logFantail('entering shutdown state',l.FANTAIL_ERROR);}this._lastState=ib;this._lastStatus=hb;this.enterState(mb);},_processTransportData:function(eb,fb){this._processTransportData0(eb,fb,fb.json);},_processTransportData0:function(eb,fb,gb){var hb=gb.t;if('s' in gb){gb.seq=gb.s;delete gb.s;}if(gb.u&&sa.user&&gb.u!=sa.user){oa.warn('misguided_msg',{user:sa.user,target:gb.u});this._reportProxyMisguidedMsg(gb.u,sa.user);return;}var ib=sa.seq;if('seq' in gb){sa.seq=gb.seq;ba.doSync();}switch(hb){case 'continue':if(sa.inStreaming&&this.heartbeats.length<1){sa.streamingCapable=false;oa.log('switch_to_longpoll');la(this._probeTest,sa.PROBE_DELAY);}bb(true);if(!sa.inStreaming||sa.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:l.OK,stateId:eb});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+gb.reason,l.FANTAIL_INFO);this.exitState({status:'refresh_'+(gb.reason||0),stateId:eb},fb);break;case 'backoff':this._logFantail('server told client to back off',l.FANTAIL_WARN);bb();this.backoff=true;break;case 'lb':var jb=gb.lb_info;if(jb){sa.sticky_token=jb.sticky;if('pool' in jb)sa.sticky_pool=jb.pool;if('vip' in jb)sa.host=jb.vip;cb();}else oa.error('missing_lb_info');break;case 'test_streaming':la(this._probeTest,500);break;case 'fullReload':aa.clear();oa.log('full_reload');this.sessionRegistered=true;this.informCurrentSession();i.inform(l.ON_INVALID_HISTORY);bb(true);this._logFantail('full reload incurred',l.FANTAIL_INFO);var kb=l.ERROR_MISSING;if(sa.fullReloadAsSuccess)kb=l.OK;this.exitState({status:kb,stateId:eb},fb);if('ms' in gb)this._processMessages(gb,ib);break;case 'msg':bb(true);this._processMessages(gb,ib);break;case 'heartbeat':if(sa.inStreaming){var lb=Date.now();if(this.heartbeats.length>0)var mb=lb-this.heartbeats[this.heartbeats.length-1];oa.log('heartbeat_interval',{client_id:sa.sessionID,interval:mb});this.heartbeats.push(lb);}break;case 'batched':var nb=gb.batches,ob;for(ob=0;ob<nb.length;ob++)this._processTransportData0(eb,fb,nb[ob]);break;default:this._logFantail('got an unknown protocol message: '+hb,l.FANTAIL_ERROR);oa.error('unknown_msg_type',{type:hb});break;}},_processMessages:function(eb,fb){var gb,hb,ib,jb;if('tr' in eb)sa.trace_id=eb.tr;hb=eb.ms;ib=sa.seq-hb.length;for(gb=0;gb<hb.length;gb++,ib++){sa.estimatedReceived++;if(ib>=fb){jb=hb[gb];if(jb.type){var kb=l.getArbiterType(jb.type);if(jb.type==='messaging'){var lb={type:'messaging',event:jb.event};if(jb.message){lb.inbox_unread=jb.unread_counts&&jb.unread_counts.inbox;lb.tid=jb.message.tid;lb.mid=jb.message.mid;this._logFantail('got message with id: '+jb.message.mid,l.FANTAIL_INFO);}}else if(jb.type==='pages_messaging'){if(jb.unread_counts&&jb.unread_counts.inbox)i.inform(l.getArbiterType('pages_inbox_count_update'),{page_id:jb[y.VIEWER_FBID],inbox_unread:jb.unread_counts.inbox});}else if(jb.type==='skywalker'){kb=l.SKYWALKER;}else if(jb.type==='qprimer'){jb.first=!sa.ready;if(jb.first){sa.ready=true;sa.timeUntilReady=Date.now()-sa.created;sa.queueMade=jb.made;}kb=l.CHANNEL_ESTABLISHED;}else if(jb.type==='delta')sa.sequenceId=jb.iseq;i.inform(kb,{obj:jb});}}else oa.warn('seq_regression',{seq:ib,last_seq:fb,messages:hb.length});}},_enter_init:function(){if(va.init>=ma.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:l.ERROR_MAX,stateId:ua}),0);this._initTimer=la(this.exitState.bind(this,{status:l.ERROR,stateId:ua},'timeout'),sa.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(eb){oa.warn('enter_reconnect',eb);this._logFantail('entered reconnect with reason: '+eb,l.FANTAIL_INFO);var fb=ua;if(!ca.hasUserCookie()){this._logFantail('user has no cookie???',l.FANTAIL_WARN);oa.warn('no_user_cookie');setTimeout(function(){ma._shutdownHint=l.HINT_AUTH;ma.exitState({status:l.ERROR_SHUTDOWN,stateId:fb});},0);return;}var gb={reason:eb,fb_dtsg:r.getToken()};if(v.token)gb.fb_isb=v.token;if(pa)pa(gb);var hb=new t('GET','/ajax/presence/reconnect.php',gb);hb.onSuccess=(function(){ma.configure(hb.json);aa.store();this.exitState({status:l.OK,stateId:fb});}).bind(this);hb.onError=(function(){var ib=hb.json&&hb.json.error;this._logFantail('reconnect error: '+hb.errorType,l.FANTAIL_ERROR);if(hb.errorType==h.TRANSPORT_ERROR||hb.errorType==h.PROXY_ERROR||hb.errorType==h.SERVICE_UNAVAILABLE)this._shutdownHint=l.HINT_CONN;if(ib&&ib==1356007){this._shutdownHint=l.HINT_MAINT;}else if(ib==1357001||ib==1357004||ib==1348009){this._shutdownHint=l.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?l.ERROR_SHUTDOWN:l.ERROR,stateId:fb},hb);}).bind(this);hb.send();},_enter_shutdown:function(){i.inform(l.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!sa.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in sa&&sa.shutdown_recovery_interval_seconds>0){var eb=sa.shutdown_recovery_interval_seconds*1000;la((function(){i.inform(l.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),eb);}},_exit_init:function(eb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(eb==l.ERROR_MAX)this._sendIframeError(l.reason_IFrameLoadGiveUp);},_exit_pull:function(eb,fb){var gb=eb==l.OK;ta.reportPullReturned(gb,this);if(gb){this.lastPullTime=Date.now();}else{var hb='exit status: '+eb;if(fb&&fb.errorType)hb+=' ajax request error: '+fb.errorType;this._logFantail('pull failed with status: '+hb,l.FANTAIL_ERROR);}},_exit_ping:function(eb){if(eb==l.OK){var fb=Date.now()-(this.lastPullTime||s.start);if(fb>sa.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',l.FANTAIL_ERROR);return l.ERROR_STALE;}}else this._logFantail('ping failed with status: '+eb,l.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(eb,fb){this._logFantail('misguided message to '+fb+' meant for '+eb,l.FANTAIL_ERROR);var gb=Date.now();if(gb-this.lastReportOnMisguidedMsgTime<=sa.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=gb;var hb={received_uid:eb,expected_uid:fb};if(sa.sticky_token)hb.sticky_token=sa.sticky_token;var ib=new ga('/err_misguided_msg').setDomain(sa.host+'.'+sa.domain).setPort(sa.port).setSecure(new ga(window.location.href).isSecure()).setQueryData(hb),jb=new h('GET',ib);if(h.supportsCORS())jb.xhr.withCredentials=true;jb.onSuccess=function(kb){};jb.onError=function(kb){};jb.onJSON=function(kb,lb){};jb.send();},_probeTest:function(){sa.streamingCapable=false;var eb=[],fb={mode:'stream',format:'json'};if(sa.sticky_token)fb.sticky_token=sa.sticky_token;var gb=new ga('/probe').setDomain(sa.host+'.'+sa.domain).setPort(sa.port).setSecure(new ga(window.location.href).isSecure()).setQueryData(fb),hb=new h('GET',gb);hb.onJSON=function(ib,jb){if(ib&&ib.json&&ib.json.t==='heartbeat'){eb.push(Date.now());if(eb.length>=2){var kb=eb[1]-eb[0];if(kb>=sa.PROBE_HEARTBEATS_INTERVAL_LOW&&kb<=sa.PROBE_HEARTBEATS_INTERVAL_HIGH){sa.streamingCapable=true;oa.log('switch_to_streaming');}}}};hb.onSuccess=function(ib){if(eb.length!=2){sa.streamingCapable=false;oa.error('probe_error',{error:'beats.length = '+eb.length});}oa.log('probe_success');};hb.onError=function(ib){sa.streamingCapable=false;oa.error('probe_error',ib);};hb.send();},_logFantail:function(eb,fb){if(fb==l.FANTAIL_ERROR)oa.error(eb);var gb=sa.fantail_queue_capacity||sa.FANTAIL_QUEUE_CAPACITY;if(!sa.fantail_enabled||sa.fantail_logs.length>gb)return;var hb='fantail queue size exceeded',ib=l.FANTAIL_WARN;if(sa.fantail_logs.length<gb){hb=eb;ib=fb;}var jb=sa.fantail_logs.length,kb={};kb['time'+jb]=Date.now();kb['log'+jb]=hb;kb['severity'+jb]=ib;sa.fantail_logs.push(kb);}};f.exports=ma;function db(){if(m.channelConfig){ma.configure(m.channelConfig);if(/shutdown/.test(m.state))ma._shutdownHint=l[m.reason];ma.init(m.state,m.reason);}}if(p.get('early_channel',false)){db();}else ea.onAfterLoad(db);},6);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=Object.assign(new h(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});i.onBeforeUnload(function(){});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ca){v();q=n(w,ca);o.log('mute_warning',{time:ca});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ca,da){y();if(ca===k.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var ea=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:ea});}}else if(ca===k.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||!da.nextState&&da.state==='idle')){r=n(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=da.delay||0;o.log('reconnecting',{delay:fa});if(u.disconnected())o.log('reconnecting_ui',{delay:fa});s=u.RECONNECTING;da.state==='idle'&&t++;if(t>1){u.inform(u.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')z(ca,da);},500);}else if(ca===k.ON_SHUTDOWN){o.log('shutdown',{reason:da.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,da.reason);}}function aa(){if(l.isShutdown()){z(k.ON_SHUTDOWN,l._shutdownHint);}else z(k.ON_ENTER_STATE,{state:l.state,nextState:l.nextState,delay:0});}i.onAfterLoad(aa);Object.assign(u,{disconnected:function(){return s===u.SHUTDOWN||s===u.RECONNECTING&&!q&&t>1;},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:function(ca){if(l.state==='ping'||l.isShutdown())return;o.log('reconnect',{now:ca});u.inform(u.RECONNECTING,0);if(!!ca){if(p!==null){clearTimeout(p);p=null;}l.enterState('ping!');}else if(!p)p=n(function(){l.enterState('ping!');p=null;},k.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:w});function ba(){h.subscribe([k.ON_ENTER_STATE,k.ON_SHUTDOWN],z);h.subscribe(k.ATTEMPT_RECONNECT,function(){if(u.disconnected())u.reconnect();});j.subscribe(j.TIME_TRAVEL,function(){u.reconnect();x(k.MUTE_WARNING_TIME_MSEC);});i.onBeforeUnload(y,false);}i.onAfterLoad(ba);u.mockAfterLoad=function(){aa();ba();};f.exports=u;},null);
__d('TypingDetector',['ArbiterMixin','Event','Input','Run','SubscriptionsHandler','TypingStates','createObjectFrom','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(q,r){this._input=q;this._ignoreKeys={};this._getValueFn=r;}Object.assign(p.prototype,h,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=o;this.reset();this._subscriptions=new l();this._subscriptions.addSubscriptions(i.listen(this._input,'keyup',this._update.bind(this)),k.onUnload(this._onunload.bind(this)));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(q){this._ignoreKeys=n(q);},destroy:function(){this._subscriptions.release();},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var q=i.getKeyCode(event),r=this._currentState;if(!this._ignoreKeys[q]){var s=this._getValueFn?this._getValueFn():j.getValue(this._input);if(s.trim().length===0){if(r==m.TYPING)this._transition(m.INACTIVE);}else if(r==m.TYPING){this._recordKeystroke();}else if(r==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}}},_transition:function(q){this.reset();this._currentState=q;this.inform('change',q);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var q=this._lastKeystrokeTime+this._timeout,r=Date.now();if(r>q){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),q-r+10);}}});f.exports=p;},null);
__d('TypingDetectorController',['AsyncRequest','AvailableList','AvailableListConstants','ChannelConnection','ChatVisibility','Keys','MercuryServerRequestsConfig','TypingDetector','TypingStates','emptyFunction','setTimeoutAcrossTransitions','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();function t(u,v,w,x,y,z){'use strict';this.userID=u;this.input=v;this.source=w;this.threadID=y;this.remoteState=p.INACTIVE;this.notifyTimer=null;x=x||{};this.notifyDelay=x.notifyDelay||this.notifyDelay;this._typingDetector=new o(v,z);this._typingDetector.init(x);this._typingDetector.subscribe('change',this._stateChange.bind(this));}t.prototype.setUserAndThread=function(u,v){'use strict';if(this.userID!==u||this.threadID!==v){this.resetState();this.userID=u;this.threadID=v;}};t.prototype.setIgnoreEnter=function(u){'use strict';var v=u?[m.RETURN]:[];this._typingDetector.setIgnoreKeys(v);};t.prototype.resetState=function(){'use strict';this._notifyState(p.INACTIVE);this.remoteState=p.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};t.prototype.destroy=function(){'use strict';this.resetState();this._typingDetector.destroy();};t.prototype._stateChange=function(u,v){'use strict';if(v!=p.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(s(this._notifyState,this,v),this.notifyDelay);}else this._notifyState(v,true);};t.prototype._notifyState=function(u,v){'use strict';if(!this.userID&&!this.threadID||!l.isOnline()||u===this.remoteState||k.disconnected())return;this._sendRequest(u,this.userID,v);};t.prototype._sendRequest=function(u,v,w){'use strict';this.remoteState=u;var x={typ:u,to:v,source:this.source,thread:this.threadID},y=new h().setHandler(this._onTypResponse.bind(this,v)).setErrorHandler(q).setData(x).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous_DEPRECATED',!w);if(n.msgrRegion)y.setRequestHeader('X-MSGR-Region',n.msgrRegion);y.send();};t.prototype._onTypResponse=function(u,v){'use strict';var w=v.getPayload()||{};if(w.offline)i.set(u,j.OFFLINE,'typing_response');};Object.assign(t.prototype,{notifyDelay:1000});f.exports=t;},null);
__d('SplitImage.react',['React','Image.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.createClass({displayName:'SplitImage',render:function(){var m=this.props.size;return (h.createElement('div',babelHelpers._extends({},this.props,{className:k(this.props.className,"_55lt"),style:babelHelpers._extends({},this.props.style||{},{width:m,height:m})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var m=this.props.srcs,n=Array.isArray(m);if(n){m=m.filter(function(o){return o!==null;});if(!m.length)return null;}if(!n||m.length==1)return this.renderOne(n?m[0]:m);return m.length==2?this.renderTwo(m):this.renderThree(m);},renderOne:function(m){return (h.createElement(i,{src:m,width:this.props.size,height:this.props.size,alt:''}));},renderTwo:function(m){var n=this.props.size,o=Math.floor(n/2),p=-Math.floor(o/2),q="_55lu"+(this.props.border?' '+"_57xo":'');return (h.createElement('div',null,h.createElement('div',{className:"_55lu",style:{width:o}},h.createElement(i,{src:m[0],width:n,height:n,style:{marginLeft:p},alt:''})),h.createElement('div',{className:q,style:{width:o}},h.createElement(i,{src:m[1],width:n,height:n,style:{marginLeft:p},alt:''}))));},renderThree:function(m){var n=this.props.size,o=Math.floor(n/3*2),p=-Math.floor((n-o)/2),q=Math.floor(n/2),r=n-o,s=-Math.floor((q-r)/2),t="_55lu"+(this.props.border?' '+"_57pl":''),u="_55lu"+(this.props.border?' '+"_57pm":'');return (h.createElement('div',null,h.createElement('div',{className:t,style:{width:o}},h.createElement(i,{src:m[0],width:n,height:n,style:{marginLeft:p},alt:''})),h.createElement('div',{className:u,style:{width:r,height:q}},h.createElement(i,{src:m[1],width:q,height:q,style:{marginLeft:s},alt:''})),h.createElement('div',{className:"_55lu",style:{width:r,height:q}},h.createElement(i,{src:m[2],width:q,height:q,style:{marginLeft:s},alt:''}))));}});f.exports=l;},null);
__d('MercuryMessageInfo',['MercuryActionStatus','MercuryMessageDeliveryState','MercuryViewer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={isOutbound:function(l){return l.author===j.getID();},isInbound:function(l){return !k.isOutbound(l);},isSending:function(l){return (l.status===h.UNSENT||l.status===h.UNCONFIRMED||l.status===h.UNABLE_TO_CONFIRM||l.status===h.RESENDING);},isSent:function(l){return (l.status===undefined||l.status===h.SUCCESS);},hasError:function(l){return (l.status===h.FAILED_UNKNOWN_REASON||l.status===h.UNABLE_TO_CONFIRM||l.status===h.ERROR);},getDeliveryState:function(l,m){if(this.hasError(l))return i.ERROR;if(this.isSending(l))return i.SENDING;if(this.isSent(l)){if(l.timestamp<=m)return i.DELIVERED;return i.SENT;}return i.UNKNOWN;}};f.exports=k;},null);
__d('MercuryErrorInfo',['MercuryErrorType','MercuryMessageInfo','fbt'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={getMessage:function(l){var m='';if(k.isConnectionError(l)){m=j._("This message didn't send.");if(k.isTransient(l))m=j._("{message} Check your internet connection and click to try again.",[j.param('message',m)]);}else{if(l&&l.description){m=l.description;}else m=j._("This message failed to send.");if(k.isTransient(l))m=j._("{message} Click to send again.",[j.param('message',m)]);}return m;},isConnectionError:function(l){if(l&&l.type==h.TRANSPORT)return l.code===1001||l.code===1004||l.code===1006;return false;},isTransient:function(l){return l&&l.is_transient;},isPermanent:function(l){return l?!this.isTransient(l):false;},hasErrorStatus:function(l){return i.hasError(l);}};f.exports=k;},null);
__d('MercuryMessageError.react',['CurrentUser','ImmutableObject','MercuryErrorInfo','MercuryMessageActions','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'MercuryMessageError',propTypes:{authorFBID:o.string,message:o.instanceOf(i).isRequired},getDefaultProps:function(){return {authorFBID:h.getID()};},render:function(){var q=this.props.message,r=q.error_data;return (l.createElement('div',babelHelpers._extends({},this.props,{className:n(this.props.className,this._getClassNameFromStatus(q)),tabIndex:j.isTransient(r)?0:null,onClick:j.isTransient(r)?this.messageResend:null}),l.createElement('div',{className:"_2fs1"}),l.createElement('span',{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(q)}})));},messageResend:function(){k.getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(q){if(j.hasErrorStatus(q)){return "_2fs2"+(' '+"_2fs3")+(j.isTransient(q.error_data)?' '+"_2fs4":'')+(j.isPermanent(q.error_data)?' '+"_2fs5":'');}else return "_2fs6 _2fs2";},_getTextFromStatus:function(q){var r='',s=q.error_data;if(j.hasErrorStatus(q))r=j.getMessage(s);if(typeof r==='object'&&r.__html)r=r.__html;return r;}});f.exports=p;},null);
__d('PhotoStoreCore',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(i){if(!this._photoCache[i])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[i];},hasBeenCreated:function(i){return !!this._photoCache[i];},clearSetCache:function(i){delete this._photoCache[i];delete this._postCreateCallbacks[i];},getByIndex:function(i,j,k){this.getPhotoCache(i).getItemAtIndex(j,k);},getByIndexImmediate:function(i,j){if(this._photoCache[i])return this._photoCache[i].getItemAtIndexImmediate(j);return undefined;},getItemsInAvailableRange:function(i){var j=this.getAvailableRange(i),k=[];for(var l=j.offset;l<j.length;l++)k.push(this.getByIndexImmediate(i,l));return k;},getItemsAfterIndex:function(i,j,k,l){var m=this.getCursorByIndexImmediate(i,j);this.fetchForward(i,m,k,l);},getAllByIDImmediate:function(i){var j=Object.keys(this._photoCache);return j.map((function(k){return this.getByIndexImmediate(k,this.getIndexForID(k,i));}).bind(this)).filter(function(k){return !!k;});},getIndexForID:function(i,j){if(this._photoCache[i])return this._photoCache[i].getIndexForID(j);return undefined;},getEndIndex:function(i){var j=this.getAvailableRange(i);return j.offset+j.length-1;},getCursorByIndexImmediate:function(i,j){var k=this.getByIndexImmediate(i,j);if(k)return this._photoCache[i].getCursorForID(k.id);return undefined;},hasNextPage:function(i){var j=this.getCursorByIndexImmediate(i,this.getEndIndex(i));return this.getPhotoCache(i).hasNextPage(j);},getAvailableRange:function(i){return this.getPhotoCache(i).getAvailableRange();},hasLooped:function(i){return this.getPhotoCache(i).hasLooped();},fetchForward:function(i,j,k,l){this.getPhotoCache(i).getItemsAfterCursor(j,k,l);},fetchBackward:function(i,j,k,l){this.getPhotoCache(i).getItemsBeforeCursor(j,k,l);},executePostCreate:function(i,j){if(this._photoCache[i]){j&&j();}else this._postCreateCallbacks[i]=j;},runPostCreateCallback:function(i){var j=this._postCreateCallbacks[i];if(j){j();delete this._postCreateCallbacks[i];}},setPreFetchCallback:function(i,j){this.getPhotoCache(i).setPreFetchCallback(j);},updateData:function(i){var j=i.set_id;if(!this._photoCache[j]){this._photoCache[j]=new i.cache_class(i);this.runPostCreateCallback(j);}else if(i.query_metadata.action==h.actions.UPDATE){this._photoCache[j].updateData(i);}else this._photoCache[j].addData(i);},updateFeedbackData:function(i){var j=Object.keys(i);j.forEach(function(k){return h.getAllByIDImmediate(k).forEach(function(l){l.feedback=i[k].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach((function(i){return this.clearSetCache(i);}).bind(this));}};f.exports=h;},null);
__d("XStickerAssetController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/asset\/",{sticker_id:{type:"Int",required:true},image_type:{type:"Enum",defaultValue:"BestEffortImage",enumType:1}});},null);
__d('MessengerHotLikeUtils',['EmojiLikeConstants','StickerAssetType','StickerConstants','XStickerAssetController'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l={SizeTimes:{small:1000,medium:2000,large:3000},getStickerIDForTime:function(m){var n=null;switch(true){case m<this.SizeTimes.small:n=j.HOT_LIKE_SMALL_STICKER_ID;break;case m<this.SizeTimes.medium:n=j.HOT_LIKE_MEDIUM_STICKER_ID;break;case m<this.SizeTimes.large:n=j.HOT_LIKE_LARGE_STICKER_ID;break;}return n;},getEmojiSizeForTime:function(m){var n=null;if(m<this.SizeTimes.small){n=h.size.SMALL;}else if(m<this.SizeTimes.medium){n=h.size.MEDIUM;}else if(m<this.SizeTimes.large)n=h.size.LARGE;return n;},getGrowCoefficientForSince:function(m){return Math.min(1,(Date.now()-m)/this.SizeTimes.large);},getMetadataForHotLike:function(m){var n;switch(m){case j.HOT_LIKE_LARGE_STICKER_ID:n=120;break;case j.HOT_LIKE_MEDIUM_STICKER_ID:n=84;break;case j.HOT_LIKE_SMALL_STICKER_ID:n=35;break;}return n?{height:n,width:n}:undefined;},getPreviewURI:function(){return k.getURIBuilder().setInt('sticker_id',j.HOT_LIKE_LARGE_STICKER_ID).setEnum('image_type',i.IMAGE).getURI().toString();},getURIWithID:function(m){return k.getURIBuilder().setInt('sticker_id',m).setEnum('image_type',i.IMAGE).getURI().toString();}};f.exports=l;},null);
__d('MessengerContextBannerBootloader',['BootloadedComponent.react','CurrentUser','DOM','JSResource','React','ReactDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(q,r,s,t,u){var v=j.create('div');o(q,r,function(w){m.render(w,v,s(v));},t,u);}function o(q,r,s,t,u,v){v=babelHelpers._extends({left:0,position:'absolute',right:0,top:0},v);p({otherUserFBIDs:t&&[t],threadID:q,style:v},r,s,u);}function p(q,r,s,t){s(l.createElement(h,babelHelpers._extends({bootloadPlaceholder:l.createElement('div',{style:{height:80}}),bootloadLoader:k('MessengerContextBannerContainer.react'),location:r,onResize:t,viewer:i.getID()},q)));}f.exports={bootload:n,getBootloadedComponent:o};},null);
__d('EmojiLikeUtils',['EmoticonsList','EmojiLikeConstants','MercuryConfig','MercuryTagHelper','SupportedEmoji','Utf16'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n,o,p=i.size,q='/images/emoji/unicode/emoji_',r='/images/emoticons/',s=(n={},n[p.SMALL]='_16',n[p.MEDIUM]='_16-2x',n[p.LARGE]='_64',n),t=(o={},o[p.MEDIUM]='-2x',o),u='.png',v='emoji',w='emoticon',x=new RegExp('([\u203C\u2049\u2100-\u21FF\u2300-\u27FF'+'\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),y=function(da){if(!j.BubblelessEmojiRenderingGK)return false;var ea=da||'',fa=[],ga=null;while(ea.length>0){ea=ea.trim();if(h.noncapturingRegexp.test(ea)){ga=h.noncapturingRegexp.exec(ea);fa.push({type:w,title:ga[1],id:h.emotes[ga[1]]});ea=ea.replace(h.noncapturingRegexp,'');}else if(x.test(ea)){var ha=x.exec(ea);if(!ha||!ha.length)return false;ga=ha[1];var ia=m.decode(ga),ja=l.emoji[ia];if(!ja)return false;fa.push({type:v,id:ia.toString(16)});ea=ea.replace(x,'');}else return false;}return fa;};function z(da){return i.TAG_PREFIX+':'+da;}function aa(da){return !!(da&&k.get(da,i.TAG_PREFIX));}function ba(da,ea){return (q+m.decode(da).toString(16)+s[ea]+u);}function ca(da){var ea=p.LARGE,fa=p.MEDIUM,ga=[];if(da)da.forEach(function(ha){if(ha.type===v){ga.push({type:ha.type,title:undefined,url:q+ha.id+s[ea]+u});}else ga.push({type:ha.type,title:ha.title,url:r+ha.id+t[fa]+u});});return ga;}f.exports={getTag:z,getURI:ba,getSourceURIs:ca,hasEmojiTag:aa,richContent:y,EMOJI_TYPE:v,EMOTE_TYPE:w};},null);
__d('MercuryTypingReceiver',['Arbiter','ChannelConstants','FBID','MercuryActionType','MercuryIDs','MercuryPayloadSource','MercuryDispatcher','MercurySingletonMixin','MercuryViewer','TypingStates','isEmpty','mixInEventEmitter','setTimeoutAcrossTransitions','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryThreadIDMap').get(),v=30000;function w(x){'use strict';this.$MercuryTypingReceiver1=null;this.$MercuryTypingReceiver2={};this.$MercuryTypingReceiver3=n.getForFBID(x);this.$MercuryTypingReceiver3.subscribe('update-typing-state',(function(z,aa){var ba=aa.payload_source;if(ba!=m.CLIENT_CHANNEL_MESSAGE)return;var ca=aa.actions;if(!ca||!ca.length)return;var da=k.USER_GENERATED_MESSAGE;ca.forEach((function(ea){if(ea.action_type==da&&ea.author!=p.getID())this.$MercuryTypingReceiver4(ea.thread_id,ea.author);}).bind(this));}).bind(this));var y;if(j.isUser(x)){y=[i.getArbiterType('typ'),i.getArbiterType('ttyp')];}else y=[i.getArbiterType('page_typing')];h.subscribe(y,(function(z,aa){var ba=aa.obj,ca=this.$MercuryTypingReceiver5(ba);if(ca){var da=l.getParticipantIDFromUserID(ba.from);if(ba.st==q.TYPING){this.$MercuryTypingReceiver2[ca]=this.$MercuryTypingReceiver2[ca]||{};var ea=this.$MercuryTypingReceiver2[ca][da];this.$MercuryTypingReceiver2[ca][da]=Date.now();if(!this.$MercuryTypingReceiver1)this.$MercuryTypingReceiver1=t((function(){this.$MercuryTypingReceiver6();}).bind(this),3000);!ea&&this.$MercuryTypingReceiver7(ca);}else if(ba.st==q.INACTIVE)this.$MercuryTypingReceiver4(ca,da);}}).bind(this));}w.prototype.$MercuryTypingReceiver8=function(x){'use strict';var y=this.$MercuryTypingReceiver2[x]||{},z=Object.keys(y);z.sort(function(aa,ba){return y[aa]-y[ba];});return z;};w.prototype.$MercuryTypingReceiver6=function(){'use strict';this.$MercuryTypingReceiver1=null;var x=Date.now(),y={},z=false;for(var aa in this.$MercuryTypingReceiver2){var ba=false;for(var ca in this.$MercuryTypingReceiver2[aa]||{})if(this.$MercuryTypingReceiver2[aa][ca]<x-v){delete this.$MercuryTypingReceiver2[aa][ca];ba=true;}else z=true;if(ba)y[aa]=this.$MercuryTypingReceiver8(aa);}if(!r(y))this.$MercuryTypingReceiver9(y);if(z)this.$MercuryTypingReceiver1=t((function(){this.$MercuryTypingReceiver6();}).bind(this),3000);};w.prototype.$MercuryTypingReceiver4=function(x,y){'use strict';if(x in this.$MercuryTypingReceiver2)if(y in this.$MercuryTypingReceiver2[x]){delete this.$MercuryTypingReceiver2[x][y];this.$MercuryTypingReceiver7(x);}};w.prototype.$MercuryTypingReceiver9=function(x){'use strict';this.releaseHeldEventType('state-changed');this.emitAndHold('state-changed',x);};w.prototype.$MercuryTypingReceiver7=function(x){'use strict';var y={};y[x]=this.$MercuryTypingReceiver8(x);this.$MercuryTypingReceiver9(y);};w.prototype.$MercuryTypingReceiver5=function(x){'use strict';if(x.thread_fbid)return u.getClientIDFromServerIDNow(x.thread_fbid.toString());if(x.type==='typ'||x.type==='page_typing')return l.getThreadIDFromUserID(x.from);return null;};s(w,{'state-changed':true});Object.assign(w,o);f.exports=w;},null);
__d('MercuryIndicatorController',['ArbiterMixin','DOM','MercuryActionType','MercuryDelayedRoger','MercuryIDs','MercuryMessageSourceTags','MercuryParticipants','MercuryViewer','WorkModeConfig','arrayContains','formatDate','removeFromArray','fbt','MercuryRoger','MercuryThreads','MercuryTypingReceiver'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryRoger').get(),v=c('MercuryThreads').get(),w=c('MercuryTypingReceiver').get(),x=[];function y(z){this._threadID=z;this._canonicalUser=l.getUserIDFromThreadID(z);x.push(this);}Object.assign(y.prototype,h,{destroy:function(){s(x,this);},setLastMessage:function(z){this._lastMsg=z;this._handleStateChange();},_informStateChanged:function(z){if(z.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&o.isViewer(this._lastMsg.author))z.self_authored=true;this._currentActivity=z.activity;this.inform('state-changed',z);},_notifySentFrom:function(){var z,aa,ba=this._lastMsg.source_tags||[];if(q(ba,m.MESSENGER)){if(!p.is_work_user){z=i.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},t._("Sent from Messenger"));}else z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Work Chat"));aa='sentFromMobile';}else if(q(ba,m.MOBILE)){z=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},t._("Sent from Mobile"));aa='sentFromMobile';}else if(q(ba,m.EMAIL)){z=t._("Sent from email");aa='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:aa,text:z});},_notifySeenTimestamp:function(z){var aa=u.getSeenTimestamp(this._threadID,z[0])*.001,ba=Date.now()*.001,ca;if(aa<ba-518400){ca='M j';}else if(aa<ba-86400){ca='D g:ia';}else ca='g:ia';this._informStateChanged({activity:'seen-timestamp',text:t._("Seen {timestamp}",[t.param('timestamp',r(aa,ca))])});},_nameNormalizer:function(z){var aa;n.getMulti(z,function(ba){function ca(ea){if(ba[ea]!==undefined&&ba[ea].short_name){return ba[ea].short_name.toLowerCase();}else return ea;}var da=z.map(ca);aa=function(ea){var fa=ca(ea),ga=da.indexOf(fa)!==da.lastIndexOf(fa);return ga?ba[ea].name:ba[ea].short_name;};});return aa;},_seenByEveryone:function(z,aa,ba){var ca=ba?ba.participants.length:0,da=z.length;if(aa.author!=o.getID()&&(!ba||ba.participants.indexOf(aa.author)>-1))da++;return ca>2&&da>=ca-1;},_notifySeenBy:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,(function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea=null;if(da&&da.custom_nickname)ea=da.custom_nickname;var fa=[];for(var ga in ca){var ha=ca[ga],ia=ha.short_name;if(ea&&ea[ha.fbid])ia=ea[ha.fbid];fa[ga]=ia;}var ja,ka=false;if(this._seenByEveryone(z,aa,da)){ja=t._("Seen by everyone");}else if(z.length==1){ja=t._("Seen by {user}",[t.param('user',fa[z[0]])]);}else if(z.length==2){ja=t._("Seen by {user1}, {user2}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]])]);}else if(z.length==3){ja=t._("Seen by {user1}, {user2}, {user3}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]]),t.param('user3',fa[z[2]])]);}else if(z.length>3){var la=Object.keys(ca).length-2,ma=t._({"*":"{num} more"},[t.param('num',la,[0])]),na=i.create('span',{className:'more'},ma);ja=t._("Seen by {user1}, {user2}, {=num more link}",[t.param('user1',fa[z[0]]),t.param('user2',fa[z[1]]),t.param('=num more link',na)]);ka=true;}this._informStateChanged({activity:'seen-by',text:ja,seenBy:z,tooltip:ka});}).bind(this));ba&&this._informStateChanged({activity:'none'});},_notifyTyping:function(z){var aa=this._lastMsg,ba=true;n.getMulti(z,(function(ca){ba=false;if(this._lastMsg!=aa)return;var da=v.getThreadMetaNow(this._threadID),ea=da?da.participants.length:0,fa;if(da)fa=this._nameNormalizer(da.participants);if(!fa)fa=function(la){return ca[la].short_name;};var ga,ha=false;if(ea>2&&z.length>=ea-1){ga=t._("Everyone is typing...");}else if(z.length==1){ga=t._("{name} is typing...",[t.param('name',ca[z[0]].short_name)]);}else if(z.length==2){ga=t._("{user1} and {user2} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name)]);}else if(z.length==3){ga=t._("{user1}, {user2} and {user3} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('user3',ca[z[2]].short_name)]);}else if(z.length>3){var ia=Object.keys(ca).length-2,ja=t._({"*":"{num} more"},[t.param('num',ia,[0])]),ka=i.create('a',{href:'#'},ja);ga=t._("{user1}, {user2} and {=num more link} are typing...",[t.param('user1',ca[z[0]].short_name),t.param('user2',ca[z[1]].short_name),t.param('=num more link',ka)]);ha=true;}this._informStateChanged({activity:'typing',text:ga,typing:z,tooltip:ha});}).bind(this));ba&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var z=j.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==z){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=o.getID()){this._notifySentFrom();return;}var aa=k.getSeenBy(this._threadID,true);if(aa.length)if(this._canonicalUser){this._notifySeenTimestamp(aa);return;}else{this._notifySeenBy(aa);return;}this._informStateChanged({activity:'none'});}});w.addRetroactiveListener('state-changed',function(z){x.forEach(function(aa){var ba=z[aa._threadID];if(ba!==undefined){aa._typing=ba;aa._handleStateChange();}});});k.subscribe('state-changed',function(z,aa){x.forEach(function(ba){aa[ba._threadID]&&ba._handleStateChange();});});f.exports=y;},null);
__d('MercuryLastMessageIndicator.react',['DOM','MercuryIndicatorController','MercuryParticipants','React','ReactDOM','TooltipData','cx','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r=k.createClass({displayName:'MercuryLastMessageIndicator',propTypes:{hideTyping:q.bool,indicatorWillShow:q.func,indicatorDidShow:q.func,lastMessage:q.object,threadID:q.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:o,indicatorDidShow:o};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(s){if(s.threadID!=this.props.threadID){this._destroy();this._setup(s);}else if(s.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(s.lastMessage);},componentWillUpdate:function(s,t){if(this.isVisible(s,t))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (k.createElement('div',{className:this.getRootClass()},k.createElement('div',{className:"_510h"}),k.createElement('span',{className:"_510f",ref:'text'},'')));},getRootClass:function(){var s="_510g"+(this.state.data.self_authored?' '+"_510e":''),t=this.state.data.activity,u=null;if(String(t).startsWith('seen')){u='seen';}else if(t=='typing'){u=this.props.hideTyping?null:t;}else u=t;return p(s,u,this.props.className);},isVisible:function(s,t){s=s||this.props;t=t||this.state;return (t.data&&t.data.activity!='none'&&!(s.hideTyping&&t.data.activity=='typing'));},setText:function(){if(this.state.data.text)h.setContent(l.findDOMNode(this.refs.text),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)j.getMulti(this.state.data.seenBy,(function(s){var t=h.create('div',null,this.state.data.seenBy.map(function(u){return h.create('div',null,s[u].name);}));m.set(h.find(l.findDOMNode(this),'span.more'),t,'above','center');}).bind(this));},_setup:function(s){this._controller=new i(s.threadID);this._subscription=this._controller.subscribe('state-changed',(function(t,u){return this.setState({data:u});}).bind(this));s.lastMessage&&this._controller.setLastMessage(s.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});f.exports=r;},null);
__d('WebMessengerDeleteThreadDialog',['React','SimpleXUIDialog','XUIDialogButton.react','XUIDialogCancelButton.react','fbt','MercuryThreadActions'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryThreadActions').get(),n={show:function(o){var p=l._("Delete This Entire Conversation?"),q=l._("Once you delete your copy of this conversation, it cannot be undone."),r=h.createElement('div',null,h.createElement(k,null),h.createElement(j,{action:'cancel',label:l._("Delete Conversation"),use:'confirm',onClick:function(){return m['delete'](o);}}));i.showEx(q,p,r);}};f.exports=n;},null);
__d('WebMessengerThreadPermalinks',['MercuryIDs','MessagingTag','URI','WebMessengerPermalinkConstants','WWWBase','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={getThreadURI:function(r,s,t){if(h.isCanonical(r)){o(r,s,t);}else p(r,s,t);}};function o(r,s,t){var u=new j(l.uri),v=h.tokenize(r).value;u.setPath(q(t)+'/'+v);s&&s(u.toString());}function p(r,s,t){m('MercuryThreadIDMap',function(u){var v=u.get();v.getServerIDFromClientID(r,function(w){var x=new j(l.uri);x.setPath(k.getURIPathForThreadID(w,q(t)));s&&s(x.toString());});});}function q(r){var s=k.BASE_PATH;if(r&&r!=i.INBOX)s+='/'+r;return s;}f.exports=n;},null);
__d('MercuryTypeaheadDataSource',['Banzai','BanzaiLogger','CurrentUser','DataSource','MercuryConfig','MercuryParticipantTypes','MercuryTypeaheadConstants','OrderedFriendsList','ShortProfiles','WorkModeConfig','debounce'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s,t,u=500,v=[],w={},x={},y={},z=false,aa=false;s=babelHelpers.inherits(ba,k);t=s&&s.prototype;function ba(ca){'use strict';ca=ca||{};ca.kanaNormalization=true;t.constructor.call(this,ca);this.logQuery=r(function(da){this.$MercuryTypeaheadDataSource1(da);},u,this,true);this.logResponse=r(function(da){this.$MercuryTypeaheadDataSource1(da);},u,this,true);}ba.prototype.dirty=function(){'use strict';this.$MercuryTypeaheadDataSource2=v;this.localCache=x;this.queryCache=w;this.queryIDs=y;return this;};ba.prototype.bootstrap=function(){'use strict';if(z||aa)return false;this.$MercuryTypeaheadDataSource1({event:'bootstrap_start'});aa=true;p.fetchAll().then((function(){this.updateBootstrapData();this.$MercuryTypeaheadDataSource1({event:'bootstrap_end'});aa=false;z=true;}).bind(this),(function(){this.$MercuryTypeaheadDataSource1({event:'bootstrap_failure'});}).bind(this));return true;};ba.prototype.updateBootstrapData=function(){'use strict';var ca=this.getCachedShortProfileIDs(),da=q.is_work_user?m.FB4C:m.FRIEND,ea=ca.map(function(fa){var ga=p.getNow(fa),ha=fa==j.getID()?da:ga.type,ia=[ga.additionalName,ga.alternateName].concat(ga.searchTokens||[]).join(' ');return {uid:fa,index:o.getActiveRank(fa),text:ga.name,tokens:ia,localized_text:ga.name,additional_text:ga.additionalName,photo:ga.thumbSrc,render_type:ha,type:n.USER_TYPE};});if(ea.length)this.addEntries(ea);};ba.prototype.query=function(ca,da,ea,fa){'use strict';var ga=da||ca.length===1;return t.query.call(this,ca,ga,ea,fa);};ba.prototype.getQueryData=function(ca,da){'use strict';return babelHelpers._extends({},t.getQueryData.call(this,ca,da));};ba.prototype.setEntry=function(ca,da){'use strict';this.$MercuryTypeaheadDataSource2[ca]=da;};ba.prototype.getEntry=function(ca){'use strict';return this.$MercuryTypeaheadDataSource2[ca]||null;};ba.prototype.getCachedShortProfileIDs=function(){'use strict';var ca=p.getCachedProfileIDs(),da=ca.filter(function(ea){var fa=p.getNow(ea);return (ea==j.getID()||fa.type===m.FRIEND||fa.type===m.FB4C||fa.type===m.PAGE&&l.LinkedAgents&&l.LinkedAgents.indexOf(ea.toString())>-1);});return da;};ba.prototype.isBootstrapped=function(){'use strict';return z;};ba.prototype.isBootstrapping=function(){'use strict';return aa;};ba.prototype.processEntries=function(ca,da){'use strict';ca=ca.map(function(ea){if(ea.index==null&&(ea.render_type===m.FRIEND||ea.render_type===m.FB4C))ea.index=o.getActiveRank(ea.uid);if(ea.render_type===m.PAGE&&l.LinkedAgents&&l.LinkedAgents.indexOf(ea.uid.toString())>-1)ea.index=1;return ea;});return t.processEntries.call(this,ca);};ba.prototype.mergeUids=function(ca,da,ea,fa){'use strict';var ga=da.sort((function(ha,ia){return this.getEntry(ha).index-this.getEntry(ia).index;}).bind(this));return t.mergeUids.call(this,ca,ga,ea,fa);};ba.prototype.$MercuryTypeaheadDataSource1=function(ca){'use strict';if(!h.isEnabled('mercury_typeahead_logging'))return;i.log('MercuryQueryResultsLoggerConfig',ca);};f.exports=ba;},null);
__d('MessagesViewer',['AsyncRequest','Bootloader','DOM','MessagesViewerSetID','PhotoStore','React','ReactDOM','Run','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r={bootstrapWithElem:function(u){r.bootstrapWithConfig({fbid:u.getAttribute('data-fbid'),dimensions:u.getAttribute('data-dimensions'),src:u.getAttribute('href'),endpoint:u.getAttribute('data-endpoint'),disablePaging:u.getAttribute('data-disablepaging')},u);},bootstrapWithConfig:function(u,v){var w=u.setID;if(!w)w=k.MESSAGES;t(function(x,y){s(m.createElement(x,{actorid:u.actorid,dimensions:[u.dimensions],disablepaging:u.disablePaging,disableForward:u.disableForward,open:true,photoid:u.fbid,reverse:false,rootClassName:u.rootClassName,setid:w,snapToPhoto:u.snapToPhoto,thumbsrc:u.src}));if(!l.hasBeenCreated(w)&&u.endpoint){var z=new h(u.endpoint);if(v)z.setRelativeTo(v);z.send();}});},renderVideo:function(u){t(function(v,w){s(m.createElement(w,u));});},preload:function(){o.onAfterLoad(function(){return t(p);});}};function s(u){var v=q('messages_viewer');if(!v){v=j.create('div',{id:'messages_viewer'});document.body.appendChild(v);}u=n.render(u,v);u.subscribeOnce('close',function(){n.unmountComponentAtNode(v);});}function t(u){i.loadModules(["SpotlightMessagesViewer","MessagingVideoViewer.react"],u);}f.exports=r;},null);
__d('MercuryLogMessageRenderer',['BootloadedComponent.react','Bootloader','CSS','HovercardLink','JSResource','MercuryIDs','MercuryViewer','MessagesViewer','MercuryLogMessageType','MessagingGenericAdminTextType','MercuryParticipants','React','ReactDOM','Image.react','TextWithEntities.react','TooltipLink.react','UserAgent','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba={renderText:function(qa,ra){switch(qa.log_message_type){case p.SUBSCRIBE:ea(qa,ra);break;case p.UNSUBSCRIBE:ja(qa,ra);break;case p.THREAD_NAME:ka(qa,ra);break;case p.THREAD_IMAGE:la(qa,ra);break;case p.WALLPAPER:ma(qa,ra);break;case p.GENERIC_ADMIN_TEXT:na(qa,ra);break;default:i.loadModules(["MercurySpecialLogMessageRenderer"],function(sa){sa.renderText(qa,ra);});break;}},renderIcon:function(qa){return (s.createElement(u,{className:ca(qa),src:aa('images/spacer.gif')}));},renderLegacy:function(qa,ra,sa,ta){ca(ta).split(' ').forEach(function(ua){return ua&&j.addClass(qa,ua);});this.renderText(ta,function(ua){t.render(s.createElement('span',null,ua),ra);});this.renderAttachmentLegacy(sa,ta);},renderAttachmentLegacy:function(qa,ra){if(ra.log_message_type==p.THREAD_IMAGE){var sa=ra.log_message_data.image;if(sa&&sa.preview_url){t.render(s.createElement(u,{className:"_z6a",onClick:function(){return da(sa);},src:sa.preview_url}),qa);j.show(qa);}}}};f.exports=ba;function ca(qa){var ra=qa.log_message_type,sa=qa.log_message_data;return "_5wzu"+(ra==p.SUBSCRIBE?' '+"_5wzj":'')+(ra==p.UNSUBSCRIBE?' '+"_5wzk":'')+(ra==p.THREAD_NAME?' '+"_5wzl":'')+(ra==p.THREAD_IMAGE?' '+"_5wzm":'')+(ra==p.VIDEO_CALL&&sa.answered?' '+"_5wzn":'')+(ra==p.VIDEO_CALL&&!sa.answered?' '+"_5wzo":'')+(ra==p.PHONE_CALL&&sa.answered?' '+"_5wzp":'')+(ra==p.PHONE_CALL&&!sa.answered?' '+"_5wzq":'')+(ra==p.SERVER_ERROR?' '+"_5wzr":'');}function da(qa){o.bootstrapWithConfig({src:qa.preview_url,endpoint:qa.url,fbid:qa.metadata.fbid,dimensions:qa.metadata.dimensions,disablePaging:true},null);}function ea(qa,ra){var sa=pa(qa.log_message_data.added_participants);switch(sa.length){case 1:fa(qa,ra,sa);break;case 2:ga(qa,ra,sa);break;case 3:ha(qa,ra,sa);break;default:ia(qa,ra,sa);break;}}function fa(qa,ra,sa){var ta=[qa.author,sa[0]];r.getMulti(ta,function(ua){if(qa.author==n.getID()){ra(z._("You added {subscriber1}.",[z.param('subscriber1',oa(ua[sa[0]]))]));}else if(sa[0]==n.getID()){ra(z._("{actor} added you.",[z.param('actor',oa(ua[qa.author]))]));}else ra(z._("{actor} added {subscriber1}.",[z.param('actor',oa(ua[qa.author])),z.param('subscriber1',oa(ua[sa[0]]))]));});}function ga(qa,ra,sa){var ta=[qa.author].concat(sa);r.getMulti(ta,function(ua){if(qa.author==n.getID()){ra(z._("You added {subscriber1} and {subscriber2}.",[z.param('subscriber1',oa(ua[sa[0]])),z.param('subscriber2',oa(ua[sa[1]]))]));}else if(sa[0]==n.getID()){ra(z._("{actor} added you and {subscriber2}.",[z.param('actor',oa(ua[qa.author])),z.param('subscriber2',oa(ua[sa[1]]))]));}else ra(z._("{actor} added {subscriber1} and {subscriber2}.",[z.param('actor',oa(ua[qa.author])),z.param('subscriber1',oa(ua[sa[0]])),z.param('subscriber2',oa(ua[sa[1]]))]));});}function ha(qa,ra,sa){var ta=[qa.author].concat(sa);r.getMulti(ta,function(ua){if(qa.author==n.getID()){ra(z._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[z.param('subscriber1',oa(ua[sa[0]])),z.param('subscriber2',oa(ua[sa[1]])),z.param('subscriber3',oa(ua[sa[2]]))]));}else if(sa[0]==n.getID()){ra(z._("{actor} added you, {subscriber2} and {subscriber3}.",[z.param('actor',oa(ua[qa.author])),z.param('subscriber2',oa(ua[sa[1]])),z.param('subscriber3',oa(ua[sa[2]]))]));}else ra(z._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[z.param('actor',oa(ua[qa.author])),z.param('subscriber1',oa(ua[sa[0]])),z.param('subscriber2',oa(ua[sa[1]])),z.param('subscriber3',oa(ua[sa[2]]))]));});}function ia(qa,ra,sa){var ta=[qa.author].concat(sa);r.getMulti(ta,function(ua){function va(xa){var ya=s.createElement('div',null,xa.map(function(za){return s.createElement('div',null,za.name);}));return (s.createElement(w,{alignH:'center',position:'above',tooltip:ya},z._({"*":"{num} more"},[z.param('num',xa.length,[0])])));}var wa=sa.map(function(xa){return ua[xa];});if(qa.author==n.getID()){ra(z._("You added {subscriber1}, {subscriber2} and {more_people}.",[z.param('subscriber1',oa(wa[0])),z.param('subscriber2',oa(wa[1])),z.param('more_people',va(wa.slice(2)))]));}else if(sa[0]==n.getID()){ra(z._("{actor} added you, {subscriber2} and {more_people}.",[z.param('actor',oa(ua[qa.author])),z.param('subscriber2',oa(wa[1])),z.param('more_people',va(wa.slice(2)))]));}else ra(z._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[z.param('actor',oa(ua[qa.author])),z.param('subscriber1',oa(wa[0])),z.param('subscriber2',oa(wa[1])),z.param('more_people',va(wa.slice(2)))]));});}function ja(qa,ra){var sa=[qa.author],ta=qa.log_message_data.removed_participants,ua;if(ta.length===1){ua=ta[0];sa.push(ua);}r.getMulti(sa,function(va){var wa=va[qa.author],xa=va[ua];if(qa.author==n.getID()){if(!ua||ua==qa.author){ra(z._("You left the conversation."));}else ra(z._("You removed {name} from the conversation.",[z.param('name',oa(xa))]));}else if(!ua||ua==qa.author){ra(z._("{actor} left the conversation.",[z.param('actor',oa(wa))]));}else if(ua==n.getID()){ra(z._("{actor} removed you from the conversation.",[z.param('actor',oa(wa))]));}else ra(z._("{actor} removed {name} from the conversation.",[z.param('actor',oa(wa)),z.param('name',oa(xa))]));});}function ka(qa,ra){var sa=qa.log_message_data.name;if(qa.author==n.getID()){if(sa){var ta="_5wzs"+(x.isBrowser('Chrome')?' '+"_4fbd":'');ra(z._("You named the conversation: {name}.",[z.param('name',s.createElement('span',{className:ta},s.createElement(v,{renderEmoticons:true,renderEmoji:true,text:sa})))]));}else ra(z._("You removed the conversation name."));}else r.get(qa.author,function(ua){var va=oa(ua);if(sa){ra(z._("{actor} named the conversation: {name}.",[z.param('actor',va),z.param('name',s.createElement('span',{className:"_5wzs"},sa))]));}else ra(z._("{actor} removed the conversation name.",[z.param('actor',va)]));});}function la(qa,ra){if(qa.author==n.getID()){if(qa.log_message_data.image){ra(z._("You changed the conversation picture."));}else ra(z._("You removed the conversation picture."));}else r.get(qa.author,function(sa){var ta=oa(sa);if(qa.log_message_data.image){ra(z._("{actor} changed the conversation picture.",[z.param('actor',ta)]));}else ra(z._("{actor} removed the conversation picture.",[z.param('actor',ta)]));});}function ma(qa,ra){if(qa.author==n.getID()){ra(z._("You changed the wallpaper."));}else r.get(qa.author,function(sa){var ta=oa(sa);ra(z._("{actor} changed the wallpaper.",[z.param('actor',ta)]));});}function na(qa,ra){var sa=qa.log_message_body,ta=qa.log_message_data;switch(ta.message_type){case q.TURN_ON_PUSH:if(sa&&sa.length>0)sa=z._("{admin-text-message} for Messenger on mobile.",[z.param('admin-text-message',sa.substring(0,sa.length-1))]);break;case q.JOURNEY_PROMPT_COLOR:sa=z._("You need to be on the latest version of Messenger on a mobile device to pick a colour for this conversation.");break;case q.JOURNEY_PROMPT_NICKNAME:var ua=null,va=m.getUserIDFromParticipantID(qa.author);if(qa.other_user_fbid&&va!==qa.other_user_fbid){var wa=m.getParticipantIDFromUserID(qa.other_user_fbid);ua=r.getOrFetch(wa);}if(ua&&ua.short_name){sa=z._("You need to be on the latest version of Messenger on a mobile device to set a nickname for {admin-text-message} .",[z.param('admin-text-message',ua.short_name)]);}else sa=z._("You need to be on the latest version of Messenger on a mobile device to set a nickname for yourself.");break;case q.JOURNEY_PROMPT_LIKE:sa=z._("You need to be on the latest version of Messenger on a mobile device to pick an emoji for this conversation.");break;default:break;}ra(sa);}function oa(qa,ra){var sa=qa.fbid,ta=k.constructEndpoint({id:sa});if(qa.href)return (s.createElement('a',{className:"_5wzt",href:qa.href,'data-hovercard':ta},ra?qa.short_name:qa.name));return qa.name;}function pa(qa){var ra=qa.indexOf(n.getID());if(ra>0){var sa=qa.filter(function(ta){return ta!==n.getID();});return [n.getID()].concat(sa);}return qa;}},null);
__d('MercuryThreadSearchUtils',['escapeRegex','TokenizeUtil'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={wordsInString:function(k){return (k||'').split(/\s+/).filter(function(l){return l.trim().length>0;});},anyMatchPredicate:function(k,l){for(var m=0;m<k.length;m++)if(l(k[m]))return true;return false;},allMatchPredicate:function(k,l){for(var m=0;m<k.length;m++)if(!l(k[m]))return false;return true;},queryWordMatchesAnyNameWord:function(k,l){var m=new RegExp('^'+h(k),'i');return this.anyMatchPredicate(l,function(n){var o=i.parse(n).flatValue;return m.test(o);});},queryMatchesName:function(k,l){var m=this.wordsInString(k),n=this.wordsInString(l);return this.allMatchPredicate(m,(function(o){return this.queryWordMatchesAnyNameWord(o,n);}).bind(this));}};f.exports=j;},null);
__d('MercuryMessageGroup',['MercuryActionType','MercuryAttachmentType','MercuryShareAttachmentRenderLocations','MercuryThreadlistConstants','enumerate'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m={calculateMessageGroups:function(p,q){var r=[],s=null,t={value:null},u=l(p),v;while(!(v=u.next()).done){var w=m.canAppendMessageToLastGroup(t.value,v.value,q);if(!w){s=[];r.push(s);}s.push(v.value);t=v;}return r;},canAppendMessageToLastGroup:function(p,q,r){var s=k.GROUPING_THRESHOLD;if(!p||n(p,r)||n(q,r)||p.author!=q.author||p.timestamp<q.timestamp-s||p.is_spoof_warning!==q.is_spoof_warning||p.page_admin_notes)return false;return true;}};function n(p,q){var r=p.has_attachment;if(r&&(q===j.MESSENGER||q===j.CHAT))r=o(p);return !!(p.action_type==h.LOG_MESSAGE||r||p.forward_count||p.html_body||p.body&&p.body.length>k.MAX_CHARS_BEFORE_BREAK);}function o(p){var q=p.attachments[0];return (!q||q.attach_type===i.STICKER||q.attach_type===i.ANIMATED_IMAGE);}f.exports=m;},null);
__d('P2PAbstractSendMoneyButton.react',['React','TooltipLink.react','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=h.PropTypes,n=h.createClass({displayName:'P2PAbstractSendMoneyButton',propTypes:{button:m.object,isActive:m.bool.isRequired,isDisabled:m.bool.isRequired,isMessenger:m.bool.isRequired,onClick:m.func.isRequired,onMouseOver:m.func,recipientName:m.string},_clickGuard:false,render:function(){return (h.createElement(i,{alignH:'center',className:l(this.props.className,(this.props.isActive?"open":'')+(this.props.isDisabled?' '+"disabled":'')+(this.props.isActive?' '+"_10gz":'')+(this.props.isDisabled?' '+"_10g-":'')+(!this.props.isMessenger&&!this.props.className?' '+"_5uqy":'')+(this.props.isMessenger?' '+"_3ggc":'')),href:'#',onClick:this._handleClick,onMouseDown:this._prepareForClick,onMouseOver:this.props.onMouseOver,position:'above',role:'button',title:this._getLinkTitle(),tooltip:this._getDisabledTitle()},this.getButton()));},getButton:function(){if(this.props.button)return this.props.button;return h.createElement('i',{className:"_5s8l"});},_getLinkTitle:function(){if(this.props.isDisabled)return null;return k._("Send money");},_getDisabledTitle:function(){if(!this.props.isDisabled||!this.props.recipientName)return null;return k._("{receiverName} is unable to receive money at the moment.",[k.param('receiverName',this.props.recipientName)]);},_prepareForClick:function(){this._clickGuard=this.props.isActive;},_handleClick:function(o){o.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}this.props.onClick();}});f.exports=n;},null);
__d('P2PSendMoneyContainerBootloader.react',['Bootloader','CurrentEnvironment','DeferredComponent.react','P2PAbstractSendMoneyButton.react','React','Run','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=i.messengerdotcom,q=l.createClass({displayName:'P2PSendMoneyContainerBootloader',propTypes:{button:o.node,className:o.string,flyoutAlignment:o.string,participantIDs:o.array,onTrigger:o.func,threadID:o.string},render:function(){return (l.createElement(j,babelHelpers._extends({deferredComponent:r,deferredPlaceholder:this._renderPlaceholder()},this.props)));},_renderPlaceholder:function(){return (l.createElement(k,{button:this.props.button,className:this.props.className,isActive:false,isDisabled:true,isMessenger:p,onClick:n,onMouseOver:s}));}});function r(t){m.onAfterLoad(function(){h.loadModules(["P2PSendMoneyContainer.react"],t);});}function s(){h.loadModules(["P2PSendMoneyContainer.react"],n);}f.exports=q;},null);
__d('isSocialPlugin',['CSS'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h.hasClass(document.body,'plugin');f.exports=i;},null);
__d('StickersDispatcher',['Dispatcher_DEPRECATED','StickerConstants'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=Object.assign(new h(),{_handleUpdate:function(k,l){var m=babelHelpers._extends({payloadSource:k},l);this.dispatch(m);},handleUpdateFromViewActions:function(k){this._handleUpdate(i.PayloadSource.VIEW_ACTION,k);}});f.exports=j;},null);
__d('StickerActions',['BanzaiLogger','StickersDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j({ADD_PACK:null,CLICKED_STICKER_IN_THREAD:null,HIDE_TRAY:null,REMOVE_PACK:null,REPLACE_STICKER_STATE:null,RESET_NUM_NEW_PACKS:null,SELECT_PACK:null,SELECT_STORE_PACK:null,SHOW_TRAY:null,UPDATE_TRAY_DATA:null,TRAY_DATA_READY:null}),l={Types:k,addPack:function(m){i.dispatch({type:k.ADD_PACK,packID:m});},removePack:function(m){i.dispatch({type:k.REMOVE_PACK,packID:m});},selectPack:function(m,n){if(!n)h.log('StickersLoggerConfig',{event:'select_pack',packid:m});i.dispatch({type:k.SELECT_PACK,packID:m});},selectStorePack:function(m){i.dispatch({type:k.SELECT_STORE_PACK,packID:m});},resetNumNewPacks:function(){i.dispatch({type:k.RESET_NUM_NEW_PACKS});},handleStickerClick:function(m,n){i.dispatch({packID:m,threadID:n,type:l.Types.CLICKED_STICKER_IN_THREAD});},showStickerTray:function(m){i.dispatch({type:l.Types.SHOW_TRAY,threadID:m});},hideStickerTray:function(){i.dispatch({type:l.Types.HIDE_TRAY});},updateTrayData:function(){i.dispatch({type:l.Types.UPDATE_TRAY_DATA});},loadedTrayData:function(){i.dispatch({type:l.Types.TRAY_DATA_READY});}};f.exports=l;},null);
__d("XStickerPackImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int",defaultValue:50}});},null);
__d("XStickerQueryImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/query\/images\/",{query:{type:"String",required:true},sticker_interface:{type:"String"}});},null);
__d("XStickerStateInitialDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/",{});},null);
__d("XStickerStatePackDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});},null);
__d("XStickerStateStoreDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/store\/",{});},null);
__d("XStickersAddPackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/addpack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},is_promoted:{type:"Bool",defaultValue:false}});},null);
__d("XStickersRemovePackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/removepack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"}});},null);
__d('StickerServerRequests',['Promise','AsyncRequest','XStickerPackImagesController','XStickersAddPackController','XStickersRemovePackController','XStickerStateInitialDataController','XStickerStatePackDataController','XStickerStateStoreDataController','XStickerQueryImagesController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q={addPack:function(s,t,u){var v=k.getURIBuilder().setInt('pack_id',s).setBool('is_promoted',t).getURI();new i(v).setHandler(function(w){return u(w.payload);}).send();},removePack:function(s,t){var u=l.getURIBuilder().setInt('pack_id',s).getURI();new i(u).setHandler(function(v){return t(v.payload);}).send();},getStickersForPack:function(s,t){var u=j.getURIBuilder().setInt('pack_id',s).setInt('sticker_size',t).getURI();return new h(function(v,w){return (new i().setURI(u).setMethod('GET').setReadOnly(true).setHandler(function(x){return v(x.payload);}).send());});},getStickersForQuery:function(s,t,u){new i().setURI(p.getURIBuilder().setString('query',s).setString('sticker_interface',t).getURI()).setMethod('GET').setReadOnly(true).setHandler(function(v){return u(v);}).send();},fetchTrayData:function(s){return r(m.getURIBuilder().getURI(),s,true);},fetchStoreData:function(s){return r(o.getURIBuilder().getURI(),s);},fetchPackData:function(s,t){return r(n.getURIBuilder().setInt('pack_id',s).getURI(),t);}};function r(s,t,u){return new h(function(v,w){return (new i(s).setHandler(function(x){return v(x.getPayload());}).setAllowCrossPageTransition(u).send());}).then(t);}f.exports=q;},null);
__d('StickerImages',['StickerServerRequests'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={},j={},k={},l={getStickerTagsData:function(){return k;},requestStickersForPack:function(m,n,o){if(!m)return;if(!j[m]){j[m]=h.getStickersForPack(m,n);j[m].then((function(p){p.forEach((function(q){return this.cacheSticker(q);}).bind(this));}).bind(this));}j[m].then(function(p){return o(p);});},cacheSticker:function(m){i[m.id]=m;},getSticker:function(m){return i[m];}};f.exports=l;},null);
__d('StickerState',['ImmutableObject','StickerConfig','PresenceState','StickerActions','StickerConstants','StickerImages','StickerServerRequests'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o={},p,q,r,s=null,t=0,u={},v=[],w=[],x=[],y=null,z=null,aa=j.get();if(aa)y=aa.tray_pack_id;var ba=i.ShowStickerReplyNUX,ca={onTrayDataReady:function(ea){if(!q)q=n.fetchTrayData(function(fa){v=fa.packs.map(function(ga){return da(ga);});r=fa.mru;t=fa.num_new_packs;x=fa.tags;});q.then(function(){ea();k.loadedTrayData();});},onStoreDataReady:function(ea){if(!p)p=n.fetchStoreData(function(fa){w=fa.packs.map(function(ga){return da(ga);});});p.then(ea);},onPackDataReady:function(ea,fa){if(!o[ea])o[ea]=n.fetchPackData(ea,function(ga){da(ga);});o[ea].then(fa);},getPacksInTrayAllInterfaces:function(){return v;},getPacksInTray:function(){var ea=[],fa;for(var ga=0;ga<v.length;ga++)if(v[ga].id==l.EMOTICON_PACK_ID){fa=v[ga];}else if(v[ga].isMessengerCapable)ea.push(v[ga]);fa&&ea.push(fa);return ea;},getPacksInCommentsTray:function(){var ea=[],fa=[],ga;for(var ha=0;ha<v.length;ha++)if(v[ha].id==l.EMOTICON_PACK_ID){ga=v[ha];}else if(v[ha].isCommentsCapable){ea.push(v[ha]);}else fa.push(v[ha]);var ia=ea.concat(fa);if(ga)ia.push(ga);return ia;},getPacksInComposerTray:function(){return v.filter(function(ea){return ea.isComposerCapable;});},getPacksInFramesTray:function(){return v.filter(function(ea){return ea.isFramePack;});},getPackIDsInTray:function(){return v.map(function(ea){return ea.id;});},getPacksInStore:function(){return w.filter(function(ea){return ea.isMessengerCapable;});},getComposerPacksInStore:function(){return w.filter(function(ea){return ea.isComposerCapable;});},getPack:function(ea){return u[ea];},getNumNewPacks:function(){return t;},getFeaturedTags:function(){return x;},resetNumNewPacks:function(){t=0;},addMRUPack:function(){if(r){this._addPackToTray(r);r=null;}},addPack:function(ea){var fa=false;if(u[ea])fa=u[ea].isPromoted;n.addPack(ea,fa,(function(ga){this._addPackToTray(ga);}).bind(this));},removePack:function(ea){n.removePack(ea,function(fa){v=v.filter(function(ga){return ga.id!==fa;});u[fa]=h.set(u[fa],{isInTray:false});w=w.map(function(ga){return u[ga.id];});k.updateTrayData();});},setTrayPackID:function(ea){y=ea;j.doSync();},getTrayPackID:function(ea){if(ea&&ea.length>0&&!ea.some(function(fa){return fa.id===y;})){return ea[0].id;}else return y;},setStorePackID:function(ea){z=ea;},getStorePackID:function(){return z;},shouldShowStickerReplyNUX:function(){return ba;},clearShowStickerReplyNUX:function(){ba=false;},_addPackToTray:function(ea,fa){da(ea);u[ea.id]=h.set(u[ea.id],{isPurchased:!fa,isInTray:true});var ga=v.filter(function(ia){return ia.id===ea.id;}).length>0;if(!ga){var ha;if(!fa){ha=v.filter(function(ia){return ia.isMRU||ia.isSearch;}).length;}else ha=v.filter(function(ia){return ia.id!==l.EMOTICON_PACK_ID;}).length;v.splice(ha,0,u[ea.id]);}w=w.map(function(ia){return u[ia.id];});k.updateTrayData();},_addRecentlyUsedSticker:function(ea){for(var fa=0;fa<s.length;++fa)if(s[fa].id===ea.id){s.splice(fa,1);break;}s.unshift(ea);},getMRUStickerPack:function(ea){if(!s)s=ea;return s;},updateRecentlyUsed:function(ea){if(!s){this.addMRUPack();return;}this._addRecentlyUsedSticker(m.getSticker(ea));}};j.registerStateStorer(function(ea){ea.tray_pack_id=y;});function da(ea){var fa=ea.id;if(!u[fa]){return u[fa]=new h(ea);}else return u[fa]=h.set(u[fa],ea);}f.exports=ca;},null);
__d('AbstractDialogFitHeight',['CSS','DOM','Event','Style','SubscriptionsHandler','Vector','csx','cx','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=450,r=100,s=67,t=67;function u(v){'use strict';this.$AbstractDialogFitHeight1=v;}u.prototype.enable=function(){'use strict';this.$AbstractDialogFitHeight2=new l();this.$AbstractDialogFitHeight2.addSubscriptions(this.$AbstractDialogFitHeight1.subscribe('beforeshow',this.$AbstractDialogFitHeight3.bind(this)),j.listen(window,'resize',p(this.$AbstractDialogFitHeight3.bind(this))));this.$AbstractDialogFitHeight4=i.find(this.$AbstractDialogFitHeight1.getRoot(),"._4-i2");h.addClass(this.$AbstractDialogFitHeight4,"_5pfh");this.$AbstractDialogFitHeight5=r;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._4-i0").length)this.$AbstractDialogFitHeight5+=s;if(i.scry(this.$AbstractDialogFitHeight1.getRoot(),"._5a8u").length)this.$AbstractDialogFitHeight5+=t;};u.prototype.disable=function(){'use strict';this.$AbstractDialogFitHeight2.release();this.$AbstractDialogFitHeight2=null;h.removeClass(this.$AbstractDialogFitHeight4,"_5pfh");};u.prototype.$AbstractDialogFitHeight3=function(){'use strict';var v=m.getViewportDimensions().y,w=v-this.$AbstractDialogFitHeight5;k.set(this.$AbstractDialogFitHeight4,this.getHeightProperty(),Math.max(q,w)+'px');this.$AbstractDialogFitHeight1.updatePosition();};f.exports=u;},null);
__d('DialogFitHeight',['AbstractDialogFitHeight'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.getHeightProperty=function(){'use strict';return 'height';};function k(){'use strict';i.apply(this,arguments);}f.exports=k;},null);
__d('StickerStoreController',['Bootloader','DialogFitHeight','DOM','LayerAutoFocus','LayerFadeOnHide','LayerHideOnEscape','React','ReactComponentRenderer','StickerActions','XUIDialog.react','XUIDialogBody.react','XUISpinner.react','cx','isSocialPlugin','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=n.PropTypes,x=688,y=320,z=null,aa=n.createClass({displayName:'StoreLayer',propTypes:{isComposer:w.bool,shown:w.bool},getDefaultProps:function(){return {isComposer:false,shown:false};},getInitialState:function(){return {renderStore:function(){return (n.createElement('div',{className:"_5r5e"},n.createElement(s,{background:'light',size:'large'})));}};},componentDidMount:function(){h.loadModules(["StickerStore.react"],(function(da){this.setState({renderStore:(function(){return (n.createElement(da,{isComposer:this.props.isComposer,shown:this.props.shown}));}).bind(this)});}).bind(this));},_onToggle:function(da){v((function(){return this.setProps({shown:da});}).bind(this));},render:function(){var da=u&&document.body.offsetWidth<x?y:x;return (n.createElement(q,{behaviors:{DialogFitHeight:i,LayerAutoFocus:k,LayerFadeOnHide:l,LayerHideOnEscape:m},onToggle:this._onToggle,shown:this.props.shown,width:da},n.createElement(r,{className:"_5rq- autofocus"},this.state.renderStore())));}});function ba(da){var ea=j.create('div');j.appendContent(document.body,ea);z=new o(aa,ea);z.setProps({isComposer:da,shown:true});}var ca={showStore:function(da,ea){if(!z){ba(!!ea);}else z.setProps({shown:true,isComposer:!!ea});p.selectStorePack(da);}};f.exports=ca;},null);
__d('StickerStateStore',['FluxStore','StickerActions','StickerInterfaces','StickersDispatcher','StickerState','StickerStoreController','arrayContains','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p,q;'use strict';p=babelHelpers.inherits(r,h);q=p&&p.prototype;function r(){q.constructor.call(this,k);this.$StickerStateStore1=false;}r.prototype.getState=function(s){var t=null;if(s===j.COMPOSER){t=l.getPacksInComposerTray();}else if(s===j.COMMENTS){t=l.getPacksInCommentsTray();}else if(s===j.FRAMES){t=l.getPacksInFramesTray();}else t=l.getPacksInTray();return {showTray:this.$StickerStateStore2,storePackID:l.getStorePackID(),packID:l.getTrayPackID(t),trayPacks:t,numNewPacks:l.getNumNewPacks(),threadID:this.$StickerStateStore3,trayDataReady:this.$StickerStateStore1};};r.prototype.isPackInTray=function(s){if(!this.$StickerStateStore1)l.onTrayDataReady(o);var t=l.getPacksInTrayAllInterfaces();return t.some(function(u){return u.id===s;});};r.prototype.__onDispatch=function(s){var t=i.Types;switch(s.type){case t.REPLACE_STICKER_STATE:this.$StickerStateStore2=!!s.showTray;break;case t.SHOW_TRAY:this.$StickerStateStore2=true;this.$StickerStateStore3=s.threadID;break;case t.HIDE_TRAY:this.$StickerStateStore2=false;break;case t.CLICKED_STICKER_IN_THREAD:l.onTrayDataReady((function(){if(n(l.getPackIDsInTray(),s.packID)){l.setTrayPackID(s.packID);this.$StickerStateStore2=true;this.$StickerStateStore3=s.threadID;}else{this.$StickerStateStore2=false;m.showStore(s.packID);}}).bind(this));break;case t.SELECT_PACK:l.setTrayPackID(s.packID);break;case t.SELECT_STORE_PACK:l.setStorePackID(s.packID);break;case t.RESET_NUM_NEW_PACKS:l.resetNumNewPacks();break;case t.ADD_PACK:l.addPack(s.packID);break;case t.REMOVE_PACK:l.removePack(s.packID);break;case t.UPDATE_TRAY_DATA:break;case t.TRAY_DATA_READY:this.$StickerStateStore1=true;break;}this.__emitChange();};f.exports=new r();},null);
__d('legacy:CompactTypeaheadRenderer',['CompactTypeaheadRenderer'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadRenderers)b.TypeaheadRenderers={};b.TypeaheadRenderers.compact=c('CompactTypeaheadRenderer');},3);