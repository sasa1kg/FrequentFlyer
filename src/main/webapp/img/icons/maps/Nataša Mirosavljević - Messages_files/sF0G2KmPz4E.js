/*!CK:410439214!*//*1451899397,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["0ekgi"]); }

__d('P2PSendMoneyButton.react',['CurrentEnvironment','immutable','P2PAbstractSendMoneyButton.react','P2PActions','P2PErrorDialog.react','P2PGKValues','P2PGroupSendDialog.react','P2PPasswordProtectionNUXDialog.react','P2PPasswordProtectionStatusTypes','P2PSendMoneyDialog.react','P2PSendMoneyNUXContextualDialog.react','P2PSendMoneySuccessDialog.react','P2PTransferParam','P2PTransferStore','P2PTransferRiskResult','P2PUnderManualReviewDialog.react','P2PVerificationFlowHelper','React','ReactDOM','ReactLayeredComponentMixin','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';if(c.__markCompiled)c.__markCompiled();var da=y.PropTypes,ea=y.createClass({displayName:'P2PSendMoneyButton',mixins:[aa],propTypes:{amount:da.string,button:da.object,groupThreadFBID:da.string,flyoutAlignment:da.string,isNewEmptyLocalThread:da.bool,isGroupChat:da.bool,onTrigger:da.func,participants:da.instanceOf(i.List),platformData:da.object,sendMoneyDialogShown:da.bool,threadID:da.string,threadFBID:da.string},getDefaultProps:function(){return {amount:'',groupThreadFBID:'',onTrigger:ba,sendMoneyDialogShown:false};},getInitialState:function(){return {sendMoneyNUXDismissed:false};},canShowSendMoneyDialog:function(){if(!this.props.participants||!this.props.participants.size)return false;if(this.getRecipient()&&!this.isRecipientEligible())return false;return true;},originalCreateTransactionResponse:null,_onButtonClick:function(){this.canShowSendMoneyDialog()&&this.showSendMoneyDialog();},hideSendMoneyDialog:function(){k.chatSendViewClosed({threadID:this.props.threadID});},showSendMoneyDialog:function(){k.chatSendViewOpened({referrer:this.props.referrer,threadID:this.props.threadID});},_handleDialogToggle:function(fa){if(!fa){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},handlePaymentRequestSuccess:function(){this.hideSendMoneyDialog();this.props.onTrigger();},handleOnSendSuccess:function(fa){this.hideSendMoneyDialog();var ga=fa[t.RISK_RESULT];this.originalCreateTransactionResponse=fa;if(ga===v.REQUIRE_VERIFICATION){x.startVerificationFlow(fa.id,true,this.handleVerificationCompleted);}else if(ga===v.UNDER_MANUAL_REVIEW){this.showUnderManualReviewDialog();}else this.handlePostSendSteps(false);},handleVerificationCompleted:function(fa){this.handlePostSendSteps(!fa);},handlePostSendSteps:function(fa){var ga=this.originalCreateTransactionResponse,ha=ga.passwordProtection===p.NOT_SET;if(!fa&&ga.isFirstSend){this._passwordNUXPending=ha;this.showSendSuccessDialog();}else if(ha){this.showPasswordProtectionDialog();}else k.hideDialog();this.originalCreateTransactionResponse=null;this.props.onTrigger();},handleConfirmationOKClick:function(){if(this._passwordNUXPending){this._passwordNUXPending=false;this.showPasswordProtectionDialog();}else k.hideDialog();},handleSendError:function(fa){this.showErrorDialog(fa);},handlePaymentRequestError:function(fa){this.showPaymentRequestErrorDialog(fa);},getMoneyButtonNode:function(){return z.findDOMNode(this.refs.p2pSendMoneyButton);},getRecipient:function(){if(!this.props.isGroupChat&&this.props.participants){return this.props.participants.first();}else return this.getGroupSendRecipient();},getGroupSendRecipient:function(){return (this.props.participants&&this.props.participants.find((function(fa){return fa.userID===this.props.groupSendRecipientUserID;}).bind(this)));},isRecipientEligible:function(){var fa=this.getRecipient();if(!fa)return false;return !!(fa.p2p_eligible||u.hasReceivedFromSender(fa.userID));},showErrorDialog:function(fa){var ga=ca._("Problem While Sending Money");k.showDialog(l,{error:fa,onOKClick:k.hideDialog,title:ga});},showPaymentRequestErrorDialog:function(fa){var ga=ca._("Problem with money request");k.showDialog(l,{error:fa,onOKClick:k.hideDialog,title:ga});},showPasswordProtectionDialog:function(){k.showDialog(o,{onComplete:k.hideDialog});},showSendSuccessDialog:function(){k.showDialog(s,{onClose:this.handleConfirmationOKClick});},showUnderManualReviewDialog:function(){k.showDialog(w,{onClose:this.handlePostSendSteps.bind(this,false)});},shouldShowNUX:function(){return (!this.state.sendMoneyNUXDismissed&&!m.P2PUserAddedCredentialBefore&&!u.hasSentDuringSession());},renderLayers:function(){var fa={},ga='USD',ha='$',ia=this.getRecipient();if(this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown)if(this.shouldShowNUX()){fa.nux=y.createElement(r,{context:this.getMoneyButtonNode(),loggingData:{object_id:ia&&ia.userID},flyoutAlignment:this.props.flyoutAlignment,onNextClick:(function(){return this.setState({sendMoneyNUXDismissed:true});}).bind(this),onToggle:this._handleDialogToggle});}else if(!this.props.groupSendRecipientUserID&&this.props.isGroupChat&&this.props.threadFBID){fa.groupSendMoneyDialog=y.createElement(n,{amount:this.props.amount,context:this.getMoneyButtonNode(),flyoutAlignment:this.props.flyoutAlignment,currency:ga,onToggle:this._handleDialogToggle,participants:this.props.participants,referrer:this.props.referrer,threadID:this.props.threadID,threadFBID:this.props.threadFBID});}else fa.sendMoneyDialog=y.createElement(q,{amount:this.props.amount,context:this.getMoneyButtonNode(),currency:ga,currencySymbol:ha,groupThreadFBID:this.props.groupThreadFBID,flyoutAlignment:this.props.flyoutAlignment,memoText:this.props.memoText,onToggle:this._handleDialogToggle,onError:this.handleSendError,onPaymentRequestError:this.handlePaymentRequestError,onPaymentRequestSuccess:this.handlePaymentRequestSuccess,onSendSuccess:this.handleOnSendSuccess,platformData:this.props.platformData,receiver:ia,ref:'send_money_dialog',referrer:this.props.referrer,paymentRequestID:this.props.paymentRequestID,useModal:this.props.useModal});return fa;},render:function(){var fa=this.getRecipient();if(this.props.isNewEmptyLocalThread&&this.props.participants.size>1)return null;return (y.createElement(j,{button:this.props.button,className:this.props.className,isActive:this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown,isDisabled:!!(fa&&!this.isRecipientEligible()),isMessenger:!!h.messengerdotcom,onClick:this._onButtonClick,recipientName:fa&&fa.short_name,ref:'p2pSendMoneyButton'}));}});f.exports=ea;},null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';var m,n;k=babelHelpers.inherits(o,i);l=k&&k.prototype;function o(){l.constructor.call(this);n={};m=j.register(this.onEventDispatched.bind(this));}o.prototype.onEventDispatched=function(p){var q=p.data,r=p.type;switch(r){case h.CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(q);this.emit('change');break;case h.CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(q);this.emit('change');break;}};o.prototype.getStateByThreadID=function(p){return n[p];};o.prototype.handleChatSendViewOpened=function(p){n[p.threadID]={amount:p.amount,groupSendRecipientUserID:p.groupSendRecipientUserID,groupSendReceiptDetails:p.groupSendReceiptDetails,groupThreadFBID:p.groupThreadFBID,memoText:p.memoText,platformData:p.platformData,referrer:p.referrer,paymentRequestID:p.paymentRequestID,sendMoneyDialogShown:true,useModal:p.useModal};};o.prototype.handleChatSendViewClosed=function(p){n[p.threadID]={amount:'',groupSendRecipientUserID:null,groupSendReceiptDetails:null,groupThreadFBID:'',memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,useModal:false};};f.exports=new o();},null);
__d('P2PUserEligibilityStore',['P2PActionConstants','EventEmitter','MercuryIDs','P2PAPI','P2PDispatcher','P2PGKValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;'use strict';var p,q;n=babelHelpers.inherits(r,i);o=n&&n.prototype;function r(){o.constructor.call(this);q={};p=l.register(this.onEventDispatched.bind(this));}r.prototype.onEventDispatched=function(s){var t=s.data,u=s.type;switch(u){case h.USER_ELIGIBILITY_UDPATED:this.handleEligibilityUpdated(t);this.emit('change');break;}};r.prototype.getEligibilityByUserIDs=function(s){var t=[],u,v,w={};for(var x=0;x<s.length;x++){v=s[x];u=q[v];if(u===undefined){q[v]=false;t.push(v);}w[v]=q[v];}if(m.P2PEnabled&&t.length)k.getUserEligibility({userIDs:t});return w;};r.prototype.getEligibilityByUserID=function(s){var t=this.getEligibilityByUserIDs([s]);return t[s];};r.prototype.getEligibilityByThreadID=function(s){return (this.getEligibilityByUserID(j.getUserIDFromThreadID(s)));};r.prototype.handleEligibilityUpdated=function(s){for(var t=0;t<s.length;t++)q[s[t].user_id]=s[t].p2p_eligible;};f.exports=new r();},null);
__d('P2PSendMoneyContainer.react',['CurrentUser','immutable','ImmutableObject','MercuryIDs','MercuryParticipants','MercuryShareAttachmentRenderLocations','MercuryThreads','P2PSendMoneyButton.react','P2PSendMoneyDialogStore','P2PUserEligibilityStore','React','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=r.PropTypes,u=r.createClass({displayName:'P2PSendMoneyContainer',propTypes:{button:t.node,className:t.string,flyoutAlignment:t.string,participantIDs:t.array,onTrigger:t.func,threadID:t.string},getDefaultProps:function(){return {referrer:m.CHAT};},mixins:[s(l,n,p,q)],statics:{calculateState:function(v){var w=v.threadID,x=null,y=v.participantIDs,z=null,aa=null,ba=null,ca,da,ea=v.referrer;if(!w)return {};ca=p.getStateByThreadID(w);da=ca&&ca.referrer;if(ea===m.WEB_INBOX&&da===m.CHAT||ea===m.CHAT&&da===m.WEB_INBOX)ca={};if(w){x=n.getForFBID(h.getID()).getOrFetch(w);if(!y)y=x&&x.participants.filter(function(fa){return (h.getID()!==k.getUserIDFromParticipantID(fa));});if(y){aa=q.getEligibilityByUserIDs(y.map(function(fa){return k.getUserIDFromParticipantID(fa);}));z=i.List();z=z.withMutations(function(fa){y&&y.forEach(function(ga){var ha=l.getOrFetch(ga),ia=k.getUserIDFromParticipantID(ga);ha=ha&&j.set(ha,{userID:ia,p2p_eligible:aa&&aa[ia]});if(ha)fa.push(ha);});});}}ba=n.get().isNewEmptyLocalThread(w);return babelHelpers._extends({},ca,{participants:z,isNewEmptyLocalThread:ba,isGroupChat:k.isGroupChat(w)&&!ba,threadID:w,threadFBID:x&&x.thread_fbid,referrer:da||ea});}},render:function(){return (r.createElement(o,babelHelpers._extends({},this.state,{button:this.props.button,className:this.props.className,flyoutAlignment:this.props.flyoutAlignment,onTrigger:this.props.onTrigger})));}});f.exports=u;},null);