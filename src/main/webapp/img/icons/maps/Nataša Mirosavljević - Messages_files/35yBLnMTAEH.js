/*!CK:1685070082!*//*1451895139,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["6MzG4"]); }

__d("PhotoWarningScreenConfig",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={GraphicEvents:{GRAPHIC_PHOTO_SHOWN_NO_WARNING:"GRAPHIC_PHOTO_SHOWN_NO_WARNING",GRAPHIC_PHOTO_SHOWN_WITH_WARNING:"GRAPHIC_PHOTO_SHOWN_WITH_WARNING",GRAPHIC_PHOTO_WARNING_DISMISSED:"GRAPHIC_PHOTO_WARNING_DISMISSED"},ObjectionableEvents:{INVALIDATE_CONTENT:"invalidate_content",SHOW_WARNING_SCREEN:"show_warning_screen",WARNING_SCREEN_DISMISSED:"warning_screen_dismissed",MARK_OBJECTIONABLE:"mark_objectionable",UNDO_MARK_OBJECTIONABLE:"undo_mark_objectionable"},Types:{GRAPHIC:"graphic",OBJECTIONABLE:"objectionable"}};},null);
__d("SpotlightViewerLoggingEvents",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"};},null);
__d('ImageUtils',['UserAgent_DEPRECATED'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={hasLoaded:function(j){if(j.naturalWidth!==undefined){return j.complete&&j.width!==0;}else if(j.height==20&&j.width==20&&j.complete){return false;}else if(j.complete===undefined&&h.webkit()<500){var k=new Image();k.src=j.src;return k.complete;}return j.complete;}};f.exports=i;},null);
__d('PhotoEverstoreLogger',['Event','AsyncRequest','ImageUtils'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={BATCH_WINDOW_MS:500,storedLog:[]};function l(){}Object.assign(l,{_log:function(n){k.storedLog.push(n);if(k.storedLog.length==1)setTimeout(m,k.BATCH_WINDOW_MS);},logImmediately:function(n){l._log(n);},registerForLogging:function(n){var o=document.getElementById(n);if(o!=null)if(j.hasLoaded(o)){l._log(o.src);}else h.listen(o,'load',function(event){l._log(o.src);});}});function m(){var n=k.storedLog;k.storedLog=[];var o=JSON.stringify(n);new i().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:o}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}f.exports=l;},null);
__d('PhotoViewerImage',['PhotoEverstoreLogger','URI','Vector'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){'use strict';this._hiResDimensions=l.hiResDimensions&&j.deserialize(l.hiResDimensions);this._normalDimensions=l.normalDimensions&&j.deserialize(l.normalDimensions);this._info=l.info;this._video=l.video;this._shouldLog=l.everstoreLogThis;this._hiResSrc=l.hiResSrc;this._normalSrc=l.normalSrc;this._thumbSrc=l.thumbSrc;this._isInverted=false;this._data=l;}k.prototype.getURIString=function(){'use strict';return new i(this._info.permalink).getUnqualifiedURI().toString();};k.prototype.hasHiResDimensions=function(){'use strict';return !!this._hiResDimensions;};k.prototype.getHiResDimensions=function(){'use strict';return this._hiResDimensions;};k.prototype.getNormalDimensions=function(){'use strict';return this._normalDimensions;};k.prototype.getHiResSrc=function(){'use strict';return this._hiResSrc;};k.prototype.getNormalSrc=function(){'use strict';return this._normalSrc;};k.prototype.getThumbSrc=function(){'use strict';return this._thumbSrc;};k.prototype.getInfo=function(){'use strict';return this._info;};k.prototype.getPermalink=function(){'use strict';return this._info.permalink;};k.prototype.getHighestResSrc=function(){'use strict';return this._hiResSrc||this._normalSrc;};k.prototype.preload=function(l){'use strict';var m;if(this.getHighestResSrc())if(l&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();m=this._resource.src;if(this._shouldLog)h.logImmediately(this._resource.src);}else if(!l&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;m=this._small.src;if(this._shouldLog)h.logImmediately(this._small.src);}return m;};k.prototype.setNormalDimensions=function(l,m){'use strict';this._normalDimensions=new j(l,m);};k.prototype.setHiResDimensions=function(l,m){'use strict';this._hiResDimensions=new j(l,m);};k.prototype.invertDimensions=function(){'use strict';if(this.hasHiResDimensions())this._hiResDimensions=new j(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new j(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;};k.prototype.copy=function(){'use strict';return new k(this._data);};f.exports=k;},null);
__d('PhotosConst',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_COMPOSER:16,VIEWER_CAROUSEL:19,VIEWER_PERMALINK_STRING:'permalink',VIEWER_SNOWLIFT_STRING:'snowlift',VIEWER_VAULTBOX_STRING:'vaultbox',VIEWER_CAROUSEL_STRING:'carousel',BULK_EDITOR:3,BULK_EDITOR_REACT:15,EDITOR_MODAL:17,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180,ALBUM_NAME_MAXLEN:65};f.exports=h;},null);
__d('PhotoStreamCache',['DOM','HTML','PhotoEverstoreLogger','PhotosConst','PhotoViewerImage','Rect','UIPagelet','URI','Vector','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();function r(){'use strict';}r.prototype.init=function(s,t,u,v,w){'use strict';this.version=s;this.pageletName=t;this.pageletRootID=u;this.tagSuggestionMode=w;this.bufferSize=r.BUFFER_SIZE;this.fullBucketSize=r.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=v;this.viewAsUser=null;this.reset();};r.prototype.setViewAs=function(s){'use strict';this.viewAsUser=s;};r.prototype.isInViewAsMode=function(){'use strict';return !!this.viewAsUser;};r.prototype.getViewAsUserId=function(){'use strict';return this.viewAsUser;};r.prototype.getUsesOpaqueCursor=function(){'use strict';return this.usesOpaqueCursor;};r.prototype.isNonCircularPhotoSet=function(){'use strict';return this.usesNonCircularPhotoSet;};r.prototype.setReachedLeftEnd=function(){'use strict';this.reachedLeftEnd=true;};r.prototype.setReachedRightEnd=function(){'use strict';this.reachedRightEnd=true;};r.prototype.hasReachedLeftEnd=function(){'use strict';return this.reachedLeftEnd;};r.prototype.hasReachedRightEnd=function(){'use strict';return this.reachedRightEnd;};r.prototype.nonCircularPhotoSetCanPage=function(s){'use strict';if(!this.isNonCircularPhotoSet())return true;if(s<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(s>0)return this.getLength()-1!=this.getCursorPos()||!this.hasReachedRightEnd();return true;};r.prototype.setUseAjaxPipe=function(s){'use strict';this.useAjaxPipe=s;};r.prototype.reset=function(){'use strict';this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;};r.prototype.waitForInitData=function(){'use strict';this.fbidList.push(r.INIT_PLACEHOLDER);};r.prototype.destroy=function(){'use strict';this.reset();this.isActive=false;};r.prototype.isLoaded=function(){'use strict';return this.loaded;};r.prototype.canPage=function(){'use strict';if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;};r.prototype.errorInCurrent=function(){'use strict';if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());};r.prototype.getLength=function(){'use strict';return this.fbidList.length;};r.prototype.getPhotoSet=function(){'use strict';return this.photoSetQuery.set;};r.prototype.getPhotoSetQuery=function(){'use strict';return this.photoSetQuery;};r.prototype.getCurrentImageData=function(){'use strict';return this.getImageData(this.getCursor());};r.prototype.addViewAsToURI=function(s){'use strict';var t=new o(s);if(this.isInViewAsMode())t.addQueryData({viewas:this.getViewAsUserId()});return t;};r.prototype.getOpaqueCursor=function(s){'use strict';if(this.getImageData(s)){if(this.version===k.VIEWER_VAULTBOX)return this.getImageData(s).getInfo().opaquecursor;return this.getImageData(s).info.opaquecursor;}if(s==this.firstCursor)return this.firstOpaqueCursor;return null;};r.prototype.getImageData=function(s){'use strict';var t=this.getCacheContent(s,r.IMAGE_DATA);if(t)t.info.permalink=this.addViewAsToURI(t.info.permalink);return t;};r.prototype.getCurrentHtml=function(){'use strict';return this.getCacheContent(this.getCursor(),r.HTML);};r.prototype.getCurrentExtraData=function(){'use strict';return this.getCacheContent(this.getCursor(),r.EXTRA);};r.prototype.getCacheContent=function(s,t){'use strict';if(!s||s===r.ERROR_ID||s===r.INIT_PLACEHOLDER)return null;return this.cache[t][s];};r.prototype.getCursorPos=function(){'use strict';return this.position;};r.prototype.getCursor=function(){'use strict';if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;};r.prototype.getCursorAt=function(s){'use strict';return this.fbidList[s];};r.prototype.getCursorForURI=function(s){'use strict';return this.permalinkMap[s];};r.prototype.calculatePositionForMovement=function(s){'use strict';var t=this.position+s;if(this.allLoaded){var u=this.getLength();t=(u+t%u)%u;}return t;};r.prototype.isValidMovement=function(s){'use strict';if(!this.isLoaded()||!this.canPage())return false;var t=this.calculatePositionForMovement(s);return this.getCursor()>0||t>=0&&t<this.getLength();};r.prototype.moveCursor=function(s){'use strict';if(!this.isValidMovement(s))return;this.position=this.calculatePositionForMovement(s);if(s!==0)this.loadMoreIfNeccessary(s>0);};r.prototype.checkErrorAt=function(s){'use strict';if(!this.isLoaded())return false;if(s===r.ERROR_ID)return true;return false;};r.prototype.getRelativeMovement=function(s){'use strict';for(var t=0;t<this.getLength();t++)if(this.fbidList[t]==s)return t-this.position;return null;};r.prototype.preloadImages=function(s){'use strict';var t,u,v=this.getLength(),w=this.cache.image,x=r.BUFFER_SIZE;if(v>x*2){t=(this.position+v-x%v)%v;u=(this.position+x)%v;}else{t=0;u=v-1;}while(t!=u){var y,z=this.fbidList[t],aa=s&&s(w[z]);if(this.version===k.VIEWER_VAULTBOX){y=w[z]&&w[z].preload(aa);}else if(w[z]&&w[z].url)if(aa&&!w[z].resource){w[z].resource=new Image();w[z].resource.src=w[z].url;y=w[z].url;if(w[z].everstoreLogThis===true)j.logImmediately(w[z].resource.src);}else if(!aa&&!w[z].small){w[z].small=new Image();w[z].small.src=w[z].smallurl||w[z].url;y=w[z].small.src;if(w[z].everstoreLogThis===true)j.logImmediately(w[z].small.src);}if(this.logger&&y)this.logger.log(y);t=(t+1)%v;}};r.prototype.loadMoreIfNeccessary=function(s){'use strict';if(this.allLoaded||s&&this.rightLock||!s&&this.leftLock)return;var t=s?1:-1,u=this.position+this.bufferSize*t;if(u<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(u>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}};r.prototype.getEndCursor=function(s){'use strict';return s?this.fbidList[this.getLength()-1]:this.fbidList[0];};r.prototype.calculateRelativeIndex=function(s,t,u){'use strict';if(!this.totalCount)return null;var v=this.fbidList.indexOf(t),w=this.fbidList.indexOf(u);if(v===-1||w===-1)return null;var x=w-v;return (s+x+this.totalCount)%this.totalCount;};r.prototype.calculateDistance=function(s,t){'use strict';var u=this.fbidList.indexOf(s),v=this.fbidList.indexOf(t);if(u===-1||v===-1)return null;return (v-u+this.getLength())%this.getLength();};r.prototype.fetch=function(s,t){'use strict';var u=this.getEndCursor(t),v=babelHelpers._extends({cursor:u,version:this.version,end:this.getEndCursor(!t),fetchSize:t?s:-1*s,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(u),tagSuggestionMode:this.tagSuggestionMode},this.photoSetQuery);if(this.isInViewAsMode())v.viewas=this.getViewAsUserId();if(this.totalCount&&this.firstCursorIndex!==null){v.total=this.totalCount;v.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,u);}var w=q(this.pageletRootID);if(!w){w=h.create('div',{id:this.pageletRootID});h.appendContent(document.body,w);}n.loadFromEndpoint(this.pageletName,w,v,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);};r.prototype.storeToCache=function(s){'use strict';var t={};if(!this.isActive)return t;if('error' in s){this.processErrorResult(s.error);t.error=true;return t;}if('init' in s){this.processInitResult(s.init);t.init={logids:s.init.logids,fbid:s.init.fbid,loggedin:s.init.loggedin,fromad:s.init.fromad,withinbusiness:s.init.withinbusiness,eid:s.init.eid};}if('image' in s){this.processImageResult(s.image);t.image=true;}if('data' in s){this.processDataResult(s.data);t.data=true;}return t;};r.prototype.processInitResult=function(s){'use strict';if(this.loaded)return;this.usesOpaqueCursor=s.usesopaquecursor;this.usesNonCircularPhotoSet=s.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=s.query;if(s.bufferSize)this.bufferSize=s.bufferSize;if(s.fullBucketSize)this.fullBucketSize=s.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(s.fbid);this.rightLock=true;}else{var t=this.fbidList.indexOf(r.INIT_PLACEHOLDER);if(t!=-1)this.fbidList[t]=s.fbid;}this.firstCursor=s.fbid;this.firstOpaqueCursor=s.opaquecursor;if('initIndex' in s&&'totalCount' in s){this.firstCursorIndex=s.initIndex;this.totalCount=s.totalCount;}if(this.version==k.VIEWER_PERMALINK){var u=s.initialBucketSize?s.initialBucketSize:r.INIT_BUCKET_SIZE;this.fetch(u,true);}};r.prototype.processImageResult=function(s){'use strict';for(var t in s){if(t===this.firstCursor&&s[t].everstoreLogThis)j.logImmediately(s[t].url);if(this.version===k.VIEWER_VAULTBOX){var u=s[t];this.cache.image[t]=new l(u);this.permalinkMap[this.cache.image[t].getURIString()]=t;}else{this.cache.image[t]=s[t];if(s[t].dimensions)this.cache.image[t].dimensions=p.deserialize(s[t].dimensions);if(s[t].originalDimensions)this.cache.image[t].originalDimensions=p.deserialize(s[t].originalDimensions);if(s[t].smalldims)this.cache.image[t].smalldims=p.deserialize(s[t].smalldims);this.permalinkMap[new o(s[t].info.permalink).getUnqualifiedURI().toString()]=t;}}};r.prototype.attachToFbidsList=function(s,t,u){'use strict';if(this.allLoaded)return;if(t===-1){for(var v=s.length-1;v>=0;v--){this.fbidList.unshift(s[v]);this.position++;}this.leftLock=false;}else{for(var w=0;w<s.length;w++)this.fbidList.push(s[w]);this.rightLock=false;}if(u)this.setAllLoaded();};r.prototype.setAllLoaded=function(){'use strict';this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);};r.prototype.processDataResult=function(s){'use strict';for(var t in s){if(!this.cache.html[t])this.cache.html[t]={};for(var u in s[t].html){var v=s[t].html[u];if(typeof v==='string')v=i(v).getRootNode();if(v.childNodes){this.cache.html[t][u]=Array.from(v.childNodes);}else this.cache.html[t][u]=[];}if(!('extra' in s[t])){this.cache.extra[t]=null;continue;}this.cache.extra[t]={tagRects:{}};if(!Array.isArray(s[t].extra.tagRects))for(var w in s[t].extra.tagRects)if(s[t].extra.tagRects[w])this.cache.extra[t].tagRects[w]=m.deserialize(s[t].extra.tagRects[w]);Object.keys(s[t].extra).forEach((function(x){if(x=='tagRects')return;this.cache.extra[t][x]=s[t].extra[x];}).bind(this));}};r.prototype.processErrorResult=function(s){'use strict';if(!this.isLoaded()){this.initError=true;return;}var t=s.side,u=[r.ERROR_ID];this.attachToFbidsList(u,t);};r.prototype.setTotalCount=function(s){'use strict';this.totalCount=s;};r.prototype.setFirstCursorIndex=function(s){'use strict';this.firstCursorIndex=s;};Object.assign(r,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});f.exports=r;},null);
__d("XPhotosetSearchPivotController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null);
__d('PhotosetSearchPivotData',['Promise','AsyncRequest','PhotoStreamCache','XPhotosetSearchPivotController'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=/^(perm:)?tag:(\d+)/,m={},n={fetch:function(o,p){if(!(o in m)){var q=k.getURIBuilder().setInt('fbid',o);if(p){var r={};p.fbidList.forEach(function(s){var t=p.getCacheContent(s,j.EXTRA);if(t)Object.keys(t.tagRects).forEach(function(u){if(l.test(u)){var v=RegExp.$2;if(v in r){r[v]++;}else r[v]=1;}});});q.setIntToIntMap('tags',r);}m[o]=new h(function(s,t){new i().setURI(q.getURI()).setHandler(function(u){s(u.getPayload());}).setErrorHandler(t).setAllowCrossPageTransition(true).send();});}return m[o]['catch'](function(s){delete m[o];throw s;});}};f.exports=n;},null);
__d('tickerPhoteSnowLiftOpenStatus',['ArbiterMixin'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='CheckIsOpen',j={registerOpenChecker:function(k){return j.subscribe(i,function(l,m){if(k())m.is_Open=true;});},checkIsOpen:function(){var k={is_Open:false};j.inform(i,k);return k.is_Open;}};Object.assign(j,h);f.exports=j;},null);
__d('ObjectionableContentFilterTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(){this.clear();}k.prototype.log=function(){i.log('logger:ObjectionableContentFilterLoggerConfig',this.$ObjectionableContentFilterTypedLogger1,h.BASIC);};k.prototype.logVital=function(){i.log('logger:ObjectionableContentFilterLoggerConfig',this.$ObjectionableContentFilterTypedLogger1,h.VITAL);};k.prototype.clear=function(){this.$ObjectionableContentFilterTypedLogger1={};return this;};k.prototype.updateData=function(m){this.$ObjectionableContentFilterTypedLogger1=babelHelpers._extends({},this.$ObjectionableContentFilterTypedLogger1,m);return this;};k.prototype.setContentID=function(m){this.$ObjectionableContentFilterTypedLogger1.content_id=m;return this;};k.prototype.setEvent=function(m){this.$ObjectionableContentFilterTypedLogger1.event=m;return this;};k.prototype.setVC=function(m){this.$ObjectionableContentFilterTypedLogger1.vc=m;return this;};k.prototype.updateExtraData=function(m){m=j(i.serializeMap(m));i.checkExtraDataFieldNames(m,l);this.$ObjectionableContentFilterTypedLogger1=babelHelpers._extends({},this.$ObjectionableContentFilterTypedLogger1,m);return this;};k.prototype.addToExtraData=function(m,n){var o={};o[m]=n;return this.updateExtraData(o);};var l={content_id:true,event:true,vc:true};f.exports=k;},null);
__d('PhotoLogger',['Event','BanzaiScuba','SpotlightViewerLoggingEvents','SubscriptionsHandler'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m){'use strict';this.$PhotoLogger1=m;this.$PhotoLogger2={};}l.prototype.log=function(m){'use strict';if(!this.$PhotoLogger2[m]){this.$PhotoLogger3(m);this.$PhotoLogger2[m]=true;}};l.prototype.$PhotoLogger3=function(m){'use strict';this.$PhotoLogger4(j.LOADING,{uri:m});var n=new k(),o=new Image();n.addSubscriptions(h.listen(o,'load',(function(){this.$PhotoLogger4(j.LOADED,{uri:m});n.release();}).bind(this)),h.listen(o,'error',(function(){this.$PhotoLogger4(j.ERROR,{uri:m});n.release();}).bind(this)),h.listen(o,'abort',(function(){this.$PhotoLogger4(j.ABORT,{uri:m});n.release();}).bind(this)));o.src=m;};l.prototype.logEvent=function(m){'use strict';this.$PhotoLogger4(m);};l.prototype.$PhotoLogger4=function(m,n){'use strict';var o=new i('photos_client_loading',null,{addBrowserFields:true});o.addNormal('event',m);o.addNormal('viewer',this.$PhotoLogger1);for(var p in n)o.addNormal(p,n[p]);o.post();};f.exports=l;},null);
__d('PhotoSessionLog',['AsyncRequest','Run','URI','Vector'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(){}Object.assign(l,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(m){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.eid='';this.version=m;this.buttonLikes=0;this.pagingAction='';this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;this.panoramaClicks=0;this.panoramaImpressions=0;if(m===l.SNOWLIFT){var n=k.getViewportDimensions();this.width=n.x;this.height=n.y;}},setLogFbids:function(m){this.logIds=m;},setEid:function(m){this.eid=m;},setPhotoSet:function(m){this.set=m;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(m){this.pagingAction=m;},setCycle:function(m){this.cycle=m;},setEndOfRelevant:function(m){this.endOfRelevant=m;},setRelevantCount:function(m){this.relevantCount=m;},setEndMetrics:function(m){this.endMetrics=m;},setSource:function(m){this.source=m;},addPanoramaClick:function(){this.panoramaClicks++;},addPanoramaImpression:function(){this.panoramaImpressions++;},addPhotoView:function(m,n,o){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(m)this.fbidList.push([m.fbid,m.owner,Date.now()]);if(n)this.hiResLoads++;if(o)this.fullScreenViews[m.fbid]=true;},logEnterFullScreen:function(m){this.fullScreenViews[m]=true;},addDetailData:function(m,n){if(!this.details[m])this.details[m]={t:n.num_tags,l:n.has_location,c:n.has_caption,cm:n.comment_count,lk:n.like_count,w:n.width,h:n.height,ad:'{}',p:this.pagingAction};},updateAdData:function(m,n){if(this.details[m])this.details[m].ad=JSON.stringify(n);},logPhotoViews:function(m){if(!this.views)return;if(m!=this.AGGREGATE)this.last=true;var n={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},eid:this.eid,first:this.first,last:this.last,close:m?m:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,panorama_clicks:this.panoramaClicks,panorama_impressions:this.panoramaImpressions};if(this.version===l.SNOWLIFT){var o=k.getViewportDimensions();n.width=o.x||this.width;n.height=o.y||this.height;if(this.hiResLoads>0)n.hires_loads=this.hiResLoads;if(this.last){var p=Object.keys(this.fullScreenViews).length;if(p>0)n.fullscreen=p;}}var q=new j('/ajax/photos/logging/session_logging.php').setSubdomain('www');new h().setAllowCrossPageTransition(true).setURI(q).setOption('asynchronous_DEPRECATED',m!=l.UNLOAD).setOption('suppressErrorHandlerWarning',true).setData(n).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});i.onUnload(function(){l.logPhotoViews(l.UNLOAD);});i.onLeave(function(){l.logPhotoViews(l.LEAVE);});f.exports=l;},null);
__d('PhotosUtils',['Vector'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(){}Object.assign(i,{getNearestBox:function(j,k){var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n;}}}return m;},absoluteToNormalizedPosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain='pure';return n;},normalizedToAbsolutePosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain='document';return n;},isFacebox:function(j){return j.match(/^face:/);},isTag:function(j){return j.match(/^tag:/);}});f.exports=i;},null);
__d('PhotoPermalinkURI',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isValid:function(i){return h.parse(i)!==null;},parse:function(i){if(this.isValidLegacy(i)){var j=i.getQueryData();if(j.fbid)return {photo_id:j.fbid,set_token:j.set};if(j.id&&j.pid)return {photo_id:j.id+':'+j.pid,set_token:j.set};return null;}var k=i.getPath();if(k[k.length-1]==='/')k=k.substring(0,k.length-1);var l=k.split('/');if(l.length>=3&&l[2]==='photos')if(l.length===4&&/^\d+$/.exec(l[3])!==null){return {photo_id:l[3],set_token:null};}else if(l.length===5&&/^\d+$/.exec(l[4])!==null)return {photo_id:l[4],set_token:l[3]};return null;},isValidLegacy:function(i){var j=i.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);if(j==='/photo.php'||j==='/force_photo/photo.php'||j==='/photo'||j==='/force_photo/photo/index.php'||j==='/photo/index.php'||j==='/force_photo/photo'||j==='/video.php'||j==='/video/video.php')return true;return false;}};f.exports=h;},null);
__d('VideoPermalinkURI',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isValid:function(i){return h.parse(i)!==null;},parse:function(i){if(this.isValidLegacy(i)){var j=i.getQueryData();if(j.v)return {video_id:j.v,set_token:j.set};return null;}var k=i.getPath();if(k[k.length-1]==='/')k=k.substring(0,k.length-1);var l=k.split('/');if(l.length>=3&&l[2]==='videos')if(l.length===4&&/^\d+$/.exec(l[3])!==null){return {video_id:l[3],set_token:null};}else if(l.length===5&&/^\d+$/.exec(l[4])!==null)return {video_id:l[4],set_token:l[3]};return null;},isValidLegacy:function(i){var j=i.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);if(j==='/photo.php'||j==='/force_photo/photo.php'||j==='/photo'||j==='/force_photo/photo/index.php'||j==='/photo/index.php'||j==='/force_photo/photo'||j==='/video.php'||j==='/video/video.php')return true;return false;}};f.exports=h;},null);
__d('PhotoTagSearchPivotLogger',['Banzai'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};h.subscribe(h.SHUTDOWN,function(){Object.keys(i).forEach(function(m){var n=i[m];Object.keys(n).forEach(function(o){h.post('photo_tag_search_pivot',{source:m,action:o,count:n[o]});});});});var j=/^(perm:)?tag:/,k,l={logImpression:function(m,n){var o=m in i?i[m]:i[m]={};o[n]=n in o?o[n]+1:1;},logImageImpression:function(m,n,o){if(k!==n){if(o.some(function(p){return j.test(p);}))this.logImpression(m,'image_impression');k=n;}},logPivotImpression:function(m,n){if(j.test(n))this.logImpression(m,'pivot_impression');},logShowMorePhotos:function(){this.logImpression('photoset','show_more_photos');},logHideMorePhotos:function(){this.logImpression('photoset','hide_more_photos');},logSuggestMorePhotos:function(){this.logImpression('photoset','suggest_more_photos');},logMorePhotosNavigation:function(m){h.post('photo_tag_search_pivot',{source:'photoset',action:'more_photos_search',query:m,count:1});}};f.exports=l;},null);
__d('PhotosetSearchPivot.react',['LeftRight.react','PhotoTagSearchPivotLogger','PhotosetSearchPivotData','React','XUISpinner.react','XUIText.react','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r=k.createClass({displayName:'PhotosetSearchPivotItem',propTypes:{normalized:q.string,title:q.object,uri:q.string,images:q.array},onClick:function(){i.logMorePhotosNavigation(this.props.normalized);},render:function(){return (k.createElement('div',{className:"_25r"},k.createElement('a',{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},k.createElement('div',{className:"_25u"},k.createElement('div',{className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),k.createElement('div',{className:"_25x"},k.createElement('div',{className:"_25y"},k.createElement('div',{className:"_25z"}),k.createElement('div',{className:"_26r"},k.createElement('div',{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),k.createElement('div',{className:"_274"},k.createElement('div',{className:"_25z"}),k.createElement('div',{className:"_26r"},k.createElement('div',{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),k.createElement(m,{display:'block',className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}}))));}}),s=k.createClass({displayName:'PhotosetSearchPivot',propTypes:{fbid:q.string,endofalbum:q.bool,withBackground:q.bool,linesAroundHeader:q.bool,onclose:q.func},fetchPivots:function(t){j.fetch(t).then((function(u){setTimeout(this.onFetchSuccess.bind(this,t,u.pivots),0);}).bind(this),(function(u){setTimeout(this.onFetchError.bind(this,t),0);}).bind(this));},onFetchSuccess:function(t,u){if(!this.isMounted()||this.props.fbid!==t)return;u=u||[];var v='show';if(u.length===0)v='hide';this.setState({pivots:u,action:v});},onFetchError:function(t){if(!this.isMounted()||this.props.fbid!==t)return;this.setState({pivots:[],action:'hide'});},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(t){if(t.fbid){this.setState({action:'loading'});this.fetchPivots(t.fbid);}else this.setState({action:'hide',pivots:[]});},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (k.createElement('div',{className:p(this.props.className,"_27h _2ph_")},k.createElement(l,{size:'large'})));if(this.state.action==='hide')return k.createElement('span',null);var t=this.state.pivots.map(function(x){return (k.createElement(r,{normalized:x.normalized,title:x.title,uri:x.uri,images:x.images}));}),u=this.props.endofalbum?k.createElement('span',{className:"_2pij"},o._("End of album")):null,v="_27m"+(' '+"_2pi3")+(' '+"_2pib")+(this.props.linesAroundHeader?' '+"_3-te":''),w=k.createElement('span',null,u,k.createElement('span',{className:"_4ptz"},o._("Other photos you may like")));if(this.props.onclose){w=k.createElement(h,{className:v},w,k.createElement('a',{href:'#',onClick:this.onExitClicked,className:"_27n"}));}else w=k.createElement('div',{className:v},w);return (k.createElement('div',{className:p(this.props.className,(this.state.action==='hide'?"_27j":'')+(this.state.action==='show'?' '+"_27k":''))},k.createElement('div',{className:"_27l"+(this.props.withBackground?' '+"_3-tf":'')},w,k.createElement('div',{className:"_27o _2pi8 clearfix"},t))));}});f.exports=s;},null);
__d('PhotosetPivotSlide.react',['Image.react','Link.react','PhotosetSearchPivot.react','React','XUIText.react','cx','fbt','xuiglyph'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.PropTypes,q=k.createClass({displayName:'PhotosetPivotSlide',propTypes:{fbid:p.string,isAlbum:p.bool,albumOwnerName:p.string,visible:p.bool,onReturn:p.func},render:function(){return (k.createElement('div',{className:"_1_ap"+(this.props.visible?' '+"_1_aq":'')},k.createElement('div',{className:"_1_ar"},k.createElement(l,{display:'block'},this._getEndOfAlbumTitle()),k.createElement(i,{className:"_1_as",onClick:this.props.onReturn},k.createElement(h,{className:"_1_at",src:o({name:'arrow-right',shade:'white',size:'small'})}),n._("Return to beginning"))),k.createElement(j,{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:true})));},_getEndOfAlbumTitle:function(){if(this.props.albumOwnerName){if(this.props.isAlbum){return n._("End of {user_name}'s album",[n.param('user_name',k.createElement(l,{weight:'bold'},this.props.albumOwnerName))]);}else return n._("End of {user_name}'s photos",[n.param('user_name',k.createElement(l,{weight:'bold'},this.props.albumOwnerName))]);}else if(this.props.isAlbum){return n._("End of album");}else return n._("End of photos");}});f.exports=q;},null);
__d("XPhotosSnowliftProfilePicXOutAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/profilepic\/xout\/",{});},null);
__d('SnowliftProfilePhotoNUX',['AsyncRequest','CSS','Event','XPhotosSnowliftProfilePicXOutAsyncController','tidyEvent'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();function m(n,o){l(j.listen(n,'click',function(p){i.hide(p);var q=k.getURIBuilder().getURI();new h().setURI(q).setMethod('POST').send();}));}g.registerXOut=m;},null);
__d('PhotoSnowliftAds',['Arbiter','Event','CSS','csx','DataStore','DOM','PhotoSessionLog','UIPagelet','URI','Vector'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(s,t){if(t)this.adsStatus=s;var u=Date.now();this.adsEvents[s+'_'+u]=u;},init:function(s,t,u,v){this.reset();this.root=s;this.snowlift=t;this.minAds=u.min_ads;this.displayedCallback=v;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(s){this.availableDimensions=s;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(s,t,u){var v={};s.forEach((function(w){var x=w.root.firstChild.offsetHeight;w.units.forEach((function(z){if(!j.hasClass(z,'hidden')&&!this.getIsHoldout(z)&&!this.getIsShadow(z)){var aa=this.getHeight(z.firstChild,t);x-=aa;}}).bind(this));var y={height:x,visible:false};w.units.forEach((function(z){var aa=this.getIsAds(z),ba=this.getHeight(z.firstChild,t),ca=this.getUnitId(z),da=this.getIsHoldout(z);if(da&&u)return;v[ca]={height:ba,visible:false,priority:0,is_ads:aa,is_holdout:da,section_ref:y};}).bind(this));}).bind(this));return v;},calculateVisibleUnits:function(s,t,u){var v=0,w=this.getUnitPriority(t);w.forEach((function(x){if(t.hasOwnProperty(x)){var y=t[x],z=y.height;if(!y.section_ref.visible)z+=y.section_ref.height;y.height_below=u-z;y.visible=y.height_below>=0&&z>0;if(y.visible){y.section_ref.visible=true;u-=z;v++;}}}).bind(this));return t;},displayUnits:function(s,t){s.forEach((function(u){var v=false,w=true;u.units.forEach((function(x){var y=this.getUnitId(x),z=t[y];if(!z)return;var aa=z.visible,ba=z.height_below,ca=z.is_ads;j.conditionClass(x,'hidden',!aa);if(ca&&aa&&w){var da=m.find(x,'div.ego_unit');j.addClass(da,'ego_unit_no_top_border');w=false;}v=v||aa;this.calcUnitStats(this.units[ca][y],aa,ba);}).bind(this));j.conditionClass(u.root,'hidden',!v);}).bind(this));h.inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(s,t){var u=0;s.forEach((function(v){v.units.forEach((function(w){var x=this.getUnitId(w),y=t[x];if(!y||!y.visible)return;u++;}).bind(this));}).bind(this));return u;},getHeightsRequired:function(s,t){var u=0,v=[];s.forEach((function(w){var x=false;w.units.forEach((function(y){var z=this.getUnitId(y),aa=t[z];if(!aa)return;u+=aa.height;if(!x){u+=aa.section_ref.height;x=true;}v.push(u);}).bind(this));}).bind(this));return v;},getUnitPriority:function(s){var t=[],u=0,v=0;for(var w in s){var x=s[w];t.push(w);var y=this.minAds+u+v;if(x.is_ads){if(v<this.minAds)y=v;v++;}else u++;x.priority=y;}t=t.sort((function(z,aa){var ba=s[z],ca=s[aa];return ba.priority-ca.priority;}).bind(this));return t;},updateUnitsStatus:function(){var s=this.availableDimensions.x,t=this.availableDimensions.y,u=this.calculateUnitSizes(this.sections,s);u=this.calculateVisibleUnits(this.sections,u,t);for(var v in u){if(!u.hasOwnProperty(v))continue;var w=u[v];if(!w.is_holdout||!w.visible)continue;var x=this.units[1][v];this.calcUnitStats(x,w.visible,w.height_below);}u=this.calculateUnitSizes(this.sections,s,true);u=this.calculateVisibleUnits(this.sections,u,t);this.displayUnits(this.sections,u);if(this.displayedCallback){var y=this.getUnitsDisplayed(this.sections,u),z=this.getHeightsRequired(this.sections,u);this.displayedCallback(y,z);}},calcUnitStats:function(s,t,u){var v=Date.now();if(s.visible)s.totalTime+=v-s.lastShowTime;if(s.trackingCode!==null&&s.totalTime>=this.UNITS_REGISTER_DELAY){var w=s.trackingCode;s.trackingCode=null;this.registerImpression(w,s.registerUrl);}s.visible=t;s.heightBelow=u;s.lastShowTime=v;},prepareResize:function(){var s=function(t){var u=m.create('div',{className:'inner'}),v=m.create('div',{className:'wrapper'},u);m.replace(t,v);m.setContent(u,t);return v;};this.sections=m.scry(this.root,'div.ego_section').map(function(t){return {root:s(t),units:m.scry(t,'div.ego_unit').map(s)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var s=this.nextRegisterTime();if(s!==Infinity)setTimeout(this.processResize.bind(this),s);},setIsLogAdData:function(s){this.isLogAdData=s;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var s=this.snowlift.getImageId();if(this.isLogAdData&&s){var t=q.getElementDimensions(this.snowlift.getImage()),u=q.getElementDimensions(this.snowlift.getRHCHeader()),v=q.getElementDimensions(this.snowlift.getRHCBody()),w=q.getElementDimensions(this.snowlift.getRHCFooter()),x={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:t.x,image_y:t.y,header_x:u.x,header_y:u.y,body_x:v.x,body_y:v.y,footer_x:w.x,footer_y:w.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};n.updateAdData(s,x);}},getAdsBelowSpace:function(){var s=[],t=this.units[1];for(var u in t)if(t.hasOwnProperty(u)&&!this.getIsHoldout(this.getAdUnit(u)))s.push(t[u].heightBelow);return s;},getIsAds:function(s){var t=m.scry(s,"div._4u8");return t.length;},getUnitId:function(s){if(this.getIsAds(s)){return this.getAdId(s);}else return this.getEgoId(s);},getEgoId:function(s){var t=m.find(s,'div.ego_unit');return t.getAttribute('data-ego-fbid');},getAdData:function(s){var t=m.find(s,"div._4u8"),u=t.getAttribute('data-ad');return u&&JSON.parse(u)||{};},getAdId:function(s){return this.getAdData(s).adid;},getIsHoldout:function(s){return s&&this.getIsAds(s)&&this.getAdData(s).holdout;},getIsShadow:function(s){return s&&this.getIsAds(s)&&this.getAdData(s).shadow;},getAdUnit:function(s){if(!this.sections)return null;var t=[];this.sections.forEach(function(v){t.push.apply(t,v.units);});for(var u=0;u<t.length;u++)if(this.getIsAds(t[u])&&this.getAdId(t[u])==s)return t[u];return null;},nextRegisterTime:function(){var s=Infinity,t=babelHelpers._extends({},this.units[0],this.units[1]);for(var u in t)if(t.hasOwnProperty(u)){var v=t[u];if(v.trackingCode!==null&&v.visible)s=Math.min(s,this.UNITS_REGISTER_DELAY-v.totalTime);}return s;},getHeight:function(s,t){var u=l.get(s,'height');if(u&&u.x===t)return u.y;return this.cacheHeight(s,t);},cacheHeight:function(s,t){var u={x:t,y:s.offsetHeight};l.set(s,'height',u);return u.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var s=this.getCursorFBID(this.loadQuery);o.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,s,false,this.snowlift.getOpaqueCursor(s)]},{crossPage:true,bundle:false});},getCursorFBID:function(s){if(s.v!==undefined)return s.v;if(s.fbid!==undefined)return s.fbid;return '0';},unitsLoaded:function(s,t){var u;if(t){u='/ai.php';this.addEvent('adsLoaded',true);}else{u='/ajax/ei.php';this.addEvent('egoLoaded',true);}var v={};for(var w in s)if(s.hasOwnProperty(w))v[w]={trackingCode:s[w],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:u};this.units[t]=v;if(t)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();j.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var s=Date.now()-this.lastLoadTime;if(!this.isLoading&&s>r.REFRESH_RATE){j.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(s,t){var u=m.create('iframe',{src:new p(t).addQueryData({aed:s}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});u.setAttribute('aria-hidden','true');m.appendContent(this.root,u);},waitForImages:function(s){var t=m.scry(this.root,'img.img'),u=t.length,v=u;if(v===0)s();var w=function(){v--;if(v===0)setTimeout(s,0);};for(var x=0;x<u;x++){var y=t[x];if(y.complete){w();}else i.listen(y,{load:w,error:w,abort:w});}}};f.exports=r;},null);
__d('PhotoViewer',['Bootloader','CSS','DOM','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(){'use strict';this.image=null;this.root=null;this.stream=null;}l.prototype.getEventString=function(m){'use strict';var n=this.getEventPrefix();if(n)return n+'.'+m;return null;};l.prototype.getImage=function(){'use strict';return this.image;};l.prototype.getPosition=function(){'use strict';return this.stream?this.stream.getCursor():null;};l.prototype.getRoot=function(){'use strict';return this.root;};l.prototype.hiliteAllBoxes=function(){'use strict';j.scry(this.stageWrapper,'div.tagsWrapper div.faceBox').forEach(function(m){i.addClass(m,'otherActive');});};l.bootstrap=function(m,n){'use strict';h.loadModules(["PhotoSnowlift"],function(o){o.bootstrap(m,n);});};Object.assign(l.prototype,{getEventPrefix:k.thatReturnsNull,getSourceString:k.thatReturnsNull,getVersionConst:k.thatReturnsNull,getViewerSource:k.thatReturnsNull,getViewerSet:k.thatReturnsNull});f.exports=l;},null);
__d("XGraphicPhotoWarningLoggingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/graphic_photo\/logging\/",{event:{type:"Enum",required:true,enumType:1}});},null);
__d('PhotoWarningScreen',['AsyncRequest','CSS','cx','Event','PhotoWarningScreenConfig','ObjectionableContentFilterTypedLogger','XGraphicPhotoWarningLoggingController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(p){'use strict';k.listen(p.seePhotoButton,'click',function(){i.hide(p.warningOverlay);i.removeClass(p.innerContent,"_1t6v");switch(p.warningType){case l.Types.GRAPHIC:o.logGraphic(l.GraphicEvents.GRAPHIC_PHOTO_WARNING_DISMISSED);break;case l.Types.OBJECTIONABLE:p.responsiblePhotos.forEach(function(q){new m().setEvent(l.ObjectionableEvents.WARNING_SCREEN_DISMISSED).setContentID(q).log();});break;}});}o.logGraphic=function(event){var p=n.getURIBuilder().setEnum('event',event).getURI();new h(p).setAllowCrossPageTransition(true).send();};f.exports=o;},null);
__d('PhotoWarningScreenMixin',['CSS','DOM','csx','cx','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=l,n={getGraphicWarningContainer:m,getGraphicWarningHiddenContent:m,_graphicWarningMarkup:null,_graphicWarningOverlay:null,_graphicWarningHiddenContentWrapper:null,initGraphicWarningDOM:function(o){this._graphicWarningMarkup=o;this._graphicWarningOverlay=i.scry(o,"._1t6w").pop();this._graphicWarningHiddenContentWrapper=i.scry(o,"._1t6x").pop();},showGraphicWarning:function(){this._graphicWarningOverlay&&h.show(this._graphicWarningOverlay);if(this.getGraphicWarningContainer().contains(this._graphicWarningMarkup))return;if(this._graphicWarningHiddenContentWrapper){this.getGraphicWarningContainer().replaceChild(this._graphicWarningMarkup,this.getGraphicWarningHiddenContent());h.addClass(this._graphicWarningHiddenContentWrapper,"_1t6v");this._graphicWarningHiddenContentWrapper.appendChild(this.getGraphicWarningHiddenContent());}},hideGraphicWarning:function(){if(!this.getGraphicWarningContainer().contains(this._graphicWarningMarkup))return;this.getGraphicWarningContainer().replaceChild(this.getGraphicWarningHiddenContent(),this._graphicWarningMarkup);}};f.exports=n;},null);
__d("SnowliftVideoPivotsCarouselController",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={setPivotsCarousel:function(i,j){this._pivotsCarousel=i;this.adjustCarousel(j);},adjustCarousel:function(i){if(this._pivotsCarousel)this._pivotsCarousel.pageTo(i);},adjustCarouselOnAutoPlay:function(){if(this._pivotsCarousel)this._pivotsCarousel.page();}};f.exports=h;},null);
__d("XPhotosSnowliftProfilePicAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/profilepic\/",{uri:{type:"String",required:true}});},null);
__d('PhotoSnowlift',['$','Arbiter','AsyncRequest','Bootloader','CSS','DataStore','Dialog','DisplaySnowliftProfilePhotoNux','DOM','DOMControl','DOMQuery','Event','FullScreen','ImageUtils','Input','Keys','Layer','LayerHideOnEscape','LikeConfirmer','LinkController','LitestandShareAttachment','LitestandStoryInsertionStatus','Locale','PageTransitions','Parent','PhotoLogger','PhotoPermalinkURI','PhotosConst','PhotoSessionLog','PhotosetPivotSlide.react','PhotosetSearchPivot.react','PhotosetSearchPivotData','PhotoSnowliftActionsGating','PhotoSnowliftAds','PhotoStreamCache','PhotosUtils','PhotoTagSearchPivotLogger','PhotoViewer','PhotoWarningScreen','PhotoWarningScreenMixin','ReactComponentRenderer','Rect','ScriptPath','ScrollableArea','SnowliftVideoPivotsCarouselController','Style','Toggler','Tooltip','UFIFeedbackTargets','UFIRootRegistry','UFIUIEvents','UIPagelet','URI','UserAgent_DEPRECATED','Vector','VideoPermalinkURI','VideoPlayerAbortLoadingExperiment','VideoPlayerReason','XPhotosSnowliftProfilePicAsyncController','arrayContains','classWithMixins','computeRelativeURI','csx','cx','emptyFunction','fbt','ge','getActiveElement','goURI','invariant','isNode','mixin','tickerPhoteSnowLiftOpenStatus','setTimeoutAcrossTransitions','PhotoWarningScreenConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc){if(c.__markCompiled)c.__markCompiled();var dc,ec,fc=c('PhotoWarningScreenConfig').GraphicEvents,gc=74,hc=75,ic=70,jc=76,kc=315,lc=new RegExp('\\/posts\\/(\\d+)\\/?$');dc=babelHelpers.inherits(mc,pb(sa,ac(ua)));ec=dc&&dc.prototype;function mc(){'use strict';ec.constructor.call(this);this._seenTags={};this._navCount=0;this._isZoomOn=false;this.clearAlbumBoundaries();}mc.prototype.preload=function(nc,oc){'use strict';k.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],(function(pc){this.PhotoTagger=pc;}).bind(this));this.checkProfilePhotoNUX(nc);};mc.prototype.checkProfilePhotoNUX=function(nc){'use strict';if(!o.display||!this.root)return;var oc=r.scry(this.root,'#profile_photo_snowlift_nux');if(oc.length>0)l.hide(oc[0]);var pc=nb.getURIBuilder().setString('uri',nc).getURI();new j().setURI(pc).setHandler((function(qc){if(qc&&qc.payload){var rc=r.scry(this.root,'#profile_photo_snowlift_nux');if(rc.length>0)l.show(rc[0]);}}).bind(this)).send();};mc.prototype.bootstrap=function(nc,oc){'use strict';this.preload(nc,oc);this._href=nc;this._elem=oc;if(this.closeDirty){setTimeout(this.bootstrap.bind(this,nc,oc),0);return;}oa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var pc=fa.byAttribute(oc,'data-cursor');if(pc){try{var rc=JSON.parse(pc.getAttribute('data-ft'));this._dataFt={qid:rc.qid,mf_story_key:rc.mf_story_key};}catch(qc){}}else try{pc=fa.byAttribute(oc,'data-ad');var sc=JSON.parse(pc.getAttribute('data-ad'));this._dataFt={ad_id:sc.adid};}catch(qc){}xa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&l.removeClass(this.loading,'loading');if(oc){l.addClass(this.loading=oc,'loading');var tc=fa.byClass(oc,'uiStreamStory')||fa.bySelector(oc,"._5jmm");if(tc){this.storyID=tc.id;}else{var uc=fa.bySelector(oc,"._5b9c");if(uc)this.storyID=uc.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(oc);}else this.loading=null;i.inform('PhotoSnowlift.GO',nc,i.BEHAVIOR_STATE);this.loadFrameIfUninitialized();this._setupNextItemUI();};mc.prototype._updateContainerOwnerID=function(){'use strict';if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};mc.prototype.setupFromSnowflake=function(nc,oc){'use strict';this.extraClasses=nc;this.snowflake=true;this.firstInSet=oc;if(this.root){l.addClass(this.root,"snowflake");this.extraClasses.forEach(function(pc){l.addClass(this.root,pc);},this);}};mc.prototype.getCurrentImageServerSizeDimensions=function(){'use strict';var nc=this.stream.getCurrentImageData();return nc.originalDimensions||nc.dimensions;};mc.prototype.getEventPrefix=function(){'use strict';return 'PhotoSnowlift';};mc.prototype.getRoot=function(){'use strict';return this.root;};mc.prototype.getSourceString=function(){'use strict';return 'snowlift';};mc.prototype.getViewerSource=function(){'use strict';return this.source;};mc.prototype.getViewerSet=function(){'use strict';return this.stream.getPhotoSet();};mc.prototype.getVersionConst=function(){'use strict';return ia.VIEWER_SNOWLIFT;};mc.prototype.getImage=function(){'use strict';return this.image;};mc.prototype.getImageId=function(){'use strict';return this.stream.getCursor();};mc.prototype.getRHCHeader=function(){'use strict';return this.rhcHeader;};mc.prototype.getRHCBody=function(){'use strict';return this.ufiForm;};mc.prototype.getRHCFooter=function(){'use strict';return this.rhcFooter;};mc.prototype.getLoadQuery=function(){'use strict';return this.loadQuery;};mc.prototype.getCurrentPhotoInfo=function(){'use strict';var nc=this.stream.getCurrentImageData();if(nc)return nc.info;return null;};mc.prototype.getOwnerId=function(){'use strict';var nc=this.stream.getCurrentImageData();if(nc)return nc.info.owner;return null;};mc.prototype.getThumbAndSize=function(nc){'use strict';this.currentImageSize=null;this.thumbSrc=null;var oc=new hb(nc.getAttribute('ajaxify')).getQueryData();if(!oc.size)return;var pc=jb.deserialize(oc.size);if(!pc.x||!pc.y)return;this.currentImageSize=pc;if(nc.getAttribute('data-cropped'))return;var qc=p.scry(nc,'img')[0],rc=p.scry(nc,'i')[0],sc=fa.byAttribute(nc,'data-size');this.shouldStretch=sc&&this.currentImageSize&&qc&&sc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=mc.TIMELINE_STRETCH_WIDTH&&qc.offsetWidth===mc.TIMELINE_STRETCH_WIDTH;var tc;if(qc){tc=qc.src;}else if(rc){tc=ab.get(rc,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=tc;};mc.prototype.loadFrameIfUninitialized=function(){'use strict';if(this.root)return;new j('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};mc.prototype.init=function(nc,oc){'use strict';this.init=tb;this._shouldLog=oc.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new ga(ia.VIEWER_SNOWLIFT_STRING);this._showHover=oc.pivot_hover;this._showMorePhotos=oc.show_more_photos;this._extraSlidePivot=oc.extra_slide_pivot;ja.setEndMetrics(oc.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=t.isSupportedWithKeyboardInput();this.showOGVideos=oc.og_videos;this.resizeCommentsForAds=oc.resize_comments_for_ads;this._canSeeGraphicWarning=!!oc.can_see_graphic_warning;this.initGraphicWarningDOM(oc.graphic_warning_markup);this.spotlight=nc;this.spotlight.subscribe('blur',(function(){this.closingAction=ja.OUTSIDE;}).bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());oa.init(this.sideAdUnit,this,oc,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){aa.registerHandler(this.handleNavigateAway.bind(this));this.subscription=i.subscribe('PhotoSnowlift.GO',(function(pc,qc){this.openExplicitly=true;this.loading&&l.removeClass(this.loading,'loading');this.open(qc);}).bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ea.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;i.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));i.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)t.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=oc.snowlift_slideshow;this.buttonTruncateGk=oc.snowlift_button_truncate;this._hasZoomCapability=this._hasZoomCapability&&oc.www_panorama_viewer;this.allowIrrelevantRequests=!!oc.snowlift_allow_irrelevant_requests;if(this.snowflake){l.addClass(this.root,"snowflake");this.extraClasses.forEach(function(pc){l.addClass(this.root,pc);},this);}this._setupNextItemUI();};mc.prototype.onFullScreenChange=function(){'use strict';if(!this.isOpen)return;var nc=t.isFullScreen();l.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',nc);if(nc){this.lastFullscreenEnter=Date.now();if(!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var oc=this.stream.getCurrentImageData();if(oc&&oc.url&&this.image.src!==oc.url&&this.shouldShowHiRes(oc))this.switchImage(oc.url);this.adjustForResize();if(!this._isZoomOn)this._conditionDisplayZoomInButton();}else{if(!this._isZoomOn)this.uncollapseRHC();if(ib.chrome()&&this.lastPage>this.lastFullscreenEnter&&!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);i.inform('reflow');}bb.hide();};mc.prototype.initializeNodes=function(nc){'use strict';this.root=nc;this.container=p.find(nc,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=p.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=p.find(this.snowliftPopup,'div.rhc');this.rhcHeader=p.find(this.rhc,'div.rhcHeader');this.rhcFooter=p.find(this.rhc,'div.rhcFooter');this.taglist=p.find(this.rhc,'span.fbPhotoTagList');this.ufiForm=p.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=p.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=p.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=p.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=p.find(this.snowliftPopup,'div.stageWrapper');this.overlay=p.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=p.find(this.stageWrapper,'div.stageError');this.image=p.find(this.stageWrapper,'img.spotlight');this.stage=p.find(this.stageWrapper,'div.stage');this.showZoomInButton=p.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=p.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=p.scry(this.stage,"._10zw").pop();this.outerImageSlider=p.scry(this.stage,"._10zx").pop();this.innerImageSlider=p.scry(this.stage,"._10zv").pop();this._hasZoomCapability=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this._hasZoomCapability){l.hide(this.showZoomInButton);l.hide(this.showZoomOutButton);l.hide(this.zoomedImage);l.hide(this.outerImageSlider);}this.videoStage=p.find(this.stageWrapper,'div.videoStage');this.prevPager=p.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=p.find(this.snowliftPopup,'a.snowliftPager.next');this.upPager=p.find(this.container,'a.snowliftPager.up');this.downPager=p.find(this.container,'a.snowliftPager.down');this.stageActions=p.find(nc,'div.stageActions');this.buttonActions=p.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=p.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=p.find(nc,"._5ciw");l.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};mc.prototype.getGraphicWarningContainer=function(){'use strict';return this.stageWrapper;};mc.prototype.getGraphicWarningHiddenContent=function(){'use strict';return this.stage;};mc.prototype.initializeScroller=function(){'use strict';this.initializeScroller=tb;l.addClass(this.scroller,"_467y");this.scrollableArea=ya.fromNative(this.scroller,{fade:true,persistent:true});var nc=(function(event){var oc=s.$E(event).getTarget();if(p.contains(this.ufiInputContainer,oc)){var pc=q.getInstance(oc);if(pc){this.scrollableArea.scrollToBottom();var qc=pc.subscribe('resize',(function(){var sc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();sc&&this.scrollableArea.scrollToBottom();}).bind(this)),rc=s.listen(oc,'blur',function(){pc.unsubscribe(qc);rc.remove();});}}if(oc.classList.contains('UFIPagerLink')||oc.classList.contains('UFICommentLink'))if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.haltAutoplay=true;}).bind(this);i.subscribe(fb.InputHeightChanged,(function(oc,pc){if(p.contains(this.ufiInputContainer,pc.node))this.adjustScroller();}).bind(this));i.subscribe(fb.PhotoPreviewHeightChanged,(function(oc,pc){if(!pc.node||p.contains(this.ufiInputContainer,pc.node))this.adjustScroller();}).bind(this));i.subscribe(fb.Changed,(function(oc,pc){if(this.ufiForm===pc.form)this.adjustScrollerIfNecessary();}).bind(this));i.subscribe(fb.Comment,(function(oc,pc){if(this.ufiForm===pc.form){this.adjustScrollerIfNecessary();if(pc.isinverted){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}).bind(this));s.listen(this.rhc,'click',(function(event){var oc=event.getTarget();if(fa.byTag(oc,'a')||fa.byTag(oc,'button')||p.isNodeOfType(oc,'input'))this.adjustScrollerIfNecessary();}).bind(this));i.subscribe(['reflow',fb.CommentPager],(function(){if(this.isOpen)this.adjustScrollerIfNecessary();}).bind(this));i.subscribe(fb.TranslationRendered,(function(){this.adjustScrollerIfNecessary();}).bind(this));s.listen(this.ufiForm,'focusin',nc);};mc.prototype.openHandler=function(nc){'use strict';if(this.isOpen||!ha.isValid(nc)||this.returningToStart||nc.getQueryData().closeTheater||nc.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(nc);this._uriStack.push(new hb(nc).getQualifiedURI().toString());ea.transitionComplete(true);return true;};mc.prototype.addHaltAutoplaySubscription=function(){'use strict';i.subscribe([fb.Focus],(function(){this.haltAutoplay=true;}).bind(this));i.subscribe([fb.Blur],(function(nc,oc){this.haltAutoplay=oc.hasEnteredText;}).bind(this));};mc.prototype.open=function(nc){'use strict';var oc=new hb(nc),pc=oc.getQueryData(),qc=ha.parse(oc);if(qc!==null){pc.fbid=qc.photo_id;pc.set=qc.set_token;}var rc=kb.parse(oc);if(rc!==null){pc.v=rc.video_id;pc.set=rc.set_token;}if(!pc.fbid&&!pc.v&&!pc.pid){var sc=lc.exec(oc.getPath());if(sc)pc.v=sc[1];}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){pc.firstLoad=true;this.initialLoad=true;ca.registerBlocker((function(){return this.isOpen;}).bind(this));bc.registerOpenChecker((function(){return this.isOpen;}).bind(this));}this.sessionID=Date.now();this.loadQuery=Object.assign(pc,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.autoplayOptionScreenConfig=null;this.haltAutoplay=false;this.shouldRenderVideoPivots=false;l.show(this.nextPager);l.show(this.prevPager);this.source=null;this.saveTagSubscription=i.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new pa();this.stream.init(ia.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null,pc.tagSuggestionMode||'everyone');if(!!hb.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(hb.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(mc.STATE_HTML,true);this.rhcCollapsed=false;this._open(nc);k.loadModules(["PhotosButtonTooltips"],function(tc){tc.init();});};mc.prototype._open=function(nc){'use strict';this.createLoader();this.spotlight.show();i.inform('layer_shown',{type:'PhotoSnowlift'});i.inform('PhotoSnowlift.OPEN');this.stageHandlers=[s.listen(window,'resize',this.adjustForResize.bind(this)),s.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),s.listen(this.stageWrapper,'mouseleave',(function(event){var qc=event.getTarget();if(!(fa.byClass(qc,'snowliftOverlay')||fa.byClass(qc,'fbPhotoSnowliftTagApproval')||fa.byClass(qc,'tagPointer')||fa.byClass(qc,'arrow')||fa.byClass(qc,'faceboxSuggestion')||fa.byClass(qc,'typeaheadWrapper')||fa.byClass(qc,'photoTagTypeahead')||fa.byClass(qc,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}).bind(this)),s.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),s.listen(this.root,'mousemove',this.hiliteProductItemPager.bind(this)),s.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),s.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),s.listen(this.container,'mousemove',this._enableMouseOver.bind(this)),s.listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),s.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),s.listen(this.root,'focusin',this.hiliteProductItemPager.bind(this)),s.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this._hasZoomCapability){this.stageHandlers.push(s.listen(this.stage,'mousedown',this._zoomedImageMouseDown.bind(this)));this.stageHandlers.push(s.listen(this.root,'mouseup',this._zoomedImageMouseUp.bind(this)));}this.stageHandlers.push(s.listen(this.container,'click',(function(event){var qc=event.getTarget();if(fa.byClass(qc,'rotateRight')){this.rotate('right');}else if(fa.byClass(qc,'rotateLeft')){this.rotate('left');}else if(fa.bySelector(qc,"._418x")){if(t.isFullScreen()){t.toggleFullScreen();return;}this.closingAction=ja.X;this.spotlight.hide();return false;}else if(fa.bySelector(qc,"._32_l")){var rc=fa.bySelector(qc,"._32_l"),sc=rc.getAttribute('data-fbid'),tc=this.stream.getCursor(),uc=this.stream.calculateDistance(tc,sc),vc=this.stream.fbidList.indexOf(sc);za.adjustCarousel(vc);this.page(uc,false);this.haltAutoplay=false;this.removeAutoplayOptionScreen();}else if(this.fullscreen)if(fa.byClass(qc,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(fa.byClass(qc,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}).bind(this)));var oc=vb('fbPhotoSnowliftFeedback');if(oc)this.stageHandlers.push(s.listen(oc,'click',(function(event){var qc=event.getTarget();if(fa.byClass(qc,'like_link')||fa.byClass(qc,'UFILikeLink')&&fa.byClass(qc,'UIActionLinks'))this.toggleLikeButton();var rc=fa.byClass(event.getTarget(),'uiUfiCollapsedComment');if(rc)l.addClass(rc,'uiUfiCollapsedCommentToggle');}).bind(this)));var pc=vb('fbPhotoSnowliftOnProfile');if(pc)this.stageHandlers.push(s.listen(pc,'click',(function(event){if(fa.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}).bind(this)));if(this.resetUriStack)this.startingURI=hb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();this.setLoadingState(mc.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ea.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}ja.initLogging(ja.SNOWLIFT);if(this.pivots)ja.setRelevantCount(this.pivots.relevantCount);};mc.prototype.toggleFullScreen=function(){'use strict';var nc=t.toggleFullScreen(document.documentElement);if(nc){var oc=this.stream.getCurrentImageData();if(oc&&oc.url&&this.image.src!==oc.url&&this.shouldShowHiRes(oc))if(!this._log(oc.url))new Image().src=oc.url;ja.logEnterFullScreen(this.stream.getCursor());}};mc.prototype.getStream=function(){'use strict';return this.stream;};mc.prototype.fetchInitialData=function(){'use strict';this.stream.waitForInitData();var nc=this.loadQuery.within_business?this.loadQuery.business_thread_id:this.loadQuery.fbid;gb.loadFromEndpoint('PhotoViewerInitPagelet',vb('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:db.getActorIDForFeedbackTargetIfExists(nc),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};mc.prototype.toggleCollapse=function(){'use strict';if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};mc.prototype.collapseRHC=function(){'use strict';this.rhcCollapsed=true;l.addClass(this.root,'collapseRHC');this.adjustForResize();};mc.prototype.uncollapseRHC=function(){'use strict';this.rhcCollapsed=false;l.removeClass(this.root,'collapseRHC');this.adjustForResize();};mc.prototype.closeHandler=function(){'use strict';if(!this.isOpen)return;this.closingAction=this.closingAction||ja.ESC;if(hb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};mc.prototype.returnToStartingURI=function(nc,oc){'use strict';if(!nc)if(oc){this.squashNextTransition(xb.bind(null,oc));}else this.squashNextTransition();this.returningToStart=true;var pc=i.subscribe('page_transition',(function(){this.returningToStart=false;pc.unsubscribe();}).bind(this)),qc=nc||isNaN(ib.opera()),rc=this._uriStack.length;if(qc&&rc<window.history.length){window.history.go(-rc);}else{var sc=this.startingURI,tc=new hb(sc).removeQueryData('closeTheater');if(sc.getQueryData().sk=='approve'&&sc.getPath()=='/profile.php'){tc.removeQueryData('highlight');tc.removeQueryData('notif_t');}xb(tc);}};mc.prototype.squashNextTransition=function(nc){'use strict';this.squashNext=true;ea.registerHandler((function oc(){if(this.squashNext){this.squashNext=false;if(nc)setTimeout(nc,0);ea.transitionComplete(true);return true;}return false;}).bind(this),7);};mc.prototype.handleNavigateAway=function(nc){'use strict';var oc=qb(ea.getMostRecentURI().getQualifiedURI(),nc.getAttribute('href'));if(this.isOpen&&oc instanceof hb&&oc.getUnqualifiedURI().toString()!=this.startingURI.toString()&&oc.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=ja.NAVIGATE;this.returnToStartingURI(false,oc);this.close();return false;}return true;};mc.prototype.postProcessTaggedPhotos=function(){'use strict';if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var nc=null;if(this.source===mc.COLLECTIONS_UNTAGGED_PHOTOS){nc='/ajax/photos/photo/edit/skiptag/';}else if(this.source===mc.PHOTOS_OF_YOU_SUGGESTIONS||this.source===mc.FRIENDS_IN_PHOTOS_SUGGESTIONS)nc='/ajax/photos/photo/add_to_star_grid/';if(nc)new j().setURI(nc).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};mc.prototype.onTagSaved=function(nc,oc){'use strict';if(this.taggedPhotoIds){if(this.source===mc.PHOTOS_OF_YOU_SUGGESTIONS&&!oc.self_tag)return;this.taggedPhotoIds.push(oc.photo_fbid);}};mc.prototype.clearAlbumBoundaries=function(){'use strict';this._albumBoundaries={start:0,end:0,dir:0};};mc.prototype.close=function(){'use strict';if(!this.isOpen)return;this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this.isOpen=false;this._navCount=0;this.clearAlbumBoundaries();if(this.fullscreen)t.disableFullScreen();xa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();i.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;cc(this.closeCleanup.bind(this),0);if(this.snowflake){l.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(nc){l.removeClass(this.root,nc);},this);}eb.cleanupSnowliftNodes();this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};mc.prototype.closeCleanup=function(){'use strict';this.closeDirty=false;l.removeClass(this.root,'dataLoading');ja.logPhotoViews(this.closingAction);this.destroy();l.hide(this.errorBox);l.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var nc=this.stream.getCursor();if(lb.canAbort){var oc;for(oc=0;oc<this.stream.getLength();oc++){var pc=this.stream.getImageData(this.stream.getCursorAt(oc));if(pc&&pc.video)pc.controller.abortLoading();}}l.removeClass(this.stageWrapper,'showVideo');p.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();p.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var qc=this.closingAction===ja.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ea.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}i.inform('layer_hidden',{type:'PhotoSnowlift'});i.inform('PhotoSnowlift.CLOSE',{is_navigating:qc,fbid:nc});this._setZoomOut();this._previousZoomScrollPercent=null;};mc.prototype.createLoader=function(nc){'use strict';if(this.currentImageSize===null){this.adjustStageSize(mc.STAGE_MIN);}else{var oc=this.getStageSize(this.currentImageSize);oc=new jb(Math.max(oc.x,this.getMinimumStageWidth()),Math.max(oc.y,mc.STAGE_MIN.y));var pc=this.getImageSizeInStage(this.currentImageSize,oc);if(this.thumbSrc===null){this.adjustStageSize(pc);}else this.useImage(p.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:pc.x+'px',height:pc.y+'px'}}),pc,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(nc)setTimeout((function(){var qc=new Image(),rc=(function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(nc,this.currentImageSize);this.setLoadingState(mc.STATE_IMAGE_DATA,false);}}).bind(this),sc=s.listen(qc,'load',rc),tc=function(){if(sc){sc.remove();sc=null;}};i.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',tc);i.subscribeOnce('PhotoSnowlift.CLOSE',tc);this._log(nc);qc.src=nc;}).bind(this),0);l.hide(this.stageActions);this.setStagePagersState('disabled');};mc.prototype.initDataFetched=function(nc){'use strict';ja.setPhotoSet(this.stream.getPhotoSet());ja.setLogFbids(nc.logids);if(nc.eid)ja.setEid(nc.eid);this._albumBoundaries.start=this.stream.getCursor();var oc=this.stream.getCurrentImageData();ja.addPhotoView(oc.info,this.shouldShowHiRes(oc),this.fullscreen&&t.isFullScreen());var pc=this.stream.getCurrentExtraData();if(this._showHover&&pc)ra.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(pc.tagRects));if(pc&&pc.source!==undefined){this.source=parseInt(pc.source,10);ja.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[s.listen(this.root,'click',this.pageListener.bind(this)),s.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];l.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=nc.loggedin;this.disableAds=!this.isLoggedInViewer||nc.fromad||nc.withinbusiness||this.stream.isInViewAsMode();this.loadAds();if(this._isZoomAvailable(oc)){ja.addPanoramaImpression();var qc=new jb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(qc);}else if(this._hasZoomCapability)l.hide(this.showZoomInButton);};mc.prototype.adjustScrollerIfNecessary=function(){'use strict';clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};mc.prototype.adjustScroller=function(nc){'use strict';clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var oc=jb.getElementDimensions(this.rhc),pc=oc.y;pc-=jb.getElementDimensions(this.rhcHeader).y;pc-=jb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var qc=jb.getElementDimensions(this.placeInfo);pc-=qc.y;ab.set(this.sideAdUnit,'bottom',qc.y+'px');}if(nc==null)nc=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=nc;pc=Math.max(0,pc);var rc=jb.getElementDimensions(this.scrollerBody).y,sc=Math.max(mc.MIN_UFI_HEIGHT,pc-nc);if(rc>=sc){if(pc>sc){l.removeClass(this.rhc,'pinnedUfi');pc-=sc;}else{l.addClass(this.rhc,'pinnedUfi');pc=0;}ab.set(this.scroller,'height',sc+'px');}else{ab.set(this.scroller,'height','auto');l.removeClass(this.rhc,'pinnedUfi');pc-=rc;}var tc=jb.getElementDimensions(this.ufiInputContainer).y;ab.set(this.ufiForm,'padding-bottom',tc+'px');oa.resize(new jb(oc.x,pc));this.scrollableArea.adjustGripper();};mc.prototype.adjustForResize=function(){'use strict';this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this._hasZoomCapability){if(!this._isZoomOn)this._conditionDisplayZoomInButton();this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);}};mc.prototype.shouldShowHiRes=function(nc){'use strict';if(!nc||!nc.smallurl)return false;var oc=this.getStageSize(nc.dimensions);oc=this._adjustStageSizeForPixelRatio(oc);var pc=this.getImageSizeInStage(nc.dimensions,oc);return (pc.x>mc.STAGE_NORMAL_MAX.x||pc.y>mc.STAGE_NORMAL_MAX.y);};mc.prototype._adjustStageSizeForPixelRatio=function(nc){'use strict';if(window.devicePixelRatio&&window.devicePixelRatio>1)nc=new jb(nc.x*window.devicePixelRatio,nc.y*window.devicePixelRatio);return nc;};mc.prototype.getImageURL=function(nc){'use strict';if(nc.video){return null;}else if(nc.smallurl&&!this.shouldShowHiRes(nc))return nc.smallurl;return nc.url;};mc.prototype.getImageOrVideoDimensions=function(nc){'use strict';if(nc.video){var oc=this.getVideoElement(nc.video);if(oc)return this.getVideoSize(oc);}return this.getImageDimensions(nc);};mc.prototype.getImageDimensions=function(nc){'use strict';if(this._isZoomOn)return nc.originalDimensions;if(nc.smalldims&&(!this.shouldShowHiRes(nc)||this.image.src===nc.smallurl))return nc.smalldims;return nc.dimensions;};mc.prototype.getStageSize=function(nc,oc){'use strict';var pc=jb.getViewportDimensions(),qc=new jb(nc.x,nc.y+this.getExtraVerticalSpace());if(oc)qc=new jb(Math.max(nc.x,oc.x),Math.max(nc.y,oc.y));var rc,sc;if(this.fullscreen&&t.isFullScreen()){sc=screen.height-mc.FULL_SCREEN_PADDING*2;return new jb(this.rhcCollapsed?screen.width:screen.width-mc.SIDEBAR_SIZE_MAX,this._isItemPagerEnabled()?sc-mc.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:sc);}else{rc=Math.min(qc.x,pc.x-mc.SIDEBAR_SIZE_MAX-mc.STAGE_CHROME.x);var tc=pc.y-mc.STAGE_CHROME.y;sc=Math.min(qc.y,this._isItemPagerEnabled()?tc-mc.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:tc);}if(rc===0&&sc===0)return new jb(0,0);var uc=rc/sc,vc=qc.x/qc.y;if(uc<vc)return new jb(rc,Math.round(rc/vc));return new jb(Math.round(sc*vc),sc);};mc.prototype.getExtraVerticalSpace=function(){'use strict';if(this.getVideoOnStage())return mc.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};mc.prototype.getComponentsHeight=function(){'use strict';var nc=this.getVideoOnStage();if(nc){var oc=vb(nc);if(oc)return this.getVideoComponentsHeight(oc);}return 0;};mc.prototype.getMinimumStageWidth=function(){'use strict';var nc=mc.STAGE_MIN.x;if(this.getVideoOnStage())return nc;if(na.ALLOW_MAKE_PROFILE_PICTURE_BUTTON)nc+=mc.PROFILE_PICTURE_BUTTON_WIDTH;return nc;};mc.prototype.getImageSizeInStage=function(nc,oc){'use strict';var pc=nc.x,qc=nc.y,rc=this.getComponentsHeight(),sc=this.getExtraVerticalSpace();qc-=rc;oc=new jb(oc.x,oc.y-rc-sc);if(pc>=oc.x||qc>=oc.y){var tc=oc.x/oc.y,uc=pc/qc;if(tc<uc){pc=oc.x;qc=Math.round(pc/uc);}else if(tc>uc){qc=oc.y;pc=Math.round(qc*uc);}else{pc=oc.x;qc=oc.y;}}return new jb(pc,qc+rc);};mc.prototype.getStageSizeForZoomedImage=function(nc,oc){'use strict';if(this.fullscreen&&t.isFullScreen()){var pc=this.rhcCollapsed?screen.width:screen.width-mc.SIDEBAR_SIZE_MAX,qc=screen.height-mc.FULL_SCREEN_PADDING*2;return new jb(pc,qc);}var rc=jb.getViewportDimensions();if(oc===null)oc=new jb(0,0);var sc=new jb(Math.max(nc.x,this.getMinimumStageWidth(),oc.x),Math.max(nc.y,mc.STAGE_MIN.y,oc.y)),tc=rc.x-mc.STAGE_CHROME.x;if(!this.rhcCollapsed)tc-=mc.SIDEBAR_SIZE_MAX;pc=Math.min(sc.x,tc);qc=Math.min(sc.y,rc.y-mc.STAGE_CHROME.y);return new jb(pc,qc);};mc.prototype.adjustStageSize=function(nc){'use strict';var oc=this.currentImageSize;if(nc){oc=nc;}else{var pc=this.stream&&this.stream.getCurrentImageData();if(pc)oc=this.getImageOrVideoDimensions(pc);}if(!oc)return;this.currentImageSize=oc;var qc=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&oc.x>oc.y&&oc.x<=mc.TIMELINE_STRETCH_WIDTH&&oc.x>=mc.TIMELINE_STRETCH_MIN){oc.y=Math.round(oc.y*mc.TIMELINE_STRETCH_WIDTH/oc.x);oc.x=mc.TIMELINE_STRETCH_WIDTH;}var rc;if(this._isZoomOn){rc=this.getStageSizeForZoomedImage(oc,this.currentMinSize);}else rc=this.getStageSize(oc,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new jb(0,0);this.currentMinSize=new jb(Math.max(rc.x,this.getMinimumStageWidth(),this.currentMinSize.x),Math.max(rc.y,mc.STAGE_MIN.y,this.currentMinSize.y));var sc=this.getImageSizeInStage(oc,this.currentMinSize),tc=this.currentMinSize.x-sc.x,uc=this.currentMinSize.y-sc.y;if(tc>0&&tc<mc.PADDING_MIN){this.currentMinSize.x-=tc;}else if(uc>0&&uc<mc.PADDING_MIN)this.currentMinSize.y-=uc;var vc=this.currentMinSize.x+mc.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)vc=this.currentMinSize.x;var wc=this.getVideoOnStage()&&this.pivotsCarouselElement,xc=0,yc=this.currentMinSize.y;if(wc){var zc=this.pivotsCarouselElement.clientHeight;xc=Math.ceil(zc/100)*100;yc=yc+xc;}this.snowliftPopup.style.cssText='width:'+vc+'px;'+'height:'+yc+'px;';var ad=this.currentMinSize.y-qc,bd=ad+xc;if(ib.firefox()){var cd=ab.get(this.stageWrapper,'font-size');ad=ad/parseFloat(cd)+'em';bd=bd/parseFloat(cd)+'em';}else{ad=ad+'px';bd=bd+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+ad+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+bd+';';if(this._isZoomOn){var dd=this.currentMinSize.y-qc;if(oc.y>dd){var ed=oc.x/oc.y*dd;ab.apply(this.zoomedImage,{width:ed+"px",height:dd+"px"});}else ab.apply(this.zoomedImage,{width:oc.x+"px",height:oc.y+"px"});}else{sc.y-=this.getComponentsHeight();this.setMediaElementSize(sc);}if(wc)this.setPivotCarouselElementWidth(cd);var fd=this.getTagger();if(fd)fd.repositionTagger();this.adjustScrollerIfNecessary();};mc.prototype.setMediaElementSize=function(nc){'use strict';var oc=this.image;if(this.getVideoOnStage())if(this._videoPlayerStateManager&&this._videoPlayerStateManager.setDimensions){this._videoPlayerStateManager.setDimensions(nc.x,nc.y);}else oc=p.scry(this.videoStage,"._53j5")[0]||oc;oc.style.cssText='width:'+nc.x+'px;'+'height:'+nc.y+'px;';};mc.prototype.setPivotCarouselElementWidth=function(nc){'use strict';var oc=this.videoStage.clientWidth;if(ib.firefox()){oc=oc/parseFloat(nc)+'em';}else oc=oc+'px';this.pivotsCarouselElement.style.width=oc;};mc.prototype.adjustForNewData=function(){'use strict';if(!this.image)return;var nc=p.scry(this.stage,'div.tagsWrapper')[0],oc=jb.getElementDimensions(this.image);if(nc){ab.set(nc,'width',oc.x+'px');ab.set(nc,'height',oc.y+'px');}};mc.prototype.adsDisplayedCallback=function(nc,oc){'use strict';var pc=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&nc<mc.MIN_ADS_VISIBLE&&oc.length>=mc.MIN_ADS_VISIBLE;if(pc){this.inAdsDisplayedCallback=true;var qc=oc[mc.MIN_ADS_VISIBLE-1];this.adjustScroller(qc);this.inAdsDisplayedCallback=false;}};mc.prototype.setLoadingState=function(nc,oc){'use strict';switch(nc){case mc.STATE_IMAGE_PIXELS:l.conditionClass(this.root,'imagePixelsLoading',oc);break;case mc.STATE_IMAGE_DATA:this.loadingStates[nc]=oc;l.conditionClass(this.root,'imageLoading',oc);break;case mc.STATE_HTML:this.loadingStates[nc]=oc;l.conditionClass(this.root,'dataLoading',oc);this.rhc.setAttribute('aria-busy',oc?'true':'false');break;}};mc.prototype.destroy=function(){'use strict';this.stageHandlers.forEach(function(nc){nc.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(nc){nc.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;this._videoPlayerStateManager=null;};mc.prototype.checkState=function(nc){'use strict';if(nc!=mc.STATE_ERROR&&!this.loadingStates[nc])return;switch(nc){case mc.STATE_IMAGE_DATA:var oc=this.stream.getCurrentImageData();if(oc){var pc=this.getImageURL(oc);if(pc){this.switchImage(pc,null,true);}else if(oc.video)this.switchVideo(oc.video,true);this.setLoadingState(nc,false);}break;case mc.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(nc,false);}break;default:if(this.stream.errorInCurrent()){l.hide(this.image);l.show(this.errorBox);}break;}};mc.prototype.buttonListener=function(event){'use strict';var nc=event.getTarget(),oc=Date.now();if(fa.bySelector(nc,"._5qmg")){ja.addPanoramaClick();this.switchIntoZoomedImage();return;}if(fa.bySelector(nc,"._5qmh")){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(fa.byClass(nc,'fbPhotoTagApprovalBox'))return;if(oc-this.lastPage<350)return;if(fa.byClass(nc,'fbPhotosPhotoLike')){this.likePhoto();}else if(fa.byClass(nc,'tagApproveIgnore')){this.updateTagBox(event,nc);}else if(fa.bySelector(nc,"._5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(fa.bySelector(nc,"._5ymu")){if(!this._showingMorePhotos){ra.logShowMorePhotos();var pc=this.stream.getCursor();if(pc)this.showMorePhotos(String(pc));if(this._hasZoomCapability)l.hide(this.showZoomInButton);}else{ra.logHideMorePhotos();this._conditionDisplayZoomInButton();this.hideMorePhotos();}return;}else if(fa.bySelector(nc,"._27n"))this._conditionDisplayZoomInButton();this.hideMorePhotos();};mc.prototype.toggleSlideshow=function(){'use strict';if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};mc.prototype.startSlideshow=function(){'use strict';this._slideshowToken=window.setInterval(this.page.bind(this,1,ib.chrome()&&t.isFullScreen()),mc.SLIDESHOW_TIME);l.addClass(this.root,'slideshowStarted');l.removeClass(this.root,'slideshowAvailable');};mc.prototype.stopSlideshow=function(){'use strict';this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;l.addClass(this.root,'slideshowAvailable');l.removeClass(this.root,'slideshowStarted');};mc.prototype.likePhoto=function(){'use strict';ja.addButtonLike();var nc=h('fbPhotoSnowliftFeedback'),oc=p.scry(nc,'button.like_link')[0];if(!oc)oc=p.scry(nc,'a.UFILikeLink')[0];var pc=oc.getAttribute('href');if(t.isFullScreen())if(ib.chrome())oc.setAttribute('href','javascript:;');oc.click();oc.setAttribute('href',pc);};mc.prototype.toggleLikeButton=function(){'use strict';var nc=p.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(nc){var oc=p.find(this.root,'.likeCount'),pc=p.find(oc,'.likeCountNum');if(oc)if(l.hasClass(nc,'viewerLikesThis')){p.setContent(pc,parseInt(pc.textContent,10)-1);}else p.setContent(pc,parseInt(pc.textContent,10)+1);l.toggleClass(nc,'viewerLikesThis');l.removeClass(nc,'viewerAlreadyLikedThis');}};mc.prototype.likePhotoWithKey=function(){'use strict';return z.like(this.likePhoto.bind(this),wb());};mc.prototype.updateTagBox=function(nc,oc){'use strict';this.unhiliteAllTags();var pc=vb(nc);if(!pc)return;l.addClass(pc,'tagBox');l.addClass(pc,'tagBoxPendingResponse');l.removeClass(pc,'tagBoxPending');l.hide(p.find(pc,'span.tagForm'));if(oc){l.show(p.find(pc,'span.tagApproved'));}else l.show(p.find(pc,'span.tagIgnored'));};mc.prototype.rotate=function(nc){'use strict';var oc=this.stream.getCursor();if(this.getVideoOnStage()){var pc=nc=='left'?270:90;!!!this.videoRotateURI?yb(0):undefined;k.loadModules(["VideoRotate"],(function(rc){new rc(oc,this.videoRotateURI).motionRotate(pc);}).bind(this));return;}var qc=babelHelpers._extends({fbid:oc,opaquecursor:this.stream.getOpaqueCursor(oc),cs_ver:ia.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());qc[nc]=1;this.setLoadingState(mc.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);l.hide(this.image);new j('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(qc).setErrorHandler(this.rotationError.bind(this,oc)).setFinallyHandler(this.rotationComplete.bind(this,oc)).setMethod('POST').setReadOnly(false).send();};mc.prototype.rotationComplete=function(nc,oc){'use strict';if(nc==this.stream.getCursor()){this.setLoadingState(mc.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};mc.prototype.rotationError=function(nc,oc){'use strict';if(nc==this.stream.getCursor()){this.setLoadingState(mc.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));k.loadModules(["AsyncResponse"],function(pc){pc.defaultErrorHandler(oc);});}};mc.prototype.saveTagsFromPayload=function(nc){'use strict';this.storeFromData(nc);if('data' in nc&&this.stream.getCursor() in nc.data)this.swapData();};mc.prototype.saveEdit=function(){'use strict';if(!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;k.loadModules(["PhotoInlineEditor","FormSubmit"],(function(nc,oc){var pc=nc.getInstance(this.getViewerConst());pc&&oc.send(pc.getForm().controller);}).bind(this));};mc.prototype.mouseLeaveListener=function(event){'use strict';this.unhiliteAllTags();this.reHilitePendingTag();};mc.prototype.hiliteProductItemPager=function(event){'use strict';var nc=jb.getEventPosition(event),oc=jb.getElementDimensions(this.root),pc=oc.y-nc.y;if(pc>mc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE&&nc.y>mc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE){l.conditionClass(this.upPager,'hilightPager',false);l.conditionClass(this.downPager,'hilightPager',false);return;}var qc=pc<mc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE;l.conditionClass(this.upPager,'hilightPager',!qc);l.conditionClass(this.downPager,'hilightPager',qc);};mc.prototype.hilitePager=function(event){'use strict';var nc=jb.getEventPosition(event),oc=jb.getElementPosition(this.stage),pc=jb.getElementDimensions(this.stage);if(da.isRTL()){this.stagePagerPrev=pc.x-(nc.x-oc.x)<mc.GOPREV_AREA;}else this.stagePagerPrev=nc.x-oc.x<mc.GOPREV_AREA;l.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);l.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var qc,rc=event.getTarget();if(!fa.byClass(rc,'snowliftOverlay')&&!fa.byClass(rc,'bottomBarActions')&&!fa.byClass(rc,'snowliftPager'))qc=mc.PAGER_FADE;this.showPagers(qc);};mc.prototype.showPagers=function(nc){'use strict';clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof nc!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),nc);};mc.prototype.hidePagers=function(){'use strict';var nc=p.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(nc)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};mc.prototype.getTagger=function(){'use strict';return this.PhotoTagger&&this.PhotoTagger.getInstance(ia.VIEWER_SNOWLIFT);};mc.prototype.unhiliteAllTags=function(){'use strict';clearTimeout(this.unhiliteTimer);p.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(oc){l.removeClass(oc,'hover');});p.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(oc){l.removeClass(oc,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!l.hasClass(this.root,'taggingMode')){var nc=this.getTagger();if(nc){nc.hideTagger();nc.setCurrentFacebox(null);}}};mc.prototype.switchHilitedTags=function(nc,oc){'use strict';if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var pc=vb(nc);if(pc){this.hilitedTag=nc;if(!l.hasClass(this.root,'taggingMode')&&qa.isFacebox(this.hilitedTag)){var qc=this.getTagger();if(qc){l.addClass(pc,'hover');var rc=qc.getFacebox(nc);qc.setCurrentFacebox(rc);if(rc)qc.addTagFromFacebox(rc);}}else l.addClass(pc,'hover');if(l.hasClass(pc,'tagBoxPending')&&!l.hasClass(pc,'showPendingTagName')&&oc===true){p.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(sc){l.removeClass(sc,'showPendingTagName');});l.addClass(pc,'showPendingTagName');}}};mc.prototype.reHilitePendingTag=function(){'use strict';var nc=vb(this.hilitedTag);if(nc&&l.hasClass(nc,'showPendingTagName'))return;var oc=p.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(oc)this.switchHilitedTags(oc.id);};mc.prototype.hiliteTagsOnMouseMove=function(event){'use strict';if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var nc=event.getTarget();if(fa.byClass(nc,'snowliftOverlay')||fa.byClass(nc,'fbPhotoSnowliftTagApproval')||fa.byClass(nc,'tagPointer')||fa.byClass(nc,'arrow')||fa.byClass(nc,'faceboxSuggestion')||fa.byClass(nc,'typeaheadWrapper')||fa.byClass(nc,'photoTagTypeahead'))return;var oc=fa.byClass(nc,'tagBoxPending'),pc=false;if(this.hilitedTag){var qc=vb(this.hilitedTag);pc=qc&&l.hasClass(qc,'tagBoxPending');}var rc=!this.hilitedTag&&oc||!pc&&oc;if(rc){this.switchHilitedTags(oc.id);return;}if(oc&&oc.id==this.hilitedTag)return;var sc=250,tc=15,uc=jb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=uc;var vc=qa.absoluteToNormalizedPosition(this.image,uc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(uc)<tc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(vc))return;var wc=qa.getNearestBox(this.stream.getCurrentExtraData().tagRects,vc);if(!wc){if(!pc){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var xc=null;if(pc){var yc={};yc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];xc=qa.getNearestBox(yc,vc);}if(xc!==null&&pc)return;if(this.hilitedTag!=wc)if(pc){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,wc),sc);}else{if(this._showHover&&!this._seenTags[wc]){this._seenTags[wc]=true;ra.logPivotImpression('snowlift',wc);}this.switchHilitedTags(wc);}};mc.prototype.currentTagHasPrecedence=function(nc){'use strict';if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false;}var oc=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],pc=new wa(oc.t+oc.h()/2,oc.r,oc.b+(qa.isFacebox(this.hilitedTag)?10:0),oc.l,oc.domain);return pc.contains(nc);};mc.prototype.getVideoOnStage=function(){'use strict';var nc=this.stream&&this.stream.getCurrentImageData();return nc&&nc.video;};mc.prototype.shouldPageOnAction=function(nc,oc){'use strict';if(!this.isOpen||z.isShowingConfirmation())return false;var pc=zb(oc)&&(fa.byClass(oc,'snowliftPager')||fa.byClass(oc,'stagePagers')||fa.byClass(oc,'pivotPageColumn')),qc=zb(oc)&&fa.byClass(oc,'stage'),rc=l.hasClass(oc,'faceBox'),sc=!l.hasClass(this.root,'taggingMode')&&rc&&!pc;if(sc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){p.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var tc=qc&&l.hasClass(this.root,'taggingMode')||fa.byClass(oc,'tagBoxPending')||fa.byClass(oc,'tagBoxPendingResponse')||fa.byClass(oc,'fbPhotoTagApprovalBox')||fa.byClass(oc,'tag');if(tc)return false;if(qc&&this._isZoomOn)qc=false;return nc==w.LEFT||nc==w.RIGHT||nc==w.UP||nc==w.DOWN||nc==gc||nc==hc||pc||sc||qc;};mc.prototype.keyHandler=function(nc,event){'use strict';if(event.getModifiers().any||x.getTopmostLayer()!==this.spotlight)return true;switch(s.getKeyCode(event)){case w.LEFT:case w.RIGHT:case w.UP:case w.DOWN:case gc:case hc:this.pageListener(event);return false;case ic:return this.toggleFullScreen();case jc:return this.likePhotoWithKey();case w.SPACE:this.toggleSlideshow();this.showPagers(mc.PAGER_FADE);return false;case w.ESC:if(this._isZoomOn){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};mc.prototype._isItemPagerEnabled=function(){'use strict';var nc=this._scrapProductItemSnowLiftLinks();return nc!==null&&nc.length>1;};mc.prototype._setupNextItemUI=function(){'use strict';if(!this.upPager||!this.downPager)return;var nc=this._scrapProductItemSnowLiftLinks();if(!nc||nc.length<2){l.hide(this.upPager);l.hide(this.downPager);}else{var oc=jb.getElementDimensions(this.stage),pc=jb.getElementDimensions(this.root),qc=(pc.y-oc.y)/2-mc.PRODUCT_ITEM_PAGER_MARGIN;this.upPager.style.marginTop="-"+qc+"px";this.downPager.style.marginTop=qc-mc.PRODUCT_ITEM_PAGER_HEIGHT+"px";l.show(this.upPager);l.show(this.downPager);}};mc.prototype._scrapProductItemSnowLiftLinks=function(){'use strict';if(!this._elem)return null;var nc=vb('pagelet_group_forsaleposts');if(!nc)nc=vb('group_commerce_cross_group_feed_stories');if(!nc)return null;var oc=p.scry(nc,'a[name="snowlift"]').filter(function(rc){return p.scry(rc,'img').length==1;}),pc=oc.map(function(rc){return rc.href;}),qc=ob(pc,this._elem.href);return qc?oc:[];};mc.prototype._loadNextItem=function(nc){'use strict';var oc=this._scrapProductItemSnowLiftLinks();if(!oc)return;var pc=oc[0];oc.every((function(qc,rc){if(qc.href===this._elem.href){var sc=nc?++rc:--rc;if(sc<0){pc=oc[oc.length-1];}else if(sc<oc.length)pc=oc[sc];return false;}return true;}).bind(this));pc.click();};mc.prototype.shouldHandlePendingTag=function(event){'use strict';var nc=this.getTagger();if(!nc||!nc.tags.length)return false;var oc=qa.absoluteToNormalizedPosition(this.getImage(),jb.getEventPosition(event)),pc=nc.findNearestTag(oc);if(!pc||!l.hasClass(pc.node,'tagBoxPending'))return false;i.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:pc.id,version:this.getVersionConst()});return true;};mc.prototype.pageListener=function(event){'use strict';var nc=s.getKeyCode(event),oc=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(nc,oc))return;if(this.shouldHandlePendingTag(event))return;var pc=0,qc=null,rc=null;if(nc==w.RIGHT||nc==hc){pc=1;ja.setPagingAction('key_right');this._disableMouseOver=true;}else if(nc==w.LEFT||nc==gc){pc=-1;ja.setPagingAction('key_left');this._disableMouseOver=true;}else if(nc==w.UP){ja.setPagingAction('key_up');this._disableMouseOver=true;qc=false;}else if(nc==w.DOWN){ja.setPagingAction('key_down');this._disableMouseOver=true;qc=true;}else if(fa.byClass(oc,'next')){pc=1;ja.setPagingAction('click_next');}else if(fa.byClass(oc,'prev')){pc=-1;ja.setPagingAction('click_prev');}else if(fa.byClass(oc,'down')){qc=true;ja.setPagingAction('click_down');}else if(fa.byClass(oc,'up')){qc=false;ja.setPagingAction('click_up');}else if(rc=fa.byClass(oc,'seek')){var sc=m.get(rc,'seek-fbid');pc=this.stream.getRelativeMovement(sc);ja.setPagingAction('seek');}else if(!this.stagePagerPrev){pc=1;ja.setPagingAction('click_stage');}else{pc=-1;ja.setPagingAction('click_stage_back');}var tc=p.scry(this.ufiForm,'input.mentionsHidden'),uc=false;for(var vc=0;vc<tc.length;vc++)if(!v.isEmpty(tc[vc])){uc=true;break;}if(uc||l.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,pc));}else{this.page(pc,ib.chrome()&&t.isFullScreen());this._previousZoomScrollPercent=null;}if(null!==qc)this._loadNextItem(qc);};mc.prototype.warnLeavePage=function(nc){'use strict';new n().setTitle(ub._("Are you sure you want to leave this page?")).setBody(ub._("You have unsaved changes that will be lost if you leave the page.")).setButtons([{name:'leave_page',label:ub._("Leave this page"),handler:nc},{name:'continue_editing',label:ub._("Stay on This Page"),className:'inputaux'}]).setModal(true).show();};mc.prototype.getUsesOpaqueCursor=function(){'use strict';return this.stream.getUsesOpaqueCursor();};mc.prototype.getOpaqueCursor=function(nc){'use strict';return this.stream.getOpaqueCursor(nc);};mc.prototype.setReachedLeftEnd=function(){'use strict';this.stream.setReachedLeftEnd();};mc.prototype.setReachedRightEnd=function(){'use strict';this.stream.setReachedRightEnd();};mc.prototype._initLitestandShareAttachments=function(){'use strict';var nc=r.scry(this.root,'.'+ba.getSimpleCropClass());nc.forEach(function(oc){return ba.init(oc);});};mc.prototype.page=function(nc,oc,pc){'use strict';if(!this.stream.isValidMovement(nc)||!this.stream.nonCircularPhotoSetCanPage(nc)){this.showPagers(mc.PAGER_FADE);return;}var qc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(nc));if(this.snowflake&&(this.stream.getCursor()==this.firstInSet&&nc<0||this.firstInSet==qc&&nc>0)){this.showPagers(mc.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};this._navCount+=nc;var rc=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){if(!this._albumBoundaries.end&&rc===0){this._albumBoundaries.end=this.stream.getCursor();this._albumBoundaries.dir=nc;}else if(rc===-1)ma.fetch(this._albumFBID,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this._albumBoundaries.end&&qc===this._albumBoundaries.start&&nc===this._albumBoundaries.dir){this.showPivotSlide(this._albumFBID,oc);return;}else if(this.stream.getCursor()===this._albumBoundaries.start&&qc===this._albumBoundaries.end&&nc===-this._albumBoundaries.dir)this.showPivotSlide(this._albumFBID,oc);}else{this.hidePivotSlide();if(nc===-this._albumBoundaries.dir)return;}}var sc=this.getVideoOnStage();if(sc)this.switchVideo(sc,false);if(this.pivots&&this.pivots.page(nc))return;i.inform('PhotoSnowlift.PAGE');bb.hide();this.recacheData();this.stream.moveCursor(nc);l.hide(this.image);if(nc!==0){this.storyID=null;this._updateContainerOwnerID();}if(nc!==0&&this._isZoomOn)this._setZoomOut();if(this.stream.errorInCurrent()){this.setLoadingState(mc.STATE_HTML,true);l.show(this.errorBox);return;}this.movementDelta+=nc;var tc=this.stream.getCurrentImageData();if(tc){var uc=this.getImageURL(tc);if(uc){if(tc.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();ta.logGraphic(fc.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();ta.logGraphic(fc.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(uc,null,true);}else if(tc.video)this.switchVideo(tc.video,true,pc);if(!oc){this.replaceUrl=true;xb(tc.info.permalink);}this.setLoadingState(mc.STATE_IMAGE_DATA,false);}else{this.setLoadingState(mc.STATE_IMAGE_PIXELS,true);this.setLoadingState(mc.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(mc.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this._slideshowToken){l.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)l.addClass(this.root,'slideshowAvailable');if(!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID)if(rc===-1){ma.fetch(this._albumFBID,this.stream);}else if(rc===0){ra.logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}this._initLitestandShareAttachments();};mc.prototype.showMorePhotos=function(nc,oc){'use strict';if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));l.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=new va(la,this.searchPivot);this.searchPivotComponent.setProps({className:"_27g",fbid:nc,onclose:this.hideMorePhotos.bind(this),endofalbum:oc||false,withBackground:true});};mc.prototype.hideMorePhotos=function(){'use strict';if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;l.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};mc.prototype.showPivotSlide=function(nc,oc){'use strict';if(this.onExtraSlide)return;this.onExtraSlide=true;l.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=p.create('div');p.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=new va(ka,this.pivotSlide);this.pivotSlideComponent.setProps({fbid:nc,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:true,onReturn:this.page.bind(this,this._albumBoundaries.dir,oc)});};mc.prototype.hidePivotSlide=function(){'use strict';if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});l.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};mc.prototype.logImpressionDetailsForPhoto=function(){'use strict';var nc=[].concat(p.scry(h('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),p.scry(h('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(nc.length===0)return;var oc={};for(var pc=0;pc<nc.length;pc++)oc[nc[pc].name]=nc[pc].value;if(this.getVideoOnStage()){oc.width=0;oc.height=0;}else{var qc=this.getImageDimensions(this.stream.getCurrentImageData());oc.width=qc.x;oc.height=qc.y;}ja.addDetailData(this.stream.getCursor(),oc);oa.setIsLogAdData(true);};mc.prototype.loadAds=function(){'use strict';if(this.disableAds)return;oa.loadAdsFromUserActivity();};mc.prototype.transitionHandler=function(nc){'use strict';if(nc.getQueryData().closeTheater||nc.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(nc.getQualifiedURI().toString());ea.transitionComplete(true);return true;}var oc=this._uriStack.length;if(oc>=2&&this._uriStack[oc-2]==nc.getQualifiedURI().toString())this._uriStack.pop();var pc=this.stream.getCursorForURI(nc.getUnqualifiedURI().toString());if(pc){var qc=this.stream.getRelativeMovement(pc);this.page(qc,true);ea.transitionComplete(false);return true;}if(this.isOpen){ea.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};mc.prototype.recacheData=function(){'use strict';if(!this.loadingStates.html){var nc=this.stream.getCurrentHtml();for(var oc in nc){var pc=h(oc);nc[oc]=Array.from(pc.childNodes);p.empty(pc);}}};mc.prototype.reloadIfTimeout=function(){'use strict';if(!u.hasLoaded(this.image)){var nc=this.makeNewImage(this.image.src,true);s.listen(nc,'load',this.useImage.bind(this,nc,null,true));this._log(nc.src);}};mc.prototype.useImage=function(nc,oc,pc){'use strict';if(pc&&u.hasLoaded(this.image))return;p.replace(this.image,nc);this.image=nc;this.adjustStageSize(oc);};mc.prototype.makeNewImage=function(nc,oc){'use strict';if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!oc)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),mc.LOADING_TIMEOUT);var pc=p.create('img',{className:'spotlight',alt:''});pc.setAttribute('aria-describedby','fbPhotosSnowliftCaption');pc.setAttribute('aria-busy','true');var qc=(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}).bind(this);s.listen(pc,'load',qc);this._log(nc);pc.src=nc;return pc;};mc.prototype.switchImage=function(nc,oc,pc){'use strict';l.hide(this.image);l.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var qc=this.stream&&this.stream.getCurrentImageData();if(qc){ja.addPhotoView(qc.info,this.shouldShowHiRes(qc),this.fullscreen&&t.isFullScreen());if(this._showHover){var rc=this.stream.getCurrentExtraData();if(rc)ra.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(rc.tagRects));}}this.useImage(this.makeNewImage(nc,false),oc,false);if(pc)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this._isZoomOn&&this._isZoomAvailable(qc)){ja.addPanoramaImpression();var sc=new jb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(sc);}else if(this._hasZoomCapability)l.hide(this.showZoomInButton);if(this._isZoomOn)this.switchIntoZoomedImage();i.inform('PhotoSnowlift.SWITCH_IMAGE');};mc.prototype._conditionDisplayZoomInButton=function(){'use strict';if(!this._hasZoomCapability)return;if(this._isZoomAvailable()){var nc=new jb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(nc);}else l.hide(this.showZoomInButton);};mc.prototype._displayZoomInButton=function(nc){'use strict';var oc=parseInt(this.image.style.height,10),pc=(nc.y-oc)/2;if(pc>=mc.ZOOM_BUTTON_TOP_PAD+mc.ZOOM_BUTTON_BOT_PAD+mc.ZOOM_BUTTON_HEIGHT){var qc=pc-mc.ZOOM_BUTTON_HEIGHT-mc.ZOOM_BUTTON_TOP_PAD;ab.set(this.showZoomInButton,'bottom',qc+'px');}else ab.set(this.showZoomInButton,'bottom','60px');l.show(this.showZoomInButton);};mc.prototype._isZoomAvailable=function(nc){'use strict';if(typeof nc==="undefined")nc=this.stream&&this.stream.getCurrentImageData();if(!this._hasZoomCapability||!nc||!nc.originalDimensions)return false;var oc=new jb(this.stage.clientWidth,this.stage.clientHeight),pc=nc.originalDimensions,qc=pc.x/pc.y,rc=Math.min(oc.y*qc,pc.x);if(!isNaN(qc)&&qc>2&&pc.y>mc.MIN_PANORAMA_Y&&oc.x*mc.MIN_PANO_TO_STAGE_RATIO<rc){return true;}else return false;};mc.prototype._setZoomIn=function(){'use strict';this._isZoomOn=true;l.hide(this.showZoomInButton);l.hide(this.stageActions);l.show(this.showZoomOutButton);ab.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(y);this.collapseRHC();};mc.prototype._setZoomOut=function(){'use strict';if(!this._hasZoomCapability)return;this._isZoomOn=false;this.spotlight.enableBehavior(y);ab.set(this.stage,'overflow','visible');l.hide(this.showZoomInButton);l.hide(this.showZoomOutButton);l.hide(this.zoomedImage);l.hide(this.outerImageSlider);l.show(this.stageActions);this.uncollapseRHC();};mc.prototype.switchIntoZoomedImage=function(nc){'use strict';this._setZoomIn();l.hide(this.zoomedImage);l.hide(this.outerImageSlider);var oc=this.stream.getCurrentImageData(),pc=oc.originalDimensions;this.zoomedImage.src=oc.url;this.adjustStageSize(pc);this._initializeZoomedImagePositions(new jb(parseInt(ab.get(this.zoomedImage,'width'),10),parseInt(ab.get(this.zoomedImage,'height'),10)));l.hide(this.image);};mc.prototype._adjustInnerImageSlider=function(nc){'use strict';var oc=this.stage.clientWidth,pc=Math.min(100,oc/nc.x*100);ab.set(this.innerImageSlider,'width',pc+'%');return pc;};mc.prototype._getSliderSizeForZoomedImage=function(nc){'use strict';var oc=mc.MAX_SLIDER_HEIGHT*this.stage.clientHeight/nc.y,pc=mc.MAX_SLIDER_WIDTH*this.stage.clientWidth/nc.x,qc=Math.min(oc,pc);return new jb(100*nc.x*qc/this.stage.clientWidth,100*nc.y*qc/this.stage.clientHeight);};mc.prototype._initializeZoomedImagePositions=function(nc){'use strict';this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);var oc=this._getSliderSizeForZoomedImage(nc);ab.set(this.outerImageSlider,'width',oc.x+'%');ab.set(this.outerImageSlider,'height',oc.y+'%');ab.set(this.outerImageSlider,'left',50-oc.x/2+'%');ab.set(this.showZoomOutButton,'bottom',oc.y*this.stage.clientHeight/100+parseInt(ab.get(this.outerImageSlider,'bottom'),10)+20+'px');l.show(this.zoomedImage);l.show(this.outerImageSlider);};mc.prototype._zoomedImageMouseDown=function(event){'use strict';if(!this._isZoomOn)return;l.addClass(this.stage,'showSlider');if(this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();var nc=false,oc=event.getTarget();if(fa.bySelector(oc,"._10zv")){this.startSliderMargins=new jb(parseFloat(ab.get(this.innerImageSlider,'marginLeft')),parseFloat(ab.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new jb(event.clientX,event.clientY);}else if(fa.bySelector(oc,"._10zx")){this.startSliderMargins=new jb(parseInt(ab.get(this.innerImageSlider,'marginLeft'),10),parseInt(ab.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var pc=parseInt(ab.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new jb(this.innerImageSlider.getBoundingClientRect().left+pc/2,event.clientY);nc=true;}else if(fa.bySelector(oc,"._10zw")){this.startImageMargins=new jb(parseInt(ab.get(this.zoomedImage,'marginLeft'),10),parseInt(ab.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new jb(event.clientX,event.clientY);}this._zoomedImageMouseMoveHandle=s.listen(this.stage,'mousemove',this._zoomedImagePan.bind(this));if(nc){this._zoomedImagePan(event);}else event.kill();};mc.prototype._zoomedImageMouseUp=function(event){'use strict';if(this._zoomedImageMouseMoveHandle){l.removeClass(this.stage,'showSlider');this._zoomedImageMouseMoveHandle.remove();this._zoomedImageMouseMoveHandle=null;var nc=parseFloat(ab.get(this.zoomedImage,'marginLeft')),oc=-this.zoomedImage.width+this.stage.clientWidth;this._previousZoomScrollPercent=nc/oc;}};mc.prototype._zoomedImagePan=function(event){'use strict';var nc;if(this.startSliderMargins){nc=event.clientX-this.mouseDownStartPosition.x;var oc=parseFloat(ab.get(this.outerImageSlider,'width')),pc=parseFloat(ab.get(this.innerImageSlider,'width')),qc=Math.max(0,Math.min(oc-pc,this.startSliderMargins.x+nc))/oc;ab.set(this.innerImageSlider,'marginLeft',100*qc+"%");ab.set(this.zoomedImage,'marginLeft',-1*qc*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){nc=1.75*(this.mouseDownStartPosition.x-event.clientX);var rc=Math.min(0,Math.max(this.startImageMargins.x-nc,-this.zoomedImage.width+this.stage.clientWidth));ab.set(this.zoomedImage,'marginLeft',rc+'px');ab.set(this.innerImageSlider,'marginLeft',-rc/this.zoomedImage.width*100+"%");event.kill();}};mc.prototype._scrollZoomedImageToPercent=function(nc){'use strict';if(nc===undefined||nc===null)nc=.5;var oc=new jb(parseInt(ab.get(this.zoomedImage,'width'),10),parseInt(ab.get(this.zoomedImage,'height'),10));ab.set(this.innerImageSlider,'marginLeft',(100-this._adjustInnerImageSlider(oc))*nc+'%');ab.set(this.zoomedImage,'marginLeft',(this.stage.clientWidth-oc.x)*nc+'px');};mc.prototype._preloadNextVideo=function(){'use strict';var nc=this.stream.calculatePositionForMovement(1),oc=this.stream.getCursorAt(nc),pc=this.stream.getImageData(oc);if(pc&&pc.video)pc.controller.preload();};mc.prototype.switchVideo=function(nc,oc,pc){'use strict';this._pauseVideoIfNeeded();var qc='swf_'+nc;p.empty(this.videoStage);if(oc){this._preloadNextVideo();l.addClass(this.stageWrapper,'showVideo');var rc=this.stream.getCurrentImageData();if(this.shouldRenderVideoPivots){l.hide(this.nextPager);l.hide(this.prevPager);}var sc=rc.video_element;p.scry(sc,"._ox1")[0].style.cssText='';var tc=null;if(this.pivotsCarouselElement)tc=r.scry(this.pivotsCarouselElement,"._32_l");if(tc)tc.forEach((function(xc){var yc=xc.getAttribute('data-fbid'),zc=this.stream.getCursor(),ad=p.find(xc,"._1pqn");if(yc===zc){l.show(ad);}else l.hide(ad);}).bind(this));l.addClass(sc,'videoStageContainer');p.appendContent(this.videoStage,sc);p.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[qc]&&!vb(qc))window[qc].write(nc);var uc='video_warning_'+nc,vc=vb(nc);if(!this.videoWarnings)this.videoWarnings=[];if(vc&&this.videoWarnings[uc])p.setContent(vc,this.videoWarnings[uc]);this._videoPlayerStateManager=rc.controller;this._videoPlayerStateManager.reset();this._videoPlayerStateManager.collectFeedTrackingData();if(this._autoplayVideos){var wc=pc||mb.USER;this._videoPlayerStateManager.play(wc);}if(this._autoplayNextVideo)this._videoPlayerStateManager.addListener('finishPlayback',(function(){var xc=rc.info.fbid.toString();if(this.haltAutoplay&&xc!==this.stream.fbidList[this.stream.fbidList.length-1]){if(this.autoplayOptionScreenConfig){var yc=this.autoplayOptionScreenConfig.controller;yc.registerCallbacks(sc,this.chooseToReplayVideo.bind(this,this._videoPlayerStateManager),this.handleAutoplay.bind(this,rc));}}else this.handleAutoplay(rc);}).bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,nc),0);}else{window[qc]&&window[qc].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);l.removeClass(this.stageWrapper,'showVideo');}};mc.prototype.removeAutoplayOptionScreen=function(){'use strict';if(this.autoplayOptionScreenConfig)this.autoplayOptionScreenConfig.controller.removeSelf();};mc.prototype.chooseToReplayVideo=function(nc){'use strict';nc.play(mb.USER);this.removeAutoplayOptionScreen();this.haltAutoplay=false;};mc.prototype.handleAutoplay=function(nc){'use strict';var oc=nc.info.fbid.toString();if(oc===this.stream.getCursor()&&oc!==this.stream.fbidList[this.stream.fbidList.length-1]){za.adjustCarouselOnAutoPlay();this.page(1,false,mb.AUTOPLAY);}this.removeAutoplayOptionScreen();this.haltAutoplay=false;};mc.prototype.checkVideoStatus=function(nc){'use strict';if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var oc=this.getVideoOnStage();if(!oc){return;}else{if(oc!==nc)return;this.adjustStageSizeForVideo(nc);}};mc.prototype.getVideoSize=function(nc){'use strict';return new jb(nc.getAttribute('data-video-width'),+nc.getAttribute('data-video-height')+this.getVideoComponentsHeight(nc));};mc.prototype.getVideoElement=function(nc){'use strict';return p.scry(this.videoStage,"._ox1")[0];};mc.prototype.getVideoComponentsHeight=function(nc){'use strict';var oc=0,pc=fa.bySelector(nc,"._1c_u");if(!pc)return 0;var qc=p.scry(pc,"._2i84");if(qc.length){var rc=qc[0].getBoundingClientRect();oc=rc.bottom-rc.top;}return oc;};mc.prototype.adjustStageSizeForVideo=function(nc){'use strict';var oc=this.getVideoElement(nc);if(!oc){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,nc),200);}else this.adjustStageSize(this.getVideoSize(oc));};mc.prototype.handleServerError=function(nc,oc){'use strict';p.setContent(this.errorBox,nc);this.storeFromData(oc);};mc.prototype.fixButtonText=function(nc){'use strict';if(!this.buttonTruncateGk)return;var oc=p.scry(nc,".photosTruncatingUIButton"),pc=parseInt(ab.get(nc,'width'),10);if(pc>kc){var qc={tagPhoto:ub._("Tag photo"),doneTagPhoto:ub._("Done Tagging"),addLocation:ub._("Add Location"),editPhoto:ub._("Edit")};for(var rc=0;rc<oc.length;rc++){var sc=oc[rc];l.addClass(sc,"_2n0k");cb.set(sc,qc[sc.getAttribute('data-buttonname')],'below','center');}}};mc.prototype.swapData=function(){'use strict';var nc,oc=this.stream.getCurrentHtml();if(oc){this.setLoadingState(mc.STATE_HTML,false);for(var pc in oc){nc=vb(pc);nc&&p.setContent(nc,oc[pc]);}var qc=vb('photosTruncatingUIButtonGroup');qc&&this.fixButtonText(qc);i.inform('PhotoSnowlift.DATA_CHANGE',Object.assign(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),i.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())i.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),i.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};mc.prototype.updateTotalCount=function(nc,oc,pc){'use strict';var qc=this.stream.getCurrentHtml();if(qc){var rc=h('fbPhotoSnowliftPositionAndCount');p.replace(rc,pc);rc=pc;l.show(rc);var sc='fbPhotoSnowliftPositionAndCount';qc[sc]=Array.from(rc.childNodes);}this.stream.setTotalCount(nc);this.stream.setFirstCursorIndex(oc);};mc.prototype.addPhotoFbids=function(nc,oc,pc,qc){'use strict';if(qc&&this.sessionID&&qc!=this.sessionID)return;var rc=this.stream.getCursor()===null;if(this.shouldRenderVideoPivots&&!this._videoSameAsSource)this.stream.fbidList=[];this.stream.attachToFbidsList(nc,oc,pc);if(pc&&rc)this.page(0,true);if(this.pivots&&pc)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;l.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){var sc=this.stream.getCursor(),tc=this.stream.calculateDistance(sc,this._mediaFBID);this.stream.moveCursor(tc);}};mc.prototype.attachTagger=function(nc,oc){'use strict';p.appendContent(this.stageActions,nc);if(oc)oc.setTokenarea(this.taglist);};mc.prototype.storeFromData=function(nc){'use strict';if(!this.isOpen)return;if(nc.pivots)this.pivotsCarouselElement=nc.pivots;if(nc.autoplay_option_screen_config){this.autoplayOptionScreenConfig=nc.autoplay_option_screen_config;if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.addHaltAutoplaySubscription();}this.shouldRenderVideoPivots=nc.should_render_pivots;if(nc.ssid&&this.sessionID&&this.sessionID!=nc.ssid)return;var oc=this.stream.storeToCache(nc);if('error' in oc){this.checkState(mc.STATE_ERROR);return;}if('init' in nc){if(this.shouldRenderVideoPivots)this._videoSameAsSource=nc.init.videoSameAsSource;this._mediaFBID=nc.init.fbid;this._albumFBID=nc.init.album_fbid;this._isAlbum=nc.init.is_album;this._albumOwnerName=nc.init.album_owner_name;this._autoplayVideos=nc.init.autoplay_videos;this._autoplayNextVideo=nc.init.autoplay_next_video;}else this._preloadNextVideo();if('init' in oc){this.initDataFetched(oc.init);if(this.openExplicitly){this.replaceUrl=true;xb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();}if('image' in oc)this.checkState(mc.STATE_IMAGE_DATA);if('data' in oc)this.checkState(mc.STATE_HTML);};mc.prototype.setLeftAndRightPagersState=function(){'use strict';if(this.stream.isNonCircularPhotoSet()){l.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));l.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){l.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var nc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));l.conditionClass(this.root,'disableRight',nc==this.firstInSet);}};mc.prototype.setStagePagersState=function(nc){'use strict';switch(nc){case 'ready':l.addClass(this.root,'pagingReady');this.pagersShown=true;this._setupNextItemUI();return;case 'active':l.addClass(this.root,'pagingActivated');return;case 'inactive':l.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':l.removeClass(this.root,'pagingReady');return;}};mc.prototype.deletePhoto=function(nc){'use strict';this.closeRefresh();};mc.prototype.closeRefresh=function(){'use strict';this.refreshOnClose=true;this.spotlight.hide();};mc.prototype.onHiliteTag=function(nc,oc){'use strict';if(oc.version!=ia.VIEWER_SNOWLIFT)return;var pc=oc.tag;if(pc)this.switchHilitedTags(pc,true);};mc.prototype.onUpdateTagBox=function(nc,oc){'use strict';if(oc.version==ia.VIEWER_SNOWLIFT)this.updateTagBox(oc.id,oc.approve);};mc.prototype._log=function(nc){'use strict';if(this._shouldLog){this._logger&&this._logger.log(nc);return true;}return false;};mc.prototype._enableMouseOver=function(){'use strict';this._disableMouseOver=false;};mc.prototype._interceptMouseOver=function(event){'use strict';if(this._disableMouseOver)event.kill();};mc.prototype.isReturningToStart=function(){'use strict';return !!this.returningToStart;};mc.prototype._pauseVideoIfNeeded=function(){'use strict';if(this._videoPlayerStateManager){this._videoPlayerStateManager.pause('unloaded');if(lb.canAbort)this._videoPlayerStateManager.abortLoading();}};mc.getInstance=function(){'use strict';if(!mc._instance)mc._instance=new mc();return mc._instance;};mc.initWithSpotlight=function(nc,oc){'use strict';mc.getInstance().init(nc,oc);};mc.addPhotoFbids=function(nc,oc,pc,qc){'use strict';mc.getInstance().addPhotoFbids(nc,oc,pc,qc);};mc.setReachedLeftEnd=function(){'use strict';mc.getInstance().setReachedLeftEnd();};mc.setReachedRightEnd=function(){'use strict';mc.getInstance().setReachedRightEnd();};mc.attachFollowFlyout=function(nc){'use strict';p.insertAfter(h('fbPhotoSnowliftSubscribe'),nc);};mc.attachSubscribeFlyout=function(nc){'use strict';p.insertAfter(h('fbPhotoSnowliftSubscribe'),nc);};mc.attachTagger=function(nc,oc){'use strict';mc.getInstance().attachTagger(nc,oc);};mc.preload=function(nc,oc){'use strict';if(!mc.shouldUseSnowlift(nc,oc))return;mc.getInstance().preload(nc,oc);};mc.bootstrap=function(nc,oc){'use strict';if(!mc.shouldUseSnowlift(nc,oc))return;var pc=nc&&new hb(nc).getQueryData();if(pc&&pc.hasOwnProperty('share_id')){k.loadModules(["SpotlightShareViewer"],function(qc){qc.bootstrap(nc,oc);});return;}mc.getInstance().bootstrap(nc,oc);};mc.shouldUseSnowlift=function(nc,oc){'use strict';var pc=nc&&new hb(nc).getQueryData();if(pc&&pc.hasOwnProperty('sell_story_id')){mc.getInstance().loadFrameIfUninitialized();k.loadModules(["MarketplaceProductDetail.react"],function(qc){qc.showDialog(pc.sell_story_id);});return false;}return true;};mc.closeRefresh=function(){'use strict';mc.getInstance().closeRefresh();};mc.deletePhoto=function(nc){'use strict';mc.getInstance().deletePhoto(nc);};mc.getImage=function(){'use strict';return mc.getInstance().getImage();};mc.getImageId=function(){'use strict';return mc.getInstance().getImageId();};mc.getLoadQuery=function(){'use strict';return mc.getInstance().getLoadQuery();};mc.getRHCBody=function(){'use strict';return mc.getInstance().getRHCBody();};mc.getRHCFooter=function(){'use strict';return mc.getInstance().getRHCFooter();};mc.getRHCHeader=function(){'use strict';return mc.getInstance().getRHCHeader();};mc.getRoot=function(){'use strict';return mc.getInstance().getRoot();};mc.likePhotoSkipConfirmation=function(nc){'use strict';mc.getInstance().likePhotoSkipConfirmation(nc);};mc.saveTagsFromPayload=function(nc){'use strict';mc.getInstance().saveTagsFromPayload(nc);};mc.saveTagsFromPayloadDelayed=function(nc){'use strict';setTimeout(mc.saveTagsFromPayload.bind(null,nc),2000);};mc.handleServerError=function(nc,oc){'use strict';mc.getInstance().handleServerError(nc,oc);};mc.setVideoWarning=function(nc,oc){'use strict';var pc=mc.getInstance(),qc='video_warning_'+nc;if(!pc.videoWarnings)pc.videoWarnings=[];pc.videoWarnings[qc]=oc;};mc.storeFromData=function(nc){'use strict';mc.getInstance().storeFromData(nc);};mc.swapData=function(){'use strict';mc.getInstance().swapData();};mc.updateTotalCount=function(nc,oc,pc){'use strict';mc.getInstance().updateTotalCount(nc,oc,pc);};mc.setVideoRotateURI=function(nc){'use strict';mc.getInstance().videoRotateURI=nc;};Object.assign(mc,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},PROFILE_PICTURE_BUTTON_WIDTH:140,SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:tb,touchMarkup:tb,PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE:100,PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:70,PRODUCT_ITEM_PAGER_HEIGHT:21,PRODUCT_ITEM_PAGER_MARGIN:20});Object.assign(mc.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:mc.STAGE_NORMAL_MAX,stageChrome:mc.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});f.exports=mc;},null);