/*!CK:712691582!*//*1451977672,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["4DNEs"]); }

__d("MessagingFilteringType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LEGACY:"legacy",MODERATE:"moderate",STRICT:"strict"};},null);
__d("MNCommerceBlockTypeJSInstance",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ALL:"all",PROMOTION:"promotion",NONE:"none"};},null);
__d('MercuryAudioPlayer',['Arbiter','DOM','Event','Flash'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=200;function m(){var v=i.create('audio'),w=false;try{if(!!v.canPlayType)if(v.canPlayType('video/mp4;').replace(/^no$/,''))w=true;}finally{return w;}}function n(){return k.isAvailable();}var o=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');j.listen(this.audio,'playing',(function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval((function(){this.informAttachment('playing',this.audio.currentTime);}).bind(this),l);}).bind(this));j.listen(this.audio,'ended',(function(){clearInterval(this.interval);this.informAttachment('finished');}).bind(this));};Object.assign(o.prototype,{setAudio:function(v,w){this.audio.setAttribute('src',v);this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var p=function(){this.src=null;this.arbiterInstance=null;var v=i.create('div');document.body.appendChild(v);this.swf=k.embed('/swf/cigars/SoundStreamPlayer.swf',v,null,{});this.interval=null;h.subscribe('soundstream/finished',(function(){clearInterval(this.interval);this.informAttachment('finished');}).bind(this));};Object.assign(p.prototype,{setAudio:function(v,w){this.src=v;this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.swf.playSound(this.src);this.interval=setInterval((function(){var v=this.swf.getCurrentTime();this.informAttachment('playing',v);}).bind(this),l);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function q(){if(m()){return new o();}else if(n())return new p();return false;}var r=null,s=null,t=0;function u(v,w){this.src=v;this.arbiterInstance=w;this.audio_id=++t;r!==null||(r=q());if(!r)return false;}Object.assign(u.prototype,{getType:function(){if(!r){return false;}else return r.getType();},play:function(v){if(v&&s==this.audio_id){r.resume();}else{this.pause();s=this.audio_id;r.setAudio(this.src,this.arbiterInstance);r.play();}},pause:function(){r.pause();}});f.exports=u;},null);
__d('MercuryAttachmentAudioClip.react',['Arbiter','ArbiterMixin','MercuryAudioPlayer','CurrentUser','JSLogger','LeftRight.react','MercuryShareAttachmentRenderLocations','React','SubscriptionsHandler','cx','fbt','joinClasses','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=o.PropTypes,v='MercuryAttachmentAudioClip/play',w=l.create('mercury_audio_clip'),x=o.createClass({displayName:'AudioClip',mixins:[i],propTypes:{duration:u.number,location:u.oneOf(n.getValues()),rootClassName:u.string,showHelp:u.bool,src:u.string.isRequired,width:u.number},getInitialState:function(){this.logged=false;return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:new j(this.props.src,this)};},componentDidMount:function(){this._subscriptionsHandler=new p();this._subscriptionsHandler.addSubscriptions(this.subscribe('playing',this.updateTime),this.subscribe('played',t(this.setState,this,{playing:true,started:true})),this.subscribe('paused',t(this.setState,this,{playing:false})),this.subscribe('finished',t(this.setState,this,{playing:false,started:false,time:this.props.duration})),h.subscribe(v,(function(y,z){if(this.props.src!=z)this.setState({time:0});}).bind(this)));},componentWillUnmount:function(){this._subscriptionsHandler&&this._subscriptionsHandler.release();},updateTime:function(y,z){this.setState({time:z});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);h.inform(v,this.props.src);if(!this.logged){this.logged=true;w.log('play',{uid:k.getID(),duration:this.props.duration});}}},_formatSeconds:function(y){if(y){y=Math.round(y);var z=y%60;if(z<10)z='0'+z;var aa=Math.floor(y/60);return aa+':'+z;}else return null;},_renderPlayer:function(y,z){return (o.createElement('a',{className:"_1miz _2e-1 _3_om",href:'#',style:{width:y},onClick:this.play},o.createElement('span',{className:"_1mi- _2e-2"},o.createElement('i',{className:"_1mi_ _2e-3"})),o.createElement('span',{className:"_1mj0 _2e-4 _3oh-"},z),o.createElement('div',{className:"_1mj1 _2e-5"})));},render:function(){var y=this.state.time,z=this.state.playing,aa=this._formatSeconds(this.state.duration),ba=this.props.location===n.MESSENGER,ca=this.props.width||170;if(ba){var da=this.props.duration;if(da>10){ca=240;}else if(da>5){ca=200;}else if(da>2){ca=160;}else ca=120;}var ea=null,fa=Math.ceil(y*(ca+2)/this.state.duration);if(ba)fa=Math.ceil(y*(ca+24)/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var ga=this._renderPlayer(ca,aa),ha=this._renderPlayer(ca,aa),ia="_1mj2"+(' '+"_2e-6")+(z&&y!==0?' '+"_1mj3":'')+(z&&y===0?' '+"_4g4x":'');ea=o.createElement('div',{className:ia},ga,o.createElement('div',{className:"_1mj4 _2e-7",style:{width:fa}},ha));}else ea=o.createElement('div',{className:"_1mj2"},o.createElement('div',{className:"_1miz"},o.createElement(m,null,o.createElement('a',{className:"_1mj5",href:this.props.src},o.createElement('span',{className:"_3qi6"},o.createElement('i',{className:"_1mj6"})),o.createElement('span',{className:"_1mj7"},r._("Voice Message")),o.createElement('span',{className:"_1mj8"},aa)),o.createElement('a',{href:this.props.src,className:"_1mj9"},o.createElement('i',{className:"_1mja"})))));return (o.createElement('div',{className:s("_1mjb"+(ba?' '+"_454y":''),this.props.rootClassName)},ea));}});f.exports=x;},null);
__d("MercuryAttachmentConstants",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={SIDE_LENGTH:9};f.exports=h;},null);
__d('MercuryAttachmentError.react',['XUINotice.react','XUIText.react','React','fbt'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.createClass({displayName:'MercuryAttachmentError',render:function(){return (j.createElement(h,{use:'warn'},j.createElement(i,{size:'small'},k._("This attachment could not be loaded."))));}});f.exports=l;},null);
__d('MercuryAttachmentFile.react',['Image.react','LeftRight.react','Link.react','MercuryAttachment','ReactComponentWithPureRenderMixin','React','ix','cx','joinClasses','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=m.PropTypes,s=m.createClass({displayName:'MercuryAttachmentFile',propTypes:{name:r.string.isRequired,open_url:r.string,rel:r.string,type:r.string.isRequired,url:r.string},mixins:[l],_renderFileLinks:function(){if(this.props.open_url)return (m.createElement('div',{className:"_59gs"},m.createElement(j,{target:'_blank',href:this.props.open_url},q._("open")),' ','Â·',' ',m.createElement(j,{href:this.props.url},q._("download"))));return m.createElement('div',null);},render:function(){var t=p(k.getAttachIconClass(this.props.type),"_59go _59gq");if(this.props.url)return (m.createElement(i,{className:t},m.createElement(j,{href:this.props.url},m.createElement(i,null,m.createElement(h,{src:n('/images/messaging/docs/generic.png')}),m.createElement('span',{className:"_59gp"},this.props.name))),this._renderFileLinks()));return (m.createElement(i,{className:t},m.createElement(h,{src:n('/images/messaging/docs/generic.png')}),m.createElement('span',{className:"_59gp"},this.props.name)));}});f.exports=s;},null);
__d('MercuryAttachmentMalicious.react',['XUINotice.react','XUIText.react','React','fbt'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.createClass({displayName:'MercuryAttachmentMalicious',render:function(){return (j.createElement(h,{use:'warn'},j.createElement(i,{size:'small'},k._("This attachment has been marked as malicious."))));}});f.exports=l;},null);
__d('ChatImageArrowDirection',['keyMirror'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h({BOTH:null,LEFT:null,RIGHT:null});f.exports=i;},null);
__d('ChatImageWithArrow.react',['BackgroundImage.react','ChatImageArrowDirection','Link.react','MercuryAttachmentConstants','React','XUISpinner.react','cx','getVendorPrefixedName','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=l.PropTypes,r=30,s=15,t=l.createClass({displayName:'ChatImageWithArrow',propTypes:{arrowDirection:q.oneOf(Object.keys(i)),onClick:q.func,height:q.number.isRequired,isLoading:q.bool,round:q.bool,rootClassName:q.string,sideLength:q.number,source:q.string,width:q.number.isRequired},getDefaultProps:function(){return {sideLength:k.SIDE_LENGTH,isLoading:false,round:false};},render:function(){this._arrowWidth=Math.floor(this.props.sideLength/Math.sqrt(2));this._extendedPhotoWidth=Math.ceil(this._getWidth()+this._arrowWidth);if(this.props.isLoading)return this._renderUploadingBubble();var u=p("_4yp6"+(this.props.round?' '+"_3lk2":''),this.props.rootClassName);return this._renderLink(l.createElement('div',{className:u},l.createElement('div',{className:"_52kr"+(this.props.round?' '+"_3_om":''),style:{width:this._getWidth(),height:this._getHeight()}},l.createElement('div',{className:"_4yp9",style:{backgroundImage:'url('+this.props.source+')',width:this._getWidth(),height:this._getHeight()}}))));},_getWidth:function(){return Math.max(this.props.width,s);},_getHeight:function(){return Math.max(this.props.height,r);},_renderLink:function(u){if(this.props.onClick)return (l.createElement(j,{onClick:this.props.onClick},u));return u;},_calculateArrowTransform:function(u,v,w,x){if(v===i.LEFT){return 'translate('+w+'px, '+x+'px)'+'rotate(45deg)';}else return 'translate('+(u-w)+'px, '+x+'px)'+'rotate(45deg)';},_calculateArrowImageTransform:function(u,v,w,x){if(v===i.LEFT){return 'rotate(-45deg)'+'translate(-'+(this._arrowWidth+w)+'px,'+'-'+x+'px)';}else return 'rotate(-45deg)'+'translate(-'+(u-w)+'px, -'+x+'px)';},_renderUploadingBubble:function(){var u={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)u.backgroundImage='url('+this.props.source+')';var v={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)v.opacity=0;var w={width:this._getWidth(),height:this._getHeight()};if(this.props.source){w.backgroundImage='url('+this.props.source+')';w.backgroundSize='cover';}return (l.createElement('div',{className:"_4yp6"},l.createElement('div',{className:"_4ypb _3_om",style:w},l.createElement(m,{size:'small'}))));}});f.exports=t;},null);
__d('MercuryAttachmentPhoto.react',['ChatImageArrowDirection','ChatImageWithArrow.react','MercuryMessageInfo','MessagesViewer','React'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=l.PropTypes,n=l.createClass({displayName:'MercuryAttachmentPhoto',propTypes:{height:m.number,image:m.object.isRequired,message:m.object.isRequired,onAttachmentLoad:m.func,round:m.bool,width:m.number},componentDidMount:function(){k.preload();this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.height);},_handleClickPicture:function(o){var p=this.props.image;k.bootstrapWithConfig({src:p.preview_url,endpoint:p.url,fbid:p.metadata.fbid,dimensions:p.metadata.dimensions,disablePaging:true},null);},render:function(){var o=j.isInbound(this.props.message);return (l.createElement(i,{arrowDirection:o?h.LEFT:h.RIGHT,source:this.props.image.preview_url,height:this.props.height,width:this.props.width,onClick:this._handleClickPicture,round:!!this.props.round,isLoading:!!this.props.image.preview_uploading}));}});f.exports=n;},null);
__d('ChatGridImage.react',['Link.react','React','cx'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=i.PropTypes,l=i.createClass({displayName:'ChatGridImage',propTypes:{isLoading:k.bool,onClick:k.func,size:k.number.isRequired,source:k.string},render:function(){if(this.props.isLoading)return (i.createElement('div',{className:"_4ypb",style:{width:this.props.size,height:this.props.size}}));return (i.createElement(h,{onClick:this.props.onClick},i.createElement('div',{className:"_332l",style:{backgroundImage:'url('+this.props.source+')',width:this.props.size,height:this.props.size}})));}});f.exports=l;},null);
__d('MercuryAttachmentPhotoGrid.react',['ChatGridImage.react','Grid.react','MercuryAttachmentType','MercuryMessageInfo','MessagesViewer','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=i.GridItem,p=m.PropTypes,q=m.createClass({displayName:'MercuryAttachmentPhotoGrid',propTypes:{images:p.arrayOf(p.object).isRequired,size:p.number.isRequired,message:p.object.isRequired},componentDidMount:function(){l.preload();},_generateClickHandler:function(r){var s=this.props.images.some(function(t){return t.attach_type===j.ANIMATED_IMAGE;});return (function(t){l.bootstrapWithConfig({src:r.preview_url,endpoint:r.url,fbid:r.metadata.fbid,dimensions:r.metadata.dimensions,disablePaging:s},null);});},render:function(){var r=this.props.images,s=r.length,t=s==2||s==4?2:3,u=Math.floor(this.props.size/t),v=[];for(var w=0;w<r.length;w++)v.push(m.createElement(o,{key:w},m.createElement(h,{isLoading:!!r[w].preview_uploading,onClick:this._generateClickHandler(r[w]),size:u,source:r[w].preview_url})));return (m.createElement(i,{cols:t,className:"_5b2w",spacing:"_5b2x",alignh:'right'},v));}});f.exports=q;},null);
__d('MercuryAttachmentAttribution.react',['Image.react','ImmutableObject','ReactComponentWithPureRenderMixin','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'MercuryAttachmentAttribution',mixins:[j],propTypes:{attachment:n.instanceOf(i)},render:function(){var p=this._getAttribution();if(!p)return null;return (k.createElement('div',{className:m(this.props.className,"_29ew")},k.createElement(h,{src:p.icon_url,className:"_29ex"}),k.createElement('span',{className:"_29ey"},p.name)));},_getAttribution:function(){return this.props.attachment&&this.props.attachment.app_attribution;}});f.exports=o;},null);
__d('ChatAttachmentAttribution.react',['ImmutableObject','MercuryAttachmentAttribution.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'ChatAttachmentAttribution',propTypes:{attachment:l.instanceOf(h)},render:function(){return (j.createElement(i,{attachment:this.props.attachment,className:"_1ekr _4i_6"}));}});f.exports=m;},null);
__d('ChatSpeakingSticker.react',['React','ReactDOM','ReactComponentWithPureRenderMixin'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=h.PropTypes,l=h.createClass({displayName:'ChatSpeakingSticker',mixins:[j],propTypes:{videoURI:k.string.isRequired,videoSize:k.shape({height:k.number,width:k.number}).isRequired},_handleStickerClick:function(){var m=i.findDOMNode(this.refs.stickerVideo);m.play();},render:function(){return (h.createElement('div',{onClick:this._handleStickerClick},h.createElement('video',{height:this.props.videoSize.height,ref:"stickerVideo",width:this.props.videoSize.width},h.createElement('source',{src:this.props.videoURI}))));}});f.exports=l;},null);
__d('MercuryAttachmentVideo.react',['ChatAttachmentAttribution.react','ChatImageArrowDirection','ChatImageWithArrow.react','ChatSpeakingSticker.react','CenteredContainer.react','FBOverlayBase.react','FBOverlayContainer.react','FBOverlayElement.react','Image.react','ImmutableObject','MercuryAttachment','MessagesViewer','React','Vector','cx','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=t.PropTypes,y=t.createClass({displayName:'MercuryAttachmentVideo',propTypes:{attachment:x.instanceOf(q),duration:x.number.isRequired,isChat:x.bool,isInbound:x.bool,name:x.string.isRequired,onAttachmentLoad:x.func,pageID:x.number,thumbSize:x.shape({height:x.number,width:x.number}).isRequired,thumbnail:x.string.isRequired,videoSize:x.shape({height:x.number,width:x.number}).isRequired,videoID:x.string.isRequired,videoURI:x.string.isRequired},componentDidMount:function(){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.thumbSize.height);s.preload();},_formatDuration:function(){var z=this.props.duration,aa=Math.floor(z/60),ba=z%60;if(ba<10)return aa+':0'+ba;return aa+':'+ba;},openViewer:function(){var z=this.props,aa=z.pageID,ba=z.videoID,ca=z.videoSize,da=z.videoURI;ca=new u(ca.width,ca.height);s.renderVideo({pageID:aa,videoID:ba,videoSize:ca,videoURI:da});},_renderImage:function(){if(this.props.isChat){return (t.createElement('div',null,t.createElement(j,{height:this.props.thumbSize.height,key:'previewImage',round:true,source:this.props.thumbnail,width:this.props.thumbSize.width}),t.createElement(h,{attachment:this.props.attachment,key:'chatAttribution'})));}else return (t.createElement(p,{height:this.props.thumbSize.height,width:this.props.thumbSize.width,src:this.props.thumbnail}));},_getStyle:function(){if(this.props.isChat)return {};return this.props.thumbSize;},render:function(){if(this.props.attachment.metadata&&this.props.attachment.metadata.render_as_sticker&&this.props.isChat)return (t.createElement(k,{videoURI:this.props.videoURI,videoSize:this.props.videoSize}));var z=r.hasAttribution(this.props.attachment),aa="clearfix"+(' '+"_zow")+(' '+"_59go")+(z?' '+"_4yjw":'')+(this.props.isChat?' '+"_3ds5":''),ba=t.createElement(n,{className:aa,key:'overlayContainer',onClick:this.openViewer,style:this._getStyle()},t.createElement(m,null,this._renderImage()),t.createElement(o,null,t.createElement('div',{className:(!this.props.isChat?"_zox":'')+(z?' '+"_jt3":'')},t.createElement('span',{className:"_zoz"},this._formatDuration()))),t.createElement(o,null,t.createElement(l,{className:z?"_jt3":'',vertical:true},t.createElement(p,{src:w('/images/chat/chat_play_icon.png')}))));if(this.props.isChat)return ba;return (t.createElement('div',null,ba,t.createElement(h,{attachment:this.props.attachment,key:'inboxAttribution'})));}});f.exports=y;},null);
__d('PhotosMultiUploadInput',['Arbiter','Animation','AsyncUploadRequest','ComposerWaterfallEvent','ComposerXController','ComposerXDragDropUtils','ComposerXMarauderLogger','ComposerXMediaUploadHandler','CSS','Dialog','DOM','DragDropTarget','Event','JpegResizer','Parent','PhotosMimeType','PhotosUploadID','PhotosUploadWaterfallXMixin','PUWApplications','PUWMethods','PUWSteps','ProgressBar','Tooltip','WaterfallIDGenerator','XComposerPhotoUploader','$','csx','cx','mixin','performanceNow','fbt','updatePhotoProgressBar','Fbtrace'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){if(c.__markCompiled)c.__markCompiled();var na,oa,pa=1366052;c("Fbtrace");function qa(wa,xa,ya,za){'use strict';this._grid=ta.getInstance(za.gridID);this._grid.setProgressBarMarkup(wa).setVideoIconMarkup(xa).setConfig(za);ya.getInput().multiple=za.maxselect!=1&&j.isSupported();ya.subscribe('change',(function(ab,event){if(event.getTarget().value)this._grid.doFileUpload(ya);}).bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(ba.CLIENT_FLOW_BEGIN,{custom_tags:{high_quality:za.initWithHighQuality}});}this._grid.logStep(ba.CLIENT_SELECT_BEGIN);h.inform('PhotosMultiUploadInput/loaded/'+za.gridID,null,h.BEHAVIOR_PERSISTENT);}qa.prototype.getGrid=function(){'use strict';return this._grid;};qa.prototype.onQualitySettingChanged=function(wa){'use strict';this._grid.setQuality(wa);};Object.assign(qa,{imageUploadDone:function(wa,xa,ya,za,ab){ra[wa].imageUploadDone(xa,ya,za,ab);},addCameraImage:function(wa,xa,ya){ra[wa].addCameraImage(xa,ya);},initDragDrop:function(wa,xa){h.inform('PhotosMultiUploadInput/initDragDrop/'+wa,{dragDropArea:xa},h.BEHAVIOR_PERSISTENT);},imageUploadFail:function(wa,xa){ra[wa].removeLoadingIndicator(xa.getFile().uploadID);},doFileUpload:function(wa,xa){ra[wa].doFileUpload(xa);},onFilesDrop:function(wa,xa){ra[wa].onFilesDrop(xa);},onVaultImagesAdded:function(wa,xa){ra[wa].onVaultImagesAdded(xa);},getWaterfallID:function(wa){return ta.getInstance(wa).getWaterfallID();},clearSession:function(wa){ra[wa].clearSession();},getConfig:function(wa){return ra[wa].getConfig();}});var ra={},sa=0;na=babelHelpers.inherits(ta,ja(y));oa=na&&na.prototype;function ta(wa){'use strict';oa.constructor.call(this);this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=wa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;this._numUploadsSucceeded=0;this._numUploadsFailed=0;this._uploadIDToFileUpload={};this._failedUploadIDs={};h.subscribe('multi-upload/video-removed/'+this._gridID,(function(){r.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(xa){xa.clear();});}).bind(this));h.subscribe('multi-upload/image-removed/'+this._gridID,(function(){this._logComposerWaterfallEvent(k.PHOTO_REMOVE);}).bind(this));h.subscribe('PhotosMultiUploadInput/initDragDrop/'+this._gridID,(function(xa,ya){this.initDragDrop(ya.dragDropArea);}).bind(this));h.subscribe('AttachmentsPhotoEditor/logPhotoEditorLaunched'+this._gridID,(function(xa,ya){this.logStep(ba.CLIENT_PHOTO_EDIT_BEGIN);}).bind(this));h.subscribe('AttachmentsPhotoEditor/newImage'+this._gridID,this._onEditedImage.bind(this));}ta.prototype.getWaterfallID=function(){'use strict';if(!this._waterfallID)this._waterfallID=ea.generate();return this._waterfallID;};ta.prototype.getWaterfallAppName=function(){'use strict';return z.WEB_COMPOSER;};ta.prototype.getWaterfallSource=function(){'use strict';return this._config.ref;};ta.prototype.getLoadingIndicator=function(wa){'use strict';var xa=this._loadingIndicators[wa];return xa;};ta.prototype.initDragDrop=function(wa){'use strict';this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new s(wa).setOnFilesDropCallback((function(xa){this.onFilesDrop(xa,aa.DRAGDROP);}).bind(this)).setFileFilter(m.filterImages).enable();};ta.prototype.setConfig=function(wa){'use strict';this._config=wa;this._isHighQuality=wa.hasOwnProperty('initWithHighQuality')?wa.initWithHighQuality:true;if(!u.isSupported()){this.logStep(ba.CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer){this._resizer=new u(this._config.maxselect===1?1:u.DEFAULT_POOL_SIZE);this._resizer.setHighQuality(this._isHighQuality);}if(!this._waterfallID)this._waterfallID=wa.waterfallID;this._concurrentLimit=wa.concurrentLimit;return this;};ta.prototype.setProgressBarMarkup=function(wa){'use strict';this._progressBarMarkup=wa;return this;};ta.prototype.setVideoIconMarkup=function(wa){'use strict';this._videoIconMarkup=wa;var xa=r.find(wa,"._3ev");t.listen(xa,'click',this._onVideoRemoved.bind(this));return this;};ta.prototype.setQuality=function(wa){'use strict';this._isHighQuality=wa;this._resizer&&this._resizer.setHighQuality(wa);this.logStep(ba.CLIENT_QUALITY_SWITCH,{custom_tags:{high_quality:this._isHighQuality}});};ta.prototype.imageUploadDone=function(wa,xa,ya,za){'use strict';this._numUploadsSucceeded++;var ab=this.getLoadingIndicator(xa);if(!ab)return;if(r.contains(document.body,ab.getRoot()))r.replace(ab.getRoot(),wa);var bb={};bb[xa]=ya;this._informImagesAdded(bb,za);this._markUploadAsFinished();this._loadingIndicators[xa]=null;};ta.prototype.addCameraImage=function(wa,xa){'use strict';this.insertIntoGrid(wa);this._informImagesAdded({'0':xa},{});this.logStep(ba.CLIENT_ATTACH_PHOTO,{method:aa.CAMERA,fbid:xa});};ta.prototype._informImagesAdded=function(wa,xa){'use strict';h.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:wa,tagInfo:{exifLocation:xa}});h.inform('composer/updateViewerLocationEstimate',xa);};ta.prototype._generateLoadingIndicatorForPhoto=function(wa){'use strict';this._generateLoadingIndicator(wa.uploadID);};ta.prototype._generateLoadingIndicator=function(wa){'use strict';this._numRemainingFiles++;var xa=this._progressBarMarkup.cloneNode(true);t.listen(xa,'click',this._clickHandler.bind(this,wa));this.insertIntoGrid(xa);this._loadingIndicators[wa]=new ca(xa);};ta.prototype._generateUploadIDsAndLoadingIndicators=function(wa){'use strict';for(var xa=0;xa<wa.length;xa++){if(!wa[xa].uploadID)wa[xa].uploadID=x.getNewID();this._generateLoadingIndicator(wa[xa].uploadID);}};ta.prototype._clickHandler=function(wa,xa){'use strict';var ya=xa.target,za="_639";if(v.byClass(ya,za))if(this._failedUploadIDs[wa]){this.removeLoadingIndicator(wa);}else this.fileUploadCanceled(wa,this._uploadIDToFileUpload[wa]);var ab="_2zo7";if(v.byClass(ya,ab)){p.hide(r.find(this.getLoadingIndicator(wa).getRoot(),"._2zo5"));this._retryFileUpload(this._uploadIDToFileUpload[wa].getFile());this._failedUploadIDs[wa]=false;}var bb="_2zo8";if(v.byClass(ya,bb))this.removeLoadingIndicator(wa);};ta.prototype.fileUploadFailure=function(wa,xa,ya){'use strict';this._numUploadsFailed++;this._failedUploadIDs[wa]=true;var za=Date.now()-this._uploadTimers[wa],ab=0;if(xa.upload)ab=xa.upload.getRetryCount?xa.upload.getRetryCount():0;var bb=xa.response.getErrorDescription(),cb=xa.response.getError();if(cb===pa)bb=JSON.stringify(ya);this.logStep(ba.CLIENT_TRANSFER_FAIL,{dt:za,error_code:cb,error_info:bb,bytes:xa.upload.getFile().size,auto_retry_count:ab,custom_tags:{high_quality:this._isHighQuality,manual_retry:!!xa.upload.getFile().manuallyRetried}});if(this._config.useNewErrorUI){var db=xa.response.isTransient()||xa.response.getError()==1004||xa.response.getError()==1006,eb=db&&this._uploadIDToFileUpload[wa];this._showNewUploadFailedMessage(wa,xa.upload.getFile().name||xa.upload.getFile().filename||'',xa.response.getErrorSummary(),xa.response.getErrorDescription(),eb,xa.upload.getFile());this._markUploadAsFinished();}else{this._showUploadFailedMessage(wa);this._fadeOutFileUpload(wa);}};ta.prototype._fadeOutFileUpload=function(wa){'use strict';new i(this.getLoadingIndicator(wa).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,wa)).go();};ta.prototype._showUploadFailedMessage=function(wa){'use strict';p.hide(r.find(this.getLoadingIndicator(wa).getRoot(),"._5l83"));p.show(r.find(this.getLoadingIndicator(wa).getRoot(),"._5l82"));};ta.prototype._showNewUploadFailedMessage=function(wa,xa,ya,za,ab,bb){'use strict';var cb=this.getLoadingIndicator(wa).getRoot();p.hide(r.find(cb,"._5l83"));p.show(r.find(cb,"._2zo5"));var db=r.find(cb,"._2zo6");r.setContent(db,xa);var eb=r.find(cb,"._2zo5");da.set(eb,ya+': '+za);if(ab){var fb=r.find(cb,"._2zo7");p.show(fb);}else{var gb=r.find(cb,"._2zo8");p.show(gb);}};ta.prototype._finishUploadBatch=function(){'use strict';h.inform('multi-upload/images-upload-completed/'+this._gridID);if(this._numUploadsFailed>0){this.logStep(ba.CLIENT_TRANSFER_BATCH_FAIL,{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed});}else this.logStep(ba.CLIENT_TRANSFER_BATCH_SUCCESS,{volume:this._numUploadsSucceeded});this._numUploadsSucceeded=0;this._numUploadsFailed=0;};ta.prototype.fileUploadCanceled=function(wa,xa){'use strict';xa&&xa.abort();var ya={latency:Date.now()-this._uploadTimers[wa]};if(xa&&xa.getFile())ya.bytes=xa.getFile().size;this.logStep(ba.CLIENT_TRANSFER_CANCEL,ya);this.removeFileUpload(wa);};ta.prototype.removeFileUpload=function(wa){'use strict';this.removeLoadingIndicator(wa);this._markUploadAsFinished();};ta.prototype._markUploadAsFinished=function(){'use strict';this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);if(this._numRemainingFiles===0)this._finishUploadBatch();};ta.prototype.getVideoOrPhotoUploadCallback=function(wa,xa){'use strict';var ya=this;return function(za){if(za){var ab=v.byTag(ga(ya._gridID),'form'),bb=l.getComposerID(ab),cb=new o(bb);cb.handleVideoSelected(wa);}else if(xa){ya._photosSelected(wa);}else new q().setBody(la._("Sorry, you can only select video files.")).setTitle(la._("Unsupported File")).setModal(true).setButtons(q.OK).show();};};ta.prototype.doFileUpload=function(wa){'use strict';var xa=false,ya=false;switch(this._config.supportedFileTypes){case 'photos':ya=true;break;case 'videos':xa=true;break;case 'both':xa=ya=true;break;}this._submitListener&&this._submitListener.remove();var za=this.getVideoOrPhotoUploadCallback(wa,ya);if(xa){o.isVideoOrAnimatedGifAsync(wa,za);}else za(false);};ta.prototype.getConfig=function(){'use strict';return this._config;};ta.prototype._resizeUpload=function(wa,xa){'use strict';var ya=wa.getFile();if(!ya||!w(ya.type).isJpeg())return xa(wa);var za=ka();this.logStep(ba.CLIENT_PROCESS_BEGIN,{bytes:ya.size,custom_tags:{high_quality:this._isHighQuality}});this._resizer.resizeBlob(ya,(function(ab,bb,cb){bb=bb||ya;if(ab){this.logStep(ba.CLIENT_PROCESS_FAIL,{dt:ka()-za,bytes:bb.size,error_code:ab.code,error_info:ab.message,custom_tags:{high_quality:this._isHighQuality}});return xa(wa);}bb.uploadID=ya.uploadID;bb.filename=ya.name;wa.setFile(bb);this.logStep(ba.CLIENT_PROCESS_SUCCESS,{dt:ka()-za,media_data_size:ya.size,bytes:bb.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:cb}});xa(wa);}).bind(this),this._onResizeProgress.bind(this,ya.uploadID));};ta.prototype._onResizeStart=function(wa){'use strict';this.logStep(ba.CLIENT_PROCESS_BEGIN,{bytes:wa.size,custom_tags:{high_quality:this._isHighQuality}});};ta.prototype._onResizeFail=function(wa,xa,ya,za){'use strict';this.logStep(ba.CLIENT_PROCESS_FAIL,{dt:za,bytes:xa.size,error_code:ya.code,error_info:ya.message,custom_tags:{high_quality:this._isHighQuality}});};ta.prototype._onResizeSuccess=function(wa,xa,ya,za){'use strict';this.logStep(ba.CLIENT_PROCESS_SUCCESS,{dt:za,media_data_size:wa.size,bytes:xa.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:ya}});};ta.prototype._isExceedMaxSelect=function(wa){'use strict';return this._config.maxselect>1&&wa>this._config.maxselect;};ta.prototype._showTooManyPhotosDialog=function(){'use strict';new q().setTitle(la._("Too many photos")).setBody(la._({"*":"Sorry, you can only add {maxselect} photos to a message. If you like, you can add photos to additional messages."},[la.param('maxselect',this._config.maxselect,[0])])).setButtons(q.OK).setModal(true).show();};ta.prototype._photosSelected=function(wa){'use strict';var xa=wa.getInput(),ya=ua(xa);if(this._isExceedMaxSelect(ya)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this._upload(wa,ya);};ta.prototype._upload=function(wa,xa){'use strict';var ya=wa.getInput(),za=this._config.uploadData;if(this._config.waterfallID)za.qn=this._config.waterfallID;var ab=(function(){h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:xa});}).bind(this),bb=new fa({uploadEndpoint:this._config.photoEndpoint,uploadData:za,retryLimit:this._config.retryLimit,concurrentLimit:this._config.concurrentLimit,resizer:this._resizer,onUploadEnqueued:this._generateLoadingIndicatorForPhoto.bind(this),onUploadsEnqueued:ab,onUploadSent:function(){return wa.clear();},onResizeStart:this._onResizeStart.bind(this),onResizeProgress:this._onResizeProgress.bind(this),onResizeSuccess:this._onResizeSuccess.bind(this),onResizeFailure:this._onResizeFail.bind(this),onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFailure:this.fileUploadFailure.bind(this)});bb.upload(ya);this.logStep(ba.CLIENT_SELECT_SUCCESS,{times_selected:sa++,volume:xa,method:'file_selector'});};ta.prototype._onVideoRemoved=function(){'use strict';this._dragDropTarget&&this._dragDropTarget.enable();h.inform('multi-upload/video-removed/'+this._gridID);};ta.prototype.removeLoadingIndicator=function(wa){'use strict';var xa=this.getLoadingIndicator(wa);xa&&r.remove(xa.getRoot());delete this._loadingIndicators[wa];h.inform('multi-upload/loading-indicator-removed/'+this._gridID);};ta.prototype._onFileUploadStart=function(wa,xa){'use strict';this._uploadIDToFileUpload[wa]=xa.upload;var ya=r.find(this.getLoadingIndicator(wa).getRoot(),"._639");p.show(ya);this._uploadTimers[wa]=Date.now();var za={custom_tags:{high_quality:this._isHighQuality}};if(xa.upload&&xa.upload.getFile())za.size=xa.upload.getFile().size;this.logStep(ba.CLIENT_TRANSFER_BEGIN,za);this._logComposerWaterfallEvent(k.PHOTO_ADD);};ta.prototype._onUploadProgress=function(wa,xa){'use strict';var ya=this.getLoadingIndicator(wa);if(!ya||this._failedUploadIDs[wa])return;this._showProgressBar(ya);p.removeClass(ya.getRoot(),"_5v_0");ma(ya,xa.event);};ta.prototype._onResizeProgress=function(wa,event){'use strict';var xa=this.getLoadingIndicator(wa);if(!xa)return;this._showProgressBar(xa);p.addClass(xa.getRoot(),"_5v_0");xa.setPosition(100*event.written/event.total);};ta.prototype._showProgressBar=function(wa){'use strict';p.hide(r.find(wa.getRoot(),"._2om"));p.show(r.find(wa.getRoot(),"._5e4h"));};ta.prototype._onFileUploadSuccess=function(wa,xa){'use strict';var ya=Date.now()-this._uploadTimers[wa],za={dt:ya};if(xa.upload){za.bytes=xa.upload.getFile().size;za.auto_retry_count=xa.upload.getRetryCount?xa.upload.getRetryCount():0;za.custom_tags={high_quality:this._isHighQuality,manual_retry:!!xa.upload.getFile().manuallyRetried};}this.logStep(ba.CLIENT_TRANSFER_SUCCESS,za);this._logComposerWaterfallEvent(k.PHOTO_ADD_SUCCESS);};ta.prototype._logComposerWaterfallEvent=function(event){'use strict';if(!v.byClass(ga(this._gridID),"_119"))return;n.logEvent(event,this._getComposerID());};ta.prototype._getComposerID=function(){'use strict';return l.getComposerID(this._gridID);};ta.prototype._getAsyncUploadRequest=function(wa){'use strict';var xa=new fa({uploadEndpoint:this._config.photoEndpoint,uploadData:this._config.uploadData,concurrentLimit:this._config.concurrentLimit,onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFail:this.fileUploadFailure.bind(this)});return xa.getAsyncUploadRequest(wa);};ta.prototype._onEditedImage=function(wa,xa){'use strict';this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([xa.blob]);var ya=this._getGridItemElementByFBID(xa.fbid);if(ya){var za=this._loadingIndicators[xa.blob.uploadID].getRoot();r.insertBefore(ya,za);}h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:aa.EDITOR});var ab=this._getAsyncUploadRequest([xa.blob]);ab.setData(Object.assign({},this._config.uploadData,{original_fbid:xa.fbid,xy_tags:xa.xyTags,stickers:xa.stickers,text_overlays:xa.textOverlays,has_crop:xa.hasCrop,has_filter:xa.hasFilter}));ab.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:1,method:aa.EDITOR});this.logStep(ba.CLIENT_PHOTO_EDIT_SUCCESS);};ta.prototype._getGridItemElementByFBID=function(wa){'use strict';var xa=r.scry(ga(this._gridID),".fbVaultGridItem");for(var ya=0;ya<xa.length;ya++)if(xa[ya].dataset.originalfbid==wa)return xa[ya];return null;};ta.prototype.onVaultImagesAdded=function(wa){'use strict';var xa=[];for(var ya=0;ya<wa.length;ya++)xa.push({imageID:wa[ya]});this._generateUploadIDsAndLoadingIndicators(xa);new j('/ajax/composerx/attachment/media/multi_upload_vault_images/').setData(Object.assign({},{vault_images:xa,grid_id:this._gridID})).setAllowCrossOrigin(true).send();};ta.prototype.onFilesDrop=function(wa,xa){'use strict';if(this._isExceedMaxSelect(wa.length)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(wa);h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:wa.length,method:xa||aa.DRAGDROP});var ya=this._getAsyncUploadRequest(wa);if(this._resizer)ya.setPreprocessHandler(this._resizeUpload.bind(this));ya.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:wa.length,method:xa||aa.DRAGDROP});};ta.prototype._retryFileUpload=function(wa){'use strict';this._numRemainingFiles++;h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1});this.logStep(ba.CLIENT_TRANSFER_MANUAL_RETRY);wa.manuallyRetried=true;var xa=this._getAsyncUploadRequest([wa]);xa.send();};ta.prototype._onBeforeAddUploadedImages=function(){'use strict';if(!this.sessionStarted)this.logStep(ba.CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)h.inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};ta.prototype.clearSession=function(){'use strict';this.sessionStarted=false;};ta.prototype.insertIntoGrid=function(wa){'use strict';var xa=r.scry(ga(this._gridID),"._577")[0];if(xa){r.insertBefore(xa,wa);}else r.prependContent(ga(this._gridID),wa);};ta.prototype._getUploadID=function(wa,xa){'use strict';if(wa.upload){return wa.upload.getFile().uploadID;}else return xa.uploadID;};ta.getInstance=function(wa){'use strict';ra[wa]=ra[wa]||new ta(wa);return ra[wa];};function ua(wa){if(!va(wa))return 1;return wa.files.length;}function va(wa){return !!wa.files&&j.isSupported();}f.exports=qa;},null);
__d('P2PSnippetStringUtils',['P2PPaymentRequestStatus','P2PTransferStatus','fbt'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={getRequestCanceledSnippet:function(l,m,n,o,p){if(l){return j._("You cancelled your request for {payment request amount} from {receiver's name}.",[j.param('payment request amount',p),j.param('receiver\'s name',o)]);}else if(m){return j._("{requester's name} cancelled their request for {payment request amount} from you.",[j.param('requester\'s name',n),j.param('payment request amount',p)]);}else return j._("{requester's name} cancelled their request for {payment request amount} from {receiver's name}.",[j.param('requester\'s name',n),j.param('payment request amount',p),j.param('receiver\'s name',o)]);},getRequestDeclinedSnippet:function(l,m,n,o,p){if(l){return j._("{receiver's name} declined your request for {payment request amount}.",[j.param('receiver\'s name',o),j.param('payment request amount',p)]);}else if(m){return j._("You declined {requester's name}'s request for {payment request amount}.",[j.param('requester\'s name',n),j.param('payment request amount',p)]);}else return j._("{receiver's name} declined {sender's name}'s request for {payment request amount}.",[j.param('receiver\'s name',o),j.param('sender\'s name',n),j.param('payment request amount',p)]);},getRequestSentSnippet:function(l,m,n,o,p){if(l){return j._("You requested {amount} from {requestee name}.",[j.param('amount',p),j.param('requestee name',o)]);}else if(m){return j._("{requester name} requested {amount} from you.",[j.param('requester name',n),j.param('amount',p)]);}else return j._("{name} requested {amount} from {requestee name}.",[j.param('name',n),j.param('amount',p),j.param('requestee name',o)]);},getRequestSnippetByStatus:function(l,m,n,o,p,q){var r=[m,n,o,p,q];switch(l){case h.DECLINED:return this.getRequestDeclinedSnippet.apply(this,r);case h.TRANSFER_FAILED:case h.CANCELED:return this.getRequestCanceledSnippet.apply(this,r);}return this.getRequestSentSnippet.apply(this,r);},getTransferCanceledSnippet:function(l,m,n,o,p){if(l){return j._("Your payment of {amount} to {receiver_name} was cancelled.",[j.param('amount',p),j.param('receiver_name',o)]);}else if(m){return j._("{sender name}'s payment of {amount} was cancelled.",[j.param('sender name',n),j.param('amount',p)]);}else return j._("{sender_name}'s payment of {amount} to {receiver_name} was cancelled.",[j.param('sender_name',n),j.param('amount',p),j.param('receiver_name',o)]);},getTransferDeclinedSnippet:function(l,m,n,o,p){if(l){return j._("{receiver_name} didn't accept your payment of {amount}.",[j.param('receiver_name',o),j.param('amount',p)]);}else if(m){return j._("You didn't accept {sender name}'s payment of {amount}.",[j.param('sender name',n),j.param('amount',p)]);}else return j._("{receiver_name} didn't accept {sender_name}'s payment of {amount}.",[j.param('receiver_name',o),j.param('sender_name',n),j.param('amount',p)]);},getTransferSentSnippet:function(l,m,n,o,p){if(l){return j._("You sent {amount} to {receiver name}.",[j.param('receiver name',o),j.param('amount',p)]);}else if(m){return j._("{name} sent {amount} to you.",[j.param('name',n),j.param('amount',p)]);}else return j._("{sender name} sent {amount} to {receiver name}.",[j.param('sender name',n),j.param('receiver name',o),j.param('amount',p)]);},getTransferSnippetByStatus:function(l,m,n,o,p,q){var r=[m,n,o,p,q],s=l||i.PENDING_SENDER_INITED;switch(s){case i.CANCELED_DECLINED:return this.getTransferDeclinedSnippet.apply(this,r);case i.CANCELED_SENDER_RISK:case i.CANCELED_RECIPIENT_RISK:case i.CANCELED_SYSTEM_FAIL:case i.CANCELED_EXPIRED:case i.CANCELED_SAME_CARD:return this.getTransferCanceledSnippet.apply(this,r);}return this.getTransferSentSnippet.apply(this,r);}};f.exports=k;},null);
__d('MercuryAttachmentSnippetType',['keyMirror'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=h({PHOTO:null,GIF:null,VIDEO:null,AUDIO_CLIP:null,STICKER:null,ORION:null,SHARE:null,ERROR:null,MIXED:null});f.exports=i;},null);
__d('MercuryFileUploader',['ArbiterMixin','CSS','Dialog','DOM','Event','FileForm','FileFormResetOnSubmit','FileInput','FormSubmitOnChange','MercuryAttachment','MercuryAttachmentTemplates','MercuryConstants','PhotosUploadID','SubscriptionsHandler','csx','fbt','getObjectValues','mixin','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa,ba;aa=babelHelpers.inherits(ca,y(h));ba=aa&&aa.prototype;function ca(ea,fa,ga,ha){'use strict';ba.constructor.call(this);this.$MercuryFileUploader1=ea;this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader8={};this.$MercuryFileUploader9={};this.$MercuryFileUploader10={};this.updateElements(fa,ga,ha);}ca.prototype.updateElements=function(ea,fa,ga){'use strict';this.$MercuryFileUploader11&&this.$MercuryFileUploader11.release();this.$MercuryFileUploader11=new u();this.$MercuryFileUploader12&&this.$MercuryFileUploader12.destroy();this.$MercuryFileUploader12=new m(ea,[p,n]);this.$MercuryFileUploader12.setAllowCrossOrigin(true);this.$MercuryFileUploader12.setUploadInParallel(true);var ha=k.find(ea,"._4q60"),ia=k.find(ha,"._4q61");new o(ha,ia,fa);this.$MercuryFileUploader11.addSubscriptions(this.$MercuryFileUploader12.subscribe('submit',(function(){var ja={count:0,file_sizes:[],files:[]};if(fa.files){for(var ka=0;ka<fa.files.length;ka++)if(fa.files[ka].size>s.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var la={};for(var ma=0;ma<fa.files.length;ma++){var na=this.$MercuryFileUploader13();this.$MercuryFileUploader14(na,fa.files[ma].name);ja.count++;ja.file_sizes.push(fa.files[ma].size);la[na]=fa.files[ma];ja.files.push({upload_id:na,metadata:fa.files[ma]});}this.$MercuryFileUploader12.setFiles(la);}else{ga.value=this.$MercuryFileUploader13();this.$MercuryFileUploader14(ga.value,fa.value);ja.count=1;}this.inform('submit',ja);}).bind(this)),this.$MercuryFileUploader12.subscribe('success',this.$MercuryFileUploader15.bind(this)),this.$MercuryFileUploader12.subscribe('failure',this.$MercuryFileUploader16.bind(this)),l.listen(ia,'click',z(this.inform,this,'open')));};ca.prototype.showAttachmentSizeErrorDialog=function(){'use strict';this.$MercuryFileUploader12.abort();this.$MercuryFileUploader12.clear();new j().setTitle(w._("The file you have selected is too large")).setBody(w._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(j.OK).setSemiModal(true).show();};ca.prototype.addDroppedFiles=function(ea){'use strict';if(!this.$MercuryFileUploader12||!this.$MercuryFileUploader12.canUseXHR())return;var fa={},ga={count:0,file_sizes:[],files:[]};for(var ha=0;ha<ea.length;ha++){var ia=ea[ha];if(ia.size>s.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var ja=this.$MercuryFileUploader13();this.$MercuryFileUploader14(ja,ia.name);fa[ja]=ia;ga.file_sizes.push(ia.size);ga.count++;ga.files.push({upload_id:ja,metadata:ia});}this.$MercuryFileUploader12.setFiles(fa);this.$MercuryFileUploader12.forceSendViaXHR();this.inform('submit',ga);};ca.prototype.isUploading=function(){'use strict';return !!Object.keys(this.$MercuryFileUploader8).length;};ca.prototype.addCachedAttachments=function(ea){'use strict';ea.forEach((function(fa){var ga=this.$MercuryFileUploader13();this.$MercuryFileUploader14(ga,fa.filename);this.inform('cached-file-added',{upload_id:ga,metadata:fa});this.$MercuryFileUploader17(ga,fa);}).bind(this));};ca.prototype.addCachedImageFiles=function(ea){'use strict';var fa=w._("Photo");ea.forEach((function(ga){var ha=this.$MercuryFileUploader13();this.$MercuryFileUploader14(ha,fa);this.$MercuryFileUploader17(ha,{filename:ga,image_id:ga,filetype:'image/jpeg'});}).bind(this));};ca.prototype.getAttachments=function(){'use strict';return x(this.$MercuryFileUploader2);};ca.prototype.getImageFiles=function(){'use strict';var ea=Object.keys(this.$MercuryFileUploader3).sort(),fa=[];ea.forEach((function(ga){return fa.push(this.$MercuryFileUploader3[ga]);}).bind(this));return fa;};ca.prototype.getAnimatedImageFiles=function(){'use strict';return x(this.$MercuryFileUploader4);};ca.prototype.getVideoFiles=function(){'use strict';return x(this.$MercuryFileUploader5);};ca.prototype.getAudioFiles=function(){'use strict';return x(this.$MercuryFileUploader6);};ca.prototype.getFiles=function(){'use strict';return x(this.$MercuryFileUploader7);};ca.prototype.removeOneAttachment=function(ea){'use strict';this.$MercuryFileUploader18(ea);};ca.prototype.removeAttachments=function(){'use strict';if(this.$MercuryFileUploader1)k.empty(this.$MercuryFileUploader1);this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader9={};this.$MercuryFileUploader8={};this.$MercuryFileUploader10={};if(this.$MercuryFileUploader1)i.hide(this.$MercuryFileUploader1);this.inform('dom-updated');};ca.prototype.destroy=function(){'use strict';this.$MercuryFileUploader11&&this.$MercuryFileUploader11.release();this.$MercuryFileUploader12&&this.$MercuryFileUploader12.destroy();this.removeAttachments();};ca.prototype.$MercuryFileUploader14=function(ea,fa){'use strict';var ga=r[':fb:mercury:upload-file-row'].build(),ha={};this.$MercuryFileUploader9[ea]=ga;this.$MercuryFileUploader8[ea]=true;this.$MercuryFileUploader10[ea]=Date.now();var ia=da(fa);k.appendContent(ga.getNode('iconText'),ia);ha.fileName=ia;l.listen(ga.getNode('closeFileUpload'),'click',this.$MercuryFileUploader18.bind(this,ea));if(this.$MercuryFileUploader1){k.appendContent(this.$MercuryFileUploader1,ga.getRoot());i.show(this.$MercuryFileUploader1);}this.inform('dom-updated',ha);};ca.prototype.$MercuryFileUploader18=function(ea,event){'use strict';if(this.$MercuryFileUploader8[ea]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader2[ea]||this.$MercuryFileUploader3[ea]||this.$MercuryFileUploader4[ea]||this.$MercuryFileUploader5[ea]||this.$MercuryFileUploader6[ea]||this.$MercuryFileUploader7[ea])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader2[ea];delete this.$MercuryFileUploader3[ea];delete this.$MercuryFileUploader4[ea];delete this.$MercuryFileUploader5[ea];delete this.$MercuryFileUploader6[ea];delete this.$MercuryFileUploader7[ea];delete this.$MercuryFileUploader8[ea];delete this.$MercuryFileUploader10[ea];var fa=this.$MercuryFileUploader9[ea];delete this.$MercuryFileUploader9[ea];if(fa){k.remove(fa.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};ca.prototype.$MercuryFileUploader19=function(ea,fa){'use strict';var ga=this.$MercuryFileUploader9[ea],ha=q.getAttachIconClassByMime(fa);i.addClass(ga.getNode('iconText'),ha);i.addClass(ga.getRoot(),'done');};ca.prototype.$MercuryFileUploader17=function(ea,fa){'use strict';if(this.$MercuryFileUploader8[ea]){delete this.$MercuryFileUploader8[ea];if(fa.image_id){this.$MercuryFileUploader3[ea]=fa.image_id;}else if(fa.gif_id){this.$MercuryFileUploader4[ea]=fa.gif_id;}else if(fa.video_id){this.$MercuryFileUploader5[ea]=fa.video_id;}else if(fa.audio_id){this.$MercuryFileUploader6[ea]=fa.audio_id;}else if(fa.file_id){this.$MercuryFileUploader7[ea]=fa.file_id;}else this.$MercuryFileUploader2[ea]=fa;this.$MercuryFileUploader19(ea,fa.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader10[ea],upload_id:ea,metadata:fa});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};ca.prototype.$MercuryFileUploader15=function(event,ea){'use strict';var fa=ea.response.getPayload();this.$MercuryFileUploader17(this.$MercuryFileUploader20(ea),fa.metadata[0]);};ca.prototype.$MercuryFileUploader16=function(event,ea){'use strict';this.inform('one-upload-failed');this.$MercuryFileUploader18(this.$MercuryFileUploader20(ea),event);};ca.prototype.$MercuryFileUploader13=function(){'use strict';return 'upload_'+t.getNewID();};ca.prototype.$MercuryFileUploader20=function(ea){'use strict';var fa=ea.response.getPayload();if(ea.upload){return ea.upload.getName();}else return fa.uploadID;};function da(ea){if(ea&&ea.startsWith('C:\\fakepath\\'))return ea.substring(12);return ea;}f.exports=ca;},null);
__d('VaultEditableGrid',['Event','Arbiter','AsyncRequest','CSS','DOM','Scroll','$','csx','ge','removeFromArray'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r={};function s(t,u,v,w){r[t.id]=this;this._grid=t;this._gridID=t.id;this._dialogEndpoint=u;this._collapseWhenEmpty=v;this._attachmentCount=w;this._selectedVaultImageIDs=[];i.subscribe('multi-upload/image-removed/'+this._gridID,(function(x,y){q(this._selectedVaultImageIDs,y);this.updateAttachmentCount(this._attachmentCount-1);}).bind(this));i.subscribe('multi-upload/composer-reset/'+this._gridID,(function(x,y){this.removeImages();}).bind(this));i.subscribe(['multi-upload/images-upload-start/'+this._gridID,'multi-upload/video-added/'+this._gridID],(function(){this.updateAttachmentCount(this._attachmentCount+1);}).bind(this));i.inform('fbVaultEditableGrid/created/'+t.id,this,i.BEHAVIOR_PERSISTENT);i.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount);}Object.assign(s,{VAULT_IMAGE:'vault_image',getInstance:function(t){return r[t];},registerDialogWithGrid:function(t,u,v){i.subscribe(['multi-upload/images-upload-start/'+t,'multi-upload/video-added/'+t],v.hide.bind(v));i.subscribe('fbVaultEditableGrid/created/'+t,function(w,x){x._registerDialogWithGrid(u,v);});},onImagesSelected:function(t,u,v){r[t]._onImagesSelected(u,v);}});Object.assign(s.prototype,{getRoot:function(){var t=p(this._gridID);if(t){return t;}else return this._grid;},_registerDialogWithGrid:function(t,u){this._dialog=u;var v=this.getMoreLink();v&&h.listen(v,'click',function(){u.show();return false;});u.subscribe('aftershow',(function(){var w=[];l.scry(n(this._gridID),'input[type="hidden"]').forEach(function(y){if(y.name.match('composer_vault_images')||y.name.match('composer_unpublished_photo'))w.push(y.value);});var x=t.getGrid();x.bulkChange(function(){var y=x.getSelectionSet();y.clear();y.addAll(w);});}).bind(this));},updateAttachmentCount:function(t){this._attachmentCount=t;if(this._collapseWhenEmpty)k.conditionShow(this._grid,this._attachmentCount>0);},getID:function(){return this._gridID;},_onImagesSelected:function(t,u){var v=l.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=u;t.forEach(function(w){l.insertBefore(v,w);});i.inform('multi-upload/images-added/'+this._gridID,{fbids:u});this._scrollToRight();},removeImages:function(){l.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(t){if(!k.hasClass(t,'fbVaultEditableGridMoreLink'))l.remove(t);});this._selectedVaultImageIDs=[];i.inform('multi-upload/all-images-removed/'+this._gridID);this.updateAttachmentCount(0);},_scrollToRight:function(){var t=this.getRoot(),u=l.find(t,'.fbScrollableAreaWrap');m.setLeft(u,Math.max(0,l.find(t,'.fbScrollableAreaBody').offsetWidth-u.offsetWidth));},showDialog:function(t,u){if(this._dialog){this._dialog.show();}else j.bootstrap(this._dialogEndpoint,t);},getMoreLink:function(){return l.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});f.exports=s;},null);
__d('BasePhotoUploader',['Arbiter','ArbiterMixin','CSS','DOM','PhotosMultiUploadInput','VaultEditableGrid','TimelineMapScrollableArea','mixin','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r;q=babelHelpers.inherits(s,o(i));r=q&&q.prototype;function s(t,u){'use strict';r.constructor.call(this);new n(t,{verticalscroll:true});this.$BasePhotoUploader1=t;this.$BasePhotoUploader2=this.$BasePhotoUploader3();this.$BasePhotoUploader4=false;this.$BasePhotoUploader5=null;u.addSubscriptions(h.subscribe('multi-upload/images-added/'+this.$BasePhotoUploader1.id,(function(v,w){var x=Object.assign({},w.fbids);Object.assign(this.$BasePhotoUploader2,x);this.$BasePhotoUploader6();this.inform('upload-completed',{fbids:p(x)});}).bind(this)),h.subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader1.id,(function(v,w){for(var x in this.$BasePhotoUploader2)if(this.$BasePhotoUploader2[x]===w){delete this.$BasePhotoUploader2[x];break;}this.$BasePhotoUploader6();}).bind(this)),h.subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader1.id,(function(v,w){j.show(this.$BasePhotoUploader1);this.$BasePhotoUploader4=true;this.inform('dom-updated');this.inform('upload-started',w);}).bind(this)),h.subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader1.id,this.clear.bind(this)),h.subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader1.id,this.$BasePhotoUploader7.bind(this)),h.subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader1.id,(function(v){this.$BasePhotoUploader4=false;this.inform('all-uploads-completed');this.$BasePhotoUploader6();}).bind(this)));j.conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length);}s.prototype.getSelectedFBIDs=function(){'use strict';var t=Object.keys(this.$BasePhotoUploader2).sort();return t.map((function(u){return this.$BasePhotoUploader2[u];}).bind(this));};s.prototype.isUploading=function(){'use strict';return this.$BasePhotoUploader4;};s.prototype.clear=function(){'use strict';var t=m.getInstance(this.$BasePhotoUploader1.id);t&&t.removeImages();};s.prototype.getWaterfallID=function(){'use strict';return l.getWaterfallID(this.$BasePhotoUploader1.id);};s.prototype.$BasePhotoUploader7=function(){'use strict';this.$BasePhotoUploader2={};this.$BasePhotoUploader4=false;j.hide(this.$BasePhotoUploader1);this.inform('all-uploads-completed');this.inform('dom-updated');};s.prototype.$BasePhotoUploader3=function(){'use strict';var t={},u=-10000;k.scry(this.$BasePhotoUploader1,'input[type="hidden"]').forEach(function(v){if(v.name.match('composer_vault_images')){t[u]=v.value;u--;}});return t;};s.prototype.$BasePhotoUploader6=function(){'use strict';j.conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length>0);this.inform('dom-updated');};s.prototype.setCurrentMethod=function(t){'use strict';this.$BasePhotoUploader5=t;};s.prototype.getCurrentMethod=function(){'use strict';return this.$BasePhotoUploader5;};f.exports=s;},null);
__d('MercuryPhotoUploader',['Arbiter','AsyncRequest','BasePhotoUploader','DOM','Event','FileInput','Focus','Parent','PhotosMultiUploadInput','PUWMethods','VaultEditableGrid','csx','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u,v;u=babelHelpers.inherits(w,j);v=u&&u.prototype;function w(x,y,z,aa){'use strict';v.constructor.call(this,x,z);this.$MercuryPhotoUploader1=x.id;this.$MercuryPhotoUploader2=false;h.subscribe('PhotosMultiUploadInput/loaded/'+x.id,(function(){this.$MercuryPhotoUploader2=true;}).bind(this));h.subscribe('MercuryPhotoUploader/initUploadButton/'+x.id,function(){var ba=k.scry(y,'input[type="file"]')[0];if(!ba)ba=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var ca=o.bySelector(y,"._9_h"),da=new m(ca,k.find(ca,"._214"),ba);da.subscribe('change',p.doFileUpload.bind(null,x.id,da));});h.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+x.id,(function(ba,ca){var da=ca.menu.getRoot();ca.menu.setContext(y);var ea=k.scry(da,"._d2p"),fa=ea&&ea[0];fa&&l.listen(fa,'click',(function(){r.getInstance(x.id).showDialog(fa,r.VAULT_IMAGE);this.setCurrentMethod(q.VAULT);this.inform('selection-start',{method:q.VAULT});}).bind(this));l.listen(y,'click',(function(){if(!this.$MercuryPhotoUploader2)return;if(!ca.menu.isShown()){var ha=k.scry(ca.menu.getContentRoot(),'li');this.inform('menu-show');ca.menu.show();if(ha)n.setWithoutOutline(ha[0]);}else{this.inform('menu-hide');ca.menu.hide();}}).bind(this));l.listen(document.documentElement,'click',(function(event){if(!k.contains(y,event.getTarget())&&!k.contains(fa,event.getTarget())){if(ca.menu.isShown())this.inform('menu-hide');ca.menu.hide();}}).bind(this));var ga=k.find(da,"._9_h");l.listen(ga,'click',(function(){this.setCurrentMethod(q.FILE_SELECTOR);this.inform('selection-start',{method:q.FILE_SELECTOR});}).bind(this));}).bind(this));aa&&p.initDragDrop(x.id,aa);}w.prototype.uploadPastedFile=function(x){'use strict';p.onFilesDrop(this.$MercuryPhotoUploader1,[x]);};w.prototype.addCachedPhotos=function(x){'use strict';i.post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader1,source:'messenger',image_ids:x});};Object.assign(w,{initUploadButton:function(x){h.inform('MercuryPhotoUploader/initUploadButton/'+x,{},h.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(x,y){h.inform('MercuryPhotoUploader/registerPhotoMenu/'+x,{menu:y},h.BEHAVIOR_PERSISTENT);}});f.exports=w;},null);
__d('MercuryShareLinkUploader',['ArbiterMixin','AsyncRequest','CSS','DOM','Event','Form','URLScraper','WebMessengerEvents','mixin','isEmpty'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s;r=babelHelpers.inherits(t,p(h));s=r&&r.prototype;function t(){'use strict';s.constructor.call(this);this.__initialize.apply(this,arguments);}t.prototype.__initialize=function(u,v,w,x,y){'use strict';this.$MercuryShareLinkUploader1=u;this.$MercuryShareLinkUploader2=v;this.$MercuryShareLinkUploader3=w;this.$MercuryShareLinkUploader4=y;this.$MercuryShareLinkUploader5=false;this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7=null;l.listen(x,'click',this.close.bind(this));l.listen(y,'keyup',(function(){!y.value.length&&this.$MercuryShareLinkUploader8.enable();}).bind(this));this.$MercuryShareLinkUploader8=new n(y);this.$MercuryShareLinkUploader8.subscribe('match',(function(z,aa){this.loadShare(aa&&aa.url);}).bind(this));};t.prototype.getAttachData=function(){'use strict';return this.loadAttachData(this.$MercuryShareLinkUploader5,this.$MercuryShareLinkUploader1,this.$MercuryShareLinkUploader4);};t.prototype.getShareDataFromStage=function(u,v){'use strict';var w=m.serialize(v),x=w.attachment&&w.attachment.params;if(!x)return null;if(x instanceof Object){var y=[];y.push(x[0]);y.push(x[1]);x=y;}return {params:x,type:w.attachment.type};};t.prototype.loadAttachData=function(u,v,w,x){'use strict';if(u){var y=m.serialize(v),z=y.attachment&&y.attachment.params,aa=y.link_metrics?y.link_metrics.no_image:true;if(!z||q(z))return null;var ba=x?x():w.value;if(ba.indexOf(z.url)===-1)return y;if(!z.summary&&!z.favicon&&aa&&z.title&&z.url&&z.url.substr(0,z.title.length)===z.title)return null;return y;}return null;};t.prototype.check=function(){'use strict';this.$MercuryShareLinkUploader8.check();};t.prototype.close=function(){'use strict';this.$MercuryShareLinkUploader9();this.$MercuryShareLinkUploader8.disable();this.inform('closed');};t.prototype.clear=function(){'use strict';this.$MercuryShareLinkUploader9();this.$MercuryShareLinkUploader8.enable();};t.prototype.enable=function(){'use strict';this.$MercuryShareLinkUploader8.enable();};t.prototype.disable=function(){'use strict';this.$MercuryShareLinkUploader8.disable();};t.prototype.loadShare=function(u){'use strict';this.$MercuryShareLinkUploader6=u;this.$MercuryShareLinkUploader7&&this.$MercuryShareLinkUploader7.abort();this.$MercuryShareLinkUploader7=new i().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:u}).setHandler(this.$MercuryShareLinkUploader10.bind(this).bind(null,u)).setStatusElement(this.$MercuryShareLinkUploader3);this.$MercuryShareLinkUploader7.send();this.inform('link-detected');};t.prototype.$MercuryShareLinkUploader10=function(u,v){'use strict';if(this.$MercuryShareLinkUploader6!==u)return;this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7=null;j.show(this.$MercuryShareLinkUploader1);k.empty(this.$MercuryShareLinkUploader2);k.setContent(this.$MercuryShareLinkUploader2,v.payload);this.$MercuryShareLinkUploader5=true;if(!this.getAttachData()){this.close();return;}o.detailDOMChanged();};t.prototype.$MercuryShareLinkUploader9=function(){'use strict';j.hide(this.$MercuryShareLinkUploader1);this.$MercuryShareLinkUploader5=false;this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7&&this.$MercuryShareLinkUploader7.abort();this.$MercuryShareLinkUploader7=null;this.$MercuryShareLinkUploader8.reset();o.detailDOMChanged();};f.exports=t;},null);
__d('ChatEmployeeAwayWarning',['MercuryIDs','MercuryParticipants','MercuryViewer'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={updateEmployeeAwayWarning:function(l,m,n){i.get(j.getID(),function(o){var p=o.employee;if(p)i.getMulti(l.participants,function(q){var r=false,s=h.getUserIDFromThreadID(l.thread_id);if(!s)return;var t='fbid:'+s;for(var u in q)if(t==q[u].id&&q[u].is_employee_away)r=true;if(r){m();}else n();});});}};f.exports=k;},null);
__d('MNCommerceDialogStateActions',['MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={showDialog:function(k,l){h.dispatch({type:i.DIALOG.SHOW,dialogContainer:k,state:l});},hideDialog:function(){h.dispatch({type:i.DIALOG.HIDE});}};f.exports=j;},null);
__d('MNCommercePromotionStateActions',['MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={stateLoaded:function(k){h.dispatch({type:i.PROMOTION_STATE.LOADED,state:k});},stateLoadError:function(k){h.dispatch({type:i.PROMOTION_STATE.LOAD_ERROR,pageID:k});},stateReload:function(k){h.dispatch({type:i.PROMOTION_STATE.RELOAD,pageID:k});}};f.exports=j;},null);
__d('MessengerRadioButton.react',['ReactComponentWithPureRenderMixin','React','XUIRadioInput.react','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.createClass({displayName:'MessengerRadioButton',mixins:[h],render:function(){return (i.createElement(j,babelHelpers._extends({},this.props,{className:"__rm"})));}});f.exports=l;},null);
__d('MessengerRadioList.react',['InputLabel.react','MessengerRadioButton.react','React','ReactChildren','cloneWithProps','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.PropTypes,o=j.createClass({displayName:'MessengerRadioList',propTypes:{name:n.string,onValueChange:n.func,selectedValue:n.any},render:function(){var p=k.map(this.props.children,function(q){return l(q,{name:this.props.name,onSelect:this.props.onValueChange,selectedValue:this.props.selectedValue});},this);return j.createElement('ul',babelHelpers._extends({},this.props,{name:null}),p);}});o.Item=j.createClass({displayName:'Item',propTypes:{disabled:n.bool,name:n.string,onSelect:n.func,selectedValue:n.any,value:n.any},render:function(){return (j.createElement('li',{className:this.props.className},j.createElement(h,{display:'inline'},j.createElement(i,{checked:this.props.selectedValue===this.props.value,disabled:!!this.props.disabled,name:this.props.name,onChange:this._handleChange,value:this.props.value}),j.createElement('label',null,this.props.children))));},_handleChange:function(event){!(event.target instanceof HTMLInputElement)?m(0):undefined;this.props.onSelect&&this.props.onSelect(event.target.value);}});f.exports=o;},null);
__d('MessengerHotLikePreview.react',['Animation','HotLikeSound','MessengerHotLikePreviewEvents','MessengerHotLikeUtils','React','ReactDOM','StickerConstants','SubscriptionsHandler','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=l.PropTypes,r=l.createClass({displayName:'MessengerHotLikePreview',propTypes:{customLike:q.object,since:q.number},componentDidMount:function(){this._subscriptions=new o();this._subscriptions.addSubscriptions(j.addListener(j.STOP,this._snapToStickerSize),j.addListener(j.POP,this._pop));i.start();this._growthAnimation=new h(m.findDOMNode(this)).to('width',80).to('height',80).duration(3000).go();this._setUpRotationAnimation();},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},render:function(){if(this.props.customLike)return (l.createElement('div',{className:"_4a9g _383m",style:{backgroundImage:'url('+this.props.customLike.large+')'}}));return (l.createElement('div',{className:"_4a9g _576q"}));},_setUpRotationAnimation:function(){this._rotateAnimation=new h(m.findDOMNode(this));this._rotateHotLike(-2,2,150,1000);this._rotateHotLike(-4,4,100,1000);this._rotateHotLike(-10,10,75,1000);this._rotateAnimation.go();},_rotateHotLike:function(s,t,u,v){var w=Math.floor(v/u),x=null;for(var y=0;y<w;y++){x=y%2?s:t;this._rotateAnimation.to('rotateZ',x).duration(u).checkpoint();}},_snapToStickerSize:function(s){if(this._snapped)return;this._snapped=true;var t=Date.now()-this.props.since,u=null;if(this.props.customLike)u=k.getEmojiSizeForTime(t);var v=k.getStickerIDForTime(t);if(v){i.snap(v);var w=k.getMetadataForHotLike(v);this._rotateAnimation.stop();var x=30,y=-10;if(v===n.HOT_LIKE_SMALL_STICKER_ID){x=0;y=0;}this._growthAnimation.stop().to('width',w.width*1.2).to('height',w.height*1.2).to('rotateZ',x).duration(100).checkpoint().to('width',w.width*.9).to('height',w.height*.9).to('rotateZ',y).duration(100).checkpoint().to('width',w.width).to('height',w.height).to('rotateZ',0).duration(100).ondone(function(){j.emit(j.FINISH_ANIMATION,s,v,u);}).go();}},_pop:function(s){i.pop();this._growthAnimation.stop().to('width',0).to('height',0).duration(100).ondone(function(){j.emit(j.REMOVE,s);}).go();}});f.exports=r;},null);
__d('MNCommerceAttachmentConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={XLARGE_IMAGE_DIMENSION:72,LARGE_IMAGE_DIMENSION:60,SMALL_IMAGE_DIMENSION:32,SINGLE_IMAGE_HEIGHT:108,BUBBLE_PADDING:6,IMAGE_HEIGHT:{CHAT:108,WEB_INBOX:130},UNLINK_ERROR_DIALOG:{WIDTH:300},DIALOG:{WIDTH:445,PADDING:12},MDOTCOMDIALOG:{WIDTH:495},ORDER_DETAIL:{SUB_TOTAL:'subTotal',SHIPPING:'shippingCost',TAX:'tax',TOTAL:'totalCost'}};f.exports=h;},null);
__d('MNCommerceDialog.react',['CurrentEnvironment','LayerFadeOnHide','LayerHideOnEscape','MNCommerceAttachmentConstants','MessengerDialog.react','React','XUIDialog.react','cx','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=m.PropTypes,s=m.createClass({displayName:'MNCommerceDialog',propTypes:{onToggle:r.func,shown:r.bool,width:r.number.isRequired},getDefaultProps:function(){return {onToggle:p,repositionOnUpdate:true,shown:true,width:h.messengerdotcom?k.MDOTCOMDIALOG.WIDTH:k.DIALOG.WIDTH};},componentDidUpdate:function(){if(this.props.repositionOnUpdate)setTimeout((function(){if(this.isMounted()&&this.refs.dialog&&this.refs.dialog.layer)this.refs.dialog.layer.updatePosition();}).bind(this),0);},render:function(){var t=h.messengerdotcom,u=t?l:n;return (m.createElement(u,babelHelpers._extends({behaviors:{LayerFadeOnHide:i,LayerHideOnEscape:j}},this.props,{className:q(this.props.className,t?"_3rx0":''),ref:'dialog'}),this.props.children));}});f.exports=s;},null);
__d('MNCommerceDialogTitle.react',['CurrentEnvironment','MessengerDialogHeader.react','React','XUIDialogTitle.react'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.createClass({displayName:'MNCommerceDialogTitle',render:function(){var m=h.messengerdotcom,n=m?i:k;return (j.createElement(n,this.props,this.props.children));}});f.exports=l;},null);
__d('MNCommerceDetailsDialog.react',['React','MNCommerceDialog.react','MNCommerceDialogBody.react','MNCommerceDialogTitle.react','XUISpinner.react','XUIButton.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=h.PropTypes,q=h.createClass({displayName:'MNCommerceDetailsDialog',propTypes:{error:p.object,errorMessage:p.string,loading:p.bool.isRequired,onToggle:p.func,onTryAgain:p.func,title:p.string,shown:p.bool.isRequired},getDefaultProps:function(){return {shown:false};},render:function(){var r=null;if(this.props.loading){r=this._renderLoading();}else if(this.props.error){r=this._renderError();}else r=this.props.children;return (h.createElement(i,{className:this.props.className,modal:true,onToggle:this.props.onToggle,shown:this.props.shown},this._renderTitle(),h.createElement(j,{useCustomPadding:true},r)));},_renderTitle:function(){return this.props.title?h.createElement(k,null,this.props.title):null;},_renderError:function(){return (h.createElement('div',{className:"_4y9b"},h.createElement('p',{className:"_4y9c"},o._("Sorry, something went wrong")),h.createElement('p',{className:"_4y9d"},this.props.errorMessage),h.createElement(m,{onClick:this.props.onTryAgain,label:o._("Try Again")})));},_renderLoading:function(){return (h.createElement('div',{className:"_4y9e"},h.createElement(l,{background:'light',size:'large',paused:false})));}});f.exports=q;},null);
__d('MNCommerceButton.react',['CurrentEnvironment','MessengerDialogButton.react','React','XUIButton.react'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.createClass({displayName:'MNCommerceButton',render:function(){var m=h.messengerdotcom,n=m?i:k,o=this.props.type;if(!o)o=this.props.type==='confirm'?'primary':'secondary';var p=m?'default':this.props.use,q=babelHelpers._extends({},this.props,{type:o,use:p});return (j.createElement(n,q,this.props.children));}});f.exports=l;},null);
__d('MNCommerceDialogFooter.react',['CurrentEnvironment','MessengerDialogFooter.react','React','XUIDialogFooter.react','cloneWithProps','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.createClass({displayName:'MNCommerceDialogFooter',render:function(){var o=h.messengerdotcom,p=o?i:k,q,r=this.props.children;if(o){q=j.Children.count(this.props.children);r=j.Children.map(this.props.children,function(s,t){if(!s)return null;return l(s,{className:"_4ec0",type:t===0&&q===2?'secondary':'primary'});});}return (j.createElement(p,this.props,r));}});f.exports=n;},null);
__d('MNCommercePromotionManageBlockDialog.react',['CurrentEnvironment','Link.react','MessengerRadioList.react','MNCommerceButton.react','MNCommerceDetailsDialog.react','MNCommerceDialogBody.react','MNCommerceDialogFooter.react','MNCommerceDialogTitle.react','MNCommerceBlockTypeJSInstance','React','XUIRadioList.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=j.Item,u=r.Item,v=q.PropTypes,w=q.createClass({displayName:'MNCommercePromotionManageBlockDialog',propTypes:{isAllBlocked:v.bool,isPromotionBlocked:v.bool,error:v.object,loading:v.bool.isRequired,merchantName:v.string,onCancelButtonClick:v.func,onConfirmButtonClick:v.func.isRequired,pageID:v.string},getInitialState:function(){return this._calculateState();},componentWillReceiveProps:function(x){this.setState(this._calculateState(x));},_calculateState:function(x){var y=x||this.props,z=p.ALL;if(y.isAllBlocked){z=p.NONE;}else if(y.isPromotionBlocked)z=p.PROMOTION;return {type:z};},onTypeChange:function(x){this.setState({type:x});},render:function(){var x=this.props.merchantName||'',y=s._("Manage messages from {label for merchant name}",[s.param('label for merchant name',x)]),z=s._("Cancel"),aa=s._("Confirm"),ba=s._("Manage Options couldn't be shown."),ca=q.createElement(i,{href:'https://www.facebook.com/help/389645087895231',target:'_blank'},s._("Learn more"));return (q.createElement(l,babelHelpers._extends({errorMessage:ba,onToggle:this.props.onToggle,shown:this.props.shown},this.props),q.createElement(o,{showCloseButton:true},y),q.createElement(m,null,this._renderBody()),q.createElement(n,{leftContent:ca},q.createElement(k,{label:z,onClick:this.props.onCancelButtonClick,use:'default'}),q.createElement(k,{label:aa,onClick:this._onConfirm,use:'confirm'}))));},_renderBody:function(){var x=h.messengerdotcom,y=x?j:r,z=x?t:u;return (q.createElement(y,{selectedValue:this.state.type,onValueChange:this.onTypeChange},q.createElement(z,{value:p.ALL},s._("All messages")),q.createElement(z,{value:p.PROMOTION},s._("Only updates")),q.createElement(z,{value:p.NONE},s._("No messages"))));},_onConfirm:function(x){var y=this.props;y.onToggle(false);if(!y.onConfirmButtonClick)return;var z=y.pageID;y.onConfirmButtonClick(z,this.state.type);}});f.exports=w;},null);
__d('MNCommerceCacheTimeoutLimits',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={SUCCESS_TIMEOUT:10,ERROR_TIMEOUT:1};f.exports=h;},null);
__d("XMNCommercePromotionStateController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/promotion\/state\/",{page_id:{type:"String",required:true}});},null);
__d('MNCommercePromotionStateDataManager',['AsyncRequest','MNCommercePromotionStateActions','XMNCommercePromotionStateController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();k.prototype.fetchPromotionState=function(l){var m=j.getURIBuilder().setString('page_id',l).getURI();new h().setURI(m).setHandler(this.$MNCommercePromotionStateDataManager1).setErrorHandler(this.$MNCommercePromotionStateDataManager2).send();};k.prototype.$MNCommercePromotionStateDataManager1=function(l){var m=l.getRequest().uri.getQueryData(),n=m.page_id;l.payload.pageID=n;i.stateLoaded(l.payload);};k.prototype.$MNCommercePromotionStateDataManager2=function(l){var m=l.getRequest().uri.getQueryData(),n=m.page_id;i.stateLoadError(n);};function k(){}f.exports=new k();},null);
__d('MNCommercePromotionStateStore',['Cache','FluxStore','LoadObject','MessengerDispatcher','MNCommerceActionTypes','MNCommerceCacheTimeoutLimits','MNCommercePromotionStateDataManager'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;'use strict';o=babelHelpers.inherits(q,i);p=o&&o.prototype;function q(){p.constructor.call(this,k);this.$MNCommercePromotionStateStore1=new h();}q.prototype.__onDispatch=function(r){var s=r.type,t=r.pageID||r.state&&r.state.pageID;switch(s){case l.PROMOTION_STATE.LOADED:var u=r.state;this.$MNCommercePromotionStateStore1.set(t,j.empty().setValue(u),null,m.SUCCESS_TIMEOUT);this.__emitChange();break;case l.PROMOTION_STATE.LOAD_ERROR:this.$MNCommercePromotionStateStore1.set(t,j.empty().setError(new Error('Unable to load permissions for: '+t)),null,m.ERROR_TIMEOUT);this.__emitChange();break;case l.PROMOTION_STATE.RELOAD:if(t){this.$MNCommercePromotionStateStore1.set(t,j.loading());n.fetchPromotionState(t);}this.__emitChange();break;}};q.prototype.getPromotionState=function(r){if(r&&!this.$MNCommercePromotionStateStore1.has(r)){this.$MNCommercePromotionStateStore1.set(r,j.loading().setValue({pageID:r}));n.fetchPromotionState(r);}return this.$MNCommercePromotionStateStore1.get(r)||j.empty();};f.exports=new q();},null);
__d('MNCommercePromotionManageBlockDialogContainer.react',['MNCommerceDialogStateActions','MNCommerceDialogStateStore','MNCommercePromotionManageBlockDialog.react','MNCommercePromotionStateActions','MNCommercePromotionStateStore','PureStoreBasedStateMixin','React'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=n.createClass({displayName:'MNCommercePromotionManageBlockDialogContainer',mixins:[m(l)],statics:{calculateState:function(){var p=i.getState(),q=null;if(p)q=p.pageID;var r=l.getPromotionState(q);return {shown:!!p,loading:r.isLoading(),onConfirmButtonClick:p&&p.onConfirmButtonClick,pageID:q,promotionState:r.getValue(),error:r.getError()};}},render:function(){var p=this.state.promotionState;return (n.createElement(j,{error:this.state.error,isAllBlocked:p&&p.is_all_blocked,isPromotionBlocked:p&&p.is_promotion_blocked,loading:this.state.loading,merchantName:p&&p.name,onCancelButtonClick:this._hideDialog,onToggle:this._onToggle,pageID:this.state.pageID,onTryAgain:this._onTryAgainClick,onConfirmButtonClick:this.state.onConfirmButtonClick,shown:this.state.shown}));},_onToggle:function(p){if(!p)this._hideDialog();},_onTryAgainClick:function(){k.stateReload(this.state.pageID);},_hideDialog:function(){h.hideDialog();}});f.exports=o;},null);
__d('MercuryShareAttachmentReactShape',['React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h.PropTypes,j=i.shape({share_id:i.string,description:i.string,media:i.shape({image:i.string,image_size:i.shape({height:i.number,width:i.number}),duration:i.number,playable:i.bool,source:i.string}),source:i.string,style_list:i.arrayOf(i.string),subattachments:i.array,target:i.object,title:i.string,properties:i.object,uri:i.string,action_links:i.array}).isRequired;f.exports=j;},null);
__d('MessengerMomentsAppSnippet.react',['Image.react','MercuryShareAttachmentReactShape','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.PropTypes,o=j.createClass({displayName:'MessengerMomentsAppSnippet',propTypes:{attachment:i},render:function(){var p=this.props.attachment;if(!p||!p.target)return null;return (j.createElement('span',{className:"uiIconText _3l6h"},j.createElement(h,{src:m('/images/messaging/docs/generic.png')}),p.target.snippet));}});f.exports=o;},null);
__d("XMNCommercePromotionBlockController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/promotion\/block\/",{page_id:{type:"String",required:true},type:{type:"String",required:true}});},null);
__d('MNCommercePromotionBlockDataManager',['AsyncRequest','MNCommercePromotionStateActions','XMNCommercePromotionBlockController'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();k.prototype.block=function(l,m){var n=j.getURIBuilder().setString('page_id',l).setString('type',m).getURI();new h().setURI(n).setHandler(this.$MNCommercePromotionBlockDataManager1).setErrorHandler(this.$MNCommercePromotionBlockDataManager2).send();};k.prototype.$MNCommercePromotionBlockDataManager1=function(l){var m=l.getRequest().uri.getQueryData(),n=m.page_id;i.stateReload(n);};k.prototype.$MNCommercePromotionBlockDataManager2=function(l){var m=l.getRequest().uri.getQueryData(),n=m.page_id;i.stateLoadError(n);};function k(){}f.exports=new k();},null);
__d('MercuryThreadMuter',['AsyncDialog','AsyncRequest','DOM','MercuryThreadInfo'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l={showMuteChangeDialog:function(m,n){h.send(new i('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(n),function(o){o.subscribe('confirm',(function(){this.hide();var p;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(q){if(q.checked)p=q.value;});p=l.convertRawMuteSetting(p);e(['MercuryThreadActions'],function(q){q.get().updateMuteSetting(m,p);});}).bind(o));});},convertRawMuteSetting:function(m){switch(m){case 'always':return -1;case '30minutes':return 1800;case '1hour':return 3600;case '8hours':return 8*3600;case '24hours':return 24*3600;case '8am':var n,o=new Date(),p=new Date();p.setHours(8);p.setMinutes(0);p.setSeconds(0);if(p>o){n=p-o;}else n=p-o+24*3600*1000;return n/1000;default:return 0;}}};f.exports=l;},null);
__d('FBRTCVideoCallButtonManagerImpl',['BanzaiLogger','CurrentUser','FBRTCCallabilityStore','FBRTCCore','FBRTCLogger','MercuryIDs','MercuryParticipants','Tooltip','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q={onCallClicked:function(r,s){if(s===l.Trigger.WEB_MESSENGER)h.log('VideoCallLoggerConfig',{event:'web_messenger_call_click'});var t=m.getUserIDFromThreadID(r);!t?p(0):undefined;k.startOutgoingCall(t,s,false);},isVideoCallableThread:function(r){if(r){var s=m.getUserIDFromThreadID(r);if(s&&s!==i.getID())return true;}return false;},updateVideoCallButton:function(r,s){if(!s||!q.isVideoCallableThread(s))return;var t=m.getUserIDFromThreadID(s);!t?p(0):undefined;r.disabled=!j.isCallable(t);n.get(m.getParticipantIDFromUserID(t),function(u){o.set(r,j.callButtonTooltip(t,u.short_name));});}};f.exports=q;},null);
__d('MercuryDrafts',['CacheStorage','MercurySingletonProvider','isEmpty'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();k.getForFBID=function(m){'use strict';return l.getForFBID(m);};k.get=function(){'use strict';return l.get();};function k(m){'use strict';this.$MercuryDrafts1=m;this.$MercuryDrafts2=new h('localstorage','mercury-drafts:'+this.$MercuryDrafts1);}k.prototype.saveDraft=function(m,n){'use strict';if(this.isMessageEmpty(n)){this.removeDraft(m);}else this.$MercuryDrafts2.set(m,this.$MercuryDrafts3(m,n));};k.prototype.removeDraft=function(m){'use strict';this.$MercuryDrafts2.remove(m);};k.prototype.getDraft=function(m){'use strict';var n=this.$MercuryDrafts2.get(m,{});return n.message;};k.prototype.isMessageEmpty=function(m){'use strict';return j(m)||j(m.body)&&j(m.content_attachment)&&j(m.raw_attachments)&&j(m.photo_fbids)&&j(m.image_ids);};k.prototype.$MercuryDrafts3=function(m,n){'use strict';return {thread_id:m,message:n};};var l=new i(k);f.exports=k;},null);
__d('MercuryDraftsController',['Input','MercurySingletonProvider','isEmpty','MercuryDrafts'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryDrafts').get();l.getForFBID=function(n){'use strict';return m.getForFBID(n);};l.get=function(){'use strict';return m.get();};function l(n){'use strict';this.$MercuryDraftsController1;}l.prototype.clearDraft=function(n){'use strict';if(this.canSaveDrafts(n))k.removeDraft(n);};l.prototype.saveDraft=function(n,o,p,q,r){'use strict';if(!this.canSaveDrafts(n))return;var s={body:h.getValue(o)};if(p&&!j(p.getAttachments())){s.has_attachment=true;s.raw_attachments=p.getAttachments();}if(p&&!j(p.getImageFiles())){s.has_attachment=true;s.image_ids=p.getImageFiles();}if(r&&!j(r.getSelectedFBIDs())){s.has_attachment=true;s.photo_fbids=r.getSelectedFBIDs();}if(q.getAttachData()){s.has_attachment=true;s.content_attachment=q.getAttachData();}k.saveDraft(n,s);};l.prototype.loadDraft=function(n,o,p,q,r){'use strict';if(!this.canSaveDrafts(n)||this.$MercuryDraftsController2(o,p,q,r))return;var s=k.getDraft(n);if(!j(s)){if(s.body){o.focus();h.setValue(o,s.body);}if(p&&!j(s.raw_attachments))p.addCachedAttachments(s.raw_attachments);if(p&&!j(s.image_ids))p.addCachedImageFiles(s.image_ids);if(!j(s.content_attachment))q.loadShare(s.content_attachment.attachment.params.url);if(r&&!j(s.photo_fbids))r.addCachedPhotos(s.photo_fbids);this.clearDraft(n);}};l.prototype.canSaveDrafts=function(n){'use strict';return !!n;};l.prototype.$MercuryDraftsController2=function(n,o,p,q){'use strict';return !h.isEmpty(n)||o&&!j(o.getAttachments())||o&&!j(o.getImageFiles())||q&&!j(q.getSelectedFBIDs())||p.getAttachData();};l.prototype.toString=function(){'use strict';return '[object MercuryDraftsController:'+this.$MercuryDraftsController1+']';};var m=new i(l);f.exports=l;},null);
__d('MercuryAttachmentSnippetRenderer',['MercuryAttachmentSnippetType','MercuryAttachmentType','MercuryAudioType','MercurySupportedShareType','P2PSnippetStringUtils','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n={getAttachmentSnippetType:function(o){if(this._hasOnlyPhotos(o))return h.PHOTO;if(this._hasOnlyAnimatedImages(o))return h.GIF;if(this._hasOnlyVideo(o))return h.VIDEO;if(this._hasAudioClip(o))return h.AUDIO_CLIP;if(this._hasSticker(o))return h.STICKER;if(this._hasOrion(o))return h.ORION;if(this._hasShare(o))return h.SHARE;if(this._hasError(o))return h.ERROR;return h.MIXED;},renderAttachmentSnippetText:function(o,p,q,r){switch(o){case h.PHOTO:return this._renderPhotoAttachmentSnippetText(p,q,this._getPhotoAttachments(r));case h.GIF:return this._renderAnimatedImagesAttachmentSnippetText(p,q,this._getAnimatedImageAttachments(r));case h.VIDEO:return p?m._("You sent a video."):m._("{sender name} sent a video.",[m.param('sender name',q)]);case h.AUDIO_CLIP:return p?m._("You sent a voice message."):m._("{name} sent a voice message.",[m.param('name',q)]);case h.STICKER:return p?m._("You sent a sticker."):m._("{name} sent a sticker.",[m.param('name',q)]);case h.ORION:if(r&&r[0]&&r[0].metadata)return this.renderOrionSnippetText(p,q,r[0].metadata);break;case h.SHARE:return p?m._("You shared a link"):m._("{sender name} shared a link.",[m.param('sender name',q)]);case h.ERROR:return p?m._("You sent an attachment."):m._("{sender name} sent an attachment.",[m.param('sender name',q)]);default:return '';}},_hasOnlyPhotos:function(o){return this._getPhotoAttachments(o).length===o.length;},_hasOnlyAnimatedImages:function(o){return this._getAnimatedImageAttachments(o).length===o.length;},_hasOnlyVideo:function(o){return (o.length===1&&o[0].attach_type===i.VIDEO);},_hasAudioClip:function(o){var p=o[0].metadata&&o[0].metadata.type;return (o.length===1&&(p===j.AudioClip||p===j.VoiceMessageWithTranscript));},_hasSticker:function(o){return (o.length===1&&o[0].attach_type===i.STICKER);},_hasOrion:function(o){return this._hasSingleAttachmentOfShareDataType(o,k.FB_ORION);},_hasSingleAttachmentOfShareDataType:function(o,p){return (o.length===1&&o[0].share_data_type===p);},_hasShare:function(o){return (o.length===1&&o[0].attach_type===i.SHARE);},_hasError:function(o){return (o.length===1&&o[0].attach_type===i.ERROR);},_getPhotoAttachments:function(o){if(!o)return [];return o.filter(function(p){return p.attach_type===i.PHOTO;});},_getAnimatedImageAttachments:function(o){if(!o)return [];return o.filter(function(p){return p.attach_type===i.ANIMATED_IMAGE;});},_renderPhotoAttachmentSnippetText:function(o,p,q){if(q.length===1){if(o){return m._("You sent a photo.");}else return m._("{name} sent a photo.",[m.param('name',p)]);}else if(o){return m._({"*":"You sent {num_photos} photos."},[m.param('num_photos',q.length,[0])]);}else return m._({"*":"{name} sent {num_photos} photos."},[m.param('name',p),m.param('num_photos',q.length,[0])]);},_renderAnimatedImagesAttachmentSnippetText:function(o,p,q){if(q.length===1){if(o){return m._("You sent a GIF.");}else return m._("{name} sent a GIF.",[m.param('name',p)]);}else if(o){return m._("You sent {num_animated_images} GIFs.",[m.param('num_animated_images',q.length)]);}else return m._("{name} sent {num_animated_images} GIFs.",[m.param('name',p),m.param('num_animated_images',q.length)]);},renderOrionSnippetText:function(o,p,q,r,s,t){return l.getTransferSnippetByStatus(r,o,s||false,p||'',t||'',q);},renderP2PPaymentRequestSnippetText:function(o,p,q,r,s,t){return l.getRequestSnippetByStatus(r,o,s||false,p||'',t||'',q);}};f.exports=n;},null);
__d('MercuryAnimatedShareSnippet.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'MercuryAnimatedShareSnippet',propTypes:{isViewerSender:m.bool,senderName:m.string},render:function(){var o=this.props.isViewerSender?k._("You sent a GIF."):k._("{sender name} sent a GIF.",[k.param('sender name',this.props.senderName)]);return (i.createElement('span',{className:"uiIconText _3l6h"},i.createElement(h,{src:l('/images/icons/photo.gif')}),o));}});f.exports=n;},null);
__d('MercuryFallbackShareAttachmentSnippet.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'MercuryFallbackShareAttachmentSnippet',propTypes:{isViewerSender:m.bool,senderName:m.string},render:function(){var o;if(this.props.isViewerSender){o=k._("You shared a link");}else o=k._("{sender name} shared a link.",[k.param('sender name',this.props.senderName)]);return (i.createElement('span',{className:"uiIconText _3l6h"},i.createElement(h,{src:l('/images/messaging/docs/generic.png')}),o));}});f.exports=n;},null);
__d('MercuryMessageLocationShareAttachmentSnippet.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'MercuryMessageLocationShareAttachmentSnippet',propTypes:{isViewerSender:m.bool,senderName:m.string},render:function(){var o;if(this.props.isViewerSender){o=k._("You sent a location.");}else o=k._("{sender name} sent a location.",[k.param('sender name',this.props.senderName)]);return (i.createElement('span',{className:"uiIconText _3l6h"},i.createElement(h,{src:l('/images/messaging/location/location.png')}),o));}});f.exports=n;},null);
__d('MercuryPhotoShareSnippet.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'MercuryPhotoShareSnippet',propTypes:{isViewerSender:m.bool,senderName:m.string},render:function(){var o=this.props.isViewerSender?k._("You sent a photo."):k._("{sender name} sent a photo.",[k.param('sender name',this.props.senderName)]);return (i.createElement('span',{className:"uiIconText _3l6h"},i.createElement(h,{src:l('/images/icons/photo.gif')}),o));}});f.exports=n;},null);
__d('MercuryProductItemShareSnippet.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'MercuryProductItemShareSnippet',propTypes:{isViewerSender:m.bool,senderName:m.string},render:function(){var o=this.props.isViewerSender?k._("You sent a for sale item."):k._("{sender name} sent a for sale item.",[k.param('sender name',this.props.senderName)]);return (i.createElement('span',{className:"uiIconText _3l6h"},i.createElement(h,{src:l('/images/messaging/docs/generic.png')}),o));}});f.exports=n;},null);
__d('MercuryPromotionShareAttachmentSnippet.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'MercuryPromotionShareAttachmentSnippet',propTypes:{senderName:m.string,attachment:m.object},render:function(){var o=this.props.attachment,p=o&&o.target,q=p&&p.message||k._("{sender name} sent an attachment.",[k.param('sender name',this.props.senderName)]);return (i.createElement('span',{className:"uiIconText _3l6h"},i.createElement(h,{src:l('/images/messaging/docs/generic.png')}),q));}});f.exports=n;},null);
__d('MercuryVideoShareSnippet.react',['Image.react','React','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'MercuryVideoShareSnippet',propTypes:{isViewerSender:m.bool,senderName:m.string},render:function(){var o=this.props.isViewerSender?k._("You sent a video."):k._("{sender name} sent a video.",[k.param('sender name',this.props.senderName)]);return (i.createElement('span',{className:"uiIconText _3l6h"},i.createElement(h,{src:l('/images/icons/video.gif')}),o));}});f.exports=n;},null);
__d('P2PMercuryAttachmentSnippetRendererBase.react',['Image.react','React','cx','ix'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.PropTypes,m=i.createClass({displayName:'P2PMercuryAttachmentSnippetRendererBase',propTypes:{text:l.node},render:function(){return (i.createElement('span',{className:"uiIconText _3l6h _3_io"},i.createElement(h,{height:12,src:k('/images/p2p/attachment-snippet-icon.png'),width:12}),this.props.text));}});f.exports=m;},null);
__d('P2PPaymentRequestMercuryAttachmentSnippet.react',['CurrentUser','MercuryAttachmentSnippetRenderer','P2PMercuryAttachmentSnippetRendererBase.react','React'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=k.PropTypes,m=k.createClass({displayName:'P2PPaymentRequestMercuryAttachmentSnippet',propTypes:{formattedAmount:l.string.isRequired,requestee:l.object.isRequired,requester:l.object.isRequired,status:l.number.isRequired},render:function(){var n=i.renderP2PPaymentRequestSnippetText(h.getID()===this.props.requester.id,this.props.requester.name,this.props.formattedAmount,this.props.status,h.getID()===this.props.requestee.id,this.props.requestee.name);return (k.createElement(j,{text:n}));}});f.exports=m;},null);
__d('P2PPaymentRequestMercuryShareAttachmentSnippet.react',['MercuryShareAttachmentReactShape','P2PPaymentRequestMercuryAttachmentSnippet.react','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.createClass({displayName:'P2PPaymentRequestMercuryShareAttachmentSnippet',propTypes:{attachment:h},render:function(){var l=this.props.attachment?this.props.attachment.target:{};return (j.createElement(i,{formattedAmount:l.amountWithSymbol,requestee:l.requestee,requester:l.requester,status:l.currentStatus}));}});f.exports=k;},null);
__d('MercuryShareStyleMap',['JSResource','Map','MercuryConfig','MercuryShareAttachmentRenderLocations','StoryAttachmentStyle','cx','emptyFunction','MercuryFallbackShareAttachmentSnippet.react','P2PMercuryShareAttachmentSnippet.react','P2PPaymentRequestMercuryShareAttachmentSnippet.react','MercuryPromotionShareAttachmentSnippet.react','MessengerMomentsAppSnippet.react','MercuryPhotoShareSnippet.react','MercuryVideoShareSnippet.react','MercuryMessageLocationShareAttachmentSnippet.react','MercuryAnimatedShareSnippet.react','MercuryProductItemShareSnippet.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=new i();o.set(l.FALLBACK,{componentName:'MercuryFallbackShareAttachment.react',componentLoader:h('MercuryFallbackShareAttachment.react'),getSnippetComponent:function(){return c('MercuryFallbackShareAttachmentSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d"]])});o.set(l.EVENT,{componentName:'MercuryEventShareAttachment.react',componentLoader:h('MercuryEventShareAttachment.react'),getSnippetComponent:function(){return c('MercuryFallbackShareAttachmentSnippet.react');}});o.set(l.ORION,{componentName:'P2PMercuryShareAttachmentContainer.react',componentLoader:h('P2PMercuryShareAttachmentContainer.react'),getSnippetComponent:function(){return c('P2PMercuryShareAttachmentSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d _3-50"]])});o.set(l.ORION_REQUEST,{componentName:'P2PPaymentRequestMercuryShareAttachmentContainer.react',componentLoader:h('P2PPaymentRequestMercuryShareAttachmentContainer.react'),getSnippetComponent:function(){return c('P2PPaymentRequestMercuryShareAttachmentSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d _3-50"]])});if(j.WWWMessengerCommerceGK){o.set(l.RETAIL_RECEIPT,{componentName:'MNCommerceReceiptMercuryShareAttachment.react',componentLoader:h('MNCommerceReceiptMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.RETAIL_CANCELLATION,{componentName:'MNCommerceCancelationMercuryShareAttachment.react',componentLoader:h('MNCommerceCancelationMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.RETAIL_SHIPMENT,{componentName:'MNCommerceShippingMercuryShareAttachment.react',componentLoader:h('MNCommerceShippingMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.RETAIL_SHIPMENT_TRACKING_EVENT,{componentName:'MNCommerceShippingMercuryShareAttachment.react',componentLoader:h('MNCommerceShippingMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.RETAIL_NOW_IN_STOCK,{componentName:'MNCommerceProductSubscriptionMercuryShareAttachment.react',componentLoader:h('MNCommerceProductSubscriptionMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.RETAIL_PROMOTION,{componentName:'MNCommercePromotionMercuryShareAttachment.react',componentLoader:h('MNCommercePromotionMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.BUSINESS_MESSAGE_ITEMS,{componentName:'MNCommercePromotionMercuryShareAttachment.react',componentLoader:h('MNCommercePromotionMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});if(j.WWWMessengerHScrollGK)o.set(l.H_SCROLL,{componentName:'MNCommerceHScrollMercuryShareAttachment.react',componentLoader:h('MNCommerceHScrollMercuryShareAttachment.react'),getSnippetComponent:function(){return c('MercuryPromotionShareAttachmentSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d _205d"]])});}if(j.WWWMessengerTransportationGK){o.set(l.RIDE_ORDERED,{componentName:'MNTransportationRideConfirmationMercuryAttachment.react',componentLoader:h('MNTransportationRideConfirmationMercuryAttachment.react'),getSnippetComponent:function(){return c('MercuryPromotionShareAttachmentSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.RIDE_RECEIPT,{componentName:'MNTransportationRideReceiptMercuryAttachment.react',componentLoader:h('MNTransportationRideReceiptMercuryAttachment.react'),getSnippetComponent:function(){return c('MercuryPromotionShareAttachmentSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d _205d"]])});}if(j.WWWMessengerAirlinesGK){o.set(l.AIRLINE_FLIGHT_RESCHEDULE_UPDATE,{componentName:'MNAirlineUpdateMercuryShareAttachment.react',componentLoader:h('MNAirlineUpdateMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.AIRLINE_CONFIRMATION,{componentName:'MNAirlineConfirmationMercuryShareAttachment.react',componentLoader:h('MNAirlineConfirmationMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});}if(j.WWWMessengerMoneyPennyGK)o.set(l.RETAIL_AGENT_ITEM_SUGGESTION,{componentName:'MNCommerceAgentItemSuggestionMercuryShareAttachment.react',componentLoader:h('MNCommerceAgentItemSuggestionMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});if(j.MomentsMessengerWWWGK){var p={componentName:'MessengerMomentsAppShareAttachment.react',componentLoader:h('MessengerMomentsAppShareAttachment.react'),getSnippetComponent:function(){return c('MessengerMomentsAppSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d"]])};o.set(l.MOMENTS_APP_INVITATION,p);o.set(l.MOMENTS_APP_PHOTO_REQUEST,p);}if(j.MercuryGenieRendering)o.set(l.GENIE_MESSAGE,{componentName:'GenieMessageShareAttachment.react',componentLoader:h('GenieMessageShareAttachment.react'),cx:new i([[k.MESSENGER,"_2wrf"]]),getSnippetComponent:function(){return c('MercuryFallbackShareAttachmentSnippet.react');}});o.set(l.MOVIE_BOT_MOVIE_LIST,{componentName:'MovieBotMovieListShareAttachment.react',componentLoader:h('MovieBotMovieListShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d"]])});o.set(l.MOVIE_BOT_MOVIE_SHOWTIME_LIST,{componentName:'MovieBotMovieShowtimeListShareAttachment.react',componentLoader:h('MovieBotMovieShowtimeListShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d"]])});o.set(l.SHARE_LARGE_IMAGE,{componentName:'MercuryShareLargeImageAttachment.react',componentLoader:h('MercuryShareLargeImageAttachment.react'),getSnippetComponent:function(){return c('MercuryPhotoShareSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d"]]),unwrapInStory:n.thatReturnsTrue});o.set(l.IMAGE_SHARE,{componentName:'MercuryImageShareAttachment.react',componentLoader:h('MercuryImageShareAttachment.react'),getSnippetComponent:function(){return c('MercuryPhotoShareSnippet.react');},cx:null,unwrapInStory:n.thatReturnsTrue});o.set(l.VIDEO,{componentName:'MercuryVideoShareAttachment.react',componentLoader:h('MercuryVideoShareAttachment.react'),getSnippetComponent:function(){return c('MercuryVideoShareSnippet.react');},cx:null,unwrapInStory:n.thatReturnsTrue});o.set(l.MESSAGE_LOCATION,{componentName:'MercuryMessageLocationShareAttachment.react',componentLoader:h('MercuryMessageLocationShareAttachment.react'),getSnippetComponent:function(){return c('MercuryMessageLocationShareAttachmentSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d"]])});o.set(l.ANIMATED_IMAGE_SHARE,{componentName:'MercuryAnimatedShareAttachment.react',componentLoader:h('MercuryAnimatedShareAttachment.react'),getSnippetComponent:function(){return c('MercuryAnimatedShareSnippet.react');},cx:null,unwrapInStory:n.thatReturnsFalse});o.set(l.GROUP_SELL_PRODUCT_ITEM,{componentName:'MercuryProductItemShareAttachment.react',componentLoader:h('MercuryProductItemShareAttachment.react'),getSnippetComponent:function(){return c('MercuryProductItemShareSnippet.react');},cx:new i([[k.MESSENGER,"_5i_d"]]),unwrapInStory:n.thatReturnsTrue});o.set(l.FINANCIAL_BILL_PAYMENT_REQUEST,{componentName:'MNBillPaymentRequestMercuryShareAttachment.react',componentLoader:h('MNBillPaymentRequestMercuryShareAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d _205d"]])});o.set(l.MUSIC_AGGREGATION,{componentName:'MercuryMusicAttachment.react',componentLoader:h('MercuryMusicAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d"]])});o.set(l.VIDEO_SHARE_YOUTUBE,{componentName:'MercuryVideoShareYoutubeAttachment.react',componentLoader:h('MercuryVideoShareYoutubeAttachment.react'),cx:new i([[k.MESSENGER,"_5i_d"]])});o.set(l.RTC_CALL_LOG,{componentName:'MercuryRTCShareAttachment.react',componentLoader:h('MercuryRTCShareAttachment.react')});var q={getStyleFactory:function(r){if(!r||!r.style_list)return null;if(r.style_list[0]===l.ATTACHED_STORY){var s=r.subattachments,t=s&&s.length?s[0].style_list:[],u=this._getStyleMapEntry(t);if(u&&u.unwrapInStory&&u.unwrapInStory())return {attachment:s[0],factory:u};}var v=this._getStyleMapEntry(r.style_list);if(!v)return null;return {attachment:r,factory:v};},_getStyleMapEntry:function(r){for(var s=0;s<r.length;s++){var t=o.get(r[s]);if(t)return t;}return null;}};f.exports=q;},null);
__d('MercuryShareAttachmentSnippet.react',['MercuryShareAttachmentReactShape','MercuryShareStyleMap','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.PropTypes,l=j.createClass({displayName:'MercuryShareAttachmentSnippet',propTypes:{attachment:h,isSenderViewer:k.bool,senderName:k.string},render:function(){var m=i.getStyleFactory(this.props.attachment);if(m.factory&&!!m.factory.getSnippetComponent){var n=m.factory.getSnippetComponent();return (j.createElement(n,babelHelpers._extends({},this.props,{attachment:m.attachment})));}return null;}});f.exports=l;},null);
__d('MercuryAttachmentSnippet.react',['EmoticonsList','Image.react','MercuryAttachment','MercuryAttachmentSnippetRenderer','MercuryAttachmentSnippetType','MercuryAttachmentType','MercuryIDs','P2PMercuryAttachmentSnippet.react','MercuryShareAttachmentSnippet.react','MercuryParticipants','React','StickerConstants','TextWithEmoticons.react','cx','ix','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){'use strict';if(c.__markCompiled)c.__markCompiled();var y=r.PropTypes,z=r.createClass({displayName:'MercuryAttachmentSnippet',propTypes:{thread:y.object.isRequired,viewer:y.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(ca){this._ensureParticipant(ca.thread.snippet_sender);this._setVariables(ca);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var ca=this._getSenderName(),da=k.getAttachmentSnippetType(this._attachments);switch(da){case l.PHOTO:return this._renderPhotoSnippet(ca);case l.GIF:return this._renderAnimatedImageSnippet(ca);case l.VIDEO:return this._renderVideoSnippet(ca);case l.AUDIO_CLIP:return this._renderAudioClipSnippet(ca);case l.STICKER:return this._renderStickerSnippet(ca);case l.ORION:return this._renderOrionSnippet(ca);case l.SHARE:return this._renderShareSnippet(ca);case l.ERROR:return this._renderError(ca);default:return this._renderMixedSnippet(ca);}},_renderPhotoSnippet:function(ca){return this._renderSnippet(k.renderAttachmentSnippetText(l.PHOTO,this._isViewerSender,ca,this._attachments));},_renderAnimatedImageSnippet:function(ca){return this._renderSnippet(k.renderAttachmentSnippetText(l.GIF,this._isViewerSender,ca,this._attachments));},_renderVideoSnippet:function(ca){return this._renderSnippet(k.renderAttachmentSnippetText(l.VIDEO,this._isViewerSender,ca));},_renderAudioClipSnippet:function(ca){return this._renderSnippet(k.renderAttachmentSnippetText(l.AUDIO_CLIP,this._isViewerSender,ca));},_renderStickerSnippet:function(ca){if(aa(this._attachments[0].metadata.stickerID)){var da=r.createElement(t,{renderEmoticons:true,text:h.symbols.like});if(this._isViewerSender){return (r.createElement('span',null,w._("You: {conversation_snippet}",[w.param('conversation_snippet',da)])));}else return (r.createElement('span',null,w._("{sender name}: {conversation_snippet}",[w.param('sender name',ca),w.param('conversation_snippet',da)])));}else return (r.createElement('span',null,k.renderAttachmentSnippetText(l.STICKER,this._isViewerSender,ca)));},_renderOrionSnippet:function(ca){return (r.createElement('span',null,r.createElement(o,this._attachments[0].metadata)));},_renderShareSnippet:function(ca){if(!!this._attachments[0].share)return (r.createElement(p,{attachment:this._attachments[0].share,senderName:ca,isViewerSender:this._isViewerSender}));return this._renderSnippet(k.renderAttachmentSnippetText(l.SHARE,this._isViewerSender,ca));},_renderMixedSnippet:function(ca){return (r.createElement('span',null,this._attachments.filter(function(da){return (da.attach_type===m.FILE||da.attach_type===m.PHOTO||da.attach_type===m.VIDEO);}).map((function(da,ea){return this._renderSnippet(da.name,da.icon_type,ea);}).bind(this))));},_renderSnippet:function(ca,da,ea){var fa=j.getAttachIconClass(da||this._attachments[0].icon_type),ga=x(fa,"uiIconText _3l6h");return (r.createElement('span',{className:ga,key:ea},r.createElement(i,{src:v('/images/messaging/docs/generic.png')}),ca));},_renderError:function(ca){var da=k.renderAttachmentSnippetText(l.ERROR,this._isViewerSender,ca);return this._renderSnippet(da);},_setVariables:function(ca){this._viewer=ca.viewer;this._sender=ca.thread.snippet_sender;this._attachments=ca.thread.snippet_attachments;this._isViewerSender=ba(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var ca=q.getNow(this._sender);if(!ca)return null;return ca.short_name;},_ensureParticipant:function(ca){if(!ca)return;this._cancelParticipantFetch();if(!q.getNow(ca))this._sub=q.get(ca,(function(da){return this.forceUpdate();}).bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function aa(ca){return (ca==s.LIKE_STICKER_ID||ca==s.HOT_LIKE_SMALL_STICKER_ID||ca==s.HOT_LIKE_MEDIUM_STICKER_ID||ca==s.HOT_LIKE_LARGE_STICKER_ID);}function ba(ca,da){return !!(ca&&n.getParticipantIDFromUserID(da)==ca);}f.exports=z;},null);
__d('MercuryParticipantsImage.react',['MercuryParticipants','React','SplitImage.react','areEqual'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.PropTypes,m=i.createClass({displayName:'MercuryParticipantsImage',_bigImageToken:null,propTypes:{participants:l.array.isRequired,size:l.number},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(n){this._getParticipantImages(n);},componentWillUnmount:function(){this._bigImageToken&&this._bigImageToken.remove();},shouldComponentUpdate:function(n,o){return (n.size!==this.props.size||!o||!k(o.participantImages,this.state.participantImages));},render:function(){if(this.state.participantImages.length>0)return (i.createElement(j,{border:true,className:this.props.className,srcs:this.state.participantImages,size:this.props.size}));return null;},_getParticipantImages:function(n){this._bigImageToken&&this._bigImageToken.remove();this._bigImageToken=h.getOrderedBigImageMulti(n.participants,(function(o){this.isMounted()&&this.setState({participantImages:o});}).bind(this));}});f.exports=m;},null);
__d('MercuryThreadImage.react',['ImmutableObject','MercuryIDs','MercuryParticipantsImage.react','MercuryParticipantsConstants','Pixelz.react','React','areEqual'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=m.PropTypes,p=m.createClass({displayName:'MercuryThreadImage',propTypes:{thread:o.instanceOf(h).isRequired,viewer:o.string.isRequired,size:o.number,useBackground:o.bool},shouldComponentUpdate:function(q,r){return (q.thread.image_src!==this.props.thread.image_src||!n(q.thread.participants,this.props.thread.participants)||q.size!==this.props.size||q.viewer!==this.props.viewer||q.useBackground!==this.props.useBackground);},render:function(){var q=this.props.size||k.BIG_IMAGE_SIZE,r=this.props.thread.image_src;if(r){if(this.props.useBackground)return (m.createElement('div',{style:{height:q,backgroundImage:'url('+r+')',backgroundPosition:'50% 50%',backgroundRepeat:'no-repeat',backgroundSize:'cover',width:q}}));return (m.createElement(l,{alt:'',height:q,resizeMode:'cover',src:r,width:q}));}var s=i.getParticipantIDFromUserID(this.props.viewer),t=this.props.thread.participants.filter(function(v){return v!==s;}),u=[];if(!t.length){u=[s];}else if(t.length==1){u=t;}else u=t.slice(0,3);return (m.createElement(j,{participants:u,size:q}));}});f.exports=p;},null);
__d('EmojiSticker.react',['Image.react','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=i.PropTypes,m=i.createClass({displayName:'EmojiSticker',propTypes:{emoji:l.string,sourceURI:l.string.isRequired},render:function(){return (i.createElement('div',{'aria-label':this.props.emoji,className:k(this.props.className,"_383m"),tabIndex:'0'},i.createElement(h,{src:this.props.sourceURI})));}});f.exports=m;},null);
__d('MercuryShareAttachment.react',['BootloadedComponent.react','MercuryShareAttachmentReactShape','MercuryShareAttachmentRenderLocations','MercuryShareStyleMap','React','ReactDOM','StoryAttachmentStyle','cx','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=l.PropTypes,s=l.createClass({displayName:'MercuryShareAttachment',propTypes:{attachment:i,messageID:r.string,location:r.oneOf(j.getValues()),onComponentLoaded:r.func.isRequired,thread_id:r.string.isRequired},getDefaultProps:function(){return {onComponentLoaded:p};},componentDidMount:function(){this._handleComponentLoad();},_renderComponent:function(t,u){if(this.props.location===j.MESSENGER)u=q("_52mr _2poz _ui9",u);return u?l.createElement('div',{className:u},t):t;},render:function(){var t=k.getStyleFactory(this.props.attachment);if(!t)return null;var u=t.attachment,v=t.factory;return (this._renderComponent(l.createElement(h,babelHelpers._extends({},this.props,{attachment:u,bootloadLoader:v.componentLoader,bootloadPlaceholder:l.createElement('div',null),module:v.componentName,onComponentLoad:this._handleComponentLoad})),v.cx&&v.cx.get(this.props.location)));},_handleComponentLoad:function(){var t=m.findDOMNode(this).children,u=0;for(var v=0;v<t.length;v++)u+=t[v].offsetHeight;this.props.onComponentLoaded(u);}});f.exports=s;},null);
__d('Sticker.react',['Arbiter','Image.react','React','ReactDOM','StickerConfig','StickerConstants','cx','emptyFunction','fbt','getElementPosition','getObjectValues','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=j.PropTypes,u=83,v=5000,w=10,x={CLICK:'click',HOVER:'hover',LOAD_AND_HOVER:'load_and_hover'},y=j.createClass({displayName:'Sticker',propTypes:{accessibilityLabel:t.string,animationTrigger:t.oneOf(r(x)),forceCursorPointer:t.bool,frameCount:t.number.isRequired,frameRate:t.number,framesPerCol:t.number.isRequired,framesPerRow:t.number.isRequired,onAttachmentLoad:t.func,onStickerClick:t.func,packID:t.string,packName:t.string,sourceURI:t.string.isRequired,sourceWidth:t.number.isRequired,sourceHeight:t.number.isRequired,spriteURI:t.string,stickerID:t.string,subscribedThreadID:t.string,testID:t.string},getInitialState:function(){return {index:0,hasAnimated:false,unsubscribeID:null};},getDefaultProps:function(){return {accessibilityLabel:'',forceCursorPointer:false,frameRate:u,onStickerClick:o,packID:null,packName:''};},componentDidMount:function(){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.sourceHeight);this._stopIntervalID=0;if(this.props.animationTrigger===x.LOAD_AND_HOVER&&this.props.frameCount>1&&this.props.spriteURI)this.startAnimation();if(this.props.subscribedThreadID&&this.props.frameCount>1){var z=h.subscribe(this.props.subscribedThreadID,(function(aa,ba){this.isScrolledIntoView(ba.scrollTop,ba.viewHeight,ba.top);}).bind(this));this.setState({unsubscribeID:z});}},componentWillUnmount:function(){if(this.state.unsubscribeID)h.unsubscribe(this.state.unsubscribeID);if(this.isAnimating())clearInterval(this._stopIntervalID);},isAnimating:function(){return !!this._stopIntervalID;},getWidth:function(){return Math.floor(this.props.sourceWidth);},getHeight:function(){return Math.floor(this.props.sourceHeight);},preloadSprite:function(){var z=new window.Image();z.onload=(function(){if(this.isMounted()&&!this.state.hasAnimated){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}}).bind(this);if(l.ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){z.src=this.props.paddedSpriteURI;}else z.src=this.props.spriteURI;},isScrolledIntoView:function(z,aa,ba){var ca=q(k.findDOMNode(this)),da=z+ca.y-ba,ea=z+aa,fa=da+ca.height;if(this.props.frameCount>1&&!this.state.hasAnimated&&fa-w<=ea&&da+w>=z)this.startAnimation();},startAnimation:function(){if(!this.state.hasAnimated&&this.props.spriteURI){this.preloadSprite();}else if(!this.isAnimating()){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}},stopAnimation:function(){this.setState({index:0});clearInterval(this._stopIntervalID);this._stopIntervalID=0;},toggleAnimation:function(){if(this.isAnimating()){this.stopAnimation();}else this.startAnimation();},shouldStopAnimating:function(){var z=this.state.index%this.props.frameCount;if(!(z===0&&this.state.index*this.props.frameRate>v))return false;if(this.props.animationTrigger===x.CLICK)return true;return !this.state.isHovered;},incrementFrameIndex:function(){if(this.shouldStopAnimating()){this.stopAnimation();}else this.setState({index:this.state.index+1});},getStyle:function(){var z=0,aa=this.props.spriteURI;if(l.ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){aa=this.props.paddedSpriteURI;var ba=240/Math.min(this.getHeight(),this.getWidth());z=Math.floor(m.SPRITE_PADDING/ba);}var ca=this.state.index%this.props.frameCount,da=ca%this.props.framesPerRow*(this.getWidth()+z*2)+z,ea=Math.floor(ca/this.props.framesPerRow)*(this.getHeight()+z*2)+z,fa=this.props.frameCount>1&&this.props.animationTrigger===x.CLICK||this._isStickerClickable(this.props.packID),ga=this.props.forceCursorPointer||fa?'pointer':'default';if(!this.state.hasAnimated||!this.props.spriteURI){return {backgroundImage:this._isHotLike()?null:'url('+this.props.sourceURI+')',backgroundRepeat:'no-repeat',backgroundSize:this.getWidth()+'px '+this.getHeight()+'px',cursor:ga,height:this.getHeight(),width:this.getWidth()};}else return {backgroundImage:'url('+aa+')',backgroundPosition:-da+'px '+ -ea+'px',backgroundSize:(this.getWidth()+z*2)*this.props.framesPerRow+'px '+(this.getHeight()+z*2)*this.props.framesPerCol+'px',cursor:ga,height:this.getHeight(),width:this.getWidth()};},_isStickerClickable:function(z){return z&&z!=m.MOBILE_LIKE_STICKER_PACK_ID&&z!=m.GRAVEYARD_PACK_ID;},onStickerClick:function(){if(!this._isStickerClickable(this.props.packID))return;if(this.props.onStickerClick)this.props.onStickerClick(this.props.packID,this.props.stickerID);},mouseLeft:function(){this.setState({isHovered:false});},mouseEntered:function(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusSelected:function(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusUnselected:function(){this.setState({isHovered:false});},getAriaLabel:function(){return p._("{pack name} {sticker name} sticker",[p.param('pack name',this.props.packName),p.param('sticker name',this.props.accessibilityLabel)]);},render:function(){var z,aa;if(this.props.animationTrigger===x.CLICK&&this.props.frameCount>1&&this.props.spriteURI){z=true;}else if((this.props.animationTrigger===x.HOVER||this.props.animationTrigger===x.LOAD_AND_HOVER)&&this.props.frameCount>1&&this.props.spriteURI)aa=true;var ba=z?this.toggleAnimation:null;if(this.props.packID)ba=this.onStickerClick;var ca=this.props.className;if(this._isHotLike())ca=s(ca,"_576q");return (j.createElement('div',{'aria-label':this.getAriaLabel(),className:ca,'data-testid':this.props.testID,tabIndex:'0',style:this.getStyle(),onClick:ba,onMouseEnter:aa?this.mouseEntered:null,onMouseLeave:aa?this.mouseLeft:null,onFocus:this.tabFocusSelected,onBlur:this.tabFocusUnselected}));},_isHotLike:function(){if(!!document.createElementNS&&!!document.createElementNS('http://www.w3.org/2000/svg','svg').createSVGRect)return (this.props.stickerID===m.HOT_LIKE_SMALL_STICKER_ID||this.props.stickerID===m.HOT_LIKE_MEDIUM_STICKER_ID||this.props.stickerID===m.HOT_LIKE_LARGE_STICKER_ID);return false;}});f.exports=y;},null);
__d("StickerUtils",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={getScaledDimensions:function(i,j,k){var l,m,n;if(j>i){n=k/j;l=i*n;m=j*n;}else{n=k/i;l=i*n;m=j*n;}return {height:Math.round(l),width:Math.round(m)};},capitalizeWords:function(i){var j=i.split(" ");for(var k=0;k<j.length;k++){var l=j[k].charAt(0).toUpperCase();j[k]=l+j[k].substr(1);}return j.join(" ");}};f.exports=h;},null);
__d('MercuryAttachmentRenderer',['MercuryAttachmentAudioClip.react','ChatAttachmentAttribution.react','EmojiLikeUtils','EmojiSticker.react','ImmutableObject','MercuryAttachment','MercuryAttachmentFile.react','MercuryAttachmentPhoto.react','MercuryAttachmentPhotoGrid.react','MercuryAttachmentVideo.react','MercuryMessageInfo','MercuryShareAttachment.react','MercuryShareAttachmentRenderLocations','MessengerHotLikeUtils','React','Sticker.react','StickerAssetType','StickerConstants','StickerImages','StickerUtils','cx','XStickerAssetController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';if(c.__markCompiled)c.__markCompiled();var da={renderFile:function(ea,fa){return (v.createElement(n,{name:ea.name,open_url:fa?null:ea.open_url,rel:ea.rel,type:ea.icon_type,url:ea.url}));},renderAudioClip:function(ea,fa){var ga=ea.metadata.duration/1000,ha=100,ia=fa?160:400,ja=100;if(ga>=5)ja=(1-Math.pow(10,(ga-5)/-30))*(ia-ha)+ha;return [v.createElement(h,{duration:ea.metadata.duration/1000,key:'audioClip',rootClassName:m.hasAttribution(ea)?"_4yjw":'',showHelp:false,src:ea.url,width:ja}),v.createElement(i,{attachment:new l(ea),key:'audioAttribution'})];},renderVideo:function(ea,fa,ga,ha){var ia=fa?ea.metadata.chat_size:ea.metadata.inbox_size,ja=fa?ea.metadata.chat_preview:ea.metadata.inbox_preview;return (v.createElement(q,{attachment:new l(ea),duration:ea.metadata.duration,isInbound:r.isInbound(ga),isChat:fa,name:ea.name,onAttachmentLoad:ha,pageID:ea.metadata.pageid,thumbSize:ia,thumbnail:ja,videoSize:ea.metadata.dimensions,videoID:ea.metadata.fbid,videoURI:ea.url}));},constructStickerComponent:function(ea,fa,ga,ha,ia){var ja=ha?'chatScrolled/':'messengerScrolled/';ja+=ea.thread_id;if(!fa){fa=u.getMetadataForHotLike(ea.sticker_id);if(!fa){var ka=z.getSticker(ea.sticker_id),la=Object.assign({},ka),ma=ka?aa.getScaledDimensions(ka.height,ka.width,y.THREAD_SIZE):{height:y.THREAD_SIZE,width:y.THREAD_SIZE},na=ma.height,oa=ma.width;la.height=na;la.width=oa;la.stickerID=ea.sticker_id;la.spriteURI='';la.spriteURI2x='';la.paddedSpriteURI='';la.paddedSpriteURI2x='';fa=la;}}var pa=null;if(fa.stickerID){pa=fa.stickerID.toString();}else if(ea.sticker_id)pa=ea.sticker_id.toString();var qa=null;if(fa.packID)qa=fa.packID.toString();var ra=ca.getURIBuilder().setInt('sticker_id',pa),sa=null,ta=null;if(window.devicePixelRatio&&window.devicePixelRatio>1){ta=fa.paddedSpriteURI2x;sa=fa.spriteURI2x;}else{ta=fa.paddedSpriteURI;sa=fa.spriteURI;}return (v.createElement(w,{animationTrigger:'hover',className:'mvs',frameCount:fa.frameCount||1,frameRate:fa.frameRate||83,framesPerCol:fa.framesPerCol||1,framesPerRow:fa.framesPerRow||1,onAttachmentLoad:ia,onStickerClick:ga,packID:qa,paddedSpriteURI:ta,sourceHeight:fa.height,sourceURI:ra.setEnum('image_type',x.IMAGE).getURI().toString(),sourceWidth:fa.width,spriteURI:sa,stickerID:pa,subscribedThreadID:ja}));},constructEmojiLikeAttachment:function(ea,fa){var ga=j.getURI(fa.body,ea.size);return (v.createElement(k,{className:"_2poz _ui9",key:'sticker:'+fa.message_id,emoji:fa.body,sourceURI:ga}));},renderPhotoAttachments:function(ea,fa,ga,ha){var ia=ea.length;if(!ia)return null;if(ia===1){var ja=ea[0],ka=m.resizeContain({width:ga,height:ga},{width:ja.preview_width,height:ja.preview_height});return (v.createElement('div',{className:"_55pk"+(' '+"_59go")+(m.hasAttribution(ja)?' '+"_4yjw":'')},v.createElement(o,{image:ja,width:ka.width,height:ka.height,message:fa,onAttachmentLoad:ha,round:true}),v.createElement(i,{attachment:new l(ea[0])})));}return (v.createElement('div',{className:"_55pk"},v.createElement(p,{images:ea,size:ga,message:fa})));},sortAttachmentsStablyByType:function(ea){var fa=[m.isPhotoAttachment,m.isShareAttachment,m.isFileAttachment,m.isErrorAttachment];fa.push(function(ha){return true;});var ga=fa.map(function(ha){return [];});ea.forEach(function(ha){for(var ia=0;ia<fa.length;ia++)if(fa[ia](ha)){ga[ia].push(ha);break;}});return Array.prototype.concat.apply([],ga);},constructStoryBasedShareAttachment:function(ea,fa,ga,ha,ia){var ja=ga?t.CHAT:t.WEB_INBOX;return (v.createElement('div',{className:!!ea.body&&ga?"_r38":''},v.createElement(s,{attachment:fa.share,location:ja,maxWidth:ha,messageID:ea.message_id,onComponentLoaded:ia,thread_id:ea.thread_id})));}};f.exports=da;},null);
__d('MercuryAttachments.react',['MercuryAttachmentRenderer','ImmutableObject','MercuryAttachment','MercuryAttachmentMalicious.react','MercuryAttachmentError.react','MessengerHotLikePreview.react','React','SubscriptionsHandler','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=n.PropTypes,r=n.createClass({displayName:'MercuryAttachments',propTypes:{attachments:q.array.isRequired,customLike:q.object,maxWidth:q.number.isRequired,message:q.instanceOf(i).isRequired,isChat:q.bool,onAttachmentLoad:q.func,onStickerClick:q.func,onProgressBarLoad:q.func},getDefaultProps:function(){return {isChat:false,onAttachmentLoad:p,onStickerClick:p};},_onAttachmentLoad:function(s){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(s);},_subscriptionsHandler:null,componentDidMount:function(){this._subscriptionsHandler=new o();},componentWillUnmount:function(){this._subscriptionsHandler&&this._subscriptionsHandler.release();},_renderAttachment:function(s){if(j.isStickerAttachment(s)){return h.constructStickerComponent(this.props.message,this.props.attachments[0].metadata,this.props.onStickerClick,this.props.isChat,this._onAttachmentLoad);}else if(j.isEmojiLikeAttachment(s)){return h.constructEmojiLikeAttachment(this.props.attachments[0],this.props.message);}else if(j.isVoiceAttachment(s)){return h.renderAudioClip(this.props.attachments[0],this.props.isChat);}else if(j.isVideoAttachment(s)){return h.renderVideo(s,this.props.isChat,this.props.message,this._onAttachmentLoad);}else if(j.isShareAttachment(s)){return h.constructStoryBasedShareAttachment(this.props.message,s,this.props.isChat,this.props.maxWidth,this._onAttachmentLoad);}else if(j.isFileAttachment(s)){return h.renderFile(s,this.props.isChat);}else if(j.isErrorAttachment(s))return n.createElement(l,null);return n.createElement(k,null);},render:function(){if(this.props.message.is_like_preview)return (n.createElement(m,{isChat:this.props.isChat,key:'hlp:'+this.props.message.like_preview_since,since:this.props.message.like_preview_since,customLike:this.props.customLike}));if(this.props.attachments.length===0)return n.createElement('div',this.props);var s=h.renderPhotoAttachments(this.props.attachments.filter(j.isPhotoAttachment),this.props.message,this.props.maxWidth,this._onAttachmentLoad),t=h.sortAttachmentsStablyByType(this.props.attachments.filter(function(u){return !j.isPhotoAttachment(u);})).map((function(u,v){return (n.createElement('span',{key:v},this._renderAttachment(u)));}).bind(this));return (n.createElement('div',this.props,s,t,this.props.renderProgressBar&&this.props.renderProgressBar()));}});f.exports=r;},null);
__d('WebMessengerStateConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete'}};f.exports=h;},null);
__d('WebMessengerOldToNewPermalink',['WebMessengerPermalinkConstants','WebMessengerStateConstants'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(o){if(!k(o))return o;l(o);n(o);m(o);return o;}function k(o){var p=o.getQueryData();if(p.sk)switch(p.sk){case 'inbox':o.setPath(h.BASE_PATH);o.removeQueryData('sk');break;case 'other':o.setPath(h.OTHER_PATH);o.removeQueryData('sk');break;default:return false;}return true;}function l(o){var p=o.getQueryData();switch(p.action){case 'read':if(!p.tid){o.addQueryData({action:i.DETAIL.RECENT_MESSAGES});}else o.removeQueryData('action');break;}}function m(o){var p=o.getQueryData();if(p.tid){o.setPath(h.getURIPathForThreadID(p.tid,o.getPath()));o.removeQueryData('tid');}}function n(o){var p=o.getQueryData();if(!o.getPath().match(h.SEARCH_POSTFIX_PATH)&&p.action!=i.DETAIL.SEARCH_SNIPPET&&!p.mid){var q=p.query;if(p.query){var r=/\bis:(archived|spam)\b(.*)/,s=r.exec(p.query);if(s){switch(s[1]){case 'archived':o.setPath(h.ARCHIVED_PATH);break;case 'spam':o.setPath(h.SPAM_PATH);break;}var t=p.query.substr(0,p.query.length-s[0].length),u=s[2];q=(t.trim()+' '+u.trim()).trim();}}if(p.thread_query){o.setPath(o.getPath()+h.SEARCH_POSTFIX_PATH);o.setQueryData({query:p.thread_query});}else if(q){o.setPath(o.getPath()+h.SEARCH_POSTFIX_PATH);o.addQueryData({query:q});}else o.removeQueryData('query');}}f.exports=j;},null);
__d('WebMessengerStateStore',['MercuryAssert','PresenceState'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=null;function k(){var m=i.get();if(m&&m.wml)return m.wml;return {};}i.registerStateStorer(function(m){if(j)m.wml=j;j=null;});var l={getLastSeenThreadID:function(){var m=k();return m.thread_id||null;},getLastSeenFolder:function(){var m=k();return m.folder||null;},setLastSeen:function(m,n){n&&h.isThreadID(n);j={folder:m,thread_id:n||null};i.doSync();}};f.exports=l;},null);
__d('WebMessengerPermalinks',['MercuryAPIArgsSource','MercuryConfig','MercuryFilters','MercuryIDs','MercuryParticipants','MercuryParticipantTypes','MercuryTypeaheadConstants','MessagingTag','WebMessengerOldToNewPermalink','WebMessengerPermalinkConstants','WebMessengerStateConstants','WebMessengerStateStore','Token','URI','WebMessengerPreferences','WWWBase','MercuryUnreadState','createCancelableFunction','goURI','isWebMessengerURI','MercuryThreadIDMap','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba=c('MercuryThreadIDMap').get(),ca=c('MercuryThreads').get(),da='(/|\\?|$)';c('MercuryParticipants');c('MercuryIDs');var ea={getDefaultURI:function(){var ra=new u(w.uri);ra.setPath(q.BASE_PATH);return ra;},goNextURI:function(ra,sa,ta,ua){if(na(ra,sa,ta)){var va=ea.getURI(ra,sa,ta);z(va,false,ua);return true;}return false;},getURI:function(ra,sa,ta){var ua=ea.getDefaultURI();if(!ra||!sa||!ta)return ua;switch(ta.folder){case o.OTHER:ua.setPath(q.OTHER_PATH);break;case o.ACTION_ARCHIVED:ua.setPath(q.ARCHIVED_PATH);break;case o.SPAM:ua.setPath(q.SPAM_PATH);break;case o.PENDING:i.CoreGraphEnabled&&ua.setPath(q.PENDING_PATH);break;}if(ta.filter&&ta.filter!=j.ALL)ua.addQueryData({filter:ta.filter});var va;switch(ra){case r.MASTER.SEARCH:va=false;ua.setPath(ua.getPath()+q.SEARCH_POSTFIX_PATH);break;}switch(sa){case r.DETAIL.COMPOSE_MAIN:case r.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case r.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ua.setPath(ua.getPath()+q.COMPOSE_POSTFIX_PATH);va=false;break;case r.DETAIL.RECENT_MESSAGES:va=!ta.thread_id;break;case r.DETAIL.SEARCH_CONTEXT:case r.DETAIL.SHARED_PHOTOS:va=false;break;default:va=true;break;}if(va)ua.addQueryData({action:sa});if(ta.thread_id){var wa=k.getUserIDFromThreadID(ta.thread_id),xa=wa&&l.getNow(k.getParticipantIDFromUserID(wa));if(xa&&xa.type!==m.EVENT){var ya=xa&&xa.vanity||wa;ua.setPath(q.getURIPathForIDOrVanity(ya,ua.getPath()));}else{var za=ba.getServerIDFromClientIDNow(ta.thread_id),ab=za?za:ta.thread_id;ua.setPath(q.getURIPathForThreadID(ab,ua.getPath()));}}if(ta.query)ua.addQueryData({query:ta.query});if(ta.message_query)ua.addQueryData({mquery:ta.message_query});if(ta.message_id)ua.addQueryData({mid:ta.message_id});if(ta.reuse_composer)ua.addQueryData({rc:true});if(ta.isStandaloneMode)ua.addQueryData({standalone:true});return ua;},processURI:function(ra,sa){ra=p(ra);if(!aa(ra))return sa(false);var ta,ua=oa(ra),va=!ua.master_state||!ua.detail_state;if(va){ta=pa(ra);}else{ta={data:{folder:la(ra),filter:ma(ra)},redirect:false,master_state:ua.master_state,detail_state:ua.detail_state};if(ra.getQueryData().rc)ta.data.reuse_composer=true;ta=ia(ra,ta);}ta.data.isStandaloneMode=ra.getQueryData().standalone;if(va)return sa(ta);switch(ua.detail_state){case r.DETAIL.RECENT_MESSAGES:return ka(ra,ta,sa);case r.DETAIL.COMPOSE_MAIN:return fa(ra,ta,sa);case r.DETAIL.SEARCH_SNIPPET:return ja(ra,ta,sa);case r.DETAIL.SEARCH_CONTEXT:return ka(ra,ta,function(wa){ja(ra,wa,function(xa){ha(ra,xa,sa);});});}ta.redirect=true;ta.detail_state=null;return sa(ta);}};function fa(ra,sa,ta){var ua=null;if(ra.getQueryData().to)ua=[].concat(ra.getQueryData().to);ta(ga(ua,sa));}function ga(ra,sa){if(ra){sa.data.new_tokens=[];ra.forEach(function(ta){var ua=l.getNow(k.getParticipantIDFromUserID(ta));if(ua){var va={uid:ta,text:ua.name,type:n.USER_TYPE};sa.data.new_tokens.push(new t(va));}});}sa.data.start=true;return sa;}function ha(ra,sa){var ta=ra.getQueryData().mid;if(ta){sa.data.message_id=ta;}else sa.redirect=true;return sa;}function ia(ra,sa){var ta=ra.getQueryData().query;sa.data.query=ta;return sa;}function ja(ra,sa,ta){var ua=ra.getQueryData().mquery;sa.data.message_query=ua;ta(sa);}function ka(ra,sa,ta){var ua=q.getThreadIDFromURI(ra);if(ua){var va=k.isValidThreadID(ua)?ua:ba.getClientIDFromServerIDNow(ua);if(va){sa.data.thread_id=va;}else sa.redirect=true;}else{var wa=q.getUserIDOrVanity(ra.getPath());if(wa){var xa=l.getIDFromVanityOrFBID(wa);if(!xa){if(!sa.waiting){sa.waiting=true;sa.retry=y(function(){ka(ra,sa,ta);});l.addListener('change',sa.retry);ta(sa);}return;}var ya=xa&&ca.getCanonicalThreadToParticipant(xa,null,h.WEBMESSENGER);if(ya){delete sa.waiting;if(sa.retry)sa.retry.cancel();if(ya.timestamp){sa.data.thread_id=ya.thread_id;}else{sa.detail_state=r.DETAIL.COMPOSE_MAIN;sa=ga([k.getUserIDFromParticipantID(xa)],sa);}}else sa.redirect=true;}}ta(sa);}function la(ra,sa){var ta=ra.getPath();if(ta.match('^'+q.ARCHIVED_PATH+da))return o.ACTION_ARCHIVED;if(ta.match('^'+q.OTHER_PATH+da))return o.OTHER;if(ta.match('^'+q.SPAM_PATH+da))return o.SPAM;if(i.CoreGraphEnabled&&ta.match('^'+q.PENDING_PATH+da))return o.PENDING;if(sa!==undefined)return sa;return o.INBOX;}function ma(ra){return ra.getQueryData().filter||j.ALL;}function na(ra,sa,ta){if(sa===r.DETAIL.SEARCH_CONTEXT||sa===r.DETAIL.SEARCH_THREAD_SNIPPET||sa===r.DETAIL.SHARED_PHOTOS)return false;if(ta&&ta.no_uri===true){delete ta.no_uri;return false;}var ua=sa==r.DETAIL.COMPOSE_MAIN||sa==r.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||sa==r.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(ua&&(!ta.start||ta.new_tokens))return false;if(!ra||!sa||!ta)return true;if(ta.bug_reporting_enabled)return false;return !ta.message_action;}function oa(ra){var sa={},ta=ra.getPath(),ua=ra.getQueryData(),va=ta.match(q.BASE_PATH+'(/[^/]+)?'+q.SEARCH_POSTFIX_PATH+da);sa.master_state=va&&ua.query?r.MASTER.SEARCH:r.MASTER.RECENT_THREADS;if(ua.action){sa.detail_state=ua.action;return sa;}if(ta.match('(?:'+q.BASE_PATH+'|'+q.OTHER_PATH+')'+'(/[^/]+)?'+q.COMPOSE_POSTFIX_PATH+da)){sa.detail_state=r.DETAIL.COMPOSE_MAIN;return sa;}if(ta.match(q.TID_POSTFIX_PARTIAL_PATH)||q.getUserIDOrVanity(ta)){if(ua.mid&&ua.mquery){sa.detail_state=r.DETAIL.SEARCH_CONTEXT;}else sa.detail_state=r.DETAIL.RECENT_MESSAGES;}else if(ua.mquery)sa.detail_state=r.DETAIL.SEARCH_SNIPPET;return sa;}function pa(ra){var sa=la(ra,null)||s.getLastSeenFolder(),ta=s.getLastSeenThreadID()||qa(sa||o.INBOX),ua=x.get();if(sa===o.OTHER&&ua.getUnreadCount(sa)===0){var va=o.INBOX;if(ua.exceedsMaxCount(va)||ua.getUnreadCount(va)>0)sa=va;}var wa={redirect:!!ta||!!sa,replace:true,master_state:r.MASTER.RECENT_THREADS,detail_state:r.DETAIL.RECENT_MESSAGES,data:{folder:sa||o.INBOX,filter:j.ALL,thread_id:ta}};return wa;}function qa(ra){var sa=v.lastReadThreadForFolder[ra];if(sa){var ta=sa.other_user_fbid||sa.thread_fbid;return ba.getClientIDFromServerIDNow(ta);}else return null;}f.exports=ea;},null);
__d('WebMessengerStateManager',['Arbiter','CurrentUser','Dialog','Focus','JSLogger','MercuryFilters','MessagingTag','WebMessengerPermalinks','WebMessengerStateConstants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=l.create('wm_state_manager'),r=i.getID(),s=false,t=Object.assign(new h(),{getCurrentUserID:function(){return r;},getCurrentMasterState:function(){return w;},getCurrentDetailState:function(){return x;},getCurrentStateData:function(){return y;},getStandaloneMode:function(){return s;},setUserID:function(aa){r=aa||i.getID();},setStandaloneMode:function(aa){s=Boolean(aa);},updateMasterState:function(aa,ba){t.updateAllStates(aa,x,ba);},updateDetailState:function(aa,ba){t.updateAllStates(w,aa,ba);},updateAllStates:function(aa,ba,ca){for(var da=0;da<z.length;da++)if(z[da]){var ea=z[da](aa,ba,ca);if(ea){q.log('confirmation_dialog',{master_state:w,detail_state:x,data:y,new_master_state:aa,new_detail_state:ba,new_data:ca});ea.setHandler(u.bind(null,aa,ba,ca)).show();var fa=ea.getButtonElement(j.OK.label);fa&&k.set(fa);return;}}u(aa,ba,ca);},updateStateOnURI:function(aa,ba,ca){v(aa,ba,ca);},registerConfirmationBeforeStateUpdate:function(aa){var ba=z.length;z.push(aa);return ba;},unregisterConfirmationBeforeStateUpdate:function(aa){delete z[aa];}});function u(aa,ba,ca){if(!ca.folder)ca.folder=y.folder;if(!ca.filter)ca.filter=y.filter;ca.isStandaloneMode=t.getStandaloneMode();if(!o.goNextURI(aa,ba,ca))v(aa,ba,ca);}function v(aa,ba,ca){w=aa;x=ba;y=ca;var da=babelHelpers._extends({},y);da.new_tokens=[];(y.new_tokens||[]).forEach(function(ea){da.new_tokens.push(ea.getInfo());});da.new_tokens=[];q.log('state_updated',{master_state:w,detail_state:x,data:da});t.inform(p.STATE_CHANGE_EVENT);}var w=p.MASTER.RECENT_THREADS,x=p.DETAIL.RECENT_MESSAGES,y={thread_id:null,folder:n.INBOX,filter:m.ALL},z=[undefined];f.exports=t;},null);
__d('WebMessengerAdsControl',['AdsMouseStateStore','Animation','Arbiter','WebMessengerConstants','CSS','CurrentUser','DOM','EgoAdsObjectSet','Event','KeyedCallbackManager','MercuryIDs','UIPagelet','URI','UserActivity','Vector','WebMessengerAdsConfig','WebMessengerStateManager','WebMessengerSubscriptionsHandler','csx','cx','getOrCreateDOMID','shield','throttle','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){if(c.__markCompiled)c.__markCompiled();var ea=c('MercuryThreads').get(),fa=600,ga=k.ADS_ROTATION_INTERVAL_PASSIVE,ha=k.ADS_ROTATION_THRESHOLD_ACTIVE,ia=k.MAX_ADS,ja=2,ka=165,la=h.STATES,ma='data-height',na=new q(),oa='webMessengerAdsStage',pa=0,qa={};function ra(){}Object.assign(ra,{init:function(){this._ads=new o();this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));y.addSubscriptions(u.subscribe(ca(this._refreshIfReady,this)),j.subscribe('footerLoaded',function(){na.setResource('footer',1);}),j.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide','minisidebar/show'],this._sideBarChanged.bind(this)),na);return this;},setContainer:function(ya){na.setResource('container',ya);this._container=ya;},setTrackingCodes:function(ya){na.setResource('codes',ya);},getTrackingCodes:function(){return na.getResource('codes');},updateRhcID:function(){var ya=n.scry(this._container,'div.ego_section')[0];if(!ya)return;h.updateRhcID(ba(ya));},start:function(){this._stage=n.create('div',{id:oa,className:"_2rn"});this._ego=n.find(this._container,"._81");n.insertAfter(this._ego,this._stage);this.updateRhcID();this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));y.addSubscriptions(p.listen(window,'resize',da(this.draw,100,this)),p.listen(this._ego,'mouseenter',ca(this._mouseEvent,this,true)),p.listen(this._ego,'mouseleave',ca(this._mouseEvent,this,false)));},stateChanged:function(ya,za){ya=ya||{};za=za||{};if(ya.thread_id&&za.thread_id&&za.thread_id!==ya.thread_id)this._refreshIfReady(true);},draw:function(){var ya=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!ya)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads.init(wa(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var ya=wa(this._stage);if(!this._lastMousedOnAds&&ya.length&&!this._focusedOnAds()){n.empty(this._ego);while(this._stage.childNodes.length)n.appendContent(this._ego,this._stage.firstChild);this._ads.init(ya);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(ya,za){var ab=wa(ya);this._loadingCount=ab.length;if(!this._loadingCount){this._lastRefresh=Date.now()-ga/2;this._pageletInProgress=false;return;}var bb=(function(cb){va(cb);if(--this._loadingCount<=0)za();}).bind(this);ab.forEach((function(cb){function db(){setTimeout(bb.bind(null,cb),0);}var eb=n.scry(cb,'img.img')[0];if(!eb||eb.complete){db();}else p.listen(eb,{load:db,error:db,abort:db});}).bind(this));},_adjustAdsToFit:function(){this._drawCount++;var ya=v.getViewportDimensions().y,za=ya-this._footerHeight-ka,ab=za,bb=0;while(ab>0&&bb<this._ads.getCount()){ab-=ua(this._ads.getUnit(bb));if(ab>=0)bb++;}bb=Math.max(bb,ja);for(var cb=0;cb<this._ads.getCount();cb++)ta(this._ads.getUnit(cb),cb>=bb);l.conditionShow(this._ego,bb);l.addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var db=n.scry(this._container,'.ego_section');db.forEach(function(eb){sa(eb,n.scry(eb,'[data-onscreen]').length);});sa(this._container,true);this._registerImpressions(bb);this._registerHoldoutImpressions(za);j.inform('WebMessengerAdsControl/adjustAds');},_waitOn:function(ya,za){na.executeOrEnqueue(ya,za);},_mouseEvent:function(ya){this._lastMousedOnAds=ya;},intentShown:function(){if(!w.stateRefresh)return false;var ya=h.getState();switch(ya){case la.STATIONARY:return !w.refreshOnStationary;case la.INTENT:case la.HOVER:return true;default:return false;}},_focusedOnAds:function(){return n.contains(this._container,document.activeElement);},_refreshIfReady:function(ya){var za=ya?ha:ga;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this.intentShown()||this._lastRefresh+za>Date.now())return;na.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=s.loadFromEndpoint('WebEgoPane',oa,{pid:43,data:[m.getID(),ia,++pa,xa()]},{crossPage:true,bundle:false,handler:this.onLoadHandler.bind(this)});},onLoadHandler:function(){if(!w.fade)return;new i(this._container).from('opacity',0).to('opacity',1).duration(fa).go();},_updateFooterHeight:function(){l.hide(this._ego);this._footerHeight=v.getElementDimensions(this._container).y;l.show(this._ego);},_registerImpression:function(ya){var za=this.getTrackingCodes();if(!za||!za[ya])return null;var ab=n.create('iframe',{src:new t('/ai.php').addQueryData({aed:za[ya]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ab.setAttribute('aria-hidden','true');n.appendContent(this._container,ab);return ab;},_registerImpressions:function(ya){var za=this.getTrackingCodes(),ab=qa;qa={};for(var bb=0;bb<ya;bb++){if(!this._ads.getUnit(bb))continue;var cb=n.scry(this._ads.getUnit(bb),"div._4u8");if(!cb.length)continue;var db=cb[0].getAttribute('data-ad'),eb=JSON.parse(db).adid;if(eb in ab){qa[eb]=ab[eb];delete ab[eb];}else{if(!za||!za[eb])continue;var fb=this._registerImpression(eb);delete za[eb];if(fb)qa[eb]=fb;}}for(eb in ab)n.remove(ab[eb]);},_registerHoldoutImpressions:function(ya){var za=this._ads.getHoldoutAdIDsForSpace(ya,ua);if(za)za.forEach(this._registerImpression.bind(this));},_sideBarChanged:function(ya,za){if(ya=='sidebar/initialized')na.setResource('sidebar',1);this._initializedAds&&this.draw();}});function sa(ya,za){l.conditionClass(ya,"_2rn",!za);}function ta(ya,za){l.conditionClass(ya,"_22r",za);ya.setAttribute('aria-hidden',za?'true':'false');if(za){ya.removeAttribute('data-onscreen');}else ya.setAttribute('data-onscreen','1');}function ua(ya){if(!ya)return 0;var za=ya.getAttribute(ma)||va(ya);return parseInt(za,10);}function va(ya){var za=v.getElementDimensions(ya).y;ya.setAttribute(ma,za);return za;}function wa(ya){return n.scry(ya,'div.ego_unit');}function xa(){var ya=x.getCurrentStateData();if(ya.thread_id){var za=ea.getThreadMetaNow(ya.thread_id);if(za)return za.participants.map(function(ab){return r.getUserIDFromParticipantID(ab);}).filter(function(ab){return ab&&ab!=m.getID();});}return [];}f.exports=ra;},null);
__d('WebMessengerActionsMenuItem',['CSS','MenuItem','WebMessengerStateManager'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;k=babelHelpers.inherits(m,i);l=k&&k.prototype;function m(n){'use strict';n.href=n.href||'#';l.constructor.call(this,n);this.setOnClickHandler(this.handleMenuItemClick);this.showFn=this._data.should_show_fn;this.hasAction=(function(){return !this._data.hideManually;}).bind(this);}m.prototype.handleMenuItemClick=function(){'use strict';var n=j.getCurrentStateData().thread_id;n&&this._data.onclick(n);};m.prototype.updateShownState=function(n){'use strict';if(this.showFn){this._isHidden=!this.showFn(n);if(this._root)h.conditionShow(this._root,!this._isHidden);}};m.prototype.isShown=function(n){'use strict';var o=this.showFn?this.showFn(n):true;return o;};m.prototype.render=function(){'use strict';var n=l.render.call(this);if(this._isHidden)h.hide(n);return n;};f.exports=m;},null);
__d('MercuryDataSources',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={add:function(j,k){h[j]=k;},get:function(j){!h[j];return h[j];}};f.exports=i;},null);
__d('MercuryTypeahead',['Event','ArbiterMixin','DOM','DOMDimensions','Input','Keys','MercuryTypeaheadTemplates','Tokenizer','Typeahead','TypeaheadCore','WorkModeConfig','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=function(u,v){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=u;this._view=v;};Object.assign(t.prototype,i);Object.assign(t.prototype,{setPlaceholder:function(u){this._placeholder=u;return this;},setExcludedParticipantsFromThreadMeta:function(u){if(!u)return;if(!u.former_participants||r.is_work_user){this.setExcludedParticipants(u.participants);return;}var v=u.former_participants.filter(function(w){return w.is_friend===false;}).map(function(w){return w.id;});this.setExcludedParticipants(v.concat(u.participants));},setExcludedParticipants:function(u){this._exclusions=[];u.forEach((function(v){var w=v.indexOf(':');if(v.substr(0,w)=='fbid')this._exclusions.push(v.substr(w+1));}).bind(this));return this;},setViewNodeID:function(u){this._viewNodeOrID=u;},setViewNode:function(u){this._viewNodeOrID=u;},setFullWidthView:function(u){var v=j.create('div',{className:"_4ck uiTypeaheadView"});j.setContent(u,v);this.setViewNode(v);},setViewOption:function(u,v){this._viewOptions[u]=v;},addTokenizerBehavior:function(u){this._tokenizerBehaviors.push(u);},build:function(u){if(this._domElement)return;var v=n[':fb:mercury:tokenizer'].build(),w=n[':fb:mercury:typeahead'].build();this._domElement=v.getRoot();j.appendContent(this._domElement,w.getRoot());var x=w.getNode('textfield');l.setPlaceholder(x,this._placeholder);x.setAttribute('data-placeholder',this._placeholder);this._input=x;var y={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},z={ctor:q,options:{setValueOnSelect:true}};this._typeahead=new p(this._dataSource,y,z,w.getRoot());this._typeahead.init();var aa={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new o(this._domElement,this._typeahead);this._tokenizer.init(v.getNode('tokenarea'),'participants',[],aa);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',(function(){this.inform('resize');}).bind(this));h.listen(x,'focus',(function(){this._resetDataSource();this._typeahead.init();}).bind(this));h.listen(this._domElement,'click',this.focus.bind(this));h.listen(x,'keydown',this.keydown.bind(this));this._heightPrev=k.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var u=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(v){u.push('fbid:'+v);});return u;},getTokens:function(){var u=[];if(this._tokenizer)u=this._tokenizer.getTokens();return u;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==m.ESC){if(l.isEmpty(this._input)){var u=this._tokenizer.getLastToken();if(u&&u.isRemovable()){this._tokenizer.removeToken(u);event.stopPropagation();return;}}else{this._typeahead.getCore().reset();event.stopPropagation();return;}this.inform('esc-pressed');return;}if(l.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===m.RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});f.exports=t;},null);
__d('MercuryTypeaheadRenderer',['Event','Badge.react','CSS','DOM','Image.react','MercuryTypeaheadConstants','MercuryParticipantsConstants','React','ReactDOM','MercuryTypeaheadTemplates','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();function s(u,v){var w;switch(u.type){case m.HEADER_TYPE:w=q[':fb:mercury:typeahead:header'].build();s.renderHeader(w,u);break;case m.USER_TYPE:case m.PAGE_TYPE:w=q[':fb:mercury:typeahead:result'].build();s.renderPerson(w,u);break;default:throw new Error('Unsupported result type: '+u.type);}return w.getRoot();}Object.assign(s,{renderHeader:function(u,v){if(v.disabled){j.hide(u.getRoot());return;}var w=v.getLinkHandler&&v.getLinkHandler();if(w){var x=u.getNode('link');k.setContent(x,v.linkText);h.listen(x,'click',w);}else j.hide(u.getNode('link'));u.setNodeContent('text',v.text);},renderPersonWithBigPhoto:function(u,v){t(u,v,n.BIG_IMAGE_SIZE);},renderPerson:function(u,v){t(u,v,n.IMAGE_SIZE);},renderPage:function(u,v){t(u,v,n.IMAGE_SIZE);}});function t(u,v,w){if(v.photo){var x=o.createElement(l,{width:w,height:w,src:v.photo});p.render(x,u.getNode('image'));}if(v.text){k.setContent(u.getNode('name'),v.text);u.getRoot().setAttribute('aria-label',v.text);}var y=[];if(v.subtext||v.category){if(v.subtext)y.push(v.subtext);if(v.category)y.push(v.category);k.appendContent(u.getNode('snippet'),y.join(" \u00b7 "));}var z=null;if(v.is_verified){z=o.createElement(i,{type:'verified',size:'xsmall'});p.render(z,u.getNode('badge'));}else if(v.is_work_user){z=o.createElement(i,{type:'work',size:'xsmall'});p.render(z,u.getNode('badge'));}if(v.non_employee){if(y.length)k.prependContent(u.getNode('snippet')," \u00b7 ");var aa=k.create('span',{className:"_52l8 highlight"},'(Non-Employee)');k.prependContent(u.getNode('snippet'),aa);}}f.exports=s;},null);
__d('WebMessengerAddPeopleToConversationDialog',['ContextualTypeaheadView','Dialog','DOM','MercuryAPIArgsSource','MercuryDataSources','MercuryIDs','MercuryLogMessageType','MercurySourceType','MercuryTypeahead','MercuryTypeaheadConstants','MercuryTypeaheadRenderer','WebMessengerTemplates','WorkModeConfig','fbt','MercuryMessageObject','MercuryMessageActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=c('MercuryMessageObject').get(),w=c('MercuryMessageActions').get(),x=c('MercuryThreads').get(),y={show:function(aa){var ba=u._("Add People"),ca={};ca[q.FRIEND_TYPE]={uid:q.FRIEND_TYPE,type:q.HEADER_TYPE,disabled:true};ca[q.NON_FRIEND_TYPE]={uid:q.NON_FRIEND_TYPE,text:u._("Other People"),type:q.HEADER_TYPE};var da=new p(l.get('MercuryRecipientsDataSource'),h);da.setViewOption('renderer',r);da.setViewOption('typeObjects',ca);var ea=t.is_work_user?u._("Add colleagues to this chat"):u._("Add friends to this chat");da.setPlaceholder(ea);var fa=[];fa.push({name:'subscribe',label:ba,handler:z.bind(null,aa,da)});fa.push(i.CANCEL);var ga=s[':fb:web-messenger:add-people-dialog'].build(),ha=new i().setTitle(ba).setBody(ga.getRoot()).setButtons(fa).showLoading();x.getThreadMeta(aa,function(ia){da.setFullWidthView(ga.getNode('participantsTypeahead'));da.setExcludedParticipantsFromThreadMeta(ia);da.build();j.appendContent(ga.getNode('participantsTypeahead'),da.getElement());ha.show();da.focus();},k.WEBMESSENGER);}};function z(aa,ba){var ca=ba.getTokens(),da=ca.map(function(ea){return m.getParticipantIDFromUserID(ea.getValue());});if(!da.length)return false;w.send(v.constructLogMessageObject(o.TITAN_WEB,aa,n.SUBSCRIBE,{added_participants:da}),null,k.WEBMESSENGER);return true;}f.exports=y;},null);
__d('WebMessengerEditThreadDialog',['Event','Button','ContextualDialog','CSS','DOM','FileInput','FileInputUploader','Input','InputSelection','LayerFadeOnHide','LayerFadeOnShow','LayerHideOnTransition','MercuryAPIArgsSource','MercuryLogMessageType','MercurySourceType','WebMessengerTemplates','URI','WebMessengerSubscriptionsHandler','csx','cx','MercuryMessageObject','MercuryMessageActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba=c('MercuryMessageObject').get(),ca=c('MercuryMessageActions').get(),da=c('MercuryThreads').get(),ea=':fb:web-messenger:read-view:header:edit-multichat';function fa(){'use strict';var ga=w[ea].build();this._dialog=new j({position:'below',addedBehaviors:[q,r,s]},ga.getRoot());this._saveButton=ga.getNode('saveButton');this._cancelButton=ga.getNode('cancelButton');this._pictureInput=ga.getNode('newPicture');this._uploadButton=ga.getNode('uploadButton');this._uploadingThrobber=ga.getNode('uploadingThrobber');this._uploadedFileDetails=ga.getNode('uploadedFileDetails');this._fileNameNode=ga.getNode('fileName');this._cancelImageButton=ga.getNode('cancelImage');this._threadID=null;var ha=ga.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var ia=l.scry(ga.getRoot(),"._8-9")[0];this._pictureInput=l.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new m(ia,this._uploadButton,this._pictureInput);}var ja=new x('/ajax/mercury/upload.php').setSubdomain('upload').toString();this._uploader=new n(this._pictureInput).setURI(ja).setAllowCrossOrigin(true).setData({images_only:true});y.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),this._uploader.subscribe('failure',this._onFileUploadFailure.bind(this)),h.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),h.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));h.listen(this._saveButton,'click',(function(){this.save(o.getValue(ha));this._dialog.hide();}).bind(this));h.listen(this._cancelButton,'click',(function(){this._dialog.hide();}).bind(this));this._dialog.subscribe('show',(function(){var ka=da.getThreadMetaNow(this._threadID);o.setValue(ha,ka.name);this._resetImageUpload();}).bind(this));this._dialog.subscribe('aftershow',(function(){p.set(ha,0,o.getValue(ha).length);}).bind(this));}fa.prototype.toggleShown=function(ga,ha){'use strict';if(!this._dialog.isShown()){this._dialog.setContext(ga);this._threadID=ha;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};fa.prototype.save=function(ga){'use strict';var ha=null,ia=da.getThreadMetaNow(this._threadID);if(ia)ha=ia.name;if((ga||ha)&&ga!=ha)ca.send(ba.constructLogMessageObject(v.CHAT_WEB,this._threadID,u.THREAD_NAME,{name:ga}),null,t.WEBMESSENGER);if(this._uploadedImage)ca.send(ba.constructLogMessageObject(v.CHAT_WEB,this._threadID,u.THREAD_IMAGE,{image:this._uploadedImage}));};fa.prototype._onFileUploadChange=function(event){'use strict';var ga=o.getValue(event.getTarget());if(ga){i.setEnabled(this._saveButton,false);k.hide(this._uploadButton);k.hide(this._uploadedFileDetails);k.show(this._uploadingThrobber);this._uploader.send();}};fa.prototype._onFileUploadSuccess=function(ga,ha){'use strict';var ia=ha.response.getPayload();this._uploadedImage=ia.metadata[0];l.setContent(this._fileNameNode,this._uploadedImage.filename);k.hide(this._uploadingThrobber);k.hide(this._uploadButton);k.show(this._uploadedFileDetails);i.setEnabled(this._saveButton,true);};fa.prototype._onFileUploadFailure=function(ga,ha){'use strict';i.setEnabled(this._saveButton,true);this._resetImageUpload();};fa.prototype._resetImageUpload=function(){'use strict';this._uploadedImage=null;this._pictureInput.value=null;k.hide(this._uploadingThrobber);k.hide(this._uploadedFileDetails);k.show(this._uploadButton);};f.exports=fa;},null);
__d("ListInputTargetTracker",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){"use strict";this._index=undefined;this._items=[];}h.prototype.getIndex=function(){"use strict";return this._index;};h.prototype.setIndex=function(i){"use strict";this._index=Math.max(0,Math.min(i,this._items.length-1));};h.prototype.getNumItems=function(){"use strict";return this._items.length;};h.prototype.getItem=function(){"use strict";if(this._index!==undefined)return this._items[this._index];};h.prototype.setTargetItem=function(i){"use strict";this.updateIndex(this._items,i);};h.prototype.addItem=function(i){"use strict";this._items.push(i);};h.prototype.removeItemAtIndex=function(i){"use strict";this._items.splice(i,1);};h.prototype.removeItemByValue=function(i){"use strict";var j=this._items.indexOf(i);this.removeItemAtIndex(j);};h.prototype.moveUp=function(){"use strict";if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};h.prototype.moveDown=function(){"use strict";if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};h.prototype.updateIndex=function(i,j){"use strict";this._items=i||[];if(j){var k=this._items.indexOf(j);if(k>=0){this._index=k;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;};f.exports=h;},null);
__d('WebMessengerShortcuts',['BanzaiODS','DialogX','DOM','KeyEventController','LayerHideOnEscape','ListInputTargetTracker','MercuryAPIArgsSource','MessagingTag','Parent','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','UserAgent_DEPRECATED','WebMessengerEvents','arrayContains','csx','cx','fbt','ge','getOrCreateDOMID','shield','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){if(c.__markCompiled)c.__markCompiled();var ca=c('MercuryThreadActions').get(),da=c('MercuryThreads').get(),ea=null,fa=null,ga=null,ha={g:{callback:na,description:y._("Search conversations"),section:'searchAndHelp',uses_meta:true},m:{callback:ma,description:y._("Start a new message"),section:'navigation',uses_meta:true},i:{callback:va.bind(null,o.INBOX),description:y._("Go to Inbox"),section:'navigation',uses_meta:true},u:{callback:va.bind(null,o.OTHER),description:y._("Go to Other"),section:'navigation',uses_meta:true},z:{callback:pa,description:y._("Archive\/unarchive conversation"),otherKeys:['y'],section:'conversation',uses_meta:true},r:{callback:qa,description:y._("Mark message as read\/unread"),section:'conversation',uses_meta:true},UP:{callback:ra,description:y._("Select next conversation"),section:'navigation',uses_meta:false},DOWN:{callback:sa,description:y._("Select previous conversation"),section:'navigation',uses_meta:false},q:{callback:ba(xa),description:y._("Show\/hide keyboard shortcuts"),section:'searchAndHelp',uses_meta:true}},ia={registerGeneralShortcuts:function(){fa=new m();for(var ya in ha){var za=ha[ya],ab=[ya];if(za.otherKeys)ab=za.otherKeys.concat(ab);for(var bb=0;bb<ab.length;bb++)k.registerKey(ab[bb],za.callback,la.bind(null,za.uses_meta));}},updateThreadlistIndex:function(ya,za,ab){ea=ya;if(fa){if(!v(za,ab))ab=null;fa.updateIndex(za,ab);}},openSearchThread:function(){var ya=ua(),za=r.getCurrentMasterState();if(ya&&za==q.MASTER.SEARCH)ea.openSearchThread(ya);},showOrHideShortcuts:xa};function ja(){return t.osx()?'CTRL':'ALT';}function ka(ya){function za(){if(!ga){var ab=j.find(document.body,"._ksg");ga=[];do{ab=ab.parentNode;ga.push(ab);}while(ab&&ab!==document.body);}return ga;}if(!p.bySelector(ya,"._ksg"))if(!v(za(),ya))if(!j.scry(ya,"._5hu2").length)return false;return true;}function la(ya,event,za){if(!k.filterEventTypes(event,za))return false;if(!ka(event.getTarget()))return false;var ab;if(ya)switch(ja()){case 'CTRL':ab='ctrlKey';break;case 'ALT':ab='altKey';break;}var bb=['ctrlKey','metaKey','altKey','shiftKey'];for(var cb=0;cb<bb.length;cb++)if(bb[cb]!==ab&&event[bb[cb]])return false;return !ya||event[ab];}function ma(){h.bumpEntityKey('kbshorts_messenger','kbshorts.compose');r.updateDetailState(q.DETAIL.COMPOSE_MAIN,{start:true});return false;}function na(){h.bumpEntityKey('kbshorts_messenger','kbshorts.search');u.focusAndSelectSearch();return false;}function oa(ya){var za;if(fa.getNumItems()>1){var ab=fa.getIndex();fa.setIndex(ab===0?1:ab-1);za=ua();}ya();r.updateDetailState(q.DETAIL.RECENT_MESSAGES,{folder:r.getCurrentStateData().folder,thread_id:za});if(za)ea._manager.scrollIntoView(z(fa.getItem()),false);}function pa(){h.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_archive');var ya=ua();if(ya){da.getThreadMeta(ya,function(za){if(za.folder==o.SPAM)return;oa(function(){if(za.is_archived){ca.unarchive(za.thread_id);}else ca.archive(za.thread_id);});},n.WEBMESSENGER);return false;}}function qa(){var ya=ua();h.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_read_status');if(ya){da.getThreadMeta(ya,function(za){var ab=!za.unread_count;ab?ca.markUnread(ya):ca.markRead(ya);},n.WEBMESSENGER);return false;}}function ra(){h.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_next');if(fa)if(fa.getIndex()===0){switch(r.getCurrentMasterState()){case q.MASTER.SEARCH:fa.moveUp();ta();ea._manager.scrollToBottom(false);break;default:ea._manager.scrollToTop(false);u.focusSearch();}}else{if(fa.getItem()){fa.moveUp();}else fa.moveDown();ta();}return false;}function sa(){h.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_previous');var ya=r.getCurrentMasterState();if(fa&&(ya!==q.MASTER.RECENT_THREADS||fa.getIndex()<fa.getNumItems()-1)){fa.moveDown();ta();}return false;}function ta(){var ya=ua();if(ya){var za=r.getCurrentMasterState();if(za==q.MASTER.SEARCH){ea.updateKeyboardSelection(ya);u.focusSearch();}else r.updateDetailState(q.DETAIL.RECENT_MESSAGES,{thread_id:ya});if(fa)if(fa.getIndex()===0){ea._manager.scrollToTop(false);}else ea._manager.scrollIntoView(z(fa.getItem()),false);}}function ua(){var ya=fa&&fa.getItem();if(typeof ya==='string'&&ya.indexOf(':')!==-1)return ya.substr(ya.indexOf(':')+1);return null;}function va(ya){if(ya===o.INBOX){h.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_inbox');}else if(ya===o.OTHER)h.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_other');var za=r.getCurrentMasterState(),ab=za==q.MASTER.SEARCH?null:r.getCurrentStateData().thread_id;r.updateMasterState(q.MASTER.RECENT_THREADS,{thread_id:ab,folder:ya});}var wa;function xa(ya){h.bumpEntityKey('kbshorts_messenger','kbshorts.show_or_hide_shortcuts');if(!wa){var za={};for(var ab in ha){var bb=ha[ab];if(!bb.uses_meta)continue;var cb=s[':fb:web-messenger:shortcuts-dialog:row'].build(),db=[ab],eb=[];if(bb.otherKeys)db=bb.otherKeys.concat(db);for(var fb=0;fb<db.length;fb++){var gb=s[':fb:web-messenger:shortcuts-dialog:key'].build();gb.setNodeContent('meta',ja());gb.setNodeContent('key',db[fb]);eb.push(gb.getRoot());}cb.setNodeContent('keys',eb);cb.setNodeContent('description',bb.description);if(!za[bb.section])za[bb.section]=[];za[bb.section].push(cb.getRoot());}var hb=s[':fb:web-messenger:shortcuts-dialog'].build();for(var ib in za)hb.setNodeContent(ib,za[ib]);var jb=j.scry(hb.getRoot(),"._1yw")[0],kb=null;if(jb)kb=aa(jb);wa=new i({modal:true,titleID:kb,width:565},hb.getRoot());wa.enableBehavior(l);}if(wa.isShown()){wa.hide();}else{wa.show();if(typeof ya==='function')wa.subscribeOnce('hide',ya);}return false;}f.exports=ia;},null);
__d("XMessagingLeaveConversationDialogController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/leave_conversation\/",{__asyncDialog:{type:"Int"}});},null);
__d("XNFXStartForMessageThreadController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/nfx\/start_message_thread\/",{thread_fbid:{type:"String",required:true},responsible_fbid:{type:"Int"},av:{type:"Int"},location:{type:"Enum",enumType:1},__asyncDialog:{type:"Int"}});},null);
__d('WebMessengerDetailViewActionsMenuControl',['WebMessengerAddPeopleToConversationDialog','AsyncDialog','AsyncRequest','Bootloader','ChatOpenTab','ContextualDialogArrow','CSS','CurrentUser','WebMessengerDeleteThreadDialog','DOM','WebMessengerEditThreadDialog','Event','FBRTCCore','FBRTCCallabilityStore','Input','Keys','Menu','MenuSeparator','MercuryAPIArgsSource','MercuryIDs','MercuryLogMessageType','MercuryParticipants','MercurySourceType','MercuryThreadInfo','MercuryThreadMuter','MercuryViewer','MessagingTag','MercuryParticipants','Popover','PopoverMenu','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','Toggler','URI','WebMessengerActionsMenuItem','WebMessengerSubscriptionsHandler','XMessagingLeaveConversationDialogController','XUIMenuTheme','XNFXStartForMessageThreadController','MercuryMessengerBlockingUtils','emptyFunction','fbt','goURI','FBRTCVideoCallButtonManager','MercuryBlockedParticipants','MercuryThreadIDMap','MercuryMessageObject','MercuryMessageActions','MercuryThreadActions','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za){if(c.__markCompiled)c.__markCompiled();var ab=c('FBRTCVideoCallButtonManager').module,bb=c('MercuryBlockedParticipants').get(),cb=c('MercuryThreadIDMap').get(),db=c('MercuryMessageObject').get(),eb=c('MercuryMessageActions').get(),fb=c('MercuryThreadActions').get(),gb=c('MercuryThreadInformer').get(),hb=c('MercuryThreads').get();function ib(ad,bd){'use strict';this._rootElement=ad;this._headerControl=bd;this._menuTemplate=oa[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton');this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton');this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton');this._videoCallButton=this._menuTemplate.getNode('videoCallButton');var cd=this._menuTemplate.getNode('actionsButton'),dd=(function(event){if(!this._searchMode){kb(this,true);}else{var ed=v.getValue(this._searchThreadInput);if(ed){var fd=babelHelpers._extends({},na.getCurrentStateData(),{message_query:ed});na.updateDetailState(ma.DETAIL.SEARCH_THREAD_SNIPPET,fd);this._searchThreadInput.focus();}else kb(this,false);}event.kill();}).bind(this);sa.addSubscriptions(gb.subscribe('threads-updated',(function(ed,fd){fd[this._threadID]&&this.updateView();}).bind(this)),s.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){na.updateDetailState(ma.DETAIL.COMPOSE_MAIN,babelHelpers._extends({},na.getCurrentStateData(),{start:true,thread_id:undefined}));}),s.listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===w.ESC){cd.focus();event.preventDefault();}}),s.listen(this._searchThreadButton,'mousedown',dd),s.listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===w.RETURN||event.keyCode===w.SPACE)dd(event);}),s.listen(this._searchThreadButton,'click',xa.thatReturnsFalse),s.listen(this._searchCloseButton,'keydown',(function(event){if(event.keyCode===w.RETURN||event.keyCode===w.SPACE){mb(this);this._menuTemplate.getNode('searchThreadButton').focus();}}).bind(this)),s.listen(this._searchCloseButton,'mousedown',(function(event){mb(this);}).bind(this)),s.listen(this._searchThreadInput,'blur',(function(event){var ed=v.getValue(this._searchThreadInput);if(!ed)kb(this,false);}).bind(this)),s.listen(this._searchThreadInput,'keyup',(function(event){var ed=v.getValue(this._searchThreadInput),fd=babelHelpers._extends({},na.getCurrentStateData(),{message_query:ed});if(event.keyCode==w.RETURN&&ed)na.updateDetailState(ma.DETAIL.SEARCH_THREAD_SNIPPET,fd);if(event.keyCode==w.ESC)v.reset(this._searchThreadInput);}).bind(this)),s.listen(this._videoCallButton,'click',(function(){ab.onCallClicked(this._threadID,'web_messenger');}).bind(this)),u.addListener((function(){ab.updateVideoCallButton(this._videoCallButton,this._threadID);}).bind(this)));this.initItems();q.setContent(this._rootElement,this._menuTemplate.getRoot());}ib.prototype.initItems=function(){'use strict';var ad=this._menuTemplate.getNode('actionsButton'),bd=this._menuTemplate.getNode('newMessageButton'),cd=function(){ad.focus();},dd=function(){bd.focus();};this.menuItems=[];this.menuItems.push({ctor:ra,label:ya._("Add People..."),onclick:ic,should_show_fn:ob},{ctor:ra,label:ya._("Edit Participants..."),onclick:jc,should_show_fn:ob},{ctor:ra,hideManually:true,label:ya._("Edit Conversation Name"),onclick:lc.bind(null,this),should_show_fn:ob},{ctor:ra,hideManually:true,label:ya._("Edit Conversation Picture..."),onclick:lc.bind(null,this),should_show_fn:ob},{ctor:ra,label:ya._("Leave Conversation..."),onclick:kc,should_show_fn:ob},{ctor:y,should_show_fn:ob});this.menuItems.push({ctor:ra,hideManually:true,label:ya._("Open in Chat"),onclick:pb,should_show_fn:l.canOpenTab},{ctor:ra,label:ya._("View Photos in Thread"),onclick:gc},{ctor:ra,label:ya._("Mark as read"),onclick:uc.bind(null,cd),should_show_fn:cc},{ctor:ra,label:ya._("Mark as unread"),onclick:tc.bind(null,cd),should_show_fn:xb(cc)});this.menuItems.push({ctor:y},{ctor:ra,label:ya._("Move to Work Account"),onclick:vb,should_show_fn:ub},{ctor:ra,label:ya._("Archive"),onclick:oc.bind(null,dd),should_show_fn:xb(bc)},{ctor:ra,label:ya._("Unarchive"),onclick:pc.bind(null,dd),should_show_fn:bc},{ctor:ra,label:ya._("Mute Conversation..."),onclick:function(ed){fa.showMuteChangeDialog(ed,ad);},should_show_fn:xb(ea.isMuted)},{ctor:ra,label:ya._("Unmute Conversation"),onclick:lb.bind(null,cd),should_show_fn:ea.isMuted},{ctor:ra,label:ya._("Move to Inbox"),onclick:rb.bind(null,dd,ha.INBOX),should_show_fn:qb.bind(null,ha.OTHER)},{ctor:ra,hideManually:true,label:ya._("Delete Conversation..."),onclick:wb},{ctor:ra,label:ya._("Delete Messages..."),onclick:vc});this.menuItems.push({ctor:y},{ctor:ra,label:ya._("Create Group..."),onclick:rc,should_show_fn:sb},{ctor:ra,label:ya._("Create Event..."),onclick:sc,should_show_fn:tb},{ctor:ra,label:ya._("Block Messages..."),onclick:ec.bind(null),should_show_fn:yb},{ctor:ra,label:ya._("Unblock Messages..."),onclick:mc.bind(null),should_show_fn:zb},{ctor:ra,label:ya._("Report Spam or Abuse..."),onclick:fc.bind(null,cd),should_show_fn:xb(ac)},{ctor:ra,label:ya._("Not Spam"),onclick:hc.bind(null,dd),should_show_fn:ac},{ctor:ra,hideManually:true,label:ya._("Keyboard Shortcuts"),onclick:zc.bind(null,cd)},{ctor:ra,label:ya._("Feedback"),onclick:za.bind(null,'/help/?page=134259426717336')});this._menu=new x(this.menuItems,{theme:ua});this._popover=new ka(new ja(ad.parentNode,ad,[m],{alignh:'right'}),ad,this._menu);nb((function(ed){if(!ed)return;var fd=[{ctor:y},{ctor:ra,label:'Enable bug reporting',onclick:wc.bind(null,cd),should_show_fn:xb(dc)},{ctor:ra,label:'Disable bug reporting',onclick:xc.bind(null,cd),should_show_fn:dc}];Array.prototype.push.apply(this.menuItems,fd);fd.forEach(function(gd){this._menu.addItem(new gd.ctor(gd));},this);}).bind(this));};ib.prototype.hideView=function(){'use strict';n.hide(this._rootElement);};ib.prototype.updateView=function(){'use strict';this.hideView();var ad=na.getCurrentDetailState(),bd=false,cd=false,dd=false,ed=false,fd=false,gd=false;switch(ad){case ma.DETAIL.COMPOSE_MAIN:case ma.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case ma.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:jb(this);this._threadID=null;break;case ma.DETAIL.RECENT_MESSAGES:case ma.DETAIL.SEARCH_CONTEXT:if(this._state!==ad)jb(this);var hd=na.getCurrentStateData().thread_id;bd=true;if(this._searchMode&&this._threadID===hd){ed=true;}else{jb(this);cd=true;dd=true;}this._threadID=hd;if(this._threadID)fd=true;break;case ma.DETAIL.SEARCH_THREAD_SNIPPET:var id=na.getCurrentStateData();v.setValue(this._searchThreadInput,id.message_query);this._threadID=id.thread_id;bd=true;ed=true;gd=true;break;case ma.DETAIL.SHARED_PHOTOS:var jd=na.getCurrentStateData();this._threadID=jd.thread_id;bd=true;cd=true;dd=true;fd=true;break;default:jb(this);bd=true;cd=true;this._threadID=null;break;}this._state=ad;n.conditionShow(this._searchThreadInput,ed);n.conditionShow(this._searchThreadButton,fd);n.conditionShow(this._searchCloseButton,gd);n.conditionShow(this._newMessageButton,cd);n.conditionShow(this._rootElement,bd);ab.updateVideoCallButton(this._videoCallButton,this._threadID);n.conditionShow(this._videoCallButton,ab.isVideoCallableThread(this._threadID)&&!this._searchMode&&t.shouldEnableVideoCalling());this._threadSubscription&&hb.unsubscribe(this._threadSubscription);if(dd&&this._threadID){this._threadSubscription=hb.getThreadMeta(this._threadID,(function(kd){this._menu.forEachItem(function(ld){return ld.updateShownState&&ld.updateShownState(kd);});n.show(this._menuTemplate.getNode('menu'));n.show(this._rootElement);}).bind(this),z.WEBMESSENGER);}else n.hide(this._menuTemplate.getNode('menu'));};ib.prototype.destroy=function(){'use strict';};function jb(ad){ad._searchMode=false;v.reset(ad._searchThreadInput);}function kb(ad,bd){if(bd){ad._searchMode=true;}else jb(ad);n.conditionShow(ad._newMessageButton,!bd);n.conditionShow(ad._videoCallButton,!bd&&ab.isVideoCallableThread(ad._threadID));n.conditionShow(ad._actionsMenu,!bd);n.conditionShow(ad._searchThreadInput,bd);if(bd){ad._searchThreadInput.focus();pa.hide(this._actionsMenu);}}function lb(ad,bd){fb.unmute(bd);pa.hide();ad();}function mb(ad){kb(ad,false);n.conditionShow(ad._searchThreadButton,true);n.conditionShow(ad._searchCloseButton,false);var bd=na.getCurrentDetailState();if(bd!==ma.DETAIL.RECENT_MESSAGES)na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,{thread_id:na.getCurrentStateData().thread_id});}function nb(ad){ia.get(ga.getID(),function(bd){ad(bd&&bd.employee);});}function ob(ad){return !ad.is_canonical&&ad.is_subscribed&&!ad.has_email_participant&&!ad.read_only;}function pb(ad){pa.hide();l.openThread(ad,'WebMessengerDetailViewActionsMenuControl');}function qb(ad,bd){return !bd.is_archived&&bd.folder==ad;}function rb(ad,bd,cd){fb.changeFolder(cd,bd);yc();ad();}function sb(ad){var bd=qc(ad.participants);return bd.length>2;}function tb(ad){var bd=qc(ad.participants);return bd.length>2;}function ub(ad){if(!o.isEmployee()||!o.hasWorkUser()||!aa.isGroupChat(ad.thread_id))return false;var bd=ad.participants;for(var cd=0;cd<bd.length;++cd){var dd=ia.getNow(bd[cd]);if(!dd||!dd.employee)return false;}return true;}function vb(ad){if(!hb.isEmptyLocalThread(ad)){var bd=db.constructLogMessageObject(da.MESSENGER_WEB,ad,ba.SWITCH_TO_WORK,{removed_participants:[ga.getID()]});eb.send(bd,null,z.WEBMESSENGER);yc();}return true;}function wb(ad){pa.hide();na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,na.getCurrentStateData());p.show(ad);}function xb(ad){return function(){return !ad.apply(this,arguments);};}function yb(ad){return ad.is_canonical&&wa.gk_result&&!bb.isMessageBlocked(ad);}function zb(ad){return ad.is_canonical&&wa.gk_result&&bb.isMessageBlocked(ad);}function ac(ad){return ad.folder===ha.SPAM;}function bc(ad){return ad.is_archived;}function cc(ad){return ad.unread_count>0;}function dc(){return na.getCurrentStateData().bug_reporting_enabled;}function ec(ad){fb.blockMessages(ad);}function fc(ad,bd){cb.getServerIDFromClientID(bd,function(cd){var dd=va.getURIBuilder().setString('thread_fbid',cd).getURI();i.send(new j(dd));});}function gc(ad){na.updateDetailState(ma.DETAIL.SHARED_PHOTOS,babelHelpers._extends({},na.getCurrentStateData()));}function hc(ad,bd){fb.unmarkSpam(bd);yc();ad();}function ic(ad){h.show(ad);}function jc(ad){cb.getServerIDFromClientID(ad,function(bd){i.send(new j(new qa('/ajax/browser/dialog/multichat_members/').addQueryData({id:bd})));});}function kc(ad){var bd=ta.getURIBuilder().getURI();i.send(new j(bd),function(cd){cd.subscribe('confirm',function(){nc(ad);cd.hide();});});}function lc(ad,bd){pa.hide();var cd=new r();cd.toggleShown(ad._headerControl?ad._headerControl._headerBar.getNode('headerName'):ad._rootElement,bd);}function mc(ad){var bd=hb.getThreadMetaNow(ad),cd=aa.getParticipantIDFromFromThreadID(ad);ca.get(cd,function(dd){k.loadModules(["MessageBlockedDialog"],function(ed){ed.show(ad,bd.can_reply,bb.isMessageBlocked(bd),dd.short_name);});});}function nc(ad){eb.send(db.constructLogMessageObject(da.TITAN_WEB,ad,ba.UNSUBSCRIBE,{removed_participants:[ga.getID()]}),null,z.WEBMESSENGER);return true;}function oc(ad,bd){fb.archive(bd);yc();ad();}function pc(ad,bd){fb.unarchive(bd);yc();ad();}function qc(ad){var bd=[];for(var cd=0;cd<ad.length;cd++){var dd=ad[cd];if(/^fbid:\d+$/.test(dd))bd.push(dd.substr(5));}return bd;}function rc(ad){hb.getThreadMeta(ad,function(bd){var cd=qc(bd.participants),dd=new qa('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:cd,message_thread_fbid:bd.thread_fbid,parent_id:'0'});i.send(new j(dd));},z.WEBMESSENGER);}function sc(ad){hb.getThreadMeta(ad,function(bd){var cd=qc(bd.participants),dd=new qa('/ajax/plans/create/dialog.php').addQueryData({invite_ids:cd,eventname:bd.name,group_chat:true});i.send(new j(dd));},z.WEBMESSENGER);}function tc(ad,bd){fb.markUnread(bd);pa.hide();ad();}function uc(ad,bd){fb.markRead(bd);pa.hide();ad();}function vc(){var ad=babelHelpers._extends({},na.getCurrentStateData(),{message_action:ma.MESSAGE_ACTION.DELETE});na.updateDetailState(na.getCurrentDetailState(),ad);}function wc(ad){var bd=babelHelpers._extends({},na.getCurrentStateData(),{bug_reporting_enabled:true});pa.hide();na.updateDetailState(na.getCurrentDetailState(),bd);ad();}function xc(ad){var bd=babelHelpers._extends({},na.getCurrentStateData(),{bug_reporting_enabled:false});pa.hide();na.updateDetailState(na.getCurrentDetailState(),bd);ad();}function yc(){na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,{folder:na.getCurrentStateData().folder});}function zc(ad){pa.hide();la.showOrHideShortcuts(ad);}f.exports=ib;},null);
__d('ExpandableDataSource',['DataSource'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;i=babelHelpers.inherits(k,h);j=i&&i.prototype;function k(l,m,n){'use strict';l=l||{};l.maxResults=m;j.constructor.call(this,l);this._initialLimit=m;this._moreResultsLimit=n;this._states={};}k.prototype.query=function(l,m,n){'use strict';this.setQueryData({offset:0,limit:this._initialLimit});j.query.call(this,l,m,n);};k.prototype.fetchHandler=function(l,m){'use strict';var n=l.getPayload(),o=m.value;this.getState('is_loading_more_per_query')[o]=false;this.getState('total_results_count_per_query')[o]=n.total_count;j.fetchHandler.call(this,l,m);};k.prototype.loadMore=function(){'use strict';if(this.value&&!this.hasLoadedAllResults()){var l=this.getState('max_results_per_query');if(!l[this.value])l[this.value]=this._initialLimit;this.setQueryData({offset:l[this.value],limit:this._moreResultsLimit});l[this.value]+=this._moreResultsLimit;if(l[this.value]>this._maxResults)this._maxResults=l[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};k.prototype.isLoadingMore=function(){'use strict';return this.getState('is_loading_more_per_query')[this.value];};k.prototype.hasLoadedAllResults=function(){'use strict';var l=this.getState('total_results_count_per_query')[this.value],m=(this.buildQueryResults(this.value)||[]).length;return l&&m>=l;};k.prototype.getStates=function(){'use strict';return this._states;};k.prototype.getState=function(l){'use strict';var m=this.getStates();if(!m[l])m[l]={};return m[l];};k.prototype.getQueryCache=function(){'use strict';return this.getState('query_cache');};f.exports=k;},null);
__d('WebMessengerDetailViewAllPeopleResultsControl',['Event','CSS','DataStore','DOM','ExpandableDataSource','MercuryIDs','Parent','WebMessengerStateConstants','WebMessengerStateManager','Token','WebMessengerEvents','cx','WebMessengerSubscriptionsHandler','WebMessengerTemplates'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=5,w=5;function x(ca){'use strict';this._rootElement=ca;k.empty(this._rootElement);var da=u[':fb:web-messenger:all-people-results'].build();k.setContent(this._rootElement,da.getRoot());this._loadingSpinner=da.getNode('loadingSpinner');this._peopleResults=da.getNode('results');this._loadMoreButton=da.getNode('loadMoreButton');this._loadMoreLink=da.getNode('loadMoreLink');t.addSubscriptions(h.listen(this._loadMoreLink,'click',(function(){i.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}).bind(this)));}x.prototype.hideView=function(){'use strict';i.hide(this._rootElement);};x.prototype.updateView=function(){'use strict';var ca=p.getCurrentDetailState();if(ca==o.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){i.show(this._rootElement);y(this);r.detailDOMChanged();}};x.prototype.destroy=function(){'use strict';};function y(ca){i.show(ca._loadingSpinner);i.hide(ca._peopleResults);i.hide(ca._loadMoreButton);var da=p.getCurrentStateData(),ea=da.all_people_query||'';z(ca);var fa=(da.participants||[]).map(function(ga){return m.tokenize(ga).value;});ca._peopleDataSource.setExclusions(fa);ca._peopleDataSource.query(ea);}function z(ca){if(!ca._peopleDataSource){ca._peopleDataSource=new l({queryEndpoint:'/ajax/mercury/search_people.php'},v,w);ca._peopleDataSource.init();t.addSubscriptions(ca._peopleDataSource.subscribe('respond',aa.bind(null,ca)),h.listen(ca._rootElement,'click',function(event){var da=event.getTarget().parentNode;if(i.hasClass(da,"_4wt"))ba(event.getTarget(),ca._peopleDataSource);}));}}function aa(ca,da,ea){var fa=p.getCurrentDetailState(),ga=p.getCurrentStateData();if(fa==o.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&ga.all_people_query==ea.value){k.empty(ca._peopleResults);i.show(ca._peopleResults);ea.results.forEach(function(ha){var ia=k.create('div',{className:'personResult'},ha.detail_markup);j.set(ia,'uid',ha.uid);k.appendContent(ca._peopleResults,ia);});if(ea.results.length){i.hide(ca._loadingSpinner);i.conditionShow(ca._loadMoreButton,!ca._peopleDataSource.hasLoadedAllResults());i.conditionClass(ca._loadMoreButton,'async_saving',ca._peopleDataSource.isLoadingMore());}}}function ba(ca,da){var ea=n.byClass(ca,'personResult'),fa=da.getEntry(j.get(ea,'uid')),ga=babelHelpers._extends({},p.getCurrentStateData(),{new_tokens:[new q(fa)],start:false});p.updateDetailState(o.DETAIL.COMPOSE_MAIN,ga);}f.exports=x;},null);
__d('Ellipsizer',['CSS','Style','UserAgent_DEPRECATED','cx','getElementText'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=1;function n(o){this.elements=[];this.descend=true;o.forEach(function(p){h.addClass(p,"_6qy");this.elements.push({node:p});},this);return this;}n.prototype.setDescend=function(o){this.descend=o;return this;};n.prototype.$Ellipsizer1=function(){var o;this.elements.forEach(function(p){o=p.node;if(this.descend)while(o.children.length===1)o=o.children[0];if(o===p.node)i.set(o,'width','');j.ie()&&i.set(o,'position','absolute');p.width=o.offsetWidth;j.ie()&&i.set(o,'position','');},this);this.elements.sort(function(p,q){return p.width-q.width;});};n.prototype.confineWithin=function(o,p){p=p||m;this.$Ellipsizer1();var q=o;this.elements.forEach(function(r,s){var t=Math.floor(q/(this.elements.length-s));if(r.width<=t||r.width<=0||t<=0||r.width<=t*p&&q>=t*p){h.removeClass(r.node,"_6s5");i.set(r.node,'width','');q-=r.width;if(r.titleSet){r.node.setAttribute('title','');r.titleSet=false;}}else{h.addClass(r.node,"_6s5");i.set(r.node,'width',t+'px');q-=t;if(!r.titleSet&&!r.node.getAttribute('title')){r.node.setAttribute('title',l(r.node));r.titleSet=true;}}},this);};f.exports=n;},null);
__d('MercuryReadOnlyReason',['React','fbt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={getReason:function(k){if(k.has_email_participant){return i._("Sorry, this conversation is no longer active because messages can no longer be sent to email addresses. Messages sent to facebook.com email addresses will now be forwarded to primary email addresses, so you can continue this conversation by email. {Learn more}.",[i.param('Learn more',h.createElement('a',{href:'/help/224049364288051'},i._("Learn more")))]);}else return i._("You cannot reply to this conversation.");}};f.exports=j;},null);
__d('MessagesEmoticonView',['DOM','EmoticonsList','Event','Focus','InputSelection','Keys','Parent','SubscriptionsHandler','TextAreaControl','Toggler','UserAgent_DEPRECATED','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=i.symbols;function u(x){return n.byClass(x,"_5r8h");}function v(x,y,z,aa){var ba=n.byClass(x,'emoticon');if(!ba)return;var ca='emoticon_',da=null;ba.className.split(' ').forEach(function(ka){if(ka.startsWith(ca))da=ka.substring(ca.length);});if(!t[da])return;if(!aa)return true;var ea=p.getInstance(y),fa=ea.getValue(),ga=t[da],ha=fa.substring(0,z.start),ia=fa.substring(z.end);if(z.start>0&&!ha.endsWith(' '))ga=' '+ga;if(!ia.startsWith(' '))ga+=' ';var ja=ha+ga+ia;z.start+=ga.length;z.end=z.start;ea.setValue(ja);l.set(y,z.start,z.end);return true;}function w(x,y){var z={start:0,end:0};function aa(){z=l.get(y);}var ba=h.find(x,'.uiToggleFlyout');this._subscriptions=new o();this._subscriptions.addSubscriptions(q.subscribe('show',function(ca,da){if(da.active&&h.contains(x,da.active)){l.set(y,z.start,z.end);var ea=h.scry(ba,'a.emoticon')[0];ea&&k.setWithoutOutline(ea);}}),j.listen(ba,'click',function(event){v(event.getTarget(),y,z,true);}),j.listen(ba,'keyup',function(event){if(event.keyCode===m.ESC){q.hide(x);l.set(y,z.start,z.end);}}),j.listen(y,'keyup',aa),j.listen(y,'click',aa));if(r.chrome()||r.ie()||r.opera())this._subscriptions.addSubscriptions(j.listen(ba,'mousedown',(function(event){var ca=j.listen(document.documentElement,'click',function(event){var da=event.getTarget(),ea=v(da,y,z,false),fa=u(da);!ea&&!fa&&q.show(x);ca.remove();});}).bind(this)));}Object.assign(w.prototype,{destroy:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});Object.assign(w,{create:function(x,y){return new w(x,y);}});f.exports=w;},null);
__d('MessagesEmoticons.react',['Grid.react','React','cx','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=h.GridItem,n=i.PropTypes,o=8,p={smile:l._("smile"),frown:l._("frown"),tongue:l._("tongue"),grin:l._("grin"),gasp:l._("gasp"),wink:l._("wink"),pacman:l._("pacman"),grumpy:l._("grumpy"),unsure:l._("unsure"),cry:l._("cry"),kiki:l._("kiki"),glasses:l._("glasses"),sunglasses:l._("sunglasses"),heart:l._("heart"),devil:l._("devil"),angel:l._("angel"),squint:l._("squint"),confused:l._("confused"),upset:l._("upset"),colonthree:l._("colon three"),like:l._("Like")},q=i.createClass({displayName:'MessagesEmoticons',propTypes:{onEmoticonSelect:n.func},getDefaultProps:function(){return {onEmoticonSelect:k};},getEmoticons:function(){return Object.keys(p).map((function(r){return (i.createElement(m,{key:r},i.createElement('div',{className:"panelCell"},i.createElement('a',{'aria-label':p[r],className:'emoticon emoticon_'+r,onClick:(function(){return this.props.onEmoticonSelect(r);}).bind(this)}))));}).bind(this));},render:function(){return (i.createElement('div',{className:"emoticonsTable"},i.createElement(h,{cols:o,alignv:'middle',alignh:'center',spacing:'pam'},this.getEmoticons())));}});f.exports=q;},null);
__d('StickersFlyoutPackSelector.react',['Animation','ImmutableObject','Locale','React','ReactDOM','Image.react','StickerActions','StickerConfig','StickerConstants','StickerInterfaces','StickerState','StickerStoreController','XUIBadge.react','cx','emptyFunction','fbt','ix','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z=k.PropTypes,aa=4,ba=200,ca=w._("Sticker Store"),da=k.createClass({displayName:'StickersFlyoutPackSelector',propTypes:{stickerInterface:z.oneOf(y(q)),numNewPacks:z.number,packs:z.arrayOf(z.instanceOf(i)).isRequired,onPackClick:z.func,selectedPackID:z.string,resetTagSelectorFunc:z.func},getInitialState:function(){return {animating:false,page:0};},getDefaultProps:function(){return {stickerInterface:q.MESSAGES,numNewPacks:0};},shouldComponentUpdate:function(fa,ga){return !ga.animating;},onFlyoutShown:function(){if(this.props.packs.length>0){var fa=this._calculatePageForPack(this.props.selectedPackID);if(this.state.page!==fa)this._setPage(fa,0);}},_calculatePageForPack:function(fa){for(var ga=0;ga<this.props.packs.length;ga++)if(this.props.packs[ga].id==fa)return ga<=aa?0:Math.floor((ga-1)/aa);return 0;},_setPage:function(fa,ga){if(this.state.animating)return;this.setState({animating:true,page:fa},function(){var ha=l.findDOMNode(this.refs.positioner),ia=this._calculatePosition(fa);new h(ha).to(ia.reference,ia.offset+'px').ondone((function(){return this.setState({animating:false});}).bind(this)).duration(ga).go();});},_calculatePosition:function(fa){var ga=l.findDOMNode(this.refs.positioner),ha=ga.childNodes[fa].offsetLeft;if(j.isRTL()){var ia=ga.offsetWidth,ja=ga.childNodes[fa].offsetWidth;return {reference:'right',offset:ha+ja-ia};}return {reference:'left',offset:-ha};},_numPages:function(){return Math.max(1,Math.ceil((this.props.packs.length-1)/aa));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_goPrev:function(){this._canGoPrev()&&this._setPage(this.state.page-1,ba);},_goNext:function(){this._canGoNext()&&this._setPage(this.state.page+1,ba);},_openStore:function(){n.resetNumNewPacks();var fa=this.props.stickerInterface==q.COMPOSER;s.showStore(null,fa);},render:function(){return (k.createElement('div',{className:"_5r85"},this._renderStoreButton(),this._renderPrevArrow(),this._renderNextArrow(),k.createElement('div',{className:"_5r88"},k.createElement('div',{className:"_5r89",ref:'positioner'},this._renderPages()))));},_selectPack:function(fa){var ga=r.getPack(fa);if(ga&&ga.isPromoted)n.addPack(fa);if(fa===p.SEARCH_PACK_ID)this.props.resetTagSelectorFunc();n.selectPack(fa);},_renderPages:function(){var fa=this.props.packs.map((function(ja,ka){return (k.createElement(ea,{key:ja.id,onClick:(function(){return this._selectPack(ja.id);}).bind(this),pack:ja,selected:this.props.selectedPackID===ja.id,index:ka,isComments:this.props.stickerInterface==q.COMMENTS}));}).bind(this)),ga=[];for(var ha=0;ha<fa.length;ha+=aa){var ia=ha;ha===0&&ha++;ga.push(k.createElement('div',{className:"_5r81",key:ha},fa.slice(ia,ha+aa)));}return ga;},_renderStoreButton:function(){return (k.createElement('a',{'aria-label':ca,className:"_5r86 rfloat",'data-hover':'tooltip',onClick:this._openStore},k.createElement(m,{className:"_5r87",src:x('/images/messaging/stickers/selector/sticker_store.png')}),this._renderJewel()));},_renderJewel:function(){var fa=this.props.numNewPacks;if(!fa)return null;return (k.createElement(t,{className:"rfloat _3fhs",count:fa,maxcount:9,type:'special'}));},_renderPrevArrow:function(){if(!this._canGoPrev())return null;var fa=j.isRTL()?x('/images/messaging/stickers/selector/right.png'):x('/images/messaging/stickers/selector/left.png');return (k.createElement('a',{className:"_37wu"+(' '+"lfloat"),onClick:this._goPrev},k.createElement(m,{className:"_5r84",src:fa})));},_renderNextArrow:function(){if(!this._canGoNext())return null;var fa=j.isRTL()?x('/images/messaging/stickers/selector/left.png'):x('/images/messaging/stickers/selector/right.png');return (k.createElement('a',{className:"_37wv"+(' '+"rfloat"),onClick:this._goNext},k.createElement(m,{className:"_5r84",src:fa})));}}),ea=k.createClass({displayName:'PackIcon',propTypes:{index:z.number,isComments:z.bool,onClick:z.func,pack:z.instanceOf(i).isRequired,selected:z.bool},getDefaultProps:function(){return {isComments:false,onClick:v};},_getPackIcon:function(fa){if(fa.id==p.SEARCH_PACK_ID)return x('/images/messaging/stickers/icons/search.png');if(fa.id==p.MRU_STICKER_PACK)return x('/images/messaging/stickers/icons/recent.png');if(fa.id==p.EMOTICON_PACK_ID)return x('/images/messaging/stickers/icons/emoji.png');return fa.icon;},render:function(){var fa=this.props.pack,ga=o.WebStickerSearch?this.props.index===1||this.props.index===2:this.props.index===1,ha="_5r8a"+(this.props.selected?' '+"_5r8b":'')+(fa.id==p.MRU_STICKER_PACK?' '+"_5qcj":'')+(fa.id==p.SEARCH_PACK_ID?' '+"_5qck":'')+(ga?' '+"_eb3":''),ia=this.props.isComments&&!fa.isCommentsCapable,ja=w._("This pack is only available in photos"),ka=w._("This pack is only available in messages"),la=ia?v:(function(){return this.props.onClick(fa.id);}).bind(this),ma=this._getPackIcon(fa);if(ma===null)return null;var na=ka;if(!fa.isMessengerCapable&&fa.isComposerCapable)na=ja;return (k.createElement('a',{'aria-label':ia?na:fa.name,className:ha,'data-id':fa.id,'data-hover':'tooltip',ref:'search_icon',onClick:la,tabIndex:'0'},k.createElement(m,{className:(ia?"_2ji6":'')+(' '+"_5r8c")+(o.WebStickerSearch?' '+"_1viy":''),src:ma})));}});f.exports=da;},null);
__d('StickerSearch',['StickerServerRequests'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i,j={},k={requestStickersForQuery:function(l,m,n){i=l;h.getStickersForQuery(l,m,function(o){return i===l&&n(o.payload);});},getTagByName:function(l){return j[l];},getTagsIndex:function(){return j;}};f.exports=k;},null);
__d('StickersFlyoutStickerSelector.react',['BanzaiLogger','Grid.react','Image.react','ScrollableArea.react','React','Sticker.react','StickerConstants','StickerImages','StickerInterfaces','StickerSearch','StickerState','StickerUtils','XUISpinner.react','cx','debounce','emptyFunction','fbt','getObjectValues','ix','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){'use strict';if(c.__markCompiled)c.__markCompiled();var ba=i.GridItem,ca=l.PropTypes,da=320,ea=278,fa=n.MRU_STICKER_PACK,ga=44,ha=112,ia=v(function(ka,la){if(!ka)return;h.log('StickersLoggerConfig',{event:'search_sticker',searchtoken:ka,numsearchresults:la.length});},1000),ja=l.createClass({displayName:'StickersFlyoutStickerSelector',propTypes:{height:ca.number,stickerInterface:ca.oneOf(y(p)),onScroll:ca.func,packID:ca.string,singleWordTags:ca.array,typeaheadTags:ca.array,userInput:ca.string},getDefaultProps:function(){return {stickerInterface:p.MESSAGES,onScroll:w};},getInitialState:function(){return {loading:false,stickers:[]};},componentDidMount:function(){if(this.props.packID){this.requestStickersForPack(this.props.packID);return;}if(this.props.userInput)this.requestStickersForQuery(this.props.userInput,this.props.stickerInterface);},componentWillReceiveProps:function(ka){if(ka.packID&&ka.packID!==this.props.packID){this.requestStickersForPack(ka.packID);}else if(ka.userInput!==this.props.userInput)this.requestStickersForQuery(ka.userInput,this.props.stickerInterface);},requestStickersForQuery:function(ka,la){this.setState({loading:true});q.requestStickersForQuery(ka,la,(function(ma){ma.map(function(na){return o.cacheSticker(na);});if(!this.props.tagChosen)ia(ka,ma);if(this.isMounted())this.setState({loading:false,stickers:ma});}).bind(this));},requestStickersForPack:function(ka){this.setState({loading:true});o.requestStickersForPack(ka,n.TRAY_SIZE,(function(la){if(ka==fa){la=r.getMRUStickerPack(la);if(this.props.stickerInterface==p.COMPOSER)la=la.filter(function(ma){return ma.isComposerCapable;});if(this.props.stickerInterface==p.COMMENTS)la=la.filter(function(ma){return ma.isCommentsCapable;});if(this.props.stickerInterface==p.MESSAGES)la=la.filter(function(ma){return ma.isMessengerCapable;});}this.setState({loading:false,stickers:la});}).bind(this));},renderStickers:function(){return this.state.stickers.map(function(ka){var la=s.getScaledDimensions(ka.height,ka.width,n.TRAY_SIZE);return (l.createElement(ba,{key:ka.id},l.createElement('div',{className:"_5r8h",'data-id':ka.id},l.createElement(m,{accessibilityLabel:ka.accessibilityLabel,animationTrigger:'hover',className:"_5r8i",forceCursorPointer:true,frameCount:ka.frameCount,frameRate:ka.frameRate||83,framesPerCol:ka.framesPerCol,framesPerRow:ka.framesPerRow,sourceHeight:la.height,sourceURI:ka.sourceURI,sourceWidth:la.width,spriteURI:ka.spriteURI,packName:ka.packName,paddedSpriteURI:ka.paddedSpriteURI,stickerID:ka.id}))));});},_onScroll:function(){var ka=this.refs.stickerScrollable;if(ka){var la=ka.getArea().getScrollTop();this.props.onScroll(la);}},render:function(){if(this.state.loading){return (l.createElement('div',{className:"_e0r"},l.createElement(t,{size:'large'})));}else if(this.state.stickers.length===0){var ka=(da-ga*2-ha)/2+'px';return (l.createElement('div',{className:"_5jdt",style:{marginTop:ka}},l.createElement(j,{src:z('/images/messaging/stickers/icons/sad_face.png')}),l.createElement('p',null,x._("No Stickers to Show"))));}return (l.createElement(k,{ref:'stickerScrollable',height:this.props.height||da,onScroll:aa(this._onScroll,200),width:ea,fade:true},l.createElement('div',{className:"_5r8k"},l.createElement(i,{cols:4,fixed:true},this.renderStickers()))));}});f.exports=ja;},null);
__d('StickersFlyoutTagSelector.react',['BanzaiLogger','Grid.react','ScrollableArea.react','Parent','React','ReactDOM','Image.react','StickerConfig','StickerConstants','StickersFlyoutStickerSelector.react','StickerInterfaces','StickerSearch','StickerState','StickerUtils','Toggler','XUIButton.react','XUICloseButton.react','XUITextInput.react','cx','emptyFunction','fbt','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';if(c.__markCompiled)c.__markCompiled();var da=i.GridItem,ea=l.PropTypes,fa=320,ga=278,ha=44,ia=l.createClass({displayName:'StickersFlyoutTagSelector',propTypes:{trigger:ea.string,stickerInterface:ea.oneOf(ca(r)),resetTrigger:ea.func,onSelectSticker:ea.func},getInitialState:function(){return {input:'',isScrolling:false,tagChosen:false};},getDefaultProps:function(){return {trigger:null,stickerInterface:r.MESSAGES,resetTrigger:aa,onSelectSticker:aa};},componentDidMount:function(){this.focusInput();this.selectTrigger(this.props.trigger);},componentWillUnmount:function(){this._togglerSub&&this._togglerSub.unsubscribe();},componentWillReceiveProps:function(ja){this.selectTrigger(ja.trigger);},focusInput:function(){this.refs.inputField.focusInput&&this.refs.inputField.focusInput();},_inputChanged:function(ja){this.setState({input:ja.target.value,tagChosen:false,isScrolling:false});},_normalizeInput:function(ja){return ja.trim().replace(/\s+/,' ').toLowerCase();},_handleResetButtonClick:function(ja){ja.preventDefault();this.reset();},reset:function(){this.setState(this.getInitialState());},renderContentArea:function(){if(this.state.tagChosen||this._normalizeInput(this.state.input).length>1){return this.renderStickers();}else return this.renderTags();},render:function(){return (l.createElement('div',{className:"_217a"+(this.state.isScrolling?' '+"_1hg1":'')},l.createElement('div',{className:"_5jdr"},l.createElement('span',{className:"_5jds"}),l.createElement(y,{onChange:this._inputChanged,ref:'inputField',placeholder:ba._("Search stickers"),value:this.state.input}),l.createElement(x,{size:'small',onClick:this._handleResetButtonClick,className:this.state.input.length===0?"hidden_elem":''})),this.renderContentArea()));},selectTag:function(ja){h.log('StickersLoggerConfig',{event:'select_tag',tagid:ja.id});this.setState({tagChosen:true,input:u.capitalizeWords(ja.name)});this.focusInput();},selectTrigger:function(ja){if(ja!==null){var ka=s.getTagByName(ja);this.setState({tagChosen:true,input:u.capitalizeWords(ka.name)});this.props.resetTrigger();}},_onScroll:function(ja){this.setState({isScrolling:!!ja});},renderStickers:function(){var ja=this._normalizeInput(this.state.input);return (l.createElement(q,{ref:'selector',height:fa-ha,userInput:ja,onScroll:this._onScroll,stickerInterface:this.props.stickerInterface,tagChosen:this.state.tagChosen}));},renderTags:function(){var ja=t.getFeaturedTags().filter(function(ka){return ka.sourceURI!==null;}).sort(function(ka,la){return ka.order-la.order;}).map((function(ka,la){return (l.createElement(da,{key:la},l.createElement('div',{className:"_t5c"+(la<2?' '+"_1b27":'')+(la%2===0?' '+"_t5d":'')+(la%2!==0?' '+"_t5e":'')},l.createElement(w,{image:l.createElement(n,{src:ka.sourceURI}),label:ka.name,onClick:this.selectTag.bind(this,ka),className:"_5jdu",style:{background:'#'+ka.color_code},disabled:this._normalizeInput(this.state.input).length===1}))));}).bind(this));return (l.createElement(j,{height:fa-ha,width:ga-16,shadow:true,fade:true,className:"_5jei"},l.createElement(i,{spacing:'pas',cols:2,fixed:true,ref:'grid'},ja)));}});f.exports=ia;},null);
__d('StickersFlyout.react',['BanzaiLogger','Event','Keys','MessagesEmoticons.react','Parent','ReactComponentWithPureRenderMixin','React','ReactDOM','StickerConstants','StickerConfig','StickersFlyoutPackSelector.react','StickersFlyoutStickerSelector.react','StickersFlyoutTagSelector.react','StickerInterfaces','StickerState','StickerStateStore','StoreAndPropBasedStateMixin','SubscriptionsHandler','Toggler','XUISpinner.react','cx','fbt','getObjectValues','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){'use strict';if(c.__markCompiled)c.__markCompiled();var fa=n.PropTypes,ga=p.SEARCH_PACK_ID,ha=n.createClass({displayName:'StickersFlyout',mixins:[m,x(w)],statics:{calculateState:function(ia){var ja=w.getState(ia.stickerInterface);return {dataReady:ja.trayDataReady,packID:ja.packID,numNewPacks:ja.numNewPacks,packs:ja.trayPacks};}},propTypes:{stickerInterface:fa.oneOf(da(u)),onStickerSelect:fa.func.isRequired,onEmoticonSelect:fa.func,onShown:fa.func,onHidden:fa.func,onEscKeyDown:fa.func,onPackSelect:fa.func,shown:fa.bool},getDefaultProps:function(){return {stickerInterface:u.MESSAGES,shown:false,packSelectorClass:r,tagSelectorClass:t,glyphProvider:null};},getInitialState:function(){return {trigger:null};},componentDidMount:function(){this._toggle=l.byClass(o.findDOMNode(this),'uiToggle');this._subscriptions=new y();if(this._toggle)this._subscriptions.addSubscriptions(z.listen('show',this._toggle,this._onShownWrapper),z.listen('hide',this._toggle,this._onHidden));this._subscriptions.addSubscriptions(i.listen(o.findDOMNode(this),'keydown',this._onKeyDown));if(this.props.shown)this._onShown();},_onShownWrapper:function(){if(this.props.onShown){this.props.onShown(this._onShown);}else this._onShown();},_onShown:function(){h.log('StickersLoggerConfig',{event:'open_tray'});if(!this.state.dataReady)this.loadTrayData();if(this.state.packID===ga)this.refs.tagSelector&&this.refs.tagSelector.focusInput();this.refs.packSelector.onFlyoutShown();},_onHidden:function(){this.resetTagSelector();this.props.onHidden&&this.props.onHidden();},componentWillUnmount:function(){this._subscriptions.release();},componentWillReceiveProps:function(ia){if(!this.state.dataReady&&ia.shown)this.loadTrayData();},componentDidUpdate:function(ia){if(!ia.shown&&this.props.shown){this._onShown();}else if(ia.shown&&!this.props.shown)this._onHidden();},_onKeyDown:function(event){if(event.keyCode===j.ESC&&this.props.onEscKeyDown){this.props.onEscKeyDown();event.kill();}else if(event.keyCode===j.RETURN&&l.byClass(event.target,"_5r8h")){event.stopPropagation();event.preventDefault();this.selectedSticker(event);}else this.setState({packID:ga});},resetTagSelector:function(){this.refs.tagSelector&&this.refs.tagSelector.reset();},loadTrayData:function(){v.onTrayDataReady((function(){}).bind(this));},loadPack:function(){if(!this.state.dataReady)return (n.createElement('div',{className:"_e0r"},n.createElement(aa,{size:'large'})));if(this.state.packID===p.EMOTICON_PACK_ID)return (n.createElement('div',{className:"_5r8l",'data-id':this.state.packID},n.createElement(k,{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.state.packID===ga&&q.WebStickerSearch){var ia=this.props.tagSelectorClass;return (n.createElement('div',{className:"_5r8l"},n.createElement(ia,{ref:'tagSelector',className:"fbStickersFlyoutTagSelector",trigger:this.state.trigger,resetTrigger:(function(){return this.setState({trigger:null});}).bind(this),stickerInterface:this.props.stickerInterface,onSelectSticker:this.onSelectSticker})));}return (n.createElement('div',{className:"_5r8l",'data-id':this.state.packID},n.createElement(s,{ref:'selector',packID:this.state.packID,stickerInterface:this.props.stickerInterface})));},onSelectSticker:function(ia,event){if(ia){v.updateRecentlyUsed(ia);this.props.onStickerSelect(ia,event);v.clearShowStickerReplyNUX();}},selectedSticker:function(event){var ia=l.byClass(event.target,"_5r8h");if(ia){var ja=ia.getAttribute('data-id');this.onSelectSticker(ja,event);}},render:function(){var ia=this.props.packSelectorClass;return (n.createElement('div',{'aria-label':ca._("Stickers"),className:ea(this.props.className,"_5r8f"),role:'dialog'},n.createElement('div',{className:"_5r8e"},n.createElement(ia,{ref:'packSelector',numNewPacks:this.state.numNewPacks,onPackClick:this.props.onPackSelect,selectedPackID:this.state.packID,packs:this.state.packs,stickerInterface:this.props.stickerInterface,resetTagSelectorFunc:this.resetTagSelector,glyphProvider:this.props.glyphProvider})),n.createElement('div',{className:"_5r8m",onClick:this.selectedSticker},this.loadPack())));}});f.exports=ha;},null);
__d('TabIndexDelegator',['CSS','DOM','Event','Focus','JSXDOM'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();function m(n,o){'use strict';this._placeholder=o||l.button(null);this._placeholder.setAttribute('aria-hidden',true);h.addClass(this._placeholder,'accessible_elem');this._listener=j.listen(this._placeholder,'click',function(){n.click();});k.relocate(this._placeholder,n);this.enable();}m.prototype.enable=function(){'use strict';h.show(this._placeholder);};m.prototype.disable=function(){'use strict';h.hide(this._placeholder);};m.prototype.getPlaceholder=function(){'use strict';return this._placeholder;};m.prototype.destroy=function(){'use strict';this._listener.remove();i.remove(this._placeholder);};f.exports=m;},null);
__d('UnsentMessageDialog',['Dialog','WebMessengerEvents','fbt'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={get:function(){var l=[{label:j._("Don't Send"),name:h.OK.name},{label:j._("Stay on Message"),name:h.CANCEL.name,className:h.CANCEL.className}];return new h().setTitle(j._("Don't Send Message?")).setBody(j._("If you leave this Page, your message won't be sent.")).setButtons(l).setCloseHandler(i.inform.bind(i,i.FOCUS_COMPOSER)).setModal(true);}};f.exports=k;},null);
__d("XMessagingSetPreferencesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/preferences\/",{send_on_enter:{type:"Bool",defaultValue:false}});},null);
__d('WebMessengerDetailViewBottomShelfControl',['ARIA','Arbiter','AsyncDialog','AsyncRequest','BanzaiLogger','Bootloader','Button','CSS','DOM','WebMessengerDeleteThreadDialog','Ellipsizer','Event','Focus','MercuryFolders','Input','Keys','Locale','MercuryAPIArgsSource','MercuryIDs','MercuryConfig','MercuryFileUploader','MercuryMessengerBlockingUtils','MercuryParticipants','MercuryPhotoUploader','MercuryReadOnlyReason','MercuryShareLinkUploader','MercurySourceType','MercuryThreadInfo','MessagesEmoticonView','MessagingTag','P2PSendMoneyContainerBootloader.react','PUWMethods','PagesEventObserver','PagesEventType','PhotosUploadWaterfall','WebMessengerPreferences','React','ReactComponentRenderer','ReactDOM','MercuryShareAttachmentRenderLocations','Run','Set','SiteData','WebMessengerStateConstants','WebMessengerStateManager','StickerActions','StickersFlyout.react','StickerState','StickerStoreController','Style','TabIndexDelegator','WebMessengerTemplates','TextAreaControl','Toggler','UnsentMessageDialog','URI','UserAgent_DEPRECATED','VaultBoxURI','Vector','WebMessengerEvents','WebMessengerSubscriptionsHandler','WorkFileUploadsGating','XMessagingSetPreferencesController','arrayContains','csx','cx','fbt','isWebMessengerURI','MercuryDraftsController','MercuryBlockedParticipants','MercuryThreadIDMap','MercuryThreadActions','MercuryMessageObject','MercuryMessageActions','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb){if(c.__markCompiled)c.__markCompiled();var xb=c('MercuryDraftsController').get(),yb=c('MercuryBlockedParticipants').get(),zb=c('MercuryThreadIDMap').get(),ac=c('MercuryThreadActions').get(),bc=c('MercuryMessageObject').get(),cc=c('MercuryMessageActions').get(),dc=c('MercuryThreadInformer').get(),ec=c('MercuryThreads').get(),fc="_1rh";function gc(kd,ld){'use strict';this._manager=kd;this._rootElement=ld;this._sendOnEnterDefault=qa.sendOnEnter;p.empty(this._rootElement);var md=gb[':fb:web-messenger:read-view:bottom-shelf'].build();p.setContent(this._rootElement,md.getRoot());this._bottomShelfToolbar=md.getNode('toolbar');this._bottomShelfComposer=md.getNode('composer');this._bottomShelfButtons=md.getNode('buttons');this._bottomPendingActions=md.getNode('pendingActions');this._autogrowContainer=md.getNode('autogrowContainer');this._composerBox=md.getNode('composerTextarea');this._composerGrid=md.getNode('composerGrid');this._sendContainer=md.getNode('sendContainer');this._replyButton=md.getNode('replyButton');this._uploadingWarning=md.getNode('uploadingWarning');this._replyButtonLabel=p.find(this._sendContainer,"._1ri");this._sendOnEnterButton=md.getNode('sendOnEnterButton');this._loadingIndicator=md.getNode('loadingIndicator');this._cannotReplyAlert=md.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');pb.addSubscriptions(s.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),ob.subscribe(ob.UPDATE_SELECTION,jd.bind(null,this)),ob.subscribe(ob.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=md.getNode('emoteWrapper');this._p2pWrapper=md.getNode('p2pWrapper');this._stickersFlyoutToggler=md.getNode('emoticons');this._emoticonsPanel=new ja(this._stickersFlyoutToggler,this._composerBox);var nd=md.getNode('stickers');if(nd){this._stickersFlyout=ta.render(ra.createElement(bb,{onStickerSelect:(function(rd){wc(this,rd);}).bind(this)}),nd);pb.addSubscriptions(ob.subscribe(ob.STICKER_CLICKED,this._onStickerClick.bind(this)));}this._messageSent=false;if(qb.canUploadFiles)this._fileUploader=new ba(md.getNode('attachmentShelf'),md.getNode('attachButtonForm'),md.getNode('fileInput'),md.getNode('attachID'));this._shareLinkUploader=new ga(md.getNode('shareStage'),md.getNode('shareStageContent'),md.getNode('shareStageLoadingIndicator'),md.getNode('shareStageCloseButton'),this._composerBox);t.relocate(this._replyButton,this._replyButtonLabel);this._delegator=new fb(this._replyButtonLabel);p.prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());e(['TypingDetectorController'],(function(rd){this._typingDetector=new rd(null,this._composerBox,'web-messenger',null,null);id(this);}).bind(this));this._photoUploader=new ea(this._composerGrid,md.getNode('photoButton'),pb,md.getNode('composer'));var od=false;pb.addSubscriptions(this._photoUploader.subscribe('dom-updated',ob.detailDOMChanged.bind(ob)),this._photoUploader.subscribe('menu-show',(function(rd,sd){if(!od){this.waterfallStep(pa.BEGIN,sd);od=true;}}).bind(this)),this._photoUploader.subscribe('selection-start',(function(rd,sd){this.waterfallStep(pa.SELECT_START,sd);}).bind(this)),this._photoUploader.subscribe('upload-started',(function(rd,sd){this.waterfallStep(pa.IMAGES_SELECTED,{method:sd.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(pa.UPLOAD_START,{count:sd.imageCount});}).bind(this)),this._photoUploader.subscribe('upload-completed',(function(rd,sd){var td=this._photoUploader.getCurrentMethod();if(td!==ma.FILE_SELECTOR)this.waterfallStep(pa.IMAGES_SELECTED,{method:td});for(var ud=0;ud<sd.fbids.length;++ud)this.waterfallStep(pa.ONE_UPLOAD_DONE);this._composerBox.focus();var vd=vb._("A photo has been attached to your message.");h.notify(vd);}).bind(this)),this._photoUploader.subscribe('all-uploads-completed',(function(rd,sd){if(this._blockedOnUpload){ad(this,false);xc(this);}this.waterfallStep(pa.ALL_UPLOADS_DONE,sd);}).bind(this)));var pd=p.scry(this._bottomShelfToolbar,"._6q-");pd.push(md.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new r(pd);if(this._fileUploader)pb.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',(function(){if(this._blockedOnUpload){ad(this,false);xc(this);}}).bind(this)),this._fileUploader.subscribe('upload-canceled',ad.bind(null,this,false)),this._fileUploader.subscribe('dom-updated',ob.detailDOMChanged.bind(ob)));this._confirmationSubscription=za.registerConfirmationBeforeStateUpdate((function(rd,sd,td){if(!xb.canSaveDrafts(this._threadID)&&ed(this)&&hc(this,sd,td))return jb.get();return false;}).bind(this));fd(this);pb.addSubscriptions(i.subscribe('page_transition',(function(rd,sd){if(wb(sd.uri))fd(this);}).bind(this)),this._shareLinkUploader.subscribe('link-detected',ob.detailDOMChanged.bind(ob)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));hb.getInstance(this._composerBox).subscribe('resize',(function(){ob.detailDOMChanged();}).bind(this));pb.addSubscriptions(s.listen(this._replyButtonLabel,'click',xc.bind(null,this)),s.listen(this._replyButton,'keydown',lc.bind(null,this)),s.listen(this._composerBox,'keydown',lc.bind(null,this)),s.listen(this._composerBox,'paste',mc.bind(null,this)),s.listen(this._sendOnEnterButton,'click',oc.bind(null,this)),s.listen(md.getNode('cancelButton'),'click',bd),s.listen(md.getNode('deleteButton'),'click',cd.bind(null,this)),ob.subscribe(ob.DETAIL_DOM_CHANGED,nc.bind(null,this)));if(aa.CoreGraphEnabled)pb.addSubscriptions(s.listen(md.getNode('deletePendingButton'),'click',(function(){za.updateDetailState(ya.DETAIL.RECENT_MESSAGES,za.getCurrentStateData());q.show(this._threadID);}).bind(this)),s.listen(md.getNode('replyPendingButton'),'click',(function(){o.hide(this._bottomPendingActions);o.show(this._bottomShelfComposer);o.removeClass(this._bottomShelfComposer,'invisible_elem');}).bind(this)));pb.addSubscriptions(dc.subscribe('threads-updated',(function(rd,sd){sd[this._threadID]&&this.updateView();}).bind(this)));this._replySet=new wa();var qd=new kb(window.location.href);this._uriData=qd.getQueryData();this._shouldLogMessageSend=!!this._uriData.loggedoutpage;}gc.prototype._logMessageSend=function(){'use strict';na.notify(oa.MESSAGES_SEND_ENTRY_POINT,this._uriData.loggedoutpage,{was_logged_out:true});};gc.prototype._onStickerClick=function(kd,ld){'use strict';if(!ld||!ld.packID)return;var md=ld.packID,nd=ld.stickerID;l.log('StickersLoggerConfig',{event:'click_sticker',packid:md,stickerid:nd});cb.onTrayDataReady((function(){if(sb(cb.getPackIDsInTray(),md)){var od=cb.getPack(md);if(od&&od.isPromoted)ab.addPack(md);var pd=this._stickersFlyout,qd=this._stickersFlyoutToggler;if(!qd||!pd||!pd.isMounted())return;ab.selectPack(md);ib.show(qd);}else db.showStore(md);}).bind(this));};gc.prototype.waterfallStep=function(kd,ld){'use strict';var md=this._photoUploader.getWaterfallID();if(!md)return;pa.sendSignal(babelHelpers._extends({qn:md,step:kd,uploader:pa.APP_MESSENGER},ld||{}));};gc.prototype.hideView=function(){'use strict';o.hide(this._rootElement);};gc.prototype.updateView=function(){'use strict';var kd=za.getCurrentDetailState();o.show(this._rootElement);var ld=za.getCurrentStateData();hc(this,kd,ld)&&zc(this);o.hide(this._bottomShelfComposer);o.removeClass(this._bottomShelfComposer,'invisible_elem');o.hide(this._bottomShelfButtons);o.show(this._sendOnEnterButton);o.hide(this._cannotReplyAlert);qc(this,this._sendOnEnterDefault);switch(kd){case ya.DETAIL.RECENT_MESSAGES:case ya.DETAIL.SEARCH_CONTEXT:this._threadID=ld.thread_id;if(ld.message_action==ya.MESSAGE_ACTION.DELETE){o.hide(this._bottomPendingActions);gd(this,ld.message_action);}else if(this._threadID)ec.getThreadMeta(this._threadID,(function(md){if(aa.CoreGraphEnabled&&!this._replySet.has(this._threadID)&&md&&md.folder===ka.PENDING){hd(this);}else if(ia.showComposer(md)){o.show(this._bottomShelfComposer);xb.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{ta.render(ra.createElement('span',null,fa.getReason(md)),this._cannotReplyAlert);o.show(this._cannotReplyAlert);}kc(this,md);jc(this,md);}).bind(this));break;case ya.DETAIL.COMPOSE_MAIN:this._threadID=null;o.show(this._bottomShelfComposer);kc(this,null);jc(this);break;default:this._threadID=null;break;}ic(this,kd,ld);id(this);ob.detailDOMChanged();this._state=kd;};gc.prototype.focusComposer=function(){'use strict';this._composerBox.focus();};gc.prototype.submitReply=function(){'use strict';xc(this);};gc.prototype.destroy=function(){'use strict';this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader&&this._fileUploader.destroy();za.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);if(this._sendMoneyDialogStoreSub){this._sendMoneyDialogStoreSub.remove();this._sendMoneyDialogStoreSub=null;}if(this._p2pButton)this._p2pButton.unmount();};gc.prototype.getStickersFlyoutToggler=function(){'use strict';return this._stickersFlyoutToggler;};function hc(kd,ld,md){switch(ld){case ya.DETAIL.RECENT_MESSAGES:case ya.DETAIL.SEARCH_CONTEXT:return !md.reuse_composer&&(kd._threadID!=md.thread_id||kd._state!=ld);case ya.DETAIL.COMPOSE_MAIN:return md.start;case ya.DETAIL.SEARCH_SNIPPET:case ya.DETAIL.SEARCH_THREAD_SNIPPET:case ya.DETAIL.SHARED_PHOTOS:return true;}return false;}function ic(kd,ld,md){var nd=md.participants&&md.participants.length>0;o.conditionClass(kd._replyButtonLabel,'uiButtonDisabled',ld==ya.DETAIL.COMPOSE_MAIN&&!nd);}function jc(kd,ld){var md=ld&&ld.thread_id;if(!kd._p2pWrapper)return;if(!md){o.addClass(kd._p2pWrapper,'invisible_elem');if(kd._p2pButton)kd._p2pButton.setProps({sendMoneyDialogShown:false});return;}o.removeClass(kd._p2pWrapper,'invisible_elem');if(!kd._p2pButton){kd._p2pButton=new sa(la,kd._p2pWrapper);kd._p2pButton.setProps({referrer:ua.WEB_INBOX});}if(kd._p2pButton)kd._p2pButton.setProps({threadID:md});}function kc(kd,ld){var md,nd;if(!ld){md=vb._("Send");nd=vb._("Write a message...");}else if(ld.participants&&ld.participants.length<=2){md=vb._("Reply");nd=vb._("Write a reply...");}else{md=vb._("Reply All");nd=vb._("Write a reply...");}if(kd._composerBox.getAttribute('placeholder')!=nd)v.setPlaceholder(kd._composerBox,nd&&nd.toString());n.setLabel(kd._replyButton,md);tc(kd);}function lc(kd,event){var ld=event.getModifiers();if(ld.any&&event.keyCode!==w.RETURN)return;var md=false;switch(event.keyCode){case w.ESC:var nd=kd.getStickersFlyoutToggler();ib.hide(nd);return;case w.SPACE:md=event.getTarget()===kd._replyButton;break;case w.RETURN:var od=!o.hasClass(kd._bottomShelfComposer,fc),pd=event.getTarget()===kd._replyButton,qd=false;if(!od){if(lb.windows()){qd=ld.control;}else if(lb.osx()){qd=ld.meta;}else qd=ld.control||ld.meta;}else if(event.getModifiers().any)return;md=pd||od||qd;break;case w.UP:case w.DOWN:var rd=za.getCurrentDetailState();if(kd._composerBox.value||rd!=ya.DETAIL.RECENT_MESSAGES)event.stop();break;}if(md){xc(kd);kd.focusComposer();return false;}}function mc(kd,event){if(lb.chrome()){var ld=event.clipboardData||event.originalEvent.clipboardData;if(!ld||!ld.items||ld.items.length<1)return;var md=ld.items[0].type;if(md!=='image/png')return;if(ld.items[0].getAsFile){var nd=ld.items[0].getAsFile();kd._photoUploader.uploadPastedFile(nd);}}}function nc(kd){rc(kd);}function oc(kd){pc(kd);var ld=!kd._sendOnEnterDefault;kd.focusComposer();kd._sendOnEnterDefault=ld;qa.sendOnEnter=ld;var md=rb.getURIBuilder().setBool('send_on_enter',ld).getURI();new k(md).send();}function pc(kd){o.toggleClass(kd._bottomShelfComposer,fc);if(o.hasClass(kd._bottomShelfComposer,fc)){kd._sendOnEnterButton.setAttribute('aria-checked','false');}else kd._sendOnEnterButton.setAttribute('aria-checked','true');tc(kd,true);ob.detailDOMChanged();}function qc(kd,ld){if(ld==o.hasClass(kd._bottomShelfComposer,fc))pc(kd);}function rc(kd){var ld;if(o.hasClass(kd._bottomShelfComposer,fc)){ld=sc(kd);}else ld=0;var md=nb.getElementDimensions(kd._bottomShelfToolbar).x;kd._ellipsizer.confineWithin(md-ld-120,1.3);}function sc(kd){return nb.getElementDimensions(kd._replyButtonLabel).x+20;}function tc(kd,ld){var md='',nd='';if(!o.hasClass(kd._bottomShelfComposer,fc)){nd=sc(kd)+'px';md='-1';kd._delegator.disable();}else kd._delegator.enable();o.conditionClass(kd._sendContainer,'transition',ld);kd._replyButton.setAttribute('tabindex',md);eb.set(kd._sendContainer,x.isRTL()?'right':'left',nd);}function uc(kd){var ld=za.getCurrentStateData(),md=bc.constructUserGeneratedMessageObject(v.getValue(kd._composerBox),ha.TITAN_WEB,ld.thread_id,ld.participants);if(kd._fileUploader){var nd=kd._fileUploader.getAttachments();if(nd&&nd.length){md.has_attachment=true;md.raw_attachments=nd;}}var od=kd._photoUploader.getSelectedFBIDs();if(od.length>0){md.has_attachment=true;md.photo_fbids=od;}if(kd._fileUploader){var pd=kd._fileUploader.getImageFiles();if(pd.length>0){md.has_attachment=true;md.image_ids=pd;}var qd=kd._fileUploader.getAnimatedImageFiles();if(qd.length>0){md.has_attachment=true;md.gif_ids=qd;}var rd=kd._fileUploader.getVideoFiles();if(rd.length>0){md.has_attachment=true;md.video_ids=rd;}var sd=kd._fileUploader.getAudioFiles();if(sd.length>0){md.has_attachment=true;md.audio_ids=sd;}var td=kd._fileUploader.getFiles();if(td.length>0){md.has_attachment=true;md.file_ids=td;}}if(kd._shareLinkUploader.getAttachData()){md.has_attachment=true;md.content_attachment=kd._shareLinkUploader.getAttachData();}md.force_sms=true;md.ui_push_phase=xa.push_phase;return md;}function vc(kd,ld,md){var nd=kd._threadID&&ec.getThreadMetaNow(kd._threadID);if(nd&&nd.is_canonical&&!ia.canReply(nd)&&ca.gk_result){yc(kd._threadID,nd);if(o.hasClass(kd._bottomShelfComposer,fc)){o.hide(kd._loadingIndicator);o.show(kd._replyButtonLabel);kd._composerBox.removeAttribute('disabled');}return;}kd.waterfallStep(pa.SESSION_POSTED);if(aa.CoreGraphEnabled&&kd._threadID)kd._replySet.add(kd._threadID);kd._sendSubscription=cc.send(ld,function(od){kd.waterfallStep(pa.POST_PUBLISHED);if(!md){xb.clearDraft(od);zc(kd);}kd._messageSent=true;if(kd._shouldLogMessageSend)kd._logMessageSend();var pd=kd.getStickersFlyoutToggler(),qd=false;if(pd)qd=ib.isShown(pd);var rd=u.getFromMeta(ec.getThreadMetaNow(od));if(aa.CoreGraphEnabled&&rd===ka.PENDING)ac.movePendingToInbox(od);var sd=ya.DETAIL.RECENT_MESSAGES;if(za.getCurrentDetailState()!==sd)za.updateDetailState(sd,{thread_id:od,folder:rd,reuse_composer:md});kd._messageSent=false;if(pd&&qd)ib.show(pd);},y.WEBMESSENGER);kd.focusComposer();}function wc(kd,ld){var md=za.getCurrentStateData(),nd=bc.constructUserGeneratedMessageObject('',ha.TITAN_WEB,md.thread_id,md.participants);if(!nd.thread_id&&!nd.specific_to_list.length)return;nd.has_attachment=true;nd.sticker_id=ld;vc(kd,nd,true);}function xc(kd){if(kd._fileUploader&&kd._fileUploader.isUploading()||kd._photoUploader.isUploading()){ad(kd,true);return;}var ld=uc(kd),md=v.isEmpty(kd._composerBox);if(md&&!ld.has_attachment||!ld.thread_id&&!ld.specific_to_list.length)return;if(o.hasClass(kd._bottomShelfComposer,fc)){o.show(kd._loadingIndicator);o.hide(kd._replyButtonLabel);kd._composerBox.setAttribute('disabled','disabled');}vc(kd,ld);}function yc(kd,ld){var md=z.getParticipantIDFromFromThreadID(kd);da.get(md,function(nd){m.loadModules(["MessageBlockedDialog"],function(od){od.show(ld.thread_id,ld.can_reply,yb.isMessageBlocked(ld),nd.short_name);});});}function zc(kd){v.reset(kd._composerBox);kd._typingDetector&&kd._typingDetector.resetState();kd._fileUploader&&kd._fileUploader.removeAttachments();kd._shareLinkUploader.clear();if(kd._photoUploader.getSelectedFBIDs().length>0)kd._photoUploader.clear();o.hide(kd._loadingIndicator);o.show(kd._replyButtonLabel);kd._composerBox.removeAttribute('disabled');if(kd._sendSubscription)kd._sendSubscription=null;ad(kd,false);}function ad(kd,ld){o.conditionShow(kd._uploadingWarning,ld);kd._blockedOnUpload=ld;}function bd(){var kd=za.getCurrentDetailState(),ld=za.getCurrentStateData();delete ld.message_action;za.updateDetailState(kd,ld);}function cd(kd){var ld=kd._manager.getSelectedMessageIDs().length;j.send(new k('/ajax/mercury/delete_messages_dialog.php').setData({count:ld}),function(md){md.subscribe('confirm',dd.bind(null,kd,md));});}function dd(kd,ld){var md=kd._manager.getSelectedMessageIDs();cc['delete'](kd._threadID,md);ld.hide();var nd=za.getCurrentStateData();if(nd.message_action){var od=babelHelpers._extends({},nd);delete od.message_action;za.updateDetailState(za.getCurrentDetailState(),od);}}function ed(kd){if(kd._messageSent)return false;if(!v.isEmpty(kd._composerBox))return true;if(kd._fileUploader){var ld=kd._fileUploader.getAttachments();if(ld&&ld.length||kd._fileUploader.getImageFiles().length>0||kd._fileUploader.getAnimatedImageFiles().length>0||kd._fileUploader.getVideoFiles().length>0||kd._fileUploader.getAudioFiles().length>0||kd._fileUploader.getFiles().length>0||kd._shareLinkUploader.getAttachData()||kd._photoUploader.getSelectedFBIDs().length>0)return true;}var md=za.getCurrentStateData(),nd=za.getCurrentDetailState(),od=nd==ya.DETAIL.COMPOSE_MAIN||nd==ya.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||nd==ya.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(od&&!md.start&&(md.participants||[]).length)return true;return false;}function fd(kd){va.onBeforeUnload(function(){var ld=kb.getNextURI();if(!ld.getQueryData().hasOwnProperty('theater')&&!mb.isVaultBoxURI(ld))xb.saveDraft(kd._threadID,kd._composerBox,kd._fileUploader,kd._shareLinkUploader,kd._photoUploader);if(!wb(ld)&&!ld.getQueryData().hasOwnProperty('theater')&&!mb.isVaultBoxURI(ld)&&ed(kd))return vb._("You haven't sent your message.");},true);va.onBeforeUnload(function(){if(wb(kb.getNextURI())&&ed(kd))return vb._("You haven't sent your message.");},false);va.onUnload(function(){xb.saveDraft(kd._threadID,kd._composerBox,kd._fileUploader,kd._shareLinkUploader,kd._photoUploader);});}function gd(kd,ld){o.show(kd._bottomShelfComposer);o.addClass(kd._bottomShelfComposer,'invisible_elem');o.conditionClass(kd._bottomShelfButtons,'delete',ld==ya.MESSAGE_ACTION.DELETE);o.show(kd._bottomShelfButtons);}function hd(kd){o.show(kd._bottomShelfComposer);o.addClass(kd._bottomShelfComposer,'invisible_elem');o.show(kd._bottomPendingActions);}function id(kd){if(kd._typingDetector){var ld=kd._threadID,md=null;if(ld){md=z.getUserIDFromThreadID(ld);var nd=ec.getThreadMetaNow(ld);if((!nd||nd.is_canonical)&&!md)ld=null;}if(!ld){kd._typingDetector.setUserAndThread(md,ld);return;}zb.getServerIDFromClientID(ld,function(od){kd._typingDetector.setUserAndThread(md,od);});}}function jd(kd,ld,md){if(p.contains(kd._ariaOwns,md))kd._composerBox.setAttribute('aria-activedescendant',md);}f.exports=gc;},null);
__d('MercuryThreadMetadataRawRenderer',['Event','CSS','DOM','MercuryActionStatus','MercuryErrorInfo','MercuryStatusTemplates','TooltipData','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q={renderParticipantListWithNoThreadName:function(r,s,t,u,v,w){var x={callback:true,check_length:true,show_unread_count:true};w=w||{};var y={};for(var z in w)if(x[z]){y[z]=w[z];delete w[z];}var aa=t.map(function(fa){return u[fa];}),ba=this.renderRawParticipantList(r,aa,t.length,w);ba=this.renderRawTitleWithUnreadCount(ba,y.show_unread_count?s.unread_count:0);var ca=w.abbr_mode,da={};for(var ea in w)da[ea]=w[ea];da.abbr_mode=true;v.forEach((function(fa){var ga=v.length>1?this._cloneIfDOMElement(ba):ba;j.setContent(fa,ga);if(y.check_length&&!ca&&fa.scrollWidth>fa.clientWidth){var ha=this.renderRawParticipantList(r,aa,t.length,da),ia=this.renderRawTitleWithUnreadCount(ha,y.show_unread_count?s.unread_count:0);j.setContent(fa,ia);}}).bind(this));y.callback&&y.callback(ba);},renderRawParticipantList:function(r,s,t,u){var v={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};u=u||{};var w=null;if(u.names_renderer){w=u.names_renderer(s);}else w=s.map(function(y){return y.name;});var x=null;if(w.length===0){if(!r){x=p._("New message");}else x=p._("No Participants");}else if(w.length==1){x=w[0];}else if(w.length==2){if(u.last_separator_uses_and){x=p._("{participant1} and {participant2}",[p.param('participant1',w[0]),p.param('participant2',w[1])]);}else x=p._("{participant1}, {participant2}",[p.param('participant1',w[0]),p.param('participant2',w[1])]);}else if(u.last_separator_uses_and){if(u.abbr_mode){x=p._("{participant1} and {others_link}",[p.param('participant1',w[0]),p.param('others_link',this.renderRawParticipantCount({render_subset:true,count:t-1}))]);}else if(w.length==3){x=p._("{participant1}, {participant2}  and {participant3}",[p.param('participant1',w[0]),p.param('participant2',w[1]),p.param('participant3',w[2])]);}else x=p._("{participant1}, {participant2} and {others_link}",[p.param('participant1',w[0]),p.param('participant2',w[1]),p.param('others_link',this.renderRawParticipantCount({render_subset:true,count:t-2}))]);}else if(w.length==3){x=p._("{participant1}, {participant2}, {participant3}",[p.param('participant1',w[0]),p.param('participant2',w[1]),p.param('participant3',w[2])]);}else x=p._("{participant1}, {participant2}, {participant3}, {others_link}",[p.param('participant1',w[0]),p.param('participant2',w[1]),p.param('participant3',w[2]),p.param('others_link',this.renderRawParticipantCount({render_subset:true,count:t-3}))]);if(Array.isArray(x))x=j.create('span',{},x);return x;},renderRawTitleWithUnreadCount:function(r,s){var t=r;if(s&&s>1)t=j.create('span',{},p._("{conversation_title} ({unread_count})",[p.param('conversation_title',r),p.param('unread_count',s)]));return t;},renderRawParticipantCount:function(r){var s=r.render_subset,t;if(!s){t=r.count>1?p._({"*":"{num} people"},[p.param('num',r.count,[0])]):p._("1 person");}else t=r.count>1?p._({"*":"{others_count} others"},[p.param('others_count',r.count,[0])]):p._("1 other");return t;},renderShortNames:function(r){if(r.length==1)return [r[0].name];return r.map(function(s){return s.short_name;});},renderStatusIndicator:function(r,s,t){var u;if(r==k.RESENDING){u=this.renderResendIndicator();}else if(r!==undefined&&r!=k.UNSENT&&r!=k.UNCONFIRMED&&r!=k.SUCCESS)u=this.renderErrorIndicator(s,t);return u;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(r,s){if(!r)return null;var t=m[':fb:mercury:error-indicator'].render(),u=r.is_transient,v=l.getMessage(r);if(u)if(l.isConnectionError(r)){v=p._("{message} Check your internet connection and click to try again.",[p.param('message',v)]);}else v=p._("{message} Click to send again.",[p.param('message',v)]);n.set(t,v,'above','center');if(s&&u){h.listen(t,'click',s);t.setAttribute('tabindex','0');i.addClass(t,"_55q-");}return t;},_cloneIfDOMElement:function(r){if(r&&r.cloneNode){return r.cloneNode();}else return r;}};f.exports=q;},null);
__d('MercurySeenByAll',['CSS','DataStore','MercuryDelayedRoger','DOM','MercuryIDs','MercuryViewer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=c('MercuryThreads').get(),o={},p={updateOnSeenChange:function(r,s,t){o[r.tagName]=true;i.set(r,'thread-id',s.thread_id);h.addClass(r,'seenByListener');q(r,s,t);}};function q(r,s,t){var u=null;if(t){u=l.getParticipantIDFromUserID(t);}else u=m.getID();var v=s.participants.filter(function(x){return x!==u;}),w=s.participants.length>0&&s.participants[0]===u;h.conditionClass(r,'repliedLast',w);h.conditionClass(r,'seenByAll',w&&j.getSeenBy(s.thread_id).length===v.length);}j.subscribe('state-changed',function(r,s){for(var t in o){var u=k.scry(document.body,t+'.seenByListener');for(var v=0;v<u.length;v++){var w=u[v],x=i.get(w,'thread-id');if(s[x])n.getThreadMeta(x,function(y){q(w,y);});}}});f.exports=p;},null);
__d('MercuryThreadMetadataRenderer',['CSS','DOM','Emoji','HTML','JSLogger','MercuryAttachmentType','MercuryIDs','MercuryMessageSourceTags','MercurySingletonMixin','MercuryThreadImage.react','MercuryThreadIDMap','MercuryThreadMetadataRawRenderer','MercuryThreadTitle.react','MercuryParticipants','React','ReactDOM','MercurySeenByAll','MercuryServerRequests','Style','MercuryThreads','Tooltip','URI','WebMessengerThreadPermalinks','arrayContains','createArrayFromMixed','cx','formatDate','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){if(c.__markCompiled)c.__markCompiled();var ja=l.create('wm_timestamp');function ka(pa){this._fbid=pa;this._serverRequests=y.getForFBID(pa);this._threads=aa.getForFBID(pa);this._threadIDMap=r.getForFBID(pa);}Object.assign(ka,p);Object.assign(ka.prototype,{renderTimestamp:function(pa,qa,ra,sa){if(sa){if(!qa){ja.warn('no_title');qa=new Date(sa).toLocaleDateString();}pa.setAttribute('title',qa);pa.setAttribute('data-utime',sa/1000);if(!ra){ja.warn('no_display');ra=ha(new Date(sa),'g:ia');}i.setContent(pa,ra);h.show(pa);}},renderMessageSourceTags:function(pa,qa,ra,sa){var ta='',ua='',va='';if(ea(ra,o.MESSENGER)){ta=ia._("Sent from Messenger");ua=new ca('/mobile/messenger');va="_9g";}else if(ea(ra,o.MOBILE)){ta=ia._("Sent from Mobile");ua=new ca('/mobile/');va="_9j";}else if(ea(ra,o.CHAT)){ta=ia._("Sent from chat");va="_9h";}else if(ea(ra,o.EMAIL)){if(sa){ta=ia._("Sent from {email}",[ia.param('email',sa)]);}else ta=ia._("Sent from email");va="_9i";}if(va){ba.set(pa,ta);h.addClass(qa,va);if(ua){pa.setAttribute('href',ua);}else pa.removeAttribute('href');}else h.hide(pa);},renderSpoofWarning:function(pa,qa,ra){if(qa){h.addClass(pa,"_sa");ba.set(pa,ia._("Unable to confirm {name_or_email} as the sender.",[ia.param('name_or_email',ra.name)]));}},renderChatSpoofWarning:function(pa,qa,ra){if(qa)i.appendContent(pa,ia._("Unable to confirm {name_or_email} as the sender.",[ia.param('name_or_email',ra.name)]));},renderCoreThreadlist:function(pa,qa,ra,sa,ta){sa=sa||{};this.renderThreadImage(pa,qa.getNode('image'));var ua=qa.getNode('accessibleName'),va=[qa.getNode('name')];if(ua)va.push(ua);oa(this,pa,va,sa);if(pa.folder&&ta)na(qa.getNode('folderBadge'),pa.folder);var wa=qa.getNode('timestamp');this.renderTimestamp(wa,pa.timestamp_absolute,pa.timestamp_relative,pa.timestamp);this.renderSnippet(pa,qa.getNode('snippet'));ma(qa,pa);ra(qa,pa);},renderAndSeparatedParticipantList:function(pa,qa,ra){ra=ra||{};ra.last_separator_uses_and=true;this._threads.getThreadMeta(pa,(function(sa){oa(this,sa,qa,ra);}).bind(this));},renderSnippet:function(pa,qa){var ra=false,sa=i.create('span');h.addClass(sa,"_3jy5");i.appendContent(qa,sa);x.updateOnSeenChange(sa,pa,this._fbid);var ta=pa.snippet;if(ta){if(pa.snippet_has_attachment)i.appendContent(qa,i.create('span',{className:"_j0r"}));if(ta.substr(0,4)=='?OTR'){ta=ia._("[encrypted message]");}else ta=ta.replace(/\r\n|[\r\n]/g," ");ta=k(j.htmlEmojiAndEmote(ta));}else if(pa.snippet_has_attachment&&pa.snippet_attachments&&pa.snippet_attachments.length){ra=true;ta=i.create('span');e(['MercuryAttachmentSnippet.react'],(function(wa){w.render(v.createElement(wa,{thread:pa,viewer:this._fbid}),ta);}).bind(this));}var ua=pa.participants.length;if(pa.is_subscribed)ua--;var va=pa.snippet_sender;if(!ra&&va&&n.getParticipantIDFromUserID(this._fbid)!=va&&ua>1){u.get(va,function(wa){if(wa.short_name){i.appendContent(qa,ia._("{name}: {conversation_snippet}",[ia.param('name',wa.short_name),ia.param('conversation_snippet',ta)]));}else i.appendContent(qa,ta);});}else i.appendContent(qa,ta);},renderWebMessengerLink:function(pa,qa,ra,sa){da.getThreadURI(pa,function(ta){qa.setAttribute('href',ta);ra&&ra();},sa);},renderThreadImage:function(pa,qa){w.render(v.createElement(q,{thread:pa,viewer:this._fbid}),qa);},renderParticipantList:function(pa,qa,ra,sa){return s.renderRawParticipantList(this._threadIDMap.getServerIDFromClientIDNow(pa),qa,ra,sa);},renderThreadNameAndParticipantList:function(pa,qa,ra,sa){var ta=s.renderRawParticipantList(this._threadIDMap.getServerIDFromClientIDNow(pa),qa,ra,sa),ua=this._threads.getThreadMetaNow(pa);if(!ua.name)return ta;return ia._("{conversation_name} [with {participant_list}]",[ia.param('conversation_name',ua.name),ia.param('participant_list',ta)]);},renderParticipantCount:function(pa,qa){return s.renderRawParticipantCount(qa);}});function la(pa){if(!pa.snippet_attachments)return [];return pa.snippet_attachments.filter(function(qa){return qa.attach_type===m.PHOTO;});}function ma(pa,qa){var ra=la(qa);if(ra.length===0)return;var sa=ra[0].thumbnail_url;if(!sa)return;var ta=ra.length==1?'snippet-thumbnail-single':'snippet-thumbnail-multiple',ua=pa.getNode(ta);if(!ua)return;var va=i.find(ua,'i');z.set(va,'background-image','url('+sa+')');h.show(ua);}function na(pa,qa){fa(pa).forEach(function(ra){i.setContent(ra,qa);});}function oa(pa,qa,ra,sa){ra=fa(ra);var ta=pa._fbid;if(qa.name){ra.forEach(function(va){w.render(v.createElement(t,{thread:qa,viewer:ta,showUnreadCount:!!sa.show_unread_count}),va);});return;}var ua=qa.participants;if(qa.participants.length>1)ua=qa.participants.filter(function(va){return va!=n.getParticipantIDFromUserID(ta);});u.getMulti(ua,function(va){s.renderParticipantListWithNoThreadName(pa._threadIDMap.getServerIDFromClientIDNow(qa.thread_id),qa,ua,va,ra,sa);});}f.exports=ka;},null);
__d('MercuryDataSourceHelper',['MercuryPayloadSource','MercuryTypeaheadConstants','MercuryThreadMetadataRawRenderer','MercuryServerPayloadPreprocessor','MercuryThreadMetadataRenderer'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryServerPayloadPreprocessor').get(),l=c('MercuryThreadMetadataRenderer').get(),m={updateMercuryOnFetchComplete:function(n){n.subscribe('fetchComplete',function(o,p){var q={participants:[],threads:[],pages:[],payload_source:h.SERVER_SEARCH};p.response.getPayload().entries.forEach(function(r){if(r.type==i.THREAD_TYPE){q.threads=q.threads.concat(r.mercury_thread);q.participants=q.participants.concat(r.participants_to_render);}else if(r.type==i.PAGE_TYPE)q.pages=q.pages.concat(r);});if(q.threads.length){k.handleUpdate(q);p.response.getPayload().entries.forEach(function(r){if(r.mercury_thread)r.text=l.renderThreadNameAndParticipantList(r.mercury_thread.thread_id,r.participants_to_render,r.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:j.renderShortNames});});}});}};f.exports=m;},null);
__d('WebMessengerComposerTypeaheadView',['BucketedTypeaheadView','CSS','DataStore','MercuryTypeaheadConstants','WebMessengerStateConstants','WebMessengerStateManager','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p,q;p=babelHelpers.inherits(r,h);q=p&&p.prototype;function r(v,w){'use strict';q.constructor.call(this,v,w);this.typeObjects={};this.typeObjects[k.FRIEND_TYPE]={disabled:true,uid:k.FRIEND_TYPE,type:k.HEADER_TYPE};this.typeObjects[k.THREAD_TYPE]={uid:k.THREAD_TYPE,text:o._("Group Conversations"),type:k.HEADER_TYPE,linkText:o._("Show More"),getLinkHandler:u.bind(null,this)};this.typeObjects[k.PAGE_TYPE]={uid:k.PAGE_TYPE,text:o._("Businesses"),type:k.HEADER_TYPE};this.typeObjects[k.FB4C_TYPE]={uid:k.THREAD_TYPE,text:o._("Colleagues"),type:k.HEADER_TYPE};this.typeObjects[k.NON_FRIEND_TYPE]={uid:k.NON_FRIEND_TYPE,text:o._("Other People"),type:k.HEADER_TYPE,linkText:o._("Show All"),getLinkHandler:(function(){return (function(){t(this.value);}).bind(this);}).bind(this)};}r.prototype.setTypeahead=function(v){'use strict';q.setTypeahead.call(this,v);var w=j.get(v,'Typeahead');w.subscribe('loading',(function(x,y){var z=w.getData();if(this._threadHeader)i.conditionClass(this._threadHeader,"_355",z.isLoadingMore(this.value));}).bind(this));};r.prototype.setNewHeader=function(v,w){'use strict';if(w.uid===k.THREAD_TYPE)this._threadHeader=v;};r.prototype.mouseover=function(event){'use strict';if(!s(this,event))q.mouseover.call(this,event);};r.prototype.mouseup=function(event){'use strict';if(!s(this,event))q.mouseup.call(this,event);};r.prototype.clearSelected=function(){'use strict';this.index=-1;this.highlight(-1);};function s(v,event){var w=v.getIndex(event);return w>=0&&w<v.results.length&&v.results[w].type==k.HEADER_TYPE;}function t(v){var w=babelHelpers._extends({},m.getCurrentStateData(),{all_people_query:v,start:false});m.updateDetailState(l.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,w);}function u(v){var w=j.get(v.typeahead,'Typeahead'),x=w.getData();if(x.hasLoadedInitialResults(v.value)&&!x.hasLoadedAllResults(v.value))return x.loadMore.bind(x);}f.exports=r;},null);
__d('MercuryExpandableDataSource',['MercuryTypeaheadDataSource'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;i=babelHelpers.inherits(k,h);j=i&&i.prototype;function k(l,m,n){'use strict';l=l||{};l.maxResults=m;j.constructor.call(this,l);this.$MercuryExpandableDataSource1=m;this.$MercuryExpandableDataSource2=n;this.$MercuryExpandableDataSource3={};}k.prototype.query=function(l,m,n){'use strict';this.setQueryData({offset:0,limit:this.$MercuryExpandableDataSource1});return j.query.call(this,l,m,n);};k.prototype.fetchHandler=function(l,m){'use strict';var n=l.getPayload(),o=m.value;this.getState('is_loading_more_per_query')[o]=false;this.getState('total_results_count_per_query')[o]=n.total_count;j.fetchHandler.call(this,l,m);};k.prototype.loadMore=function(){'use strict';if(this.value&&!this.hasLoadedAllResults()){var l=this.getState('max_results_per_query');if(!l[this.value])l[this.value]=this.$MercuryExpandableDataSource1;this.setQueryData({offset:l[this.value],limit:this.$MercuryExpandableDataSource2});l[this.value]+=this.$MercuryExpandableDataSource2;if(l[this.value]>this.$MercuryExpandableDataSource4)this.$MercuryExpandableDataSource4=l[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};k.prototype.isLoadingMore=function(){'use strict';return this.getState('is_loading_more_per_query')[this.value];};k.prototype.hasLoadedAllResults=function(){'use strict';var l=this.getState('total_results_count_per_query')[this.value],m=(this.buildQueryResults(this.value)||[]).length;return l&&m>=l;};k.prototype.getStates=function(){'use strict';return this.$MercuryExpandableDataSource3;};k.prototype.getState=function(l){'use strict';var m=this.getStates();if(!m[l])m[l]={};return m[l];};f.exports=k;},null);
__d('WebMessengerTypeaheadDataSource',['MercuryExpandableDataSource','MercuryIDs','MercuryParticipants','MercuryTypeaheadConstants','WebMessengerStateManager'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;m=babelHelpers.inherits(o,h);n=m&&m.prototype;function o(r){'use strict';r=r||{};r.kanaNormalization=true;n.constructor.call(this,r,k.COMPOSER_THREADS_INITIAL_LIMIT,k.COMPOSER_SHOW_MORE_LIMIT);this.setMaxResults(k.COMPOSER_WM_MAX);}o.prototype.bootstrap=function(){'use strict';if(!n.bootstrap.call(this))this.fetchEntryBigProfilePic();};o.prototype.updateBootstrapData=function(){'use strict';n.updateBootstrapData.call(this);this.fetchEntryBigProfilePic();};o.prototype.buildData=function(r){'use strict';var s=[],t=[],u=[],v=[],w=[];r.forEach(function(y){var z=n.getEntry.call(this,y);switch(z.render_type){case k.FRIEND_TYPE:if(s.length<k.COMPOSER_FRIENDS_MAX)s.push(y);break;case k.THREAD_TYPE:var aa=z.mercury_thread.thread_fbid;z.uid=aa;n.setEntry.call(this,aa,z);if(p().length===0)t.push(aa);break;case k.NON_FRIEND_TYPE:if(u.length<k.COMPOSER_NON_FRIENDS_MAX)u.push(y);break;case k.FB4C_TYPE:if(v.length<k.COMPOSER_FB4C_MAX)v.push(y);break;case k.PAGE_TYPE:if(w.length<k.COMPOSER_PAGES_MAX&&p().length===0)w.push(y);break;}},this);var x=s.concat(v,t,w,u);return n.buildData.call(this,x);};o.prototype.query=function(r,s,t){'use strict';this.value=r;if(!n.query.call(this,r,s,t)){if(this.getState('loaded_all_threads_per_query')[r]==null)this.getState('loaded_all_threads_per_query')[r]=true;this.getState('loaded_initial_per_query')[r]=true;}this.logQuery({event:'query_web_messenger',query:r});};o.prototype.respond=function(r,s,t){'use strict';var u=n.respond.call(this,r,s,t);this.logResponse({event:'query_response_web_messenger',response_query:r,response_uids:s});return u;};o.prototype.getQueryData=function(r,s){'use strict';var t=n.getQueryData.call(this,r,s);t.existing_token_ids=p();return t;};o.prototype.fetchHandler=function(r,s){'use strict';this.getState('loaded_all_threads_per_query')[s.value]=r.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[s.value]=true;n.fetchHandler.call(this,r,s);};o.prototype.hasLoadedInitialResults=function(r){'use strict';if(r===undefined)r=this.value;return this.getState('loaded_initial_per_query')[r]||r&&r.length<=1;};o.prototype.hasLoadedAllResults=function(r){'use strict';if(r===undefined)r=this.value;return this.getState('loaded_all_threads_per_query')[r];};o.prototype.fetchEntryBigProfilePic=function(){'use strict';var r=this.getCachedShortProfileIDs().map(function(s){return i.getParticipantIDFromUserID(s);});j.getBigImageMulti(r,q.bind(this));};o.prototype.loadMore=function(){'use strict';this.setMaxResults(this.buildQueryResults(this.value).length+k.COMPOSER_SHOW_MORE_LIMIT*2);n.loadMore.call(this);};function p(){var r=l.getCurrentStateData();return (r.participants||[]).map(function(s){return i.tokenize(s).value;});}function q(r){for(var s in r)if(r.hasOwnProperty(s)){var t=this.getEntry(i.getUserIDFromParticipantID(s));if(t)t.photo=r[s];}if(this.value)this.query(this.value);}f.exports=o;},null);
__d('WebMessengerTypeaheadRenderer',['CurrentUser','DOM','ImmutableObject','MercuryAPIArgsSource','MercuryThreadImage.react','MercuryTypeaheadConstants','MercuryTypeaheadRenderer','React','ReactDOM','WebMessengerTemplates','MercuryThreadMetadataRawRenderer','MercuryThreadIDMap','MercuryThreadMetadataRenderer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=c('MercuryThreadIDMap').get(),t=c('MercuryThreadMetadataRenderer').get(),u=c('MercuryThreads').get(),v=50;function w(y,z){var aa;switch(y.type){case m.HEADER_TYPE:aa=q[':fb:web-messenger:typeahead-header'].build();n.renderHeader(aa,y);if(this.setNewHeader)this.setNewHeader(aa.getRoot(),y);break;case m.USER_TYPE:case m.PAGE_TYPE:aa=q[':fb:web-messenger:threadlist-row'].build();n.renderPersonWithBigPhoto(aa,y);break;case m.THREAD_TYPE:aa=q[':fb:web-messenger:threadlist-row'].build();x(aa,y);break;default:return i.create('div');}return aa.getRoot();}function x(y,z){var aa=s.getClientIDFromServerIDNow(z.uid),ba=o.createElement(l,{size:v,thread:new j(z.mercury_thread),viewer:h.getID()});p.render(ba,y.getNode('image'));var ca=t.renderThreadNameAndParticipantList(aa,z.participants_to_render,z.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:r.renderShortNames});i.setContent(y.getNode('name'),ca);y.getRoot().setAttribute('aria-label',ca);u.getThreadMeta(aa,function(da){t.renderSnippet(da,y.getNode('snippet'));t.renderTimestamp(y.getNode('timestamp'),da.timestamp_absolute,da.timestamp_relative,da.timestamp);},k.WEBMESSENGER);}f.exports=w;},null);
__d('WebMessengerDetailViewComposeTypeaheadControl',['Event','WebMessengerComposerTypeaheadView','CSS','DOM','MercuryFolders','Keys','MercuryDataSourceHelper','MercuryIDs','MercuryTypeahead','MercuryTypeaheadConstants','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerEvents','WebMessengerTypeaheadDataSource','WebMessengerSubscriptionsHandler','WebMessengerTypeaheadRenderer','fbt','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z=c('MercuryThreads').get();function aa(ea,fa){'use strict';this._typeaheadRoot=ea;this._resultsRoot=fa;k.empty(this._typeaheadRoot);k.empty(this._resultsRoot);}aa.prototype.hideView=function(){'use strict';j.hide(this._typeaheadRoot);j.hide(this._resultsRoot);};aa.prototype.updateView=function(){'use strict';var ea=r;switch(s.getCurrentDetailState()){case ea.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();j.hide(this._resultsRoot);break;case ea.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();j.show(this._resultsRoot);break;}u.detailDOMChanged();};aa.prototype.renderComposeTypeahead=function(){'use strict';var ea=s.getCurrentStateData();j.show(this._typeaheadRoot);j.show(this._resultsRoot);if(!this._initiated){var fa=t[':fb:web-messenger:read-view:compose:typeahead'].build();k.setContent(this._typeaheadRoot,fa.getRoot());var ga=t[':fb:web-messenger:read-view:compose:typeahead:results'].build();k.setContent(this._resultsRoot,ga.getRoot());this._initialResultsLoadingSpinner=ga.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=ga.getNode('typeaheadFooter');this._moreResultsLink=ga.getNode('moreResultsLink');this._typeaheadCaption=ga.getNode('caption');this.buildTypeahead(ga.getNode('results'));k.appendContent(fa.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(ea.start){if(!ea.participants)this._typeahead.reset();this._typeahead.focus();var ha=this._typeahead.getTypeahead().getCore();ha.getElement().removeAttribute('disabled');}ca(this);if(ea.start)s.updateDetailState(s.getCurrentDetailState(),babelHelpers._extends({},s.getCurrentStateData(),{start:false,new_tokens:undefined}));};aa.prototype.buildTypeahead=function(ea){'use strict';if(this._typeahead)return;var fa=new v({queryEndpoint:'/ajax/mercury/composer_query.php'});n.updateMercuryOnFetchComplete(fa);var ga=new p(fa,i);ga.setPlaceholder(y._("Name"));ga.setViewNodeID(ea);ga.setViewOption('renderer',x);w.addSubscriptions(ga.subscribe('tokens-changed',this.onTokensChanged.bind(this)));ga.build();w.addSubscriptions(ga.getTypeahead().subscribe(['respond','focus'],function(){ba(!!ga.getTypeahead().getCore().getValue());}),ga.getTypeahead().subscribe(['reset','blur'],function(){ba(false);}),ga.getTypeahead().subscribe('render',(function(ha,ia){da(this,ia.length);}).bind(this)),ga.getTypeahead().subscribe('reset',(function(){da(this,false);}).bind(this)),ga.getTypeahead().subscribe('query',(function(ha,ia){k.setContent(this._moreResultsLink,y._("See more results for {query}",[y.param('query',ia.value)]));}).bind(this)),h.listen(ga.getElement(),'keydown',function(ha){if(ha.keyCode===m.TAB&&!ha.getModifiers().any){u.focusComposer();return false;}}),h.listen(this._typeaheadFooter,'mousedown',function(){return false;}),h.listen(this._moreResultsLink,'click',(function(){var ha=this._typeahead.getTypeahead().getCore().getValue(),ia=babelHelpers._extends({},s.getCurrentStateData(),{all_people_query:ha,start:false});s.updateDetailState(r.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ia);}).bind(this)),h.listen(this._typeaheadFooter,'mouseover',(function(){this._typeahead.getTypeahead().getView().clearSelected();}).bind(this)));this._typeahead=ga;};aa.prototype.onTokensChanged=function(){'use strict';var ea=s.getCurrentDetailState();if(ea==r.DETAIL.COMPOSE_MAIN||ea==r.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||ea==r.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var fa=this._typeahead,ga=fa.getTokens(),ha=ga[ga.length-1];if(ha&&ha.getInfo().mercury_thread){var ia=ha.getInfo().mercury_thread.thread_id,ja=l.getFromMeta(z.getThreadMetaNow(ia));s.updateDetailState(r.DETAIL.RECENT_MESSAGES,{thread_id:ia,folder:ja,reuse_composer:true});}else{var ka=ga.map(function(ma){if(ma.getInfo().type===q.PAGE_TYPE){var na=fa.getTypeahead().getCore();na.getElement().setAttribute('disabled','disabled');}return o.getParticipantIDFromUserID(ma.getValue());}),la=s.getCurrentStateData();if(!la.start||(ka||[]).length)s.updateDetailState(r.DETAIL.COMPOSE_MAIN,babelHelpers._extends({},la,{participants:ka}));}}};aa.prototype.destroy=function(){'use strict';};function ba(ea){var fa=s.getCurrentDetailState(),ga=r;if(fa!=ga.DETAIL.COMPOSE_MAIN&&fa!=ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ha;if(ea){ha=ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(fa==ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ha=ga.DETAIL.COMPOSE_MAIN;}else ha=fa;if(ha!=fa){var ia=babelHelpers._extends({},s.getCurrentStateData(),{start:false,new_tokens:undefined});s.updateDetailState(ha,ia);}}function ca(ea){var fa=s.getCurrentStateData();if(fa.new_tokens){var ga=ea._typeahead.getTypeahead().getCore();ga.reset();fa.new_tokens.forEach(function(ha){ea._typeahead.getTokenizer().addToken(ha);});}}function da(ea,fa){var ga=ea._typeahead.getTypeahead(),ha=ga.getCore().getValue(),ia=ga.getData().hasLoadedInitialResults(ha);j.conditionShow(ea._initialResultsLoadingSpinner,!ia);j.conditionShow(ea._moreResultsLink,ia&&fa);if(!fa&&ia){k.setContent(ea._typeaheadCaption,y._("No results found"));}else k.setContent(ea._typeaheadCaption,y._("Displaying top results"));}f.exports=aa;},null);
__d("Autosize",["CSS","cx","DOM","Style"],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],m=/^[0-9]+$/;function n(s){var t=s.cloneNode(true);h.addClass(t,"_4g");var u=s.clientWidth-k.getFloat(s,'paddingLeft')-k.getFloat(s,'paddingRight');k.set(t,'width',u+'px');var v=s.clientHeight-k.getFloat(s,'paddingTop')-k.getFloat(s,'paddingBottom');k.set(t,'height',v+'px');j.insertAfter(s,t);return t;}function o(s,t,u,v,w){var x=s.style.fontSize,y=s.style.height;k.set(s,"height","auto");if(t!==null){var z=s.style.width;k.set(s,"width","auto");}var aa=0,ba=w.length-1;while(aa<ba){var ca=Math.ceil((aa+ba)/2);k.set(s,"font-size",w[ca]+v);if(u!==null&&s.scrollHeight>u||t!==null&&s.scrollWidth>t){ba=ca-1;}else aa=ca;}s.style.fontSize=x;s.style.height=y;if(t!==null)s.style.width=z;return w[aa]+v;}function p(s,t,u,v,w,x){var y=s.style.fontSize,z=s.style.height;k.set(s,"height","auto");if(t!==null){var aa=s.style.width;k.set(s,"width","auto");}k.set(s,"font-size",x+v);if((u===null||s.scrollHeight<=u)&&(t===null||s.scrollWidth<=t)){s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return x+v;}k.set(s,"font-size",w+v);if(u!==null&&s.scrollHeight>u||t!==null&&s.scrollWidth>t){s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return w+v;}while(w+1<x){var ba=Math.ceil((w+x)/2);k.set(s,"font-size",ba+v);if(u!==null&&s.scrollHeight>u||t!==null&&s.scrollWidth>t){x=ba;}else w=ba;}s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return w+v;}function q(s,t){this._wrap=s;this._attr=t;if(this._attr.sizes){var u=this._attr.sizes;for(var v=1,w=u.length;v<w;v++){if(u[v-1]<=u[v])continue;u.sort(function(y,z){return y-z;});break;}}else if(t.min>t.max){var x=t.min;t.min=t.max;t.max=x;}this.fit();}q.prototype.fit=function(s,t){var u=this._wrap;if(!u.clientWidth){r.push(this);return;}var v=n(u);if(typeof s==="undefined")s=this._attr.width;if(m.test(s)){v.style.width=s+"px";}else if(s!==null&&s!=="auto")v.style.width=s;if(typeof t==="undefined")t=this._attr.height;if(m.test(t)){v.style.height=t+"px";}else if(t!==null&&t!=="auto")v.style.height=t;var w=null;if(!this._attr.wrap)w=v.clientWidth;var x=null;if(this._attr.wrap||t!==null)x=v.clientHeight;var y;if(this._attr.sizes){y=o(v,w,x,"px",this._attr.sizes);}else y=p(v,w,x,"px",this._attr.min,this._attr.max);j.remove(v);k.set(u,"font-size",y);h.removeClass(u,"invisible_elem");};var r=[];q.onNodeInserted=function(){var s=r;r=[];s.forEach(function(t){t.fit();});};f.exports=q;},null);
__d('MercuryPresence',['Arbiter','AvailableListConstants','DOM','CSS','requireWeak','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n={},o={},p={updateOnPresenceChanges:function(v,w){o[w.tagName]=true;n[v]=true;k.addClass(w,'presenceListener_'+v);var x=q(v);r(w,x.classes);s(w,x.label);}};function q(v){var w=u(v),x={presenceActive:false,presenceMobile:false},y=null;switch(w){case i.ACTIVE:x.presenceActive=true;y=m._("Active");break;case i.MOBILE:x.presenceMobile=true;y=m._("Mobile");break;default:break;}return {classes:x,label:y};}function r(v,w){for(var x in w)k.conditionClass(v,x,w[x]);}function s(v,w){if(v&&w){var x=j.create('span',{className:'accessible_elem'},w);j.setContent(v,x);}}function t(){for(var v in n){var w=q(v);for(var x in o){var y=j.scry(document,x+'.presenceListener_'+v);for(var z=0;z<y.length;z++){r(y[z],w.classes);s(y[z],w.label);}}}}var u=function(v){return i.OFFLINE;};l('AvailableList',function(v){u=v.get;t();});h.subscribe(i.ON_AVAILABILITY_CHANGED,t);f.exports=p;},null);
__d('WebMessengerDetailViewHeaderControl',['WebMessengerAddPeopleToConversationDialog','Autosize','AvailableListConstants','Bootloader','ContextualDialog','CSS','DOM','WebMessengerEditThreadDialog','Event','HovercardLink','HoverFlyout','JSXDOM','LastActiveTimes','LayerFadeOnHide','LayerFadeOnShow','LayerHideOnTransition','MercuryAPIArgsSource','MercuryConfig','MercuryIDs','MercuryThreadInfo','MercuryViewer','MNCommerceDialogStateActions','MNCommercePromotionBlockDataManager','MNCommercePromotionManageBlockDialogContainer.react','MercuryParticipants','MercuryPresence','ScrollableArea','WebMessengerStateConstants','WebMessengerStateManager','Style','WebMessengerTemplates','Tooltip','WebMessengerConstants','WebMessengerEvents','WebMessengerSubscriptionsHandler','csx','cx','curry','fbt','isNode','MercuryThreadInformer','MercuryThreadMetadataRenderer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua){if(c.__markCompiled)c.__markCompiled();var va=c('MercuryThreadInformer').get(),wa=c('MercuryThreadMetadataRenderer').get(),xa=c('MercuryThreads').get(),ya=null;function za(hb){'use strict';this._rootElement=hb;n.empty(this._rootElement);this._renderHeaderBar();}za.prototype.hideView=function(){'use strict';m.hide(this._rootElement);};za.prototype.updateView=function(){'use strict';m.removeClass(this._rootElement,'hasMultiChatThreadActions');m.show(this._rootElement);if(this._listener){va.unsubscribe(this._listener);this._listener=null;}var hb=ia;switch(ja.getCurrentDetailState()){case hb.DETAIL.RECENT_MESSAGES:case hb.DETAIL.SEARCH_CONTEXT:case hb.DETAIL.SEARCH_THREAD_SNIPPET:case hb.DETAIL.SHARED_PHOTOS:this.setThreadID(ja.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}oa.detailDOMChanged();};za.prototype.setThreadID=function(hb){'use strict';this._threadID=hb;if(this._threadID){this._listener=va.listen(this._threadID,this.updateView.bind(this));pa.addSubscriptions(this._listener);}hb&&xa.getThreadMeta(hb,(function(ib){if(this._threadID==hb)m.conditionClass(this._rootElement,'hasMultiChatThreadActions',!ib.is_canonical&&aa.canReply(ib));}).bind(this));};za.prototype._renderHeaderBar=function(){'use strict';this._headerBar=la[':fb:web-messenger:read-view:header'].build();n.appendContent(this._rootElement,this._headerBar.getRoot());var hb=this._headerBar.getNode('editThreadName'),ib=this._headerBar.getNode('addPeopleToThread'),jb=new o(),kb=this._headerBar.getNode('webMessengerManageButton'),lb=function(mb,nb){return da.block(mb,nb);};this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');pa.addSubscriptions(p.listen(this._headerBar.getNode('closeButton'),'click',function(){var mb=babelHelpers._extends({},ja.getCurrentStateData(),{all_people_query:undefined});ja.updateDetailState(ia.DETAIL.COMPOSE_MAIN,mb);}),p.listen(hb,'click',(function(event){this._threadID&&jb.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}).bind(this)),p.listen(ib,'click',(function(event){this._threadID&&h.show(this._threadID);return true;}).bind(this)),p.listen(kb,'click',(function(event){this._threadID&&ca.showDialog(ea,{pageID:z.getUserIDFromThreadID(this._threadID),onConfirmButtonClick:lb});return true;}).bind(this)),oa.subscribe(oa.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};za.prototype.updateHeaderBar=function(){'use strict';var hb=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var ib=s.span(null);n.setContent(this._title_node_wrapper,ib);var jb=this._headerBar.getNode('webMessengerRecIndicator');jb&&m.hide(jb);var kb=this._headerBar.getNode('webMessengerManageButton');kb&&m.hide(kb);var lb=ja.getCurrentDetailState(),mb=lb==ia.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;m.conditionShow(this._headerBar.getNode('closeButton'),mb);m.conditionClass(this._title_node_wrapper,'allPeopleResults',mb);m.hide(this._relationship_status);m.removeClass(this._title_node_wrapper,"_50jz");var nb,ob;switch(lb){case ia.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ob=ja.getCurrentStateData().all_people_query;nb=ta._("People matching {query}",[ta.param('query',n.create('strong',{},ob))]);break;case ia.DETAIL.COMPOSE_MAIN:case ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:nb=ta._("New message");break;case ia.DETAIL.SEARCH_SNIPPET:ob=ja.getCurrentStateData().message_query;if(ob)nb=ta._("Messages with word: {query}",[ta.param('query',ob)]);break;}var pb=!nb&&!this._threadID;if(pb)nb=ta._("No Selection");m.conditionClass(this._title_node_wrapper,"_3jd",pb);if(nb){n.setContent(ib,nb);gb(this._title_node_wrapper,this._threadID,hb,jb);return;}wa.renderAndSeparatedParticipantList(this._threadID,ib,{check_length:false,names_renderer:(function(qb){var rb=xa.getThreadMetaNow(this._threadID),sb=qb.map((function(ub){var vb=qb.length===1?ub.name:ub.short_name;if(rb&&rb.custom_nickname){var wb=z.getUserIDFromParticipantID(ub.id);if(rb.custom_nickname[wb])vb=rb.custom_nickname[wb];}var xb=ub.id?z.getUserIDFromParticipantID(ub.id):null;if(xb&&ub.href){var yb=s.a({href:ub.href},vb);if(qb.length===1)yb.setAttribute('data-hovercard',q.constructEndpoint({id:xb}));if(ja.getStandaloneMode())yb.setAttribute('target','_blank');return yb;}else return vb;}).bind(this));if(qb.length===1&&qb[0].fbid!==null){var tb=s.span(null);n.setContent(tb,sb[0]);bb(qb[0],tb);sb[0]=tb;}return sb;}).bind(this)});if(jb)xa.getThreadMeta(this._threadID,function(qb){cb(qb,jb);});if(kb)xa.getThreadMeta(this._threadID,function(qb){db(qb,kb);});this.renderParticipantListFlyout(ib);this.renderNamedThreadParticipantCount(ib);gb(this._title_node_wrapper,this._threadID,hb,jb);new i(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};za.prototype.renderNamedThreadParticipantCount=function(hb){'use strict';xa.getThreadMeta(this._threadID,function(ib){if(ib.name){var jb=wa.renderParticipantCount(ib.thread_id,{count:ib.participants.length}),kb=n.create('span',{className:"_1us"},ta._("{participants}",[ta.param('participants',jb)]));n.appendContent(hb,kb);}},x.WEBMESSENGER);};za.prototype.renderParticipantListFlyout=function(hb){'use strict';this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var ib=this._threadID;xa.getThreadMeta(this._threadID,(function(jb){var kb=jb.participants;if(!jb.name){kb=kb.filter(function(lb){return lb!==ba.getID();});if(kb.length<=1)return;}fa.getMulti(kb,(function(lb){if(this._threadID!=ib)return;var mb=0,nb=la[':fb:web-messenger:flyoutlist'].build();for(var ob in lb){if(!lb.hasOwnProperty(ob))continue;var pb=lb[ob],qb=la[':fb:web-messenger:flyoutlist-profile-item'].build();qb.getNode('profilePhoto').setAttribute('src',pb.image_src);var rb=qb.getNode('title');if(pb.href){var sb=s.a({href:pb.href});n.setContent(rb,sb);rb=sb;var tb=qb.getNode('profilePhoto'),ub=s.a({href:pb.href});n.replace(tb,ub);n.setContent(ub,tb);if(ja.getStandaloneMode()){sb.setAttribute('target','_blank');ub.setAttribute('target','_blank');}}n.setContent(rb,pb.name);bb(pb,qb.getNode('title'));n.setContent(qb.getNode('infoLine'),fb(pb));mb++;n.appendContent(nb.getNode('list'),qb.getRoot());}var vb=nb.getRoot();this._dialog=new l({context:hb,position:'below',addedBehaviors:[u,v,w]},vb);this._flyout=new r();this._flyout.init(this._dialog);this._flyout.initNode(hb);eb(this._flyout,vb,mb);}).bind(this));}).bind(this),x.WEBMESSENGER);};za.prototype.destroy=function(){'use strict';};function ab(hb,ib,jb){var kb=t.getShortDisplay(jb);if(!kb||hb.get(jb)!==j.MOBILE){ma.remove(ib);return;}ma.set(ib,ta._("Last active {time} ago",[ta.param('time',kb)]),'right');}function bb(hb,ib){var jb=z.getUserIDFromParticipantID(hb.id);if(!jb)return;var kb=s.span(null);ga.updateOnPresenceChanges(jb,kb);if(ua(ib)){k.loadModules(["PresenceStatus","ChatOpenTab"],function(lb,mb){p.listen(kb,'mouseenter',sa(ab,lb,kb,jb));p.listen(kb,'click',mb.openUserTab.bind(null,jb,'web messenger header'));});n.appendContent(ib,kb);}}function cb(hb,ib){if(ib)fa.getMulti(hb.participants,function(jb){var kb=true;for(var lb in jb)if(jb.hasOwnProperty(lb))kb=kb&&jb[lb].employee;m.conditionShow(ib,kb);});}function db(hb,ib){if(y.WWWMessengerManageButtonGK&&ib&&hb.thread_fbid)fa.get(z.getParticipantIDFromUserID(hb.thread_fbid),function(jb){var kb=jb.is_business_enabled;m.conditionShow(ib,kb);});}function eb(hb,ib,jb){if(jb<=na.MAX_VISIBLE_IN_FLYOUT)return;var kb=ha.fromNative(ib,{fade:true});ib.style.height=na.PARTICIPANTS_FLYOUT_HEIGHT+'px';hb.subscribe('show',function(){kb.showScrollbar(false);});}function fb(hb){var ib=hb.social_snippets||{},jb=Object.keys(ib);if(jb.length>0){var kb=jb.slice(0,1).map(function(lb){return ib[lb];});return kb;}return '';}function gb(hb,ib,jb,kb){var lb=jb.offsetWidth;if(kb){ya=ya||kb.offsetWidth;lb+=ya;}var mb=n.scry(document.body,"div._2nd");if(mb.length)lb+=mb[0].offsetWidth;var nb=hb.parentNode.offsetWidth;if(nb>lb)ka.set(hb,'max-width',nb-lb+'px');}f.exports=za;},null);
__d('MercuryListUpdateRenderer',['DOM','ge'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={updateList:function(k,l,m,n,o){var p=[];for(var q=0;q<l.length;q++){if(o){var r=o(q);r&&p.push(r);}var s=i(l[q]);if(s&&m(q)){p.push(s);}else p.push(n(q));}h.setContent(k,p);}};f.exports=j;},null);
__d('WebMessengerUnseenMessageNoticeRenderer',['JSXDOM','ContextualLayer','LayerFadeOnHide','cx','fbt','Event'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n={renderNoticeTooltip:function(p,q){var r=h.div({className:"_40p"},o(p),h.i({className:"_40q"})),s=new i(q||{},r).enableBehavior(j);return s;}};function o(p){var q=h.div({className:"_40r"},l._("You have new messages"));m.listen(q,'click',p);return q;}f.exports=n;},null);
__d('WebMessengerMessagesNotice',['LayerDestroyOnHide','MercuryViewer','WebMessengerUnseenMessageNoticeRenderer'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){'use strict';this._notice=null;this._noticeContextNode=null;this._active=false;}k.prototype.getActive=function(){'use strict';return this._active;};k.prototype.showMessageNotice=function(l,m){'use strict';if(!this._active)return;if(!this._notice)this._notice=j.renderNoticeTooltip(l,{context:this._noticeContextNode,offsetY:2,position:m,alignment:'center'});this._notice.show();};k.prototype.hideMessageNotice=function(){'use strict';this._notice&&this._notice.hide();};k.prototype.removeMessageNotice=function(){'use strict';if(this._notice){this._notice.enableBehavior(h).hide();this._notice=null;}};k.prototype.setNoticeContextNode=function(l){'use strict';this._noticeContextNode=l;};k.prototype.hideView=function(){'use strict';this._active=false;this.hideMessageNotice();};k.prototype.updateView=function(){'use strict';this._active=true;};k.prototype.destroy=function(){'use strict';this._active=false;this.removeMessageNotice();};k.prototype.onlyReceivedFromSelf=function(l){'use strict';for(var m in l){if(!l.hasOwnProperty(m))continue;for(var n=0,o=l[m].length;n<o;n++)if(l[m][n].author!==i.getID())return false;}return true;};f.exports=k;},null);
__d('WebMessengerDetailViewUnreadMessagesNotice',['MercuryThreadlistConstants','WebMessengerStateManager','throttle','UserActivity','WebMessengerMessagesNotice','WebMessengerSubscriptionsHandler','MercuryThreadInformer','MercuryThreadActions'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o,p=c('MercuryThreadInformer').get(),q=c('MercuryThreadActions').get(),r=h.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;n=babelHelpers.inherits(s,l);o=n&&n.prototype;function s(t){'use strict';o.constructor.call(this);this._manager=t;m.addSubscriptions(p.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.addScrollCallback(j.withBlocking((function(u){if(this._shouldMarkAsRead(u)){this.removeMessageNotice();if(k.isActive(5000)){var v=i.getCurrentStateData().thread_id;q.markRead(v);}else k.subscribeOnce((function(){if(this._shouldMarkAsRead(u)){var w=i.getCurrentStateData().thread_id;q.markRead(w);}}).bind(this));}}).bind(this),100,null));}s.prototype.updateOnMessagesReceived=function(t,u,v,w){'use strict';var x=!k.isActive(r);if(!o.getActive.call(this))return;if(x||o.onlyReceivedFromSelf.call(this,w)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var y=v-(u-t);this._manager.setScrollTop(y,false);this.showMessageNotice();}};s.prototype.showMessageNotice=function(){'use strict';var t=(function(){this._manager.scrollToBottom();}).bind(this);o.showMessageNotice.call(this,t,'above');};s.prototype._shouldMarkAsRead=function(t){'use strict';var u=i.getCurrentStateData().thread_id;return u&&o.getActive.call(this)&&t.isScrolledToBottom();};s.prototype._updateReadStatus=function(t,u){'use strict';var v=i.getCurrentStateData().thread_id;if(v&&u[v]&&u[v].mark_as_read)this.removeMessageNotice();};f.exports=s;},null);
__d('WebMessengerInfoBoxRenderer',['Event','cx','DOM','WebMessengerSubscriptionsHandler'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l={render:function(m,n){var o=j.create('div',{className:"_4rk"},m),p=j.create('div',{}),q=true;n.forEach(function(r){if(!q){var s=j.create('span',{className:"_4rl"},'\u00b7');j.appendContent(p,s);}q=false;var t=j.create('a',{},r.text);if(r.handler)k.addSubscriptions(h.listen(t,'click',r.handler));j.appendContent(p,t);});return j.create('div',{className:"_4rh"},[o,p]);}};f.exports=l;},null);
__d('WebMessengerMessageIDFinder',['DataStore','DOM','csx'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={find:function(l,m){var n=m?i.find(l,m):l,o=h.get(n,'MessageRenderer:messageID');return o;},findAll:function(l){var m=i.scry(l,"._53"),n=[];if(m.length){var o=m[0];for(var p=0;p<o.childNodes.length;p++)n.push(h.get(o.childNodes[p],'MessageRenderer:messageID'));}return n;}};f.exports=k;},null);
__d('WebMessengerMessagesSelection',['CSS','csx','DOM','getObjectValues','WebMessengerMessageIDFinder'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={};function n(q,r){var s=q,t=r;if(s==t)return 0;while(true){s=s.nextSibling;t=t.nextSibling;if(!s||t==q){return 1;}else if(!t||s==r)return -1;}}function o(q,r){var s=q.id,t=j.scry(q,"._yh input")[0];if(r){m[s]=q;h.addClass(q,'selected');t.checked=true;}else{delete m[s];h.removeClass(q,'selected');t.checked=false;}}var p={clear:function(){for(var q in m)o(m[q],false);},selectClick:function(q){o(q,!(q.id in m));},getSelectedMessageIDs:function(){var q=k(m);q.sort(n);var r=[];q.forEach(function(s){r=r.concat(l.findAll(s));});return r;}};f.exports=p;},null);
__d('UntrustedLink',['DOM','Event','URI','UserAgent_DEPRECATED'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m,n,o,p){this.dom=m;this.url=m.href;this.hash=n;this.func_get_params=p||function(){return {};};i.listen(this.dom,'click',this.onclick.bind(this));i.listen(this.dom,'mousedown',this.onmousedown.bind(this));i.listen(this.dom,'mouseup',this.onmouseup.bind(this));i.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown(i.$E(o));}l.bootstrap=function(m,n,o,p){if(m.__untrusted)return;m.__untrusted=true;new l(m,n,o,p);};l.prototype.getRewrittenURI=function(){var m=babelHelpers._extends({u:this.url,h:this.hash},this.func_get_params(this.dom)),n=new j('/l.php').setSubdomain('www');if(new j(this.url).getProtocol()=='https'){return n.setQueryData(m).setProtocol('https');}else return n.setQueryData(m).setProtocol('http');};l.prototype.onclick=function(){setTimeout((function(){this.setHref(this.url);}).bind(this),100);this.setHref(this.getRewrittenURI());};l.prototype.onmousedown=function(m){if(m.button==2)this.setHref(this.getRewrittenURI());};l.prototype.onmouseup=function(){this.setHref(this.getRewrittenURI());};l.prototype.onmouseout=function(){this.setHref(this.url);};l.prototype.setHref=function(m){if(k.ie()<9){var n=h.create('span');h.appendContent(this.dom,n);this.dom.href=m;h.remove(n);}else this.dom.href=m;};f.exports=l;},null);
__d('DOMHyperlink',['Env','JSXDOM','TransformTextToDOMMixin','UntrustedLink','URI','URLScraper','isFacebookURI','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p={MAX_ITEMS:40,match:function(q,r){var s=m.match(q);if(!s)return false;var t=q.indexOf(s),u=t+s.length;return {startIndex:t,endIndex:u,element:this._element(s,r)};},_element:function(q,r){var s=q,t=s.replace(/"/g,'%22');if(!/^[a-z][a-z0-9\-+.]+:\/\//i.test(q))t='http://'+t;if(!l.isValidURI(t))return s;var u=i.a({className:"_553k",href:t,target:"_blank",rel:"nofollow"},s);if(r&&!n(new l(t)))u.onmousedown=function(v){k.bootstrap(this,h.lhsh,v);};return u;}};f.exports=Object.assign(p,j);},null);
__d('MercuryMessageRenderer',['DOM','DOMEmoji','DOMEmote','DOMHyperlink','isFacebookURI','JSXDOM','URI','transformTextToDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p={formatMessageBody:function(t,u,v){var w=(t||'').replace(/\s+$/,'');if(!u)return s(w,false,v);var x=Object.keys(u).map(function(aa){return window.parseInt(aa);}).sort(function(aa,ba){return aa-ba;}),y=[],z=0;x.forEach(function(aa){var ba=w.slice(z,aa);if(ba)y.push(s(ba,false,v));z=aa+u[aa].length;var ca=w.slice(aa,z);if(ca)y.push(s(ca,true,v));});if(z<w.length)y.push(s(w.slice(z),false,v));return y.length===0?null:y.length===1?y[0]:h.create('span',{},y);}};function q(t,u){var v=u(t);if(Array.isArray(v))v.forEach(function(w){if(w.href){var x=new n(w.href);if(l(x)&&!x.getFragment())w.href=x.addQueryData({__mref:'message'}).toString();}});return v;}function r(t,u){var v=t.replace(/\r\n?/g,'\n').split(/\n{2,}/);return v.filter(function(w){return w.length;}).map(function(w){return m.p(null,q(w,u));});}function s(t,u,v){if(t.length===0&&!u)return null;var w=function(x){return o(x,[k.params(true),i,j]);};return (m.span({className:u?'highlight':null},v?r(t,w):q(t,w)));}f.exports=p;},null);
__d('WebMessengerThreadMessagesRenderer',['AsyncRequest','MercuryAttachment','CSS','DataStore','DOM','Event','HovercardLink','Image.react','ImmutableObject','LinkController','MercuryLogMessageRenderer','MercuryActionType','MercuryAttachments.react','MercuryAttachmentType','MercuryErrorInfo','MercuryIDs','MercuryMessageError.react','MercuryMessageGroup','MercuryTimePassed','MercuryViewer','MercuryMessageRenderer','WebMessengerMessagesSelection','Parent','MercuryParticipants','MercuryParticipantsConstants','React','ReactDOM','WebMessengerStateManager','MercuryStatusTemplates','Style','WebMessengerTemplates','Vector','WebMessengerConstants','WebMessengerEvents','WebMessengerSubscriptionsHandler','csx','cx','formatDate','ge','isRTL','fbt','MercuryMessages','MercuryThreadMetadataRenderer'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va){'use strict';if(c.__markCompiled)c.__markCompiled();var wa=c('MercuryMessages').get(),xa=c('MercuryThreadMetadataRenderer').get(),ya={updateSelection:function(ab){var bb=ia.getCurrentStateData().message_action;j.conditionClass(ab,'selectionEnabled',bb);},setupSelectionListener:function(ab){q.registerHandler(function(bb){var cb=ia.getCurrentStateData().message_action;if(cb&&da.byClass(bb,'webMessengerMessageGroup'))return false;});pa.addSubscriptions(m.listen(ab,'click',function(event){var bb=ia.getCurrentStateData().message_action;if(bb){var cb=null;for(var db=event.getTarget();db;db=db.parentNode)if(j.hasClass(db,'webMessengerMessageGroup'))cb=db;cb&&ca.selectClick(cb);}}));},renderForwardedMessages:function(ab,bb){var cb=y.calculateMessageGroups(bb),db=null;cb.forEach(function(eb){var fb=ya.renderMessageGroup(eb,true);l.appendContent(ab,fb.getRoot());db=eb[eb.length-1];});},renderMessageGroup:function(ab,bb,cb){var db=ab[0],eb=db.action_type==s.LOG_MESSAGE,fb=eb?la[':fb:web-messenger:read-view:log-message'].build():la[':fb:web-messenger:read-view:message-group'].build();fb.getRoot().setAttribute('id',(cb||'wm:')+db.message_id);if(eb){ya.renderSingleLogMessage(fb,db);}else ea.get(db.author,function(gb){ya.renderSingleMessage(fb,db,gb,bb);for(var hb=1;hb<ab.length;hb++)ya.appendMessageToGroup(fb,ab[hb]);});return fb;},appendMessageToGroup:function(ab,bb){var cb=la[':fb:web-messenger:read-view:message'].build();if(bb.is_filtered_content_bh){var db=ja[':fb:mercury:filtered-message-blackholefilter'].build();cb.setNodeContent('message',db.getRoot());}else if(bb.is_filtered_content_account){var eb=ja[':fb:mercury:filtered-message-account'].build();cb.setNodeContent('message',eb.getRoot());}else if(bb.is_filtered_content_quasar){var fb=ja[':fb:mercury:filtered-message-quasar'].build();cb.setNodeContent('message',fb.getRoot());}else if(bb.is_filtered_content_invalid_app){var gb=ja[':fb:mercury:filtered-message-invalid-app'].build();cb.setNodeContent('message',gb.getRoot());}else if(bb.is_filtered_content){var hb=ja[':fb:mercury:filtered-message'].build();cb.setNodeContent('message',hb.getRoot());}else cb.setNodeContent('message',ba.formatMessageBody(bb.body,null,true));ha.render(ga.createElement(x,{message:new p(bb)}),cb.getNode('status'));var ib=cb.getRoot();k.set(ib,'MessageRenderer:messageID',bb.message_id);j.addClass(cb.getNode('message'),ua(bb.body)?'direction_rtl':'direction_ltr');l.appendContent(ab.getNode('bodyDiv'),ib);ea.get(aa.getID(),function(jb){if(jb.employee){var kb=la[':fb:web-messenger:bug-reporting'].build();kb.getNode('fbtrace').setAttribute('data-timestamp',bb.timestamp);kb.getNode('brokenheart').setAttribute('data-timestamp',bb.timestamp);l.setContent(cb.getNode('bugReporting'),kb.getRoot());}});},renderSingleLogMessage:function(ab,bb){var cb=ab.getNode('attachment');r.renderLegacy(ab.getNode('icon'),ab.getNode('message'),cb,bb);ya.renderStatus(ab,bb);xa.renderTimestamp(ab.getNode('timestamp'),bb.timestamp_absolute,bb.timestamp_relative,bb.timestamp);},renderMessageSeparator:function(ab){var bb=la[':fb:mercury:timestamp'].render();bb.removeAttribute('title');var cb=ab.timestamp_absolute;if(!cb)cb=sa(new Date(ab.timestamp),{withinWeek:'l',withinYear:'F jS',older:'F jS, Y'});if(wa.isFirstMessage(ab))if(ab.timestamp_time_passed===z.TODAY){cb=va._("Conversation started today");}else cb=va._("Conversation started {timestamp}",[va.param('timestamp',cb)]);l.setContent(bb,cb);j.show(bb);return l.create('li',{className:"_2n3"},bb);},renderMessageSeparatorForIndex:function(ab,bb){var cb=ab[bb][0];if(bb){var db=cb.timestamp,eb=ab[bb-1],fb=eb[eb.length-1].timestamp,gb=na.READ_VIEW_SEPARATOR_TIME_LIMIT;if(db-fb<gb)return false;}return ya.renderMessageSeparator(cb);},renderRawAttachments:function(ab,bb){var cb=i.convertRaw(bb.raw_attachments||[]),db=(bb.photo_fbids?bb.photo_fbids.length:0)+(bb.image_ids?bb.image_ids.length:0);for(var eb=0;eb<db;eb++)cb.push({attach_type:u.PHOTO,preview_width:206,preview_height:206});if(bb.sticker_id)cb.push({attach_type:u.STICKER});ya.renderAttachments(ab,cb,bb);},renderAttachments:function(ab,bb,cb){ha.render(ga.createElement(t,{attachments:bb,maxWidth:450,message:cb,isChat:false,onStickerClick:oa.stickerClicked.bind(oa)}),ab);},renderStatus:function(ab,bb){if(v.hasErrorStatus(bb)){var cb=ga.createElement(x,{message:new p(bb)}),db=ab.getNode('statusContainer');if(db&&cb){ha.render(cb,db);j.show(db);}}},renderSingleMessage:function(ab,bb,cb,db){ya.appendMessageToGroup(ab,bb);var eb;if(cb.href){eb=l.create('a',{href:cb.href},cb.name);if(ia.getStandaloneMode())eb.setAttribute('target','_blank');var fb=w.getUserIDFromParticipantID(cb.id);if(fb)eb.setAttribute('data-hovercard',n.constructEndpoint({id:fb}));}else eb=cb.name;ab.setNodeContent('authorName',eb);var gb=ab.getNode('image');j.removeClass(gb,'MercuryThreadImage');var hb=ga.createElement(o,{alt:cb.name,width:fa.IMAGE_SIZE,height:fa.IMAGE_SIZE,src:cb.image_src,className:"_50dv"});if(cb.href)hb=ga.createElement('a',{href:cb.href},hb);hb=ha.render(hb,gb);var ib;if(bb.timestamp_time_passed===z.TODAY){ib='g:ia';}else ib='n/j, g:ia';var jb=sa(new Date(bb.timestamp),ib);xa.renderTimestamp(ab.getNode('timestamp'),bb.timestamp_absolute,jb,bb.timestamp);xa.renderMessageSourceTags(ab.getNode('tooltipForSource'),ab.getNode('sourceIcon'),bb.source_tags||[],bb.author_email);xa.renderSpoofWarning(ab.getNode('spoofWarning'),bb.is_spoof_warning,cb);if(bb.subject)ab.setNodeContent('subject',bb.subject);if(bb.has_attachment){var kb=ab.getNode('attachments');if(bb.attachments&&bb.attachments.length===0){ya.renderRawAttachments(kb,bb);}else if(bb.attachments!==null&&bb.attachments.length>0){ya.renderAttachments(kb,bb.attachments,bb);}else if(bb.raw_attachments!=null&&bb.raw_attachments.length>0)ya.renderRawAttachments(kb,bb.raw_attachments);}var lb=ab.getNode('forwards'),mb=bb.forward_count&&wa.getMessagesFromIDs(bb.forward_message_ids);if(mb)ya.renderForwardedMessages(lb,mb);j.conditionShow(lb,mb);}};function za(ab,bb,cb){var db=ta(ab),eb=l.find(db,'iframe'),fb=l.find(eb,"^._5xm"),gb=fb.firstChild;ka.set(eb,'width',bb+'px');ka.set(eb,'height',cb+1+'px');eb.setAttribute('scrolling','no');var hb=db&&ma.getElementDimensions(db).x/bb;if(hb&&hb<1){ka.set(fb,'height',Math.round(hb*(cb+1))+'px');var ib=eb.style,jb=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],kb;while(kb=jb.shift())if(typeof ib[kb]!=='undefined'){ka.set(eb,kb,'scale('+hb+','+hb+')');return;}ka.set(gb,'zoom',hb);}}f.exports=ya;},null);
__d('WebMessengerDetailViewRecentMessagesControl',['Event','Animation','CSS','WebMessengerDetailViewUnreadMessagesNotice','DOM','Arbiter','GroupChatMessageBlockAlert','MercuryLastMessageIndicator.react','MercuryListUpdateRenderer','MercuryAPIArgsSource','MercuryConfig','MercuryLogMessageType','MercurySourceType','MercuryThreadlistConstants','MercuryViewer','MercuryMessageGroup','WebMessengerMessagesSelection','MessagingTag','MessengerContextBannerBootloader','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','WebMessengerStateConstants','WebMessengerStateManager','Style','WebMessengerTemplates','WebMessengerThreadMessagesRenderer','UserActivity','WebMessengerConstants','WebMessengerInfoBoxRenderer','WebMessengerMessageIDFinder','WebMessengerSubscriptionsHandler','cx','debounce','formatDate','ge','fbt','MercuryBlockedParticipants','MercuryMessageActions','MercuryMessageObject','MercuryMessages','MercuryThreadInformer','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra){if(c.__markCompiled)c.__markCompiled();var sa=c('MercuryBlockedParticipants').get(),ta=c('MercuryMessageActions').get(),ua=c('MercuryMessageObject').get(),va=c('MercuryMessages').get(),wa=c('MercuryThreadInformer').get(),xa=c('MercuryThreadActions').get(),ya=c('MercuryThreads').get();function za(tb,ub,vb,wb,xb,yb,zb,ac){'use strict';this._manager=tb;this._rootElement=ub;this._loadingSpinner=vb;this._noSelectedConversation=wb;this._newMessageLink=xb;this._showUnreadLink=yb;this.contextBanner=zb;l.empty(this._rootElement);this._pagerExponent=-1;var bc=ga[':fb:web-messenger:read-view:recent-messages'].build();l.setContent(this._rootElement,bc.getRoot());this._selectedConversationView=bc.getRoot();this._messageList=bc.getNode('messagelist');this._loadMoreButton=bc.getNode('loadMoreButton');this._loadMoreLink=bc.getNode('loadMoreLink');this._loadMoreCount=bc.getNode('loadMoreCount');this._loadingMoreCount=bc.getNode('loadingMoreCount');this._indicatorNode=bc.getNode('lastMessageIndicator');this._unseenMessagesNotice=new k(this._manager);this._unseenMessagesNotice.setNoticeContextNode(ac);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};ha.setupSelectionListener(this._messageList);this._manager.addScrollCallback(oa(sb.bind(null,this),500));ma.addSubscriptions(h.listen(this._loadMoreLink,'click',kb.bind(null,this)),wa.subscribe('messages-reordered',(function(cc,dc){var ec=this._threadID&&dc[this._threadID];if(ec)gb(this);}).bind(this)),wa.subscribe('messages-updated',(function(cc,dc){var ec=this._threadID&&dc[this._threadID];if(ec)var fc=Object.keys(ec),gc=fc.length&&ec[fc[0]];if(ec&&gc)gb(this,dc[this._threadID]);}).bind(this)),wa.subscribe('messages-updated',sb.bind(null,this)),wa.subscribe('messages-received',(function(cc,dc){if(this._threadID&&dc[this._threadID])jb(this,dc);}).bind(this)),wa.subscribe('thread-read-changed',(function(cc,dc){if(dc[this._threadID])pb(this,dc[this._threadID]);}).bind(this)),this._manager.subscribe('scrolledNearTop',(function(){this._active&&kb(this);}).bind(this)));}za.prototype.hideView=function(){'use strict';this._active=false;j.hide(this._rootElement);j.hide(this._loadingSpinner);j.hide(this._noSelectedConversation);j.hide(this.contextBanner);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};za.prototype.updateView=function(){'use strict';this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);j.show(this._rootElement);if(this.contextBanner)j.show(this.contextBanner);var tb=bb(this);cb(this);x.clear();if(tb){db(this);}else nb(this);};za.prototype.renderContextBanner=function(tb,ub){'use strict';if(this.contextBanner&&!this.contextBannerElem)z.bootload(tb,ca.WEB_INBOX,(function(vb){this.contextBannerElem=vb;fa.set(this._rootElement,'padding-top','80px');l.prependContent(this.contextBanner,this.contextBannerElem);j.show(this.contextBanner);}).bind(this),ub);};za.prototype.unmountContextBanner=function(){'use strict';if(this.contextBannerElem){aa.unmountComponentAtNode(this.contextBannerElem);this.contextBannerElem=null;l.empty(this.contextBanner);}};za.prototype.destroy=function(){'use strict';ab(this);this._unseenMessagesNotice.destroy();aa.unmountComponentAtNode(this._indicatorNode);this.unmountContextBanner();};function ab(tb){tb._messagesSubscription&&va.unsubscribe(tb._messagesSubscription.subscriber_id,tb._messagesSubscription.thread_id);tb._messagesSubscription=null;}function bb(tb){var ub=ea.getCurrentStateData();if(!tb._threadID||tb._threadID!=ub.thread_id)return true;return false;}function cb(tb){var ub=ea.getCurrentStateData();tb._state=ea.getCurrentDetailState();tb._threadID=ub.thread_id;tb._selectionEnabled=!!ub.message_action;tb._bugReportingEnabled=ub.bug_reporting_enabled;ha.updateSelection(tb._messageList);j.conditionClass(tb._messageList,'bugReportingEnabled',tb._bugReportingEnabled);}function db(tb){l.scry(tb._rootElement,'.stickerContainer').forEach(function(vb){return aa.unmountComponentAtNode(vb);});l.empty(tb._messageList);tb.unmountContextBanner();var ub=null;if(tb._threadID)ub=ya.getThreadMetaNow(tb._threadID);if(ub&&sa.isPresentInGroupThread(ub)){n.show(sa.inGroupThread(ub),function(){return eb(tb);},function(){ta.send(ua.constructLogMessageObject(t.TITAN_WEB,tb._threadID,s.UNSUBSCRIBE,{removed_participants:[v.getID()]}),null,q.WEBMESSENGER);eb(tb);});}else eb(tb);}function eb(tb){j.show(tb._loadingSpinner);j.hide(tb._loadMoreButton);ab(tb);tb._pagerExponent=-1;aa.unmountComponentAtNode(tb._indicatorNode);if(tb._lastMessageIndicator){tb._lastMessageIndicator.unmount();delete tb._lastMessageIndicator;}if(tb._threadID){j.show(tb._selectedConversationView);j.hide(tb._noSelectedConversation);tb._manager._flexArea.showAtTop(false);if(!tb._olderMessageID[tb._threadID]){fb(tb);}else gb(tb);tb._manager.scrollToBottom(false);}else{rb(tb);j.hide(tb._selectedConversationView);j.show(tb._noSelectedConversation);j.hide(tb._loadingSpinner);tb._manager._flexArea.showAtTop(true);}}function fb(tb){tb._loadMessagesInFlight[tb._threadID]=true;tb._currentCountMap[tb._threadID]=ja.INITIAL_MESSAGES_LIMIT;j.hide(tb._loadMoreButton);var ub=va.getThreadMessagesRange(tb._threadID,0,tb._currentCountMap[tb._threadID],hb.bind(null,tb),null,q.WEBMESSENGER);if(ub){tb._messagesSubscription={subscriber_id:ub,thread_id:tb._threadID};}else gb(tb);}function gb(tb,ub){if(!tb._threadID||!tb._olderMessageID[tb._threadID])return;var vb=va.getThreadMessagesSinceTimestamp(tb._threadID,qb(tb._olderMessageID[tb._threadID]));if(vb.length>tb._currentCountMap[tb._threadID])tb._currentCountMap[tb._threadID]=vb.length;ib(tb,vb,ub);}function hb(tb,ub){tb._loadMessagesInFlight[tb._threadID]=false;if(ub&&ub.length){var vb=ub[0].timestamp,wb=tb._olderMessageID[tb._threadID]?qb(tb._olderMessageID[tb._threadID]):null;if(!wb||vb<wb)tb._olderMessageID[tb._threadID]=ub[0].message_id;}}function ib(tb,ub,vb){j.hide(tb._loadingSpinner);j.conditionShow(tb._loadMoreButton,!va.hasLoadedAllMessages(tb._threadID));var wb=ya.getThreadMetaNow(tb._threadID);if(wb){var xb=wb.message_count-ub.length;xb=xb<0?0:xb;l.setContent(tb._loadMoreCount,xb);l.setContent(tb._loadingMoreCount,xb);}if(wb&&wb.is_canonical&&r.ShowContextBanner&&va.hasLoadedAllMessages(tb._threadID))tb.renderContextBanner(tb._threadID);var yb=function(gc){var hc,ic=qa('wm:'+gc);if(ic)hc=la.findAll(ic);return hc||[];},zb=[],ac=w.calculateMessageGroups(ub),bc={},cc=[];ac.forEach(function(gc){var hc=gc[0].message_id,ic=false;if(vb){ic=gc.some(function(kc){return kc.message_id in vb;});if(!ic){zb=yb(hc);ic=zb.some(function(kc){return kc in vb;});}}if(!ic){zb=yb(hc);if(gc.length==zb.length){for(var jc=0;jc<gc.length;jc++)if(gc[jc].message_id!=zb[jc]){ic=true;break;}}else ic=true;}if(ic)bc[hc]=1;cc.push('wm:'+hc);});var dc=function(gc){return !bc[ac[gc][0].message_id];},ec=function(gc){var hc=ac[gc],ic=ha.renderMessageGroup(hc);if(gc==cc.length-1)tb._messageGroup=ic;return ic.getRoot();},fc=function(gc){return ha.renderMessageSeparatorForIndex(ac,gc);};p.updateList(tb._messageList,cc,dc,ec,fc);tb._lastMessage=ub[ub.length-1];mb(tb);nb(tb);tb._manager.poke();}function jb(tb,ub){var vb=ub[tb._threadID],wb=tb._manager._flexArea.getScrollableArea(),xb=wb.getScrollHeight();vb.forEach(function(ac){ac.timestamp_relative=pa(new Date(ac.timestamp),'g:ia');var bc=w.canAppendMessageToLastGroup(tb._lastMessage,ac);if(!bc){tb._messageGroup=ha.renderMessageGroup([ac]);var cc=ac.timestamp,dc=tb._lastMessage?tb._lastMessage.timestamp:0,ec=ja.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!dc||cc-dc>=ec){var fc=ha.renderMessageSeparator(ac);l.appendContent(tb._messageList,fc);}l.appendContent(tb._messageList,tb._messageGroup.getRoot());}else ha.appendMessageToGroup(tb._messageGroup,ac);if(ac.author!=v.getID())j.addClass(tb._messageGroup.getRoot(),'unreadHighlight');tb._lastMessage=ac;});tb._manager._flexArea.poke();var yb=wb.getScrollHeight(),zb=wb.getScrollTop();tb._unseenMessagesNotice.updateOnMessagesReceived(xb,yb,zb,ub);mb(tb);if(tb._manager.isScrolledToBottom())nb(tb);}function kb(tb){j.addClass(tb._loadMoreButton,'async_saving');if(tb._loadMessagesInFlight[tb._threadID])return;tb._loadMessagesInFlight[tb._threadID]=true;tb._pagerExponent=Math.min(tb._pagerExponent+1,ja.EXPONENTIAL_PAGER_MAX_CYCLES);var ub=Math.pow(2,tb._pagerExponent),vb=tb._currentCountMap[tb._threadID]+ub*u.WEBMESSENGER_MORE_MESSAGES_COUNT;ab(tb);var wb=va.getThreadMessagesRange(tb._threadID,0,vb,function(xb){j.removeClass(tb._loadMoreButton,'async_saving');tb._currentCountMap[tb._threadID]=vb;hb(tb,xb);tb._loadMessagesInFlight[tb._threadID]=false;},null,q.WEBMESSENGER);if(wb){tb._messagesSubscription={subscriber_id:wb,thread_id:tb._threadID};}else gb(tb);}function lb(tb){if(!tb._lastMessageIndicator){var ub;tb._lastMessageIndicator=new ba(o,tb._indicatorNode);tb._lastMessageIndicator.setProps({threadID:tb._threadID,className:"_510o",indicatorWillShow:function(){return (ub=tb._manager.isScrolledToBottom());},indicatorDidShow:function(){return (ub&&tb._manager.scrollToBottom(true));}});}return tb._lastMessageIndicator;}function mb(tb,ub){lb(tb).setProps({lastMessage:tb._lastMessage});}function nb(tb){if(ia.isActive(5000)){ob(tb);}else ia.subscribeOnce(ob.bind(null,tb));}function ob(tb){if(!tb._threadID||!tb._active)return;xa.markRead(tb._threadID);var ub=l.scry(tb._messageList,'.unreadHighlight');ub.forEach(function(vb){j.removeClass(vb,'unreadHighlight');j.addClass(vb,'unreadFading');new i(vb).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(i.ease.both).duration(1500).ondone(function(){j.removeClass(vb,'unreadFading');fa.set(vb,'background','');fa.set(vb,'borderColor','');}).go();});}function pb(tb,ub){if(!ub.mark_as_read)return;var vb=l.scry(tb._messageList,'.unreadHighlight');for(var wb=0;wb<vb.length;wb++){var xb=vb[wb],yb=la.findAll(xb),zb=va.getMessagesFromIDs(yb);if(zb[zb.length-1].timestamp<ub.timestamp)j.removeClass(xb,'unreadHighlight');}}function qb(tb){var ub=va.getMessagesFromIDs([tb])[0];return ub?ub.timestamp:0;}function rb(tb){if(tb._builtNoSelectionBox)return;var ub=function(){var wb=ea.getCurrentStateData(),xb=babelHelpers._extends({},wb);ea.updateDetailState(da.DETAIL.COMPOSE_MAIN,Object.assign(xb,{start:true,thread_id:undefined}));},vb=function(){var wb=ea.getCurrentStateData(),xb=babelHelpers._extends({},wb);ea.updateMasterState(da.MASTER.RECENT_THREADS,Object.assign(xb,{folder:y.INBOX,filter:y.UNREAD}));};l.setContent(tb._noSelectedConversation,ka.render(ra._("No Conversation Selected"),[{text:ra._("New Message"),handler:ub},{text:ra._("Show Unread"),handler:vb}]));tb._builtNoSelectionBox=true;}function sb(tb){var ub=tb._manager._flexArea.getScrollableArea(),vb=tb._manager.getFlexAreaBoundingClientRect();m.inform('messengerScrolled/'+tb._threadID,{scrollTop:ub.getScrollTop(),top:vb.y,viewHeight:vb.height});}f.exports=za;},null);
__d('MercurySearchContextResults',['KeyedCallbackManager','MercuryAPIArgsSource','MercuryIDs','MercuryThreadlistConstants','RangedCallbackManager','MercuryServerDispatcher','WebMessengerConstants','MercuryThreadIDMap','MercuryServerPayloadPreprocessor'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=c('MercuryThreadIDMap').get(),p=c('MercuryServerPayloadPreprocessor').get(),q=new h(),r=k.WEBMESSENGER_SEARCH_SNIPPET_COUNT,s=n.MORE_SEARCH_CONTEXT_COUNT,t={getSearchContext:function(x,y,z){if(x){var aa=q.executeOrEnqueue(x,function(fa){var ga=v(fa,x);z(ga);}),ba=q.getUnavailableResources(aa);if(ba.length){var ca={message_id:x,limit:r+1},da=o.getServerIDFromClientIDNow(y),ea=j.tokenize(y);if(ea.type=='user'){ca.other_user_fbid=da;}else ca.thread_fbid=da;w(ca);}return aa;}},getMoreSearchContext:function(x,y,z,aa){if(x){var ba=q.getResource(x);if(ba){var ca=z==n.MORE_SEARCH_CONTEXT_UP?ba.up_message_ids:ba.down_message_ids,da=ca.getCurrentArraySize()+s,ea=ca.executeOrEnqueue(0,da,function(){var ja=v(ba,x);aa(ja);}),fa=ca.getUnavailableResources(ea);if(fa.length){var ga={message_id:x,limit:da,direction:z},ha=o.getServerIDFromClientIDNow(y),ia=j.tokenize(y);if(ia.type=='user'){ga.other_user_fbid=ha;}else ga.thread_fbid=ha;w(ga);}return ea;}}},handleUpdate:function(x){if(x.mercury_payload)p.handleUpdate(x.mercury_payload);var y=x.search_context||{};for(var z in y){var aa=y[z],ba=aa.other_user_fbid||aa.thread_fbid,ca=o.getClientIDFromServerIDNow(ba),da=!q.getResource(z),ea=da?{thread_id:ca,up_message_ids:new l(),down_message_ids:new l()}:q.getResource(z),fa=da?r+1:s;if(aa.up_message_ids&&(ea.up_message_ids.getCurrentArraySize()===0||aa.up_message_ids.length>=ea.up_message_ids.getCurrentArraySize()))u(ea.up_message_ids,aa.up_message_ids,fa);if(aa.down_message_ids&&(ea.down_message_ids.getCurrentArraySize()===0||aa.down_message_ids.length>=ea.down_message_ids.getCurrentArraySize()))u(ea.down_message_ids,aa.down_message_ids,fa);if(da)q.setResource(z,ea);}},unsubscribe:function(x,y,z){if(y){var aa=q.getResource(y);if(aa){if(z==n.MORE_SEARCH_CONTEXT_UP){aa.up_message_ids.unsubscribe(x);}else aa.down_message_ids.unsubscribe(x);}else q.unsubscribe(x);}}};function u(x,y,z){var aa=x.getCurrentArraySize(),ba=y.length<aa+z;if(y.length){x.removeAllResources();x.addResourcesWithoutSorting(y,0);}if(ba)x.setReachedEndOfArray();}function v(x,y){var z=x.up_message_ids.hasReachedEndOfArray(),aa=x.up_message_ids.getAllResources();if(!z)aa.shift();var ba=x.down_message_ids.hasReachedEndOfArray(),ca=x.down_message_ids.getAllResources();if(!ba)ca.pop();return {thread_id:x.thread_id,message_id:y,up_message_ids:aa,up_exhausted:z,down_message_ids:ca,down_exhausted:ba};}function w(x){x.client=i.WEBMESSENGER;m.trySend('/ajax/mercury/search_context.php',x);}m.registerEndpoints({'/ajax/mercury/search_context.php':{mode:m.IMMEDIATE,handler:t.handleUpdate}});f.exports=t;},null);
__d('MercurySearchSnippetResults',['MercuryAPIArgsSource','MercuryIDs','MercurySingletonMixin','MercuryThreadlistConstants','MercuryThreadIDMap','RangedCallbackManager','MercuryServerDispatcher','MercuryServerPayloadPreprocessor'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p={},q={},r=null,s=k.WEBMESSENGER_SEARCH_SNIPPET_COUNT,t=k.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,u=k.WEBMESSENGER_SEARCH_SNIPPET_MORE;function v(fa){'use strict';this.$MercurySearchSnippetResults1=fa;this.$MercurySearchSnippetResults2=o.getForFBID(fa);n.registerEndpoints({'/ajax/mercury/search_snippets.php':{request_user_id:fa,mode:n.IMMEDIATE,handler:(function(ga){this.handleUpdate(ga);}).bind(this)}});this.$MercurySearchSnippetResults3=l.getForFBID(fa);}v.prototype.getFBID=function(){'use strict';return this.$MercurySearchSnippetResults1;};v.prototype.getThreadIDMap=function(){'use strict';return this.$MercurySearchSnippetResults3;};v.prototype.getAllThreadSearchResults=function(fa,ga){'use strict';if(fa)w(this.$MercurySearchSnippetResults1,fa,t,0,ga);};v.prototype.getAllThreadSearchMoreResults=function(fa,ga){'use strict';if(fa){var ha=p[fa];if(ha){var ia=ha.getCurrentArraySize();w(this.$MercurySearchSnippetResults1,fa,u,ia,ga);}}};v.prototype.getSingleThreadSearchResults=function(fa,ga,ha){'use strict';if(!fa||!ga)return;x.call(this,fa,ga,s,0,ha);};v.prototype.getSingleThreadSearchMoreResults=function(fa,ga,ha){'use strict';if(!fa||!ga)return;if(!q[ga])return;var ia=q[ga][fa];if(ia){var ja=ia.num_total_snippets,ka=ia.snippets_cbm.getCurrentArraySize(),la=ja-ka;if(la>0){var ma=la>u?u:la;x.call(this,fa,ga,ma,ka,ha);}}};v.prototype.countSnippetsMatchingQueryInThread=function(fa,ga){'use strict';var ha=q[ga][fa];if(ha)return ha.num_total_snippets;};v.prototype.findIndexOfSnippet=function(fa,ga,ha,ia){'use strict';var ja=da(fa,ga),ka=ja.getAllResources();for(var la=0;la<ka.length;la++)if(ha===ka[la].message_id)return la;};v.prototype.findSnippetAtIndex=function(fa,ga,ha,ia){'use strict';aa(fa,ga,ha);ba.call(this,fa,ga,ha,ia);};v.prototype.handleUpdate=function(fa){'use strict';if(fa.mercury_payload)this.$MercurySearchSnippetResults2.handleUpdate(fa.mercury_payload);var ga=fa.search_snippets||{};Object.keys(ga).filter(function(va){return !!ga[va];}).forEach(function(va){Object.keys(ga[va]).forEach(function(wa){ga[va][wa].snippets.forEach(function(xa){xa.matched_keywords=y(xa.matched_keywords);});});});var ha=fa.offset,ia=[];for(var ja in ga){var ka=ga[ja];for(var la in ka){var ma=ka[la],na=fa.other_user_fbid||fa.thread_fbid,oa=this.$MercurySearchSnippetResults3.getClientIDFromServerIDNow(la),pa=ma.snippets,qa=da(ja,oa),ra=qa.getCurrentArraySize();if(!na){ia.push(oa);if(ra)continue;}else if(ha!=ra)continue;var sa=q[oa][ja];sa.num_total_snippets=ma.num_total_snippets;qa.addResourcesWithoutSorting(pa,ra);if(!na||fa.limit>pa.length)if(qa.getCurrentArraySize()==sa.num_total_snippets)qa.setReachedEndOfArray();}if(!na){var ta=ca(ja),ua=ta.getCurrentArraySize();if(ha==ua){ta.addResourcesWithoutSorting(ia,ua);if(fa.limit>ia.length)ta.setReachedEndOfArray();}}}};function w(fa,ga,ha,ia,ja){z();var ka=ca(ga),la=ia+ha,ma=ka.executeOrEnqueue(0,la,function(pa){var qa={};for(var ra=0;ra<pa.length;ra++){var sa=pa[ra],ta=q[sa][ga];qa[sa]={num_total_snippets:ta.num_total_snippets,snippets:ta.snippets_cbm.getAllResources()};}var ua=ka.hasReachedEndOfArray();ja(qa,ua);}),na=ka.getUnavailableResources(ma);if(na.length){r={query:ga,thread_id:null,subscriber_id:ma};var oa={query:ga,offset:ia,limit:ha+1,snippetLimit:s};oa.identifier='thread_fbid';ea(oa,fa);}}function x(fa,ga,ha,ia,ja){z();var ka=da(fa,ga),la=ia+ha,ma=ka.executeOrEnqueue(0,la,function(){var sa=ka.getAllResources(),ta=q[ga][fa].num_total_snippets;ja(sa,ta);}),na=ka.getUnavailableResources(ma);if(na.length){r={query:fa,thread_id:ga,subscriber_id:ma};var oa={query:fa,snippetOffset:ia,snippetLimit:ha},pa=this.getThreadIDMap().getServerIDFromClientIDNow(ga),qa=i.tokenize(ga),ra=qa.type;if(ra=='user'){oa.other_user_fbid=pa;}else oa.thread_fbid=pa;oa.identifier='thread_fbid';ea(oa,this.getFBID());}}function y(fa){if(fa instanceof Array){var ga={};for(var ha=0;ha<fa.length;ha++)ga[ha.toString()]=fa[ha];return ga;}else return fa;}function z(){if(r){if(r.thread_id){var fa=da(r.query,r.thread_id);fa.unsubscribe(r.subscriber_id);}else{var ga=ca(r.query);ga.unsubscribe(r.subscriber_id);}r=null;}}function aa(fa,ga,ha){}function ba(fa,ga,ha,ia){var ja=q[ga][fa],ka=ja.snippets_cbm.getAllResources(),la=ja.num_total_snippets,ma=ka.length;if(ha<ma){ia(ka[ha].message_id);return;}var na=la-ma,oa=na>u?u:na;x.call(this,fa,ga,oa,ma,function(pa,qa){ba.call(this,fa,ga,ha,ia);});}function ca(fa){if(!p[fa])p[fa]=new m();return p[fa];}function da(fa,ga){if(!q[ga])q[ga]={};var ha=q[ga][fa];if(!ha){ha={num_total_snippets:-1,snippets_cbm:new m()};q[ga][fa]=ha;}return ha.snippets_cbm;}function ea(fa,ga){fa.client=h.WEBMESSENGER;n.trySend('/ajax/mercury/search_snippets.php',fa,null,ga);}Object.assign(v,j);f.exports=v;},null);
__d('WebMessengerDetailViewSearchContextControl',['Event','CSS','DOM','MercuryMessageGroup','WebMessengerMessagesSelection','MercurySearchContextResults','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadMessagesRenderer','WebMessengerConstants','fbt','WebMessengerSubscriptionsHandler','MercuryMessages','MercurySearchSnippetResults'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryMessages').get(),v=c('MercurySearchSnippetResults').get();function w(ga,ha,ia){'use strict';this._manager=ga;this._rootElement=ha;this._paginationBox=ia;j.empty(this._rootElement);var ja=p[':fb:web-messenger:read-view:search-context'].build(),ka=p[':fb:web-messenger:read-view:search-pagination-box'].build();j.setContent(this._rootElement,ja.getRoot());j.setContent(this._paginationBox,ka.getRoot());this._messagelistRoot=ja.getRoot();this._loadingSpinner=ja.getNode('loadingSpinner');this._messageList=ja.getNode('messagelist');this._loadMoreButton=ja.getNode('loadMoreButton');this._loadMoreLink=ja.getNode('loadMoreLink');this._downMoreButton=ja.getNode('downMoreButton');this._downMoreLink=ja.getNode('downMoreLink');this._nextSnippet=ka.getNode('nextSnippet');this._previousSnippet=ka.getNode('previousSnippet');this._backToSnippetsButton=ka.getNode('backToSnippetsButton');this._snippetCountDescription=ka.getNode('snippetCountDescription');this._paginationBoxCloseButton=ka.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;q.setupSelectionListener(this._messageList);t.addSubscriptions(h.listen(this._loadMoreLink,'click',(function(){i.addClass(this._loadMoreButton,'async_saving');ea(this,r.MORE_SEARCH_CONTEXT_UP);}).bind(this)),h.listen(this._downMoreLink,'click',(function(){i.addClass(this._downMoreButton,'async_saving');ea(this,r.MORE_SEARCH_CONTEXT_DOWN);}).bind(this)),h.listen(this._nextSnippet,'click',x.bind(null,this,1)),h.listen(this._previousSnippet,'click',x.bind(null,this,-1)),h.listen(this._backToSnippetsButton,'click',function(){var la=o.getCurrentStateData(),ma=la.single_thread_search?n.DETAIL.SEARCH_THREAD_SNIPPET:n.DETAIL.SEARCH_SNIPPET,na={folder:la.folder,message_query:la.message_query,query:la.query};if(la.single_thread_search)na.thread_id=la.thread_id;o.updateDetailState(ma,na);}),h.listen(this._paginationBoxCloseButton,'click',(function(){o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{thread_id:o.getCurrentStateData().thread_id});}).bind(this)));}w.prototype.hideView=function(){'use strict';i.hide(this._rootElement);i.hide(this._paginationBox);};w.prototype.updateView=function(){'use strict';i.show(this._rootElement);i.show(this._paginationBox);var ga=aa(this);ba(this);l.clear();if(ga)da(this);};w.prototype.destroy=function(){'use strict';z(this);};function x(ga,ha){var ia=o.getCurrentStateData(),ja=v.findIndexOfSnippet(ga._messageQuery,ia.thread_id,ia.message_id),ka=ja+ha;i.hide(ga._messageList);i.hide(ga._loadMoreButton);i.hide(ga._downMoreButton);i.show(ga._loadingSpinner);v.findSnippetAtIndex(ga._messageQuery,ia.thread_id,ka,function(la){i.show(ga._messageList);y(ia,la);});}function y(ga,ha){var ia={folder:ga.folder,message_id:ha,message_query:ga.message_query,query:ga.query,single_thread_search:ga.single_thread_search,thread_id:ga.thread_id};o.updateDetailState(o.getCurrentDetailState(),ia);}function z(ga){ga._searchContextSubscription&&m.unsubscribe(ga._searchContextSubscription.subscriber_id,ga._searchContextSubscription.message_id,ga._searchContextSubscription.direction);ga._searchThreadsSubscription=null;}function aa(ga){var ha=o.getCurrentStateData();if(ga._threadID!=ha.thread_id)return true;if(ga._messageQuery!=ha.message_query)return true;if(ga._messageID!=ha.message_id)return true;return false;}function ba(ga){var ha=o.getCurrentStateData();ga._state=o.getCurrentDetailState();ga._threadID=ha.thread_id;ga._messageQuery=ha.message_query;ga._messageID=ha.message_id;ga._selectionEnabled=!!ha.message_action;q.updateSelection(ga._messageList);i.conditionClass(ga._messageList,'bugReportingEnabled',ha.bug_reporting_enabled);}function ca(ga,ha){j.setAttributes(ga,{disabled:ha});var ia=j.find(ga,'^label');i.conditionClass(ia,'uiButtonDisabled',ha);}function da(ga){var ha=j.create('strong',{},ga._messageQuery),ia=v.countSnippetsMatchingQueryInThread(ga._messageQuery,ga._threadID),ja=v.findIndexOfSnippet(ga._messageQuery,ga._threadID,ga._messageID),ka=ja+1,la=s._({"*":"{index} of {count} results for {query}"},[s.param('index',ka),s.param('count',ia,[0]),s.param('query',ha)]);j.setContent(ga._snippetCountDescription,la);ca(ga._previousSnippet,ja===0);ca(ga._nextSnippet,ja===ia-1);j.empty(ga._messageList);i.show(ga._loadingSpinner);i.hide(ga._loadMoreButton);i.hide(ga._downMoreButton);z(ga);if(ga._threadID&&ga._messageID){var ma=m.getSearchContext(ga._messageID,ga._threadID,function(na){i.hide(ga._loadingSpinner);fa(ga,na);});if(ma)ga._searchContextSubscription={subscriber_id:ma,message_id:ga._messageID};}}function ea(ga,ha){z(ga);if(ga._threadID&&ga._messageID){var ia=m.getMoreSearchContext(ga._messageID,ga._threadID,ha,function(ja){if(ha==r.MORE_SEARCH_CONTEXT_UP){i.removeClass(ga._loadMoreButton,'async_saving');}else i.removeClass(ga._downMoreButton,'async_saving');fa(ga,ja);});if(ia)ga._searchContextSubscription={subscriber_id:ia,message_id:ga._messageID,direction:ha};}}function fa(ga,ha){i.conditionShow(ga._loadMoreButton,!ha.up_exhausted);i.conditionShow(ga._downMoreButton,!ha.down_exhausted);var ia=ha.up_message_ids.concat([ha.message_id],ha.down_message_ids),ja=u.getMessagesFromIDs(ia);j.empty(ga._messageList);var ka=k.calculateMessageGroups(ja);ka.forEach(function(la,ma){var na=q.renderMessageSeparatorForIndex(ka,ma);if(na)j.appendContent(ga._messageList,na);var oa=q.renderMessageGroup(la,false,'context:').getRoot(),pa=la.some(function(qa){return qa.message_id==ha.message_id;});if(pa)i.addClass(oa,'selectedHighlight');j.appendContent(ga._messageList,oa);});}f.exports=w;},null);
__d('WebMessengerSearchSnippetsRenderer',['Event','CSS','DOM','Image.react','MercuryMessageRenderer','MercuryParticipants','MercuryParticipantsConstants','React','ReactDOM','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','cx','fbt','MercurySearchSnippetResults','MercuryThreadMetadataRenderer'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=c('MercurySearchSnippetResults').get(),w=c('MercuryThreadMetadataRenderer').get(),x={renderMultipleSnippetBlocks:function(da,ea,fa){fa=fa||{};var ga=true;for(var ha in fa){ga=false;var ia=s[':fb:web-messenger:read-view:search-snippets-block'].build();j.appendContent(da,ia.getRoot());x.renderSingleSnippetBlock(ia,ea,ha,fa[ha]);}if(ga)ca(da);},renderThreadSnippetBlock:function(da,ea,fa,ga,ha){if(!ga||!ga.length){ca(da);return;}var ia=s[':fb:web-messenger:read-view:search-snippets-block'].build();j.appendContent(da,ia.getRoot());i.hide(ia.getNode('searchThreadName'));y(ia,ea,fa,ga,ha);},renderSingleSnippetBlock:function(da,ea,fa,ga){var ha=da.getNode('searchThreadName'),ia=j.create('h3');j.setContent(ha,ia);w.renderAndSeparatedParticipantList(fa,ia);y(da,ea,fa,ga.snippets,ga.num_total_snippets);},renderMultipleSnippets:function(da,ea,fa,ga){(ga||[]).forEach(function(ha){var ia=s[':fb:web-messenger:read-view:search-snippet'].build();j.appendContent(da,ia.getRoot());m.get(ha.author,function(ja){x.renderSingleSnippet(ia,ea,fa,ha,ja);});});},renderSingleSnippet:function(da,ea,fa,ga,ha){da.setNodeProperty('bodyDiv','id','snippet:'+ga.message_id);var ia=ga.matched_keywords||undefined,ja=l.formatMessageBody(ga.body,ia);da.setNodeContent('body',ja);var ka=da.getNode('image');i.removeClass(ka,'MercuryThreadImage');i.addClass(ka,'MercuryMediumThreadImage');var la=o.createElement(k,{width:n.IMAGE_SIZE,height:n.IMAGE_SIZE,src:ha.image_src});if(ha.href)la=o.createElement('a',{href:ha.href},la);p.render(la,ka);var ma=ha.short_name;da.setNodeContent('shortName',u._("{name}:",[u.param('name',ma)])+' ');w.renderTimestamp(da.getNode('timestamp'),ga.timestamp_absolute,ga.timestamp_relative,ga.timestamp);var na=da.getNode('seeContext');h.listen(na,'click',function(){var oa=r.getCurrentStateData(),pa={message_query:ea,query:oa.query,thread_id:fa,message_id:ga.message_id},qa=r.getCurrentDetailState();if(qa===q.DETAIL.SEARCH_THREAD_SNIPPET)pa.single_thread_search=true;r.updateDetailState(q.DETAIL.SEARCH_CONTEXT,pa);return false;});}};function y(da,ea,fa,ga,ha){var ia=da.getNode('snippetList');x.renderMultipleSnippets(ia,ea,fa,ga);var ja=ha-ga.length;z(da,ea,fa,ha,ja);}function z(da,ea,fa,ga,ha){var ia=da.getNode('totalSnippetsCount'),ja=da.getNode('moreSnippetsLink');i.conditionShow(ja,ha>0);if(ha>0){var ka=ba(ha);j.setContent(ja,ka);}j.setContent(ia,aa(ga));if(ha>0)h.listen(ja,'click',function(){v.getSingleThreadSearchMoreResults(ea,fa,function(la){j.empty(da.getNode('snippetList'));y(da,ea,fa,la,ga);});});}function aa(da){if(da==1){return u._("1 result in total");}else return u._({"*":"{count} results in total"},[u.param('count',da,[0])]);}function ba(da){if(da==1){return u._("Show 1 more result");}else return u._({"*":"Show {count} more results"},[u.param('count',da,[0])]);}function ca(da){var ea=u._("No results"),fa=j.create('div',{className:"_2n4"},ea);j.setContent(da,fa);}f.exports=x;},null);
__d('WebMessengerDetailViewSearchSnippetsControl',['JSXDOM','Event','CSS','DOM','WebMessengerSearchSnippetsRenderer','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerPermalinks','WebMessengerSubscriptionsHandler','cx','fbt','MercurySearchSnippetResults'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=c('MercurySearchSnippetResults').get();function u(z,aa){'use strict';this._manager=z;this._rootElement=aa;k.empty(this._rootElement);var ba=o[':fb:web-messenger:read-view:search-snippets'].build();k.setContent(this._rootElement,ba.getRoot());this._loadingSpinner=ba.getNode('loadingSpinner');this._messageList=ba.getNode('messagelist');this._downMoreButton=ba.getNode('downMoreButton');this._downMoreLink=ba.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;j.hide(this._downMoreButton);q.addSubscriptions(i.listen(this._downMoreLink,'click',(function(){j.addClass(this._downMoreButton,'async_saving');y(this);}).bind(this)));}u.prototype.hideView=function(){'use strict';j.hide(this._rootElement);};u.prototype.updateView=function(){'use strict';j.show(this._rootElement);var z=v(this);w(this);if(z)x(this);};u.prototype.destroy=function(){'use strict';};function v(z){var aa=n.getCurrentDetailState();if(z._state!=aa)return true;var ba=n.getCurrentStateData();if(z._messageQuery!=ba.message_query)return true;if(aa==m.DETAIL.SEARCH_THREAD_SNIPPET)if(z._threadID!=ba.thread_id)return true;return false;}function w(z){z._state=n.getCurrentDetailState();var aa=n.getCurrentStateData();z._threadID=aa.thread_id;z._messageQuery=aa.message_query;}function x(z){j.hide(z._downMoreButton);k.empty(z._messageList);if(z._messageQuery){j.show(z._loadingSpinner);if(z._state===m.DETAIL.SEARCH_THREAD_SNIPPET&&z._threadID){t.getSingleThreadSearchResults(z._messageQuery,z._threadID,function(aa,ba){j.hide(z._loadingSpinner);l.renderThreadSnippetBlock(z._messageList,z._messageQuery,z._threadID,aa,ba);var ca=h.a({className:"_4-ii"},s._("Search all conversations for \"{query}\"",[s.param('query',z._messageQuery)])),da=p.getURI(m.MASTER.SEARCH,m.DETAIL.SEARCH_SNIPPET,{query:z._messageQuery,message_query:z._messageQuery});ca.setAttribute('href',da);k.prependContent(z._messageList,h.div({className:"_4-ij"},ca));});}else t.getAllThreadSearchResults(z._messageQuery,function(aa,ba){j.hide(z._loadingSpinner);l.renderMultipleSnippetBlocks(z._messageList,z._messageQuery,aa);j.conditionShow(z._downMoreButton,!ba);});}}function y(z){if(z._messageQuery)t.getAllThreadSearchMoreResults(z._messageQuery,function(aa,ba){j.removeClass(z._downMoreButton,'async_saving');k.empty(z._messageList);l.renderMultipleSnippetBlocks(z._messageList,z._messageQuery,aa);j.conditionShow(z._downMoreButton,!ba);});}f.exports=u;},null);
__d('WebMessengerSharedPhotos.react',['AsyncRequest','Grid.react','immutable','LoadingIndicator.react','MessagesViewer','MessagesViewerSetID','Pixelz.react','React','Image.react','WebMessengerStateConstants','WebMessengerStateManager','URI','XUIButton.react','cx','fbt','glyph'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=o.PropTypes,y=i.GridItem,z=v._("Return to Conversation"),aa=42,ba=o.createClass({displayName:'WebMessengerSharedPhotos',propTypes:{threadID:x.string.isRequired,totalWidth:x.number.isRequired},getInitialState:function(){return {isLoadingMore:true,moreImages:true,imagesData:j.List()};},componentDidMount:function(){this.requestImages();l.preload();},componentDidUpdate:function(){if(!this.isVisible())this.requestImages();},componentWillReceiveProps:function(ca){if(ca.threadID&&ca.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:j.List()});},isVisible:function(){return !(this.state.isLoadingMore&&this.state.moreImages&&this.state.imagesData.isEmpty());},loadMoreImages:function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}},renderImages:function(){var ca=Math.floor((this.props.totalWidth-aa)/3),da=this.state.imagesData,ea=da.map((function(fa){return (o.createElement(y,{key:fa.fbid},o.createElement('div',{className:"_5dq3",onClick:this.viewFullImage.bind(null,fa)},o.createElement(n,{upscale:true,width:ca,height:ca,resizeMode:'cover',src:fa.uri,borderRadius:1,insetBorderColor:'rgba(0, 0, 0, 0.1)'}))));}).bind(this));return ea;},viewFullImage:function(ca){var da=new s('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:this.props.threadID,image_id:ca.fbid});l.bootstrapWithConfig({fbid:ca.fbid,dimensions:ca.dim,src:ca.uri,disablePaging:this.state.imagesData.size===1,endpoint:da,setID:m.MESSAGES_VIEW_ALL_IN_THREAD});},requestImages:function(){new h().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod('POST').setData({thread_id:this.props.threadID,offset:this.state.imagesData.size,limit:30}).setHandler((function(ca){var da=ca.getPayload();this.setState({isLoadingMore:false,moreImages:da.moreImagesToLoad,imagesData:this.state.imagesData.concat(da.imagesData)});}).bind(this)).send();},returnToThread:function(){var ca=babelHelpers._extends({},r.getCurrentStateData());r.updateDetailState(q.DETAIL.RECENT_MESSAGES,ca);},render:function(){var ca=o.createElement('div',{className:(this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":'')},o.createElement(k,{color:'white',size:'large'}));if(!this.isVisible()){return ca;}else if(!this.state.isLoadingMore)ca=null;return (o.createElement('div',{className:"_5dpz"},o.createElement('div',{className:"_5dp-"},o.createElement(t,{image:o.createElement(p,{src:w('back')}),label:z,size:'medium',onClick:this.returnToThread})),o.createElement('div',{className:"_5dq0"},o.createElement(i,{cols:3,fixed:false},this.renderImages()),ca)));}});f.exports=ba;},null);
__d('WebMessengerDetailViewSharedPhotosControl',['CSS','DOM','ReactComponentRenderer','WebMessengerSharedPhotos.react','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerEvents','WebMessengerSubscriptionsHandler','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=c('MercuryThreadIDMap').get();function q(r,s){'use strict';this.manager=r;this.rootElement=s;this.renderer=null;this.serverID=null;this.state=null;this.threadID=null;i.empty(this.rootElement);o.addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),n.subscribe(n.DETAIL_DOM_CHANGED,this.render.bind(this)));}q.prototype.hideView=function(){'use strict';h.hide(this.rootElement);};q.prototype.updateView=function(){'use strict';h.show(this.rootElement);this.updateStateAndData();this.render();};q.prototype.destroy=function(){'use strict';o.release();};q.prototype.updateStateAndData=function(){'use strict';this.state=m.getCurrentDetailState();var r=m.getCurrentStateData();this.threadID=r.thread_id;};q.prototype.render=function(){'use strict';this.serverID=p.getServerIDFromClientIDNow(this.threadID);if(!this.serverID)return;if(!this.renderer){this.renderer=new j(k,this.rootElement);this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});}else this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};q.prototype.notifyImageRequest=function(){'use strict';var r=m.getCurrentDetailState();if(r===l.DETAIL.SHARED_PHOTOS&&this.renderer)this.renderer.component.loadMoreImages();};f.exports=q;},null);
__d('MercurySheetPolicy',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={canReplaceOpenSheet:function(i,j){if(i.isSheetWithInput&&i.isSheetWithInput())return j.getType()!=i.getType()&&j.isSheetWithInput&&j.isSheetWithInput();if(i.getType()==j.getType())return false;if(i.isPermanent()&&!j.isPermanent())return false;if(i.getType()==='message-blocked')return false;return true;}};f.exports=h;},null);
__d('MercurySheetView',['Animation','ArbiterMixin','MercurySheetPolicy','CSS','DOM','Style','Vector','cx','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=5000,r=function(s,t,u){this._threadID=s;this._rootElement=t;this._tabMainElement=u;this._openSheet=null;};Object.assign(r.prototype,i,{destroy:function(){l.empty(this._rootElement);},_openCommon:function(s,t){if(this._openSheet&&!j.canReplaceOpenSheet(this._openSheet,s)){if(s.couldNotReplace)s.couldNotReplace();return;}this.clear((function(){this._openSheet=s;k.show(this._rootElement);s.render();if(t){k.addClass(this._tabMainElement,'sheetSlide');k.addClass(this._tabMainElement,"_1sk4");var u=n.getElementDimensions(this._rootElement).y;m.set(this._rootElement,'bottom',u+'px');this.resize();this._animation=new h(this._rootElement).to('bottom',0).duration(150).ease(h.ease.both).ondone((function(){k.removeClass(this._tabMainElement,'sheetSlide');k.removeClass(this._tabMainElement,"_1sk4");this.resize();}).bind(this)).go();}else this.resize();if(!s.isPermanent()){var v=q;if(s.getCloseTimeout)v=s.getCloseTimeout();var w=this.getAutoCloseCallback(s);this._sheetCloseHandler=p(this.close.bind(this,s,w),v);if(s.timeoutCanBeReset)s.setResetTimeoutCallback(this.resetTimeout.bind(this));}}).bind(this));},getAutoCloseCallback:function(s){if(!s.autoCloseCallback)return null;return s.autoCloseCallback.bind(s);},resetTimeout:function(s,t){clearTimeout(this._sheetCloseHandler);var u=this.getAutoCloseCallback(s);this._sheetCloseHandler=p(this.close.bind(this,s,u),t);},set:function(s){return this._openCommon(s,false);},open:function(s){return this._openCommon(s,true);},close:function(s,t){if(this._openSheet!=s)return;if(!this._openSheet){t&&t();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}k.addClass(this._tabMainElement,'sheetSlide');k.addClass(this._tabMainElement,"_1sk4");var u=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new h(this._rootElement).to('bottom',u+'px').duration(100).ease(h.ease.begin).ondone((function(){l.empty(this._rootElement);k.hide(this._rootElement);k.removeClass(this._tabMainElement,'sheetSlide');k.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();t&&t();}).bind(this)).go();},clear:function(s){this.close(this._openSheet,s);},resize:function(){this.inform('resize');}});f.exports=r;},null);
__d('WebMessengerEmployeeAwaySheet',['ArbiterMixin','DOM','mixin','WebMessengerTemplates'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l,m;l=babelHelpers.inherits(n,j(h));m=l&&l.prototype;function n(o,p,q){'use strict';m.constructor.call(this);this.$WebMessengerEmployeeAwaySheet1=o;this.$WebMessengerEmployeeAwaySheet2=p;this.$WebMessengerEmployeeAwaySheet3=q;}n.prototype.render=function(){'use strict';var o=k[':fb:mercury:employee-away-sheet'].build();i.setContent(this.$WebMessengerEmployeeAwaySheet2,o.getRoot());};n.prototype.isPermanent=function(){'use strict';return true;};n.prototype.getType=function(){'use strict';return 'employee-away';};n.prototype.open=function(){'use strict';this.$WebMessengerEmployeeAwaySheet3.open(this);};n.prototype.close=function(){'use strict';this.$WebMessengerEmployeeAwaySheet3.close(this);};f.exports=n;},null);
__d('WebMessengerIsMessageBlockedSheet',['ArbiterMixin','DOM','Event','WebMessengerTemplates','fbt','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;n=babelHelpers.inherits(p,m(h));o=n&&n.prototype;function p(q,r,s){'use strict';o.constructor.call(this);this.$WebMessengerIsMessageBlockedSheet1=q;this.$WebMessengerIsMessageBlockedSheet2=r;this.$WebMessengerIsMessageBlockedSheet3=s;}p.prototype.render=function(){'use strict';var q=k[':fb:mercury:messages-blocked-sheet'].build(),r=l._("Messages from this recipient are blocked.");i.setContent(this.$WebMessengerIsMessageBlockedSheet2,q.getRoot());i.setContent(q.getNode('text'),r+' ');j.listen(q.getNode('unblockButton'),'click',(function(){this.inform('clicked',this.$WebMessengerIsMessageBlockedSheet1);}).bind(this));};p.prototype.isPermanent=function(){'use strict';return true;};p.prototype.getType=function(){'use strict';return 'message-blocked';};p.prototype.open=function(){'use strict';this.$WebMessengerIsMessageBlockedSheet3.open(this);};p.prototype.close=function(){'use strict';this.$WebMessengerIsMessageBlockedSheet3.close(this);};f.exports=p;},null);
__d('WebMessengerThreadIsMutedTabSheet',['Event','ArbiterMixin','DOM','WebMessengerTemplates','fbt','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;n=babelHelpers.inherits(p,m(i));o=n&&n.prototype;function p(q,r){'use strict';o.constructor.call(this);this._rootElement=q;this._sheetView=r;}p.prototype.render=function(){'use strict';var q=k[':fb:web-messenger:read-view:message-mute-sheet'].build();j.setContent(q.getNode('text'),l._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));j.setContent(this._rootElement,q.getRoot());h.listen(q.getNode('unmuteButton'),'click',(function(){this.inform('clicked',null);}).bind(this));};p.prototype.isPermanent=function(){'use strict';return false;};p.prototype.getType=function(){'use strict';return 'wb-thread-is-muted';};p.prototype.open=function(){'use strict';this._sheetView.open(this);};p.prototype.close=function(){'use strict';this._sheetView.close(this);};f.exports=p;},null);
__d('WebMessengerDetailViewSheetControl',['DOM','ArbiterMixin','WebMessengerStateManager','MercurySheetView','MercuryThreadInfo','WebMessengerTemplates','WebMessengerEmployeeAwaySheet','ChatEmployeeAwayWarning','WebMessengerIsMessageBlockedSheet','WebMessengerThreadIsMutedTabSheet','WebMessengerSubscriptionsHandler','mixin','MercuryBlockedParticipants','MercuryThreadInformer','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t,u,v=c('MercuryBlockedParticipants').get(),w=c('MercuryThreadInformer').get(),x=c('MercuryThreadActions').get(),y=c('MercuryThreads').get();t=babelHelpers.inherits(z,s(i));u=t&&t.prototype;function z(aa){'use strict';u.constructor.call(this);this._template=m[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=j.getCurrentStateData().thread_id;this._sheetView=new k(this._threadID,this._rootElement,aa);this._threadIsMessageBlockedSheet=new p(this._threadID,this._rootElement,this._sheetView);this._employeeAwaySheet=new n(this._threadID,this._rootElement,this._sheetView);this._threadIsMutedTabSheet=new q(this._rootElement,this._sheetView);this._muteSetting=undefined;h.setContent(aa,this._template.getRoot());this._threadMessageBlockedSub=this._threadIsMessageBlockedSheet.subscribe('clicked',(function(){x.unblockMessages(this._threadID);}).bind(this));this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',(function(){x.unmute(this._threadID);}).bind(this));r.addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),w.subscribe('threads-updated',(function(ba,ca){if(this._threadID&&ca[this._threadID])this.updateTabSheet(false);}).bind(this)));this.updateTabSheet(true);}z.prototype.updateView=function(){'use strict';var aa=j.getCurrentStateData().thread_id;if(this._threadID!=aa){this._threadID=aa;this.updateTabSheet(true);}};z.prototype.updateTabSheet=function(aa){'use strict';if(!this._threadID)return;y.getThreadMeta(this._threadID,(function(ba){var ca=l.getMuteSetting(ba);if(ca!=this._muteSetting||aa){if(ca){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=ca;}if(v.isMessageBlocked(ba)){this._threadIsMessageBlockedSheet.open();}else this._threadIsMessageBlockedSheet.close();o.updateEmployeeAwayWarning(ba,(function(){this._employeeAwaySheet.open();}).bind(this),(function(){this._employeeAwaySheet.close();}).bind(this));}).bind(this));};z.prototype.destroy=function(){'use strict';this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();this._employeeAwaySheet&&this._employeeAwaySheet.close();};f.exports=z;},null);
__d('WebMessengerFlexibleArea',['ArbiterMixin','CSS','DOM','Event','Style','Vector','cx','mixin','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r,s=[];function t(){s.forEach(function(v){v.draw();});}k.listen(window,'resize',p(t,50));q=babelHelpers.inherits(u,o(h));r=q&&q.prototype;function u(v){'use strict';r.constructor.call(this);this.minFlexAreaHeight=0;this.flexArea=v;this.container=null;this.padding=0;this.sizeToFit=false;s.push(this);}u.prototype.setContainer=function(v){'use strict';this.container=v;return this;};u.prototype.setPadding=function(v){'use strict';this.padding=v;return this;};u.prototype.setMinFlexAreaHeight=function(v){'use strict';this.minFlexAreaHeight=v;return this;};u.prototype.setSizeToFit=function(v){'use strict';this.sizeToFit=v;return this;};u.prototype.draw=function(){'use strict';if(this.flexArea){var v=this._flexHeight;this.inform('predraw',{old_height:v});var w=m.getViewportDimensions().y-this.padding;w-=m.getElementPosition(this.container||this.flexArea).y;if(this.container){Array.from(this.container.childNodes).forEach(function(x){w-=m.getElementDimensions(x).y;});w+=m.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)w=Math.min(w,this._getNaturalHeight());if(w<this.minFlexAreaHeight)w=this.minFlexAreaHeight;if(isNaN(w)||w<0)w=0;if(w!==v){l.set(this.flexArea,'height',w+'px');this._flexHeight=w;this.inform('height_changed',{height:w,old_height:v});}}return this;};u.prototype.destroy=function(){'use strict';var v=s.indexOf(this);v>=0&&s.splice(v,1);t();};u.prototype._getNaturalHeight=function(){'use strict';var v=this.flexArea.cloneNode(true);i.addClass(v,"_2ys");l.set(v,'height','auto');j.insertAfter(this.flexArea,v);var w=m.getElementDimensions(v).y;j.remove(v);return w;};u.prototype._getFlexHeight=function(){'use strict';if(isNaN(this._flexHeight))this._flexHeight=m.getElementDimensions(this.flexArea).y;return this._flexHeight;};f.exports=u;},null);
__d('WebMessengerFlexibleScrollArea',['CSS','DOMQuery','ScrollableArea','Style','WebMessengerFlexibleArea','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;n=babelHelpers.inherits(p,l);o=n&&n.prototype;function p(q,r){'use strict';o.constructor.call(this,q);this._scroll=j.fromNative(q,r);this._scrollBody=i.find(this.flexArea,'.uiScrollableAreaBody');var s=i.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=s.length?s[0]:null;this._scrollContent=i.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallbacks=[];this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',m(this._onScroll,50,this));this._nearTop=false;this._nearBottom=false;this._lastScrollHeight=0;}p.prototype.showAtTop=function(q){'use strict';if(q){k.set(this._scrollContent,'top','0');k.set(this._scrollContent,'bottom','');}else{k.set(this._scrollContent,'top','');k.set(this._scrollContent,'bottom','0');}};p.prototype.setBottomAligned=function(q){'use strict';var r=q!==false;if(this._bottomEdgeBias===r)return;h.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',r);this._bottomEdgeBias=r;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);setTimeout(this.poke.bind(this),0);return this;};p.prototype.setInfiniteScrollHandler=function(q,r){'use strict';if(r){this._infiniteUpwardScrollHandler=q;}else this._infiniteDownScrollHandler=q;return this;};p.prototype.addScrollCallback=function(q){'use strict';this._scrollCallbacks.push(q);return this;};p.prototype.setTabbable=function(q){'use strict';this._scroll._wrap.setAttribute('tabindex',q?'0':'-1');};p.prototype.poke=function(q,r){'use strict';var s=this._scrollHeight,t=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof s=='undefined'||r&&!r.old_height){this._bottomEdgeBias&&this._setShadowHeight();return;}var u=this._scrollHeight-s;if(this._bottomEdgeBias){var v=r?r.height-r.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=setTimeout(this.poke.bind(this),200);var w,x=u-v;if(this._scrollHeight>this._getFlexHeight()){w=t+x;w=w<0?0:w;}else w=0;x>0&&this._setShadowHeight();if(w!==t)this._scroll.setScrollTop(w,false);x<0&&this._setShadowHeight();}else if(u)this._scroll.setScrollTop(t,false);};p.prototype.setScrollTop=function(q,r){'use strict';this._scroll.setScrollTop(q,r);};p.prototype.getScrollableArea=function(){'use strict';return this._scroll;};p.prototype.isScrolledToBottom=function(){'use strict';return this._scroll.isScrolledToBottom();};p.prototype.scrollToBottom=function(q){'use strict';this._scroll.scrollToBottom(q);if(this._bottomEdgeBias)this._scrollBottom=0;};p.prototype.isScrolledToTop=function(){'use strict';return this._scroll.getScrollTop()===0;};p.prototype.scrollToTop=function(q){'use strict';this._scroll.scrollToTop(q);};p.prototype.scrollIntoView=function(q,r){'use strict';this._scroll.scrollIntoView(q,r);};p.prototype.destroy=function(){'use strict';this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);o.destroy.call(this);this._scroll.destroy();};p.prototype._getScrollHeight=function(){'use strict';if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};p.prototype._setShadowHeight=function(){'use strict';var q=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==q)k.set(this._shadow,'height',this._shadowHeight+'px');};p.prototype._onScroll=function(){'use strict';var q=this._scroll.getScrollTop(),r=this._getScrollHeight(),s=this._getFlexHeight(),t=r>this._lastScrollHeight;this._lastScrollHeight=r;if(q<s){if(!this._nearTop||t&&2*s>r){this._nearTop=true;this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();}}else this._nearTop=false;if(q+2*s>r){if(!this._nearBottom||t&&2*s>r){this._nearBottom=true;this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();}}else this._nearBottom=false;this._scrollCallbacks.forEach((function(u){return u(this._scroll);}).bind(this));};f.exports=p;},null);
__d('WebMessengerDetailViewControlManager',['Event','ArbiterMixin','CSS','WebMessengerDetailViewHeaderControl','DOM','WebMessengerFlexibleScrollArea','WebMessengerDetailViewActionsMenuControl','WebMessengerDetailViewAllPeopleResultsControl','WebMessengerDetailViewComposeTypeaheadControl','WebMessengerDetailViewRecentMessagesControl','WebMessengerDetailViewSearchContextControl','WebMessengerDetailViewSearchSnippetsControl','WebMessengerDetailViewBottomShelfControl','WebMessengerDetailViewSharedPhotosControl','MercuryConfig','MercuryIDs','WebMessengerMessagesSelection','Parent','WebMessengerDetailViewSheetControl','WebMessengerStateManager','WebMessengerStateConstants','Style','UserAgent_DEPRECATED','WebMessengerEvents','WebMessengerSubscriptionsHandler','WebMessengerTemplates','mixin','getElementPosition'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){if(c.__markCompiled)c.__markCompiled();var ja,ka;ja=babelHelpers.inherits(la,ha(i));ka=ja&&ja.prototype;function la(ma){'use strict';ka.constructor.call(this);this._rootElement=ma;l.empty(this._rootElement);var na=ga[':fb:web-messenger:read-view'].build();l.setContent(this._rootElement,na.getRoot());this._readContainer=na.getNode('readContainer');this._headerControl=new k(na.getNode('detailViewHeader'));this._actionsMenuControl=new n(na.getNode('detailViewActionsMenu'),this._headerControl);this._allPeopleResultsControl=new o(na.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new p(na.getNode('detailViewComposeTypeahead'),na.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new r(this,na.getNode('detailViewSearchContext'),na.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new s(this,na.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new u(this,na.getNode('detailViewSharedPhotos'));this._sheetControl=new z(na.getNode('detailViewSheetTab'));var oa=na.getNode('detailViewBottomShelf');this._bottomShelfControl=new t(this,oa);this._detailViewScroller=na.getNode('readMessagesScroller');fa.addSubscriptions(h.listen(this._detailViewScroller,'click',(function(qa){if(y.byTag(qa.getTarget(),'a')||l.getSelection())return;this._bottomShelfControl.focusComposer();}).bind(this)));var pa={fade:!!da.osx(),persistent:true};this._flexArea=new m(this._detailViewScroller,pa).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();fa.addSubscriptions(ea.subscribe(ea.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),ea.subscribe(ea.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),aa.subscribe(ba.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));fa.addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new q(this,na.getNode('detailViewRecentMessages'),na.getNode('loadingSpinner'),na.getNode('noSelectedConversation'),na.getNode('newMessageLink'),na.getNode('showUnreadLink'),na.getNode('contextBanner'),oa);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,l.find(this._detailViewScroller,'div.uiScrollableAreaBody')];}la.prototype.updateOnStateChange=function(){'use strict';var ma=aa.getCurrentDetailState(),na=this._stateData;this._stateData=aa.getCurrentStateData();this._flexArea.setTabbable(ma!==ba.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();j.removeClass(this._readContainer,'blankComposeState');j.conditionClass(this._readContainer,'blankComposeState',ma===ba.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(ma){case ba.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case ba.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();this._composeTypeaheadControl.updateView();break;case ba.DETAIL.COMPOSE_MAIN:this._composeTypeaheadControl.updateView();break;case ba.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case ba.DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case ba.DETAIL.SEARCH_SNIPPET:case ba.DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case ba.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(ma){case ba.DETAIL.RECENT_MESSAGES:case ba.DETAIL.SEARCH_CONTEXT:if(na.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};la.prototype.hideAll=function(){'use strict';this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};la.prototype.getSelectedMessageIDs=function(){'use strict';var ma=aa.getCurrentDetailState();switch(ma){case ba.DETAIL.RECENT_MESSAGES:case ba.DETAIL.SEARCH_CONTEXT:return x.getSelectedMessageIDs();}return [];};la.prototype.scrollIntoView=function(ma){'use strict';this._flexArea&&this._flexArea.scrollIntoView(ma);};la.prototype.setScrollTop=function(ma,na){'use strict';this._flexArea&&this._flexArea.setScrollTop(ma,na);};la.prototype.isScrolledToBottom=function(){'use strict';return this._flexArea&&this._flexArea.isScrolledToBottom();};la.prototype.scrollToBottom=function(ma){'use strict';this._flexArea&&this._flexArea.scrollToBottom(ma);};la.prototype.draw=function(){'use strict';this._flexArea&&this._flexArea.draw();};la.prototype.poke=function(){'use strict';this._flexArea&&this._flexArea.poke();};la.prototype.addScrollCallback=function(ma){'use strict';this._flexArea&&this._flexArea.addScrollCallback(ma);};la.prototype.getFlexAreaBoundingClientRect=function(){'use strict';return ia(this._flexArea.flexArea);};la.prototype.resizeTo=function(ma){'use strict';if(ma!==null){ma=ma.toString();if(!ma.endsWith('%')||ma.endsWith('px'))ma=ma+'px';}this._resizeNodes.forEach(function(na){ca.set(na,'width',ma);});ea.detailDOMChanged();};la.prototype.destroy=function(){'use strict';this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};f.exports=la;},null);
__d('MercuryLogger',['JSLogger','MercuryThreadIDMap','MercuryThreads'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=h.create('messaging_impressions');function l(event,p){k.log(event,p);}function m(p,q){var r=j.getThreadMetaNow(p);if(r){var s=i.getServerIDFromClientIDNow(p);if(s){var event=q?'thread_search':'thread',t={is_single_thread:r.is_canonical_user,is_subscribed:r.is_subscribed,query:q||null};t.thread_fbid=s;l(event,t);}k.bump('opened_thread_'+r.folder);}}function n(p,q){var r={};q.forEach(function(s){var t=i.getServerIDFromClientIDNow(s),u=j.getThreadMetaNow(s);if(u&&t){var v={is_single_thread:u.is_canonical_user,folder:u.folder,participants:u.participants,other_user_fbid:u.other_user_fbid};v.thread_fbid=t;r[t]=v;}});l('threadlist',{folder:p,threads:r});k.bump('opened_threadlist_'+p);}var o={logThread:function(p){m(p);},logThreadlist:function(p,q){n(p,q);},logThreadFromSearch:function(p,q){m(q,p);},logThreadlistFromSearch:function(p,q){l('threadlist_search',{folder:q,query:p});}};f.exports=o;},null);
__d('WebMessengerMercury',['MercuryMessages','MercuryOrderedThreadlist','MercuryServerRequests','WebMessengerStateManager','MercuryThreadInformer','MercuryThreadActions','MercuryThreads','MercuryUnreadState','MercuryUnseenState'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q={getMessages:function(){return h.getForFBID(r());},getOrderedThreadlist:function(){return i.getForFBID(r());},getServerRequests:function(){return j.getForFBID(r());},getThreadInformer:function(){return l.getForFBID(r());},getThreadActions:function(){return m.getForFBID(r());},getThreads:function(){return n.getForFBID(r());},getUnreadState:function(){return o.getForFBID(r());},getUnseenState:function(){return p.getForFBID(r());}};function r(){return k.getCurrentUserID();}f.exports=q;},null);
__d('WebMessengerMasterViewUnseenMessagesNotice',['MercuryThreadlistConstants','MessagingTag','WebMessengerStateManager','UserActivity','WebMessengerSubscriptionsHandler','WebMessengerMessagesNotice','WebMessengerConstants','WebMessengerMercury','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r,s=n.THREADLIST_SCROLLTOP_OFFSET,t=h.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;q=babelHelpers.inherits(u,m);r=q&&q.prototype;function u(z){'use strict';r.constructor.call(this);this._manager=z;this._threadInformer=o.getThreadInformer();this._unseenState=o.getUnseenState();l.addSubscriptions(this._threadInformer.subscribe('messages-received',(function(aa,ba){var ca=!k.isActive(t),da=!this.isScrolledWithinTopThreshold();if(!r.getActive.call(this)||x(ba)||!w(ba))return;if(r.onlyReceivedFromSelf.call(this,ba))return;if(ca){this.removeMessageNotice();this._manager.scrollToTop();}else if(da)this.showMessageNotice();}).bind(this)),this._threadInformer.subscribe('unseen-updated',v.bind(null,this)));this._manager.addScrollCallback(p.withBlocking((function(aa){if(r.getActive.call(this)&&aa.getScrollTop()<=n.THREADLIST_TOP_OFFSET&&k.isActive(t)&&y()){this.removeMessageNotice();this._unseenState.markAsSeen();}}).bind(this),100,null));}u.prototype.isScrolledWithinTopThreshold=function(){'use strict';return this._manager.getScrollTop()<=s;};u.prototype.showMessageNotice=function(){'use strict';if(!y())return;var z=(function(){this._manager.scrollToTop();}).bind(this);r.showMessageNotice.call(this,z,'below');};function v(z){if(z._unseenState.getUnseenCount()===0)z.removeMessageNotice();}function w(z){for(var aa in z)for(var ba=0;ba<z[aa].length;ba++)if(z[aa][ba].folder==i.INBOX)return true;return false;}function x(z){var aa=j.getCurrentStateData().thread_id,ba=true;for(var ca in z)if(z.hasOwnProperty(ca))if(ca!==aa){ba=false;break;}return y()&&ba;}function y(){var z=j.getCurrentStateData().folder;return z===i.INBOX;}f.exports=u;},null);
__d('WebMessengerThreadlistRenderer',['CSS','DOM','Event','Focus','MercuryListUpdateRenderer','MercuryAPIArgsSource','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer','Tooltip','WebMessengerMercury','WebMessengerPermalinks','WebMessengerDeleteThreadDialog','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z={renderThreadsFromIDs:function(ba,ca,da,ea,fa,ga){ea=ea||function(ha){return ha;};fa=fa||{};l.updateList(ba,ca.map(ea),function(ha){return !fa[ca[ha]]&&ca[ha]!=da;},function(ha){var ia=ca[ha],ja=q[':fb:web-messenger:threadlist-row'].build();ja.getRoot().setAttribute('id',ea(ia));var ka=ja.getNode('threadLink');k.listen(ka,function(la){h.conditionClass(ja.getRoot(),"_5fes",la);});j.listen(ka,'click',function(la){if(la.getModifiers().any)return true;var ma=p.getCurrentMasterState(),na={thread_id:ia};if(ma===o.MASTER.SEARCH)na.query=p.getCurrentStateData().query;p.updateDetailState(o.DETAIL.RECENT_MESSAGES,na);return false;});if(ia==da)h.addClass(ja.getRoot(),"_kv");u.getThreads().getThreadMeta(ia,function(la){var ma=s.getForFBID(p.getCurrentUserID());ma.renderCoreThreadlist(la,ja,aa.bind(null,ga),{names_renderer:r.renderShortNames,show_unread_count:false},true);},m.WEBMESSENGER);return ja.getRoot();});}};function aa(ba,ca,da){var ea=ca.getNode('readToggler'),fa=ca.getNode('archiveButton'),ga=ca.getNode('deleteButton');ca.getNode('threadLink').setAttribute('href',v.getURI(ba,o.DETAIL.RECENT_MESSAGES,{thread_id:da.thread_id}).toString());if(da.unread_count>0){h.addClass(ca.getRoot(),"_kx");i.setContent(ca.getNode('newCount'),y._("{num} new",[y.param('num',da.unread_count)]));h.addClass(ea,"_ky");t.set(ea,y._("Mark as read"),'above','right');}else{h.addClass(ea,"_kz");t.set(ea,y._("Mark as unread"),'above','right');}j.listen(ea,'click',function(event){var ja=u.getThreadActions();h.hasClass(ea,"_ky")?ja.markRead(da.thread_id):ja.markUnread(da.thread_id);return false;});var ha=p.getCurrentStateData().folder;if(ha==n.SPAM){t.set(ga,y._("Delete Conversation"),'above','right');h.addClass(ga,"_4_3q");j.listen(ga,'click',function(event){w.show(da.thread_id);});h.hide(fa);}else{h.hide(ga);var ia=true;if(ha==n.ACTION_ARCHIVED){ia=false;t.set(fa,y._("Unarchive"),'above','right');h.addClass(fa,"_2s2");}else{t.set(fa,y._("Archive"),'above','right');h.addClass(fa,"_l9");}j.listen(fa,'click',function(event){var ja=u.getThreadActions();ia?ja.archive(da.thread_id):ja.unarchive(da.thread_id);var ka=p.getCurrentStateData();if(ka.thread_id==da.thread_id)p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:ka.folder});return false;});}}f.exports=z;},null);
__d('WebMessengerMasterViewRecentThreadsControl',['CSS','DOM','Event','MercuryLogger','MercuryAPIArgsSource','MercuryFilters','MercuryFolders','MercuryThreadlistConstants','MessagingTag','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadlistRenderer','WebMessengerConstants','WebMessengerEvents','WebMessengerInfoBoxRenderer','WebMessengerSubscriptionsHandler','WebMessengerMasterViewUnseenMessagesNotice','WebMessengerMercury','createObjectFrom','cx','ge','fbt','UserActivity'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){if(c.__markCompiled)c.__markCompiled();c('UserActivity');var fa='recent:';function ga(ya,za,ab,bb){'use strict';this._manager=ya;this._rootElement=za;this._infoBox=ab;this._orderedThreadlist=aa.getOrderedThreadlist();this._serverRequests=aa.getServerRequests();this._threadInformer=aa.getThreadInformer();this._threads=aa.getThreads();this._unseenState=aa.getUnseenState();i.empty(this._rootElement);this._pagerExponent=-1;var cb=t[':fb:web-messenger:threadlist'].build();i.setContent(this._rootElement,cb.getRoot());this._loadingSpinner=cb.getNode('loadingSpinner');this._threadlistRows=cb.getNode('threadlistRows');this._loadMoreButton=cb.getNode('loadMoreButton');this._loadMoreLink=cb.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=n.getSupportedFolders();this._filters=m.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach((function(db){this._currentCountMap[db]={};this._filters.concat([m.ALL]).forEach((function(eb){this._currentCountMap[db][eb]=o.WEBMESSENGER_THREAD_COUNT+1;}).bind(this));}).bind(this));this._unseenMessagesNotice=new z(this._manager);this._unseenMessagesNotice.setNoticeContextNode(bb);y.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',(function(db,eb){ta(this,ba(eb));}).bind(this)),j.listen(this._loadMoreLink,'click',(function(){sa(this);}).bind(this)),this._manager.subscribe('scrolledNearBottom',(function(){this._active&&sa(this);}).bind(this)));}ga.prototype.updateView=function(){'use strict';this._active=true;this._unseenMessagesNotice.updateView();h.show(this._rootElement);var ya=ia(this),za=ja(this),ab=this._folder,bb=this._selection;ka(this);if(za)la(this,bb);if(ya){ra(this);}else ma(this);if(ab!=this._folder)k.logThreadlist(this._folder,this._threadIDs);if(this._selection&&bb!=this._selection)k.logThread(this._selection);};ga.prototype.hideView=function(){'use strict';this._active=false;this._unseenMessagesNotice.hideView();h.hide(this._rootElement);};ga.prototype.destroy=function(){'use strict';ha(this);this._unseenMessagesNotice.destroy();};function ha(ya){ya._threadlistSubscription&&ya._orderedThreadlist.unsubscribe(ya._threadlistSubscription.subscriber_id,ya._threadlistSubscription.folder,ya._threadlistSubscription.filter);ya._threadlistSubscription=null;}function ia(ya){var za=s.getCurrentStateData();if(ya._folder!=za.folder||ya._filter!=za.filter)return true;return false;}function ja(ya){var za=s.getCurrentStateData();if(ya._selection!=za.thread_id)return true;return false;}function ka(ya){var za=s.getCurrentStateData();ya._state=s.getCurrentMasterState();if(ya._folder!=za.folder||ya._filter!=za.filter)ya._pageExponent=-1;ya._folder=za.folder;ya._filter=za.filter;ya._selection=za.thread_id;}function la(ya,za){var ab=da(xa(za));if(ab){h.removeClass(ab,"_kv");ab.removeAttribute('aria-selected');}var bb=da(xa(ya._selection));if(bb){h.addClass(bb,"_kv");bb.setAttribute('aria-selected','true');}w.updateSelection(bb&&bb.id);}function ma(ya){if(ya._active)q.updateThreadlistIndex(ya,ya._threadIDs.map(xa),xa(ya._selection));}function na(ya){h.addClass(ya._manager.getFlexAreaElement(),"_3j6");h.addClass(ya._manager.getFlexAreaElement(),"_3j7");}function oa(ya){h.removeClass(ya._manager.getFlexAreaElement(),"_3j6");h.removeClass(ya._manager.getFlexAreaElement(),"_3j7");}function pa(ya){h.hide(ya._threadlistRows);oa(ya);}function qa(ya){if(ya._threadIDs.length){h.show(ya._threadlistRows);oa(ya);}else{h.hide(ya._threadlistRows);na(ya);}}function ra(ya){h.show(ya._loadingSpinner);h.hide(ya._infoBox);pa(ya);h.hide(ya._loadMoreButton);ha(ya);var za=ya._orderedThreadlist.getFilteredThreadlist(o.RECENT_THREAD_OFFSET,ya._currentCountMap[ya._folder][ya._filter],ya._folder,ya._filter,function(ab,bb){h.hide(ya._loadingSpinner);ua(ya,ab,bb);qa(ya);ma(ya);ya._manager.poke();ya._manager.forceFireScrollCallbacks();},null,l.WEBMESSENGER);if(za)ya._threadlistSubscription={subscriber_id:za,folder:ya._folder,filter:ya._filter};}function sa(ya){if(ya._requestInFlight||h.hasClass(ya._loadMoreButton,'hidden_elem'))return;ya._requestInFlight=true;h.addClass(ya._loadMoreButton,'async_saving');ya._pagerExponent=Math.min(ya._pagerExponent+1,v.EXPONENTIAL_PAGER_MAX_CYCLES);var za=Math.pow(2,ya._pagerExponent),ab=ya._currentCountMap[ya._folder][ya._filter]+za*o.WEBMESSENGER_MORE_COUNT;ha(ya);var bb=ya._orderedThreadlist.getFilteredThreadlist(o.RECENT_THREAD_OFFSET,ab,ya._folder,ya._filter,function(cb,db){h.removeClass(ya._loadMoreButton,'async_saving');ya._currentCountMap[ya._folder][ya._filter]=ab;ua(ya,cb,db);ma(ya);ya._manager.poke();ya._requestInFlight=false;},null,l.WEBMESSENGER);if(bb)ya._threadlistSubscription={subscriber_id:bb,folder:ya._folder,filter:ya._filter};}function ta(ya,za){if(!ya._folder||!ya._olderTimestamp[ya._folder])return;var ab=ya._orderedThreadlist.getThreadlistUntilTimestamp(ya._olderTimestamp[ya._folder],ya._folder,ya._filter);if(ya._filter==p.UNREAD){ab=wa(ya,ab);}else ya._unreadThreadIDs=[];if(ab.length>ya._currentCountMap[ya._folder][ya._filter])ya._currentCountMap[ya._folder][ya._filter]=ab.length;ya._threadIDs=ab;qa(ya);u.renderThreadsFromIDs(ya._threadlistRows,ab,ya._selection,xa,za,r.MASTER.RECENT_THREADS);ma(ya);ya._manager.poke();}function ua(ya,za,ab){var bb=za.length==ya._currentCountMap[ya._folder][ya._filter];if(bb)za.pop();if(za.length){var cb=za[za.length-1];ya._threads.getThreadMeta(cb,function(db){ya._olderTimestamp[ya._folder]=db.timestamp;},l.WEBMESSENGER);}if(ya._filter==p.UNREAD){ya._unreadThreadIDs=za;}else ya.unreadThreadIDs=[];h.conditionShow(ya._loadMoreButton,bb);ya._threadIDs=za;u.renderThreadsFromIDs(ya._threadlistRows,za,ya._selection,xa,null,r.MASTER.RECENT_THREADS);ab=ab&&za.length===0;ab&&va(ya);h.conditionShow(ya._infoBox,ab);}function va(ya){if(ya._builtErrorMessage)return;i.setContent(ya._infoBox,x.render(ea._("Could Not Load Conversations"),[{text:ea._("Try Again"),handler:ra.bind(null,ya)}]));ya._builtErrorMessage=true;}function wa(ya,za){za.forEach(function(ab){if(ya._unreadThreadIDs.indexOf(ab)<0)ya._unreadThreadIDs.push(ab);});ya._unreadThreadIDs.sort(function(ab,bb){var cb=ya._threads.getThreadMetaNow(ab).timestamp,db=ya._threads.getThreadMetaNow(bb).timestamp;return db-cb;});ya._unreadThreadIDs=ya._unreadThreadIDs.filter(function(ab){var bb=ya._threads.getThreadMetaNow(ab);return n.getFromMeta(bb)==ya._folder;});return ya._unreadThreadIDs;}function xa(ya){if(ya)return fa+ya;return null;}f.exports=ga;},null);
__d('MercuryLocalThreadResults',['MercuryFolders','MercuryIDs','MercurySingletonMixin','MercuryOrderedThreadlist','MercuryParticipants','MercuryThreadSearchUtils','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(p){'use strict';this.$MercuryLocalThreadResults1=p;this.$MercuryLocalThreadResults2=k.getForFBID(this.$MercuryLocalThreadResults1);this.$MercuryLocalThreadResults3=n.getForFBID(this.$MercuryLocalThreadResults1);}o.prototype.findMatchingThreadsFromIds=function(p,q){'use strict';return q.filter((function(r){var s=this.$MercuryLocalThreadResults3.getThreadMetaNow(r);return this.$MercuryLocalThreadResults4(s,p);}).bind(this));};o.prototype.findMatchingThreads=function(p){'use strict';var q=[];h.getSupportedFolders().forEach((function(r){q=q.concat(this.$MercuryLocalThreadResults2.getThreadlistUntilTimestamp(0,r));}).bind(this));return this.findMatchingThreadsFromIds(p,q);};o.prototype.$MercuryLocalThreadResults4=function(p,q){'use strict';var r=this.$MercuryLocalThreadResults5(p.participants),s=m.wordsInString(q),t=null;l.getMulti(r,function(u){t=r.map(function(v){return u[v];});});if(!t)return false;return m.allMatchPredicate(s,function(u){var v=m.anyMatchPredicate(t,function(x){return x&&x.name&&m.queryWordMatchesAnyNameWord(u,m.wordsInString(x.name));}),w=p.name&&m.queryWordMatchesAnyNameWord(u,m.wordsInString(p.name));return v||w;});};o.prototype.$MercuryLocalThreadResults5=function(p){'use strict';if(p.length===1&&i.tokenize(p[0]).value===this.$MercuryLocalThreadResults1)return p;return p.filter((function(q){var r=i.tokenize(q).value;return r!==this.$MercuryLocalThreadResults1;}).bind(this));};Object.assign(o,j);f.exports=o;},null);
__d('MercurySearchThreadResults',['KeyedCallbackManager','MercuryAPIArgsSource','MercurySingletonMixin','MercuryThreadlistConstants','MercuryThreadIDMap','RangedCallbackManager','MercuryServerDispatcher','MercuryServerPayloadPreprocessor'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=new h(),q=k.WEBMESSENGER_THREAD_COUNT,r=k.WEBMESSENGER_MORE_COUNT;function s(t){'use strict';this.$MercurySearchThreadResults1=t;this.$MercurySearchThreadResults2=o.getForFBID(this.$MercurySearchThreadResults1);this.$MercurySearchThreadResults3=l.getForFBID(this.$MercurySearchThreadResults1);n.registerEndpoints({'/ajax/mercury/search_threads.php':{request_user_id:t,mode:n.IMMEDIATE,handler:(function(u){this.handleUpdate(u);}).bind(this)}});}s.prototype.getThreadlist=function(t,u){'use strict';if(t){var v=p.executeOrEnqueue(t,function(y){var z=y.getAllResources(),aa=y.hasReachedEndOfArray();u(z,aa);}),w=p.getUnavailableResources(v),x=i.WEBMESSENGER;if(w.length)this.$MercurySearchThreadResults4({client:x,query:t,offset:0,limit:q+1});return v;}};s.prototype.isExhausted=function(t){'use strict';var u=p.getResource(t);return u?u.hasReachedEndOfArray():false;};s.prototype.getCachedThreadlist=function(t){'use strict';var u=p.getResource(t);return u?u.getAllResources():null;};s.prototype.cacheThreadlist=function(t,u){'use strict';p.getResource(t);var v=new m();v.addResourcesWithoutSorting(u,0);v.setReachedEndOfArray();p.setResource(t,v);};s.prototype.getMoreThreadlist=function(t,u){'use strict';if(t){var v=p.getResource(t);if(v){var w=v.getCurrentArraySize(),x=r,y=v.executeOrEnqueue(0,w+x,function(){var aa=v.getAllResources(),ba=v.hasReachedEndOfArray();u(aa,ba);}),z=v.getUnavailableResources(y);if(z.length)this.$MercurySearchThreadResults4({query:t,offset:w,limit:x+1});return y;}}};s.prototype.handleUpdate=function(t){'use strict';if(t.mercury_payload)this.$MercurySearchThreadResults2.handleUpdate(t.mercury_payload);var u=t.search_threads||{};for(var v in u){var w=u[v]||[],x=w.map((function(z){return this.$MercurySearchThreadResults3.getClientIDFromServerIDNow(z);}).bind(this)),y=p.getResource(v);if(y){this.$MercurySearchThreadResults5(y,x,r+1);}else{y=new m();this.$MercurySearchThreadResults5(y,x,q+1);p.setResource(v,y);}}};s.prototype.unsubscribe=function(t,u){'use strict';if(u){var v=p.getResource(u);if(v){v.unsubscribe(t);}else p.unsubscribe(t);}};s.prototype.setInitialCount=function(t){'use strict';q=t;};s.prototype.$MercurySearchThreadResults5=function(t,u,v){'use strict';var w=t.getCurrentArraySize(),x=u.length<v;if(!x)u.pop();t.addResourcesWithoutSorting(u,w);if(x)t.setReachedEndOfArray();};s.prototype.$MercurySearchThreadResults4=function(t){'use strict';t.client=i.WEBMESSENGER;t.index='fbid';n.trySend('/ajax/mercury/search_threads.php',t,null,this.$MercurySearchThreadResults1);};Object.assign(s,j);f.exports=s;},null);
__d('MercurySearchThreadsStrategy',['WebMessengerConstants','MercuryLocalThreadResults','MercurySingletonMixin','MercurySearchThreadResults','createObjectFrom'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=null,n=null,o=h.SEARCH_THREAD_DELAY;function p(q){'use strict';this.$MercurySearchThreadsStrategy1=q;this.$MercurySearchThreadsStrategy2=i.getForFBID(this.$MercurySearchThreadsStrategy1);this.$MercurySearchThreadsStrategy3=k.getForFBID(this.$MercurySearchThreadsStrategy1);}p.prototype.clearTimer=function(){'use strict';m=null;clearTimeout(n);n=null;};p.prototype.search=function(q,r,s,t){'use strict';if(q!=m){m=q;clearTimeout(n);n=null;}var u=this.$MercurySearchThreadsStrategy2.findMatchingThreads(q),v=this.$MercurySearchThreadsStrategy3.getCachedThreadlist(q);if(v){var w=this.$MercurySearchThreadsStrategy4(u,v);r(w);s([],this.$MercurySearchThreadsStrategy3.isExhausted(q));t(null,q);return;}var x=this.$MercurySearchThreadsStrategy5(q),y=this.$MercurySearchThreadsStrategy4(u,x.thread_ids);if(x.from_exhausted_remote_results){this.$MercurySearchThreadsStrategy3.cacheThreadlist(q,y);r(y);s([],true);t(null,q);return;}r(y);n=setTimeout((function(){var z=this.$MercurySearchThreadsStrategy3.getThreadlist(q,s);t(z,q);}).bind(this),o);};p.prototype.$MercurySearchThreadsStrategy5=function(q){'use strict';var r='',s=[];for(var t=q.length-1;t>0;t--){var u=q.slice(0,t),v=this.$MercurySearchThreadsStrategy3.getCachedThreadlist(u);if(!v)continue;if(this.$MercurySearchThreadsStrategy3.isExhausted(u)){return {from_exhausted_remote_results:true,thread_ids:this.$MercurySearchThreadsStrategy2.findMatchingThreadsFromIds(q,v)};}else if(r.length===0){r=u;s=this.$MercurySearchThreadsStrategy2.findMatchingThreadsFromIds(q,v);}}return {from_exhausted_remote_results:false,thread_ids:s};};p.prototype.$MercurySearchThreadsStrategy4=function(q,r){'use strict';return Object.keys(babelHelpers._extends({},l(q),l(r)));};Object.assign(p,j);f.exports=p;},null);
__d('WebMessengerMasterViewSearchInputControl',['Event','CSS','DOM','Input','Keys','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerSubscriptionsHandler','WebMessengerEvents','cx','MercurySearchThreadsStrategy'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=c('MercurySearchThreadsStrategy').get();function u(ca,da){'use strict';this._manager=ca;this._rootElement=da;j.empty(this._rootElement);var ea=p[':fb:web-messenger:master-view:search-input'].build();j.replace(this._rootElement,ea.getRoot());this._searchBox=ea.getRoot();this._searchInput=ea.getNode('searchInput');this._searchClear=ea.getNode('searchClear');this._searchButton=j.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');q.addSubscriptions(r.subscribe(r.UPDATE_SELECTION,ba.bind(null,this)),h.listen(this._searchButton,'click',(function(){var fa=k.getValue(this._searchInput);if(fa)z(this,fa);}).bind(this)),h.listen(this._searchClear,'click',y.bind(null,this)),h.listen(this._searchInput,'keyup',(function(event){var fa=k.getValue(this._searchInput);if(event.keyCode==l.ESC){y(this);}else if(event.keyCode==l.RETURN&&fa){m.openSearchThread();}else if(fa){aa(this,fa);}else if(fa!==o.getCurrentStateData().query){y(this);this.focus();}return false;}).bind(this)),h.listen(this._searchInput,'focus',(function(fa){this._focused=true;}).bind(this)),h.listen(this._searchInput,'blur',(function(fa){this._focused=false;}).bind(this)));}u.prototype.updateView=function(){'use strict';var ca=w(this);v(this);if(ca)x(this);};u.prototype.focusAndSelectSearch=function(){'use strict';z(this,k.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};u.prototype.focus=function(){'use strict';setTimeout((function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this),0);};u.prototype.destroy=function(){'use strict';};function v(ca){var da=o.getCurrentStateData();ca._state=o.getCurrentMasterState();ca._folder=da.folder;if(ca._state!=n.MASTER.SEARCH){ca._query=null;}else ca._query=da.query;}function w(ca){if(!ca._state||!ca._folder)return true;var da=o.getCurrentMasterState(),ea=o.getCurrentStateData();if(ca._folder!=ea.folder)return true;if(da!=ca._state)return true;if(da==n.MASTER.SEARCH&&ca._query!=ea.query)return true;return false;}function x(ca){if(ca._state==n.MASTER.SEARCH){var da=ca._query||'';if(k.getValue(ca._searchInput)!=da)k.setValue(ca._searchInput,da);ca.focus();}else{k.reset(ca._searchInput);ca._searchInput.blur();}i.conditionClass(ca._searchBox,"_47",!k.isEmpty(ca._searchInput));}function y(ca){t.clearTimer();var da=o.getCurrentStateData();da.no_uri=true;delete da.query;o.updateMasterState(n.MASTER.RECENT_THREADS,da);}function z(ca,da){var ea=o.getCurrentMasterState();if(ea!=n.MASTER.SEARCH)ca._threadID=o.getCurrentStateData().thread_id;if(da)o.updateDetailState(n.DETAIL.SEARCH_SNIPPET,{query:da,message_query:da});}function aa(ca,da){var ea=o.getCurrentStateData();if(da!==ea.query){var fa=o.getCurrentMasterState();if(fa!=n.MASTER.SEARCH)ca._threadID=ea.thread_id;if(da)o.updateMasterState(n.MASTER.SEARCH,{all_people_query:ea.all_people_query,message_query:ea.message_query,message_id:ea.message_id,query:da,thread_id:ea.thread_id});}}function ba(ca,da,ea){if(j.contains(ca._ariaOwns,ea))ca._searchInput.setAttribute('aria-activedescendant',ea);}f.exports=u;},null);
__d('MercurySearchThreadResultOrderer',['MercurySingletonMixin','MessagingTag','MercuryThreads','createObjectFrom'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(p){'use strict';this.$MercurySearchThreadResultOrderer1=p;this.$MercurySearchThreadResultOrderer2=j.getForFBID(p);}l.prototype.separateCanonicalThreadsInFolder=function(p,q){'use strict';var r=[],s=[];p.forEach((function(t){var u=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(t);if(u.folder===q&&u.is_canonical){r.push(t);}else s.push(t);}).bind(this));return {canonical_in_folder:r.sort((function(t,u){return this.$MercurySearchThreadResultOrderer3(t,u);}).bind(this)),remaining:s};};l.prototype.filterThreadsInFolder=function(p,q){'use strict';var r=[];p.forEach((function(s){var t=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(s);if(t.folder===q&&t.is_archived===false){r.push(s);}else if(q===i.ACTION_ARCHIVED&&t.is_archived===true)r.push(s);}).bind(this));return r;};l.prototype.orderResults=function(p,q,r,s){'use strict';var t=o(q,r),u=t.sort(this.$MercurySearchThreadResultOrderer4.bind(this,s));return o(p,u);};l.prototype.$MercurySearchThreadResultOrderer4=function(p,q,r){'use strict';var s=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(q),t=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(r),u=m(s),v=m(t);if(u!==v)return n(u,p)>n(v,p)?-1:1;if(s.is_canonical!==t.is_canonical)return s.is_canonical?-1:1;return this.$MercurySearchThreadResultOrderer3(q,r);};l.prototype.$MercurySearchThreadResultOrderer3=function(p,q){'use strict';var r=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(p),s=this.$MercurySearchThreadResultOrderer2.getThreadMetaNow(q);return r.timestamp>s.timestamp?-1:1;};function m(p){return p.is_archived?i.ACTION_ARCHIVED:p.folder;}function n(p,q){if(p===q)return 5;var r={};r[i.INBOX]=4;r[i.ACTION_ARCHIVED]=3;r[i.OTHER]=2;r[i.SPAM]=1;return r[p];}function o(p,q){var r=k(p),s=q.filter(function(t){return !(t in r);});return p.concat(s);}Object.assign(l,h);f.exports=l;},null);
__d('WebMessengerMasterViewSearchThreadsControl',['Event','CSS','DOM','MercuryFolders','MercuryLogger','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadlistRenderer','WebMessengerEvents','WebMessengerMercury','WebMessengerSubscriptionsHandler','createObjectFrom','csx','cx','fbt','ge','getElementText','MercurySearchThreadResultOrderer','MercurySearchThreadResults','MercurySearchThreadsStrategy'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa=c('MercurySearchThreadResultOrderer').get(),ba=c('MercurySearchThreadResults').get(),ca=c('MercurySearchThreadsStrategy').get(),da='search:',ea='search-indicator';function fa(bb,cb,db,eb){'use strict';this._manager=bb;this._rootElement=cb;this._noMessagesIndicator=eb;this._orderedThreadlist=s.getOrderedThreadlist();this._threadInformer=s.getThreadInformer();this._threads=s.getThreads();j.empty(this._rootElement);var fb=p[':fb:web-messenger:thread-search'].build();j.setContent(this._rootElement,fb.getRoot());this._loadingSpinner=fb.getNode('loadingSpinner');this._threadlistRows=fb.getNode('threadlistRows');this._loadMoreButton=fb.getNode('loadMoreButton');this._loadMoreLink=fb.getNode('loadMoreLink');var gb=p[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=gb.getNode('threadSearchResultDescription');this._searchMessagesIndicator=gb.getRoot();this._searchMessagesIndicator.setAttribute('id',da+ea);j.replace(db,this._searchMessagesIndicator);this._snippetSearchLink=gb.getNode('snippetSearchLink');this._snippetSearchLinkText=gb.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=ha(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;t.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',(function(hb,ib){ta(this,u(ib));}).bind(this)),this._threadInformer.subscribe('messages-received',(function(){this._namesChangedSinceLastRedraw=true;}).bind(this)),h.listen(this._loadMoreLink,'click',(function(){sa(this);}).bind(this)),h.listen(this._snippetSearchLink,'click',(function(){this.updateKeyboardSelection(ea);ab(this);}).bind(this)));}fa.prototype.updateView=function(){'use strict';this._active=true;i.show(this._rootElement);i.hide(this._loadingSpinner);var bb=ia(this),cb=ja(this),db=this._folder,eb=this._query,fb=this._selection;ka(this);if(cb||bb){var gb=this._keyboardSelection;switch(this._detailState){case n.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case n.DETAIL.SEARCH_SNIPPET:case n.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=ea;}la(this,gb);}if(bb){qa(this);}else{ma(this,false);ra(this);}if(eb!=this._query||db!=this._folder)l.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&fb!=this._selection)l.logThreadFromSearch(this._query,this._selection);};fa.prototype.hideView=function(){'use strict';this._active=false;i.hide(this._rootElement);ua(this,false);ra(this);};fa.prototype.openSearchThread=function(bb){'use strict';if(bb==ea){ab(this);}else o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:bb});};fa.prototype.updateKeyboardSelection=function(bb){'use strict';var cb=this._keyboardSelection;this._keyboardSelection=bb;la(this,cb);};fa.prototype.destroy=function(){'use strict';ga(this);};function ga(bb){bb._searchThreadsSubscription&&ba.unsubscribe(bb._searchThreadsSubscription.subscriber_id,bb._searchThreadsSubscription.query);bb._searchThreadsSubscription=null;}function ha(bb){var cb={};k.getSupportedFolders().forEach((function(db){var eb=bb._orderedThreadlist.getThreadlistUntilTimestamp(0,db);cb[db]=eb.length>0?bb._threads.getThreadMetaNow(eb[eb.length-1]).timestamp:Infinity;}).bind(this));return cb;}function ia(bb){var cb=bb._namesChangedSinceLastRedraw;bb._namesChangedSinceLastRedraw=false;if(cb)return true;if(!bb._remoteResultsCompleted)return true;var db=ha(bb),eb=bb._oldestTimestamps;bb._oldestTimestamps=db;var fb=o.getCurrentStateData();if(bb._query!==fb.query||bb._folder!==fb.folder)return true;for(var gb in eb)if(eb[gb]>db[gb])return true;return false;}function ja(bb){var cb=o.getCurrentStateData();if(bb._selection!=cb.thread_id)return true;return false;}function ka(bb){var cb=o.getCurrentStateData();bb._detailState=o.getCurrentDetailState();bb._query=cb.query;bb._folder=cb.folder;bb._selection=cb.thread_id;}function la(bb,cb){var db=y(ya(cb));if(db){i.removeClass(db,"_kv");db.removeAttribute('aria-selected');}var eb=y(ya(bb._keyboardSelection));if(eb){i.addClass(eb,"_kv");eb.setAttribute('aria-selected',true);}r.updateSelection(eb&&eb.id);}function ma(bb,cb){if(bb._keyboardSelection&&bb._keyboardSelection!=ea&&bb._threadIDs.indexOf(bb._keyboardSelection)<0)bb._keyboardSelection=null;if(!bb._keyboardSelection)if(bb._threadIDs.length){bb._keyboardSelection=bb._threadIDs[0];}else if(!cb){bb._keyboardSelection=ea;la(bb);}var db=bb._threadIDs.slice(0);db.push(ea);if(bb._active)m.updateThreadlistIndex(bb,db.map(ya),ya(bb._keyboardSelection));}function na(bb){var cb=j.scry(bb._threadlistRows,"._l5");cb.filter(function(db){return z(db)!==o.getCurrentStateData().folder;}).forEach(i.show.bind(i));}function oa(bb){var cb=j.scry(bb._threadlistRows,"._l5");cb.forEach(i.hide.bind(i));}function pa(bb){na(bb);bb._manager.draw();}function qa(bb){i.show(bb._loadingSpinner);ua(bb,false);i.hide(bb._threadlistRows);i.hide(bb._loadMoreButton);oa(bb);ga(bb);if(bb._query){var cb=[],db=[];bb._remoteResultsCompleted=false;ca.search(bb._query,function(eb){var fb=aa.separateCanonicalThreadsInFolder(eb,o.getCurrentStateData().folder);cb=fb.canonical_in_folder;db=fb.remaining;za(bb);i.show(bb._threadlistRows);wa(bb,cb);pa(bb);},function(eb,fb){bb._remoteResultsCompleted=true;var gb=aa.orderResults(cb,db,eb,o.getCurrentStateData().folder);if(gb.length>0){i.conditionShow(bb._loadMoreButton,!fb);xa(bb,gb);}else va(bb);i.hide(bb._loadingSpinner);pa(bb);},function(eb,fb){if(eb)bb._searchThreadsSubscription={subscriber_id:eb,query:fb};});}else{ca.clearTimer();i.hide(bb._loadingSpinner);j.empty(bb._threadlistRows);i.show(bb._threadlistRows);bb._threadIDs=[];}ra(bb);}function ra(bb){var cb=!!bb._query&&bb._active,db=cb^i.shown(bb._searchMessagesIndicator);i.conditionShow(bb._searchMessagesIndicator,cb);bb._manager.sizeToFit(cb);db&&bb._manager.draw();}function sa(bb){ga(bb);i.addClass(bb._loadMoreButton,'async_saving');var cb=ba.getMoreThreadlist(bb._query,function(db,eb){i.removeClass(bb._loadMoreButton,'async_saving');i.conditionShow(bb._loadMoreButton,!eb);xa(bb,db);bb._manager.poke();});if(cb)bb._searchThreadsSubscription={subscriber_id:cb,query:bb._query};}function ta(bb,cb){if(bb._threadIDs.length){q.renderThreadsFromIDs(bb._threadlistRows,bb._threadIDs,bb._keyboardSelection,ya,cb,n.MASTER.SEARCH);bb._manager.poke();}}function ua(bb,cb){cb=cb&&bb._active;i.conditionClass(bb._searchMessagesIndicator,"_33x",cb!==false);i.conditionShow(bb._noMessagesIndicator,cb!==false);}function va(bb){bb._threadIDs=[];ma(bb,false);var cb=x._("No people or conversations named {query}",[x.param('query',bb._query)]),db=j.create('div',{},cb);j.setContent(bb._noMessagesIndicator,db);ua(bb,true);}function wa(bb,cb){xa(bb,cb,true);}function xa(bb,cb,db){bb._threadIDs=cb;ma(bb,db);q.renderThreadsFromIDs(bb._threadlistRows,cb,bb._keyboardSelection,ya,null,n.MASTER.SEARCH);r.updateSelection(bb._keyboardSelection);if(bb._keyboardSelection==ea)la(bb);}function ya(bb){if(bb)return da+bb;return null;}function za(bb){var cb=x._("Showing results for name: {query}",[x.param('query',bb._query)]);j.setContent(bb._threadSearchResultDescription,cb);}function ab(bb){if(bb._query){o.updateDetailState(n.DETAIL.SEARCH_SNIPPET,{query:bb._query,message_query:bb._query});r.focusSearch();}}f.exports=fa;},null);
__d('MessagingFilteringNux',['Arbiter','AsyncRequest','LayerDestroyOnHide','LayerHideOnTransition','MercuryConfig','isWebMessengerURI'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=null,o,p={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(q){h.subscribe(p.DIALOG_REGISTERED_EVENT,function(){if(!n)return;n.setContext(q);n.show();n=null;},h.SUBSCRIBE_ALL);},registerDialog:function(q){n=q.disableBehavior(j).disableBehavior(k);o=h.subscribe('page_transition',function(r,s){if(!m(s.uri)){q&&q.destroy();o.unsubscribe();}},h.SUBSCRIBE_NEW);if(q)q.subscribe('confirm',function(){l.filtering_active=true;new i('/ajax/web_messenger/dismiss_filtering_nux.php').send();q.hide();h.inform(p.ACCEPTED_EVENT,{});});h.inform(p.DIALOG_REGISTERED_EVENT,{},h.BEHAVIOR_PERSISTENT);}};f.exports=p;},null);
__d('WebMessengerEditFilteringSettingDialog',['AsyncDialog','AsyncRequest','DOM','MessagingFilteringType','csx'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m='/ajax/mercury/edit_filtering_type.php',n='/ajax/mercury/change_filtering_type.php',o={show:function(){var p=function(r){var s=r.getRoot(),t=j.find(s,"._cq6").checked,u=j.find(s,"._cq7").checked,v='';if(t){v=k.MODERATE;}else if(u)v=k.STRICT;new i(n).setData({filtering_type:v}).send();r.hide();},q=function(r){r.subscribe('confirm',p.bind(null,r));r.show();};h.send(new i(m),q);}};f.exports=o;},null);
__d('WebMessengerAuxMenu',['SelectableMenu','MenuSelectableItem','MenuTheme','PopoverMenuOverlappingBorder','Popover','PopoverMenu'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();function n(o,p){'use strict';this._menu=new h([],{className:p,theme:j});var q=new l(o.parentNode,o,null,{alignh:'right'});new m(q,o,this._menu,[k]);}n.prototype.addOption=function(o,p){'use strict';var q=new i({markup:o,title:''});q.setOnClickHandler(p);this._menu.addItem(q);return q;};n.prototype.destroy=function(){'use strict';};f.exports=n;},null);
__d('WebMessengerMenuFolderControl',['WebMessengerAuxMenu','CSS','Parent','WebMessengerTemplates','Toggler','WebMessengerSubscriptionsHandler','csx','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p,q;function r(t){return j.bySelector(t,"._282");}function s(t,u,v){'use strict';var w=!p||p!=u;p=u;this._template=k[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',t);if(!q||w){q=new h(p,"_1j");i.show(r(p));m.addSubscriptions(l.subscribe(['show','hide'],function(x,y){var z=y.getActive(),aa=z&&j.byClass(z,"_282");if(aa)i.conditionClass(aa,"_50p_",x==='show');}));}this._menuItem=q.addOption(this._template.getRoot(),v);this._menuItem.getRoot();}s.prototype.getCountBadge=function(){'use strict';return this._template.getNode('count');};s.prototype.setSelected=function(t){'use strict';i.conditionClass(r(p),'selectedFolder',t);if(t){this._menuItem.select();}else this._menuItem.deselect();};s.prototype.destroy=function(){'use strict';q&&q.destroy();};f.exports=s;},null);
__d('WebMessengerTabbedFolderControl',['Event','CSS','WebMessengerTemplates'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l,m,n,o){'use strict';this._template=j[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',l);this._listener=h.listen(this._template.getNode('link'),'click',n);if(o)this._countListener=h.listen(this._template.getNode('count'),'click',o);m.push(this._template.getRoot());}k.prototype.getCountBadge=function(){'use strict';return this._template.getNode('count');};k.prototype.setSelected=function(l){'use strict';i.conditionClass(this._template.getRoot(),'selectedFolder',l);};k.prototype.getElement=function(){'use strict';this._template.getRoot();};k.prototype.destroy=function(){'use strict';this._listener.remove();this._countListener&&this._countListener.remove();};f.exports=k;},null);
__d('WebMessengerMasterViewTabBarControl',['JSXDOM','Arbiter','CSS','DOM','Event','Ellipsizer','WebMessengerMenuFolderControl','MercuryConfig','MercuryFilters','MercuryFolders','MercuryThreadlistConstants','MessagingFilteringNux','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTabbedFolderControl','WebMessengerTemplates','WebMessengerEditFilteringSettingDialog','WebMessengerEvents','WebMessengerSubscriptionsHandler','WebMessengerMercury','csx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){if(c.__markCompiled)c.__markCompiled();function ea(la,ma,na){'use strict';this._manager=la;this._rootElement=ma;this._rootTopContentElement=na;this._threadInformer=ba.getThreadInformer();this._unreadState=ba.getUnreadState();k.empty(this._rootElement);var oa=x[':fb:web-messenger:master-view:tab-bar'].build(),pa=x[':fb:web-messenger:master-view:top-content'].build();k.setContent(this._rootElement,oa.getRoot());k.setContent(this._rootTopContentElement,pa.getRoot());this._tabList=oa.getRoot();this._moreMenu=oa.getNode('moreMenu');this._topContentCont=pa.getRoot();this._topContent=pa.getNode('masterViewTopContentHolder');this._closeButton=pa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=pa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=q.getSupportedFolders();this._foldersToHeader={};this._filters=p.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=h.a({href:"#"},da._("Mark All as Read"));this._unreadMarkAllRead=h.a({href:"#"},da._("Mark All as Read"));this._otherEditSettings=h.a({href:"#"},da._("Edit Preferences"));var qa=[];this._filters.forEach((function(ta){var ua=ja.bind(null,this,t.INBOX,ta);switch(ta){case t.UNREAD:this._filtersToHeader[ta]=this._filtersToHeader[ta]||new n(da._("Unread"),this._moreMenu,ua);break;}}).bind(this));this._folders.forEach((function(ta){var ua=ja.bind(null,this,ta,p.ALL),va=ja.bind(null,this,ta,t.UNREAD);switch(ta){case t.INBOX:var wa=o.CoreGraphEnabled?da._("Recent"):da._("Inbox");this._foldersToHeader[ta]=this._foldersToHeader[ta]||new w(wa,qa,ua,va);break;case t.OTHER:if(o.CoreGraphEnabled){this._foldersToHeader[ta]=this._foldersToHeader[ta]||new n(da._("Filtered"),this._moreMenu,ua);}else this._foldersToHeader[ta]=this._foldersToHeader[ta]||new w(da._("Other"),qa,ua);break;case t.ACTION_ARCHIVED:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new n(da._("Archived"),this._moreMenu,ua);break;case t.SPAM:if(o.CoreGraphEnabled)break;this._foldersToHeader[ta]=this._foldersToHeader[ta]||new n(da._("Spam"),this._moreMenu,ua);break;case t.PENDING:if(!o.CoreGraphEnabled)break;this._foldersToHeader[ta]=this._foldersToHeader[ta]||new w(da._("Message Requests"),qa,ua);break;}}).bind(this));k.prependContent(this._tabList,qa);var ra=k.scry(this._tabList,"._6xt");ra.push(oa.getNode('moreMenuLabel'));this._ellipsizer=new m(ra);fa(this);var sa=ja.bind(null,this,t.INBOX,p.ALL);i.subscribe(s.ACCEPTED_EVENT,ia.bind(null,this));aa.addSubscriptions(this._threadInformer.subscribe('unread-updated',ka.bind(null,this)),l.listen(this._otherMarkAllRead,'click',(function(){this._unreadState.markFolderAsRead(t.OTHER);}).bind(this)),l.listen(this._unreadMarkAllRead,'click',(function(){this._unreadState.markFolderAsRead(t.INBOX);}).bind(this)),l.listen(this._otherEditSettings,'click',function(){y.show();}),l.listen(this._closeButton,'click',sa));}ea.prototype.updateView=function(){'use strict';var la=ha(this);ga(this);if(la)ia(this);fa(this);};ea.prototype.getOtherFolderLabel=function(){'use strict';var la=t.OTHER,ma=this._foldersToHeader[la];if(!ma||!ma._template)return null;return ma._template.getNode('folderLabel');};ea.prototype.destroy=function(){'use strict';for(var la in this._foldersToHeader)this._foldersToHeader[la]&&this._foldersToHeader[la].destroy();for(var ma in this._filtersToHeader)this._filtersToHeader[ma]&&this._filtersToHeader[ma].destroy();};function fa(la){var ma=85;k.scry(la._tabList,"._1r").forEach(function(na){ma+=na.offsetWidth;});la._ellipsizer.confineWithin(la._rootElement.offsetWidth-ma,1.3);}function ga(la){var ma=v.getCurrentStateData();la._state=v.getCurrentMasterState();la._folder=ma.folder;la._filter=ma.filter;la._query=ma.query;}function ha(la){if(!la._state||!la._folder)return true;var ma=v.getCurrentStateData();if(la._folder!=ma.folder)return true;if(la._filter!=ma.filter)return true;return false;}function ia(la){var ma=false,na;la._folders.forEach(function(oa){var pa=la._filter==t.UNREAD,qa=oa==la._folder&&(la._filter==p.ALL||pa),ra,sa;switch(oa){case t.INBOX:if(pa){var ta=h.strong(null,da._("Unread")),ua=h.strong(null,da._("Inbox")),va=da._("{unread} messages in {inbox}",[da.param('unread',ta),da.param('inbox',ua)]);ra=h.div(null,va,' \u00b7 ',la._unreadMarkAllRead);sa=true;}break;case t.OTHER:if(o.CoreGraphEnabled)break;var wa='';if(o.filtering_active)wa=h.span(null,la._otherEditSettings,' \u00b7 ');ra=h.div(null,h.p(null,h.strong(null,da._("Tip:")+' '),da._("See a message from someone you know? Just reply or click Move to Inbox from the Actions menu.")),wa,la._otherMarkAllRead);s.tryShow(la.getOtherFolderLabel());break;}if(qa){na=oa;j.conditionShow(la._closeButtonCont,sa);}else la._foldersToHeader[oa].setSelected(false);if(qa&&ra){ma=true;k.setContent(la._topContent,ra);}});la._filters.forEach(function(oa){var pa=la._folder==t.INBOX&&oa==la._filter;la._filtersToHeader[oa].setSelected(pa);});na&&la._foldersToHeader[na].setSelected(true);j.conditionShow(la._topContentCont,ma);ka(la);la._manager.draw();}function ja(la,ma,na){var oa=la._state==u.MASTER.SEARCH;if(oa||la._folder!=ma||la._filter!=na){var pa=babelHelpers._extends({},v.getCurrentStateData()),qa=v.getCurrentDetailState();if(qa!==u.DETAIL.SEARCH_SNIPPET&&qa!==u.DETAIL.SEARCH_CONTEXT)delete pa.query;v.updateMasterState(u.MASTER.RECENT_THREADS,Object.assign(pa,{folder:ma,filter:na}));}z.focusComposer();return false;}function ka(la){for(var ma in la._foldersToHeader){if(ma==t.ACTION_ARCHIVED)continue;var na=la._unreadState.exceedsMaxCount(ma)?r.MAX_UNREAD_COUNT+'+':la._unreadState.getUnreadCount(ma),oa=[la._foldersToHeader[ma].getCountBadge()];if(ma==t.INBOX)la._filters.forEach(function(pa){oa.push(la._filtersToHeader[pa].getCountBadge());});oa.forEach(function(pa){if(na)k.setContent(pa,da._("({unread_count})",[da.param('unread_count',na)]));j.conditionShow(pa,na);});}fa(la);}f.exports=ea;},null);
__d('WebMessengerMasterViewControlManager',['ArbiterMixin','DOM','WebMessengerFlexibleScrollArea','WebMessengerMasterViewTabBarControl','WebMessengerMasterViewSearchInputControl','WebMessengerMasterViewRecentThreadsControl','WebMessengerMasterViewSearchThreadsControl','WebMessengerStateManager','WebMessengerStateConstants','Style','WebMessengerTemplates','WebMessengerEvents','WebMessengerSubscriptionsHandler','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v,w;v=babelHelpers.inherits(x,u(h));w=v&&v.prototype;function x(y){'use strict';w.constructor.call(this);this._rootElement=y;i.empty(this._rootElement);var z=r[':fb:web-messenger:master-view'].build();i.setContent(this._rootElement,z.getRoot());this._tabBarControl=new k(this,z.getNode('masterViewTabBar'),z.getNode('masterViewTopContent'));this._searchInputControl=new l(this,z.getNode('masterViewSearchInput'));this._searchThreadsControl=new n(this,z.getNode('masterViewSearchThreads'),z.getNode('searchMessagesIndicator'),z.getNode('noMessages'));this._threadlistRowsWrapper=z.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var aa={fade:true,persistent:true};this._flexArea=new j(this._threadlistRowsWrapper,aa).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new m(this,z.getNode('masterViewRecentThreads'),z.getNode('masterInfoBox'),z.getNode('masterViewTabBar'));t.addSubscriptions(s.subscribe(s.FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),s.subscribe(s.FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),s.subscribe(s.MASTER_DOM_CHANGED,(function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}).bind(this)),o.subscribe(p.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,i.find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];}x.prototype.updateOnStateChange=function(){'use strict';var y=o.getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(y){case p.MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case p.MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}};x.prototype.scrollIntoView=function(y,z){'use strict';this._flexArea&&this._flexArea.scrollIntoView(y,z);};x.prototype.scrollToBottom=function(y){'use strict';this._flexArea&&this._flexArea.scrollToBottom(y);};x.prototype.scrollToTop=function(y){'use strict';this._flexArea&&this._flexArea.scrollToTop(y);};x.prototype.isScrolledToTop=function(){'use strict';return this._flexArea&&this._flexArea.isScrolledToTop();};x.prototype.getScrollTop=function(){'use strict';return this._flexArea.getScrollableArea().getScrollTop();};x.prototype.draw=function(){'use strict';this._flexArea&&this._flexArea.draw();};x.prototype.poke=function(){'use strict';this._flexArea&&this._flexArea.poke();};x.prototype.sizeToFit=function(y){'use strict';this._flexArea&&this._flexArea.setSizeToFit(y);};x.prototype.addScrollCallback=function(y){'use strict';this._flexArea&&this._flexArea.addScrollCallback(y);};x.prototype.forceFireScrollCallbacks=function(){'use strict';this._flexArea&&this._flexArea._onScroll();};x.prototype.getFlexAreaElement=function(){'use strict';return this._flexArea.flexArea;};x.prototype.resizeTo=function(y){'use strict';if(y!==null){y=y.toString();if(!(y.endsWith('%')||y.endsWith('px')))y=y+'px';}this._resizeNodes.forEach(function(z){q.set(z,'width',y);});s.masterDOMChanged();};x.prototype.destroy=function(){'use strict';this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();};f.exports=x;},null);
__d('WebMessengerPageTitleRenderer',['DocumentTitle','MercuryAPIArgsSource','MercuryViewer','MercuryParticipants','WebMessengerStateConstants','WebMessengerStateManager','fbt','MercuryThreadMetadataRenderer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=c('MercuryThreadMetadataRenderer').get(),p=c('MercuryThreads').get(),q={updateTitleForState:function(t,u,v){this.withTitleForState(t,u,v||function(w){var x=m.getCurrentDetailState(),y=m.getCurrentStateData();if(t===x&&u===y)h.set(w);});},withTitleForState:function(t,u,v){switch(t){case l.DETAIL.RECENT_MESSAGES:r(u.thread_id,v);break;default:s(v);break;}}};function r(t,u){if(!t){s(u);return;}p.getThreadMeta(t,function(v){if(v.name){u(n._("{conversation_name} - Messages",[n.param('conversation_name',v.name)]));return;}k.getMulti(v.participants,function(w){var x=[];for(var y in w)if(w.hasOwnProperty(y))x.push(w[y]);var z=o.renderParticipantList(t,x,w[j.getID()]?v.participants.length-1:v.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(aa){var ba=[];if(aa.length===1&&aa[0].id===j.getID()){ba.push(aa[0].name);}else for(var ca=0;ca<aa.length;ca++)if(aa[ca].id!==j.getID())ba.push(aa[ca].name);return ba;}});u(n._("{conversation_name} - Messages",[n.param('conversation_name',z)]));});},i.WEBMESSENGER);}function s(t){t(n._("Messages"));}f.exports=q;},null);
__d('WebMessengerPageTitleControl',['WebMessengerPageTitleRenderer','WebMessengerStateManager','WebMessengerStateConstants','WebMessengerSubscriptionsHandler','WebMessengerEvents'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=function(){var n=function(){h.updateTitleForState(i.getCurrentDetailState(),i.getCurrentStateData());};k.addSubscriptions(i.subscribe(j.STATE_CHANGE_EVENT,n),l.subscribe(l.DETAIL_DOM_CHANGED,n));};f.exports=m;},null);
__d('WebMessengerThreadMessagesAgent',['MercuryAPIArgsSource','MessagingTag','WebMessengerConstants','MercuryMessages','MercuryOrderedThreadlist','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryMessages').get(),l=c('MercuryOrderedThreadlist').get(),m=c('MercuryThreadInformer').get(),n=c('MercuryThreads').get(),o=21,p=false,q='n_inbox_n_unreads',r=j.THREADLIST_MAX_READ_PRELOAD_NUM,s=j.THREADLIST_MAX_UNREAD_PRELOAD_NUM;function t(){'use strict';this._active=true;this._iterative=p;this._strategy=q;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(m.subscribe('threadlist-updated',u.bind(null,this)));}t.prototype.turnOn=function(){'use strict';this._active=true;};t.prototype.turnOff=function(){'use strict';this._active=false;};t.prototype.destroy=function(){'use strict';this._threadInformerSubscriptions.forEach(m.unsubscribe);this._threadInformerSubscriptions=[];};function u(x){if(x._active&&!x._requestIsQueued){if(x._requestInFlight){x._requestIsQueued=true;return;}var y=v(x);if(y.length){x._requestInFlight=true;if(y.length>o){y=y.slice(0,o);x._requestIsQueued=true;}}y.forEach(function(z){x._processedThreadIds[z]=true;x._pendingThreadIds[z]=true;k.getThreadMessagesRange(z,0,j.INITIAL_MESSAGES_LIMIT,function(){w(x,z);},null,h.WEBMESSENGER);});}}function v(x){var y=l.getThreadlistUntilTimestamp(0,i.INBOX),z=y.filter(function(ea){return !x._processedThreadIds[ea]&&!k.hasLoadedNMessages(ea,j.INITIAL_MESSAGES_LIMIT);});if(x._strategy===q){var aa=[],ba=[];for(var ca=0;ca<z.length;ca++){var da=n.getThreadMetaNow(z[ca]);if(da){if(da.unread_count&&ba.length<s)ba.push(z[ca]);if(!da.unread_count&&aa.length<r)aa.push(z[ca]);if(ba.length>=s&&aa.length>=r)break;}}z=aa.concat(ba);}return z;}function w(x,y){if(x._pendingThreadIds[y])delete x._pendingThreadIds[y];if(Object.keys(x._pendingThreadIds).length===0){if(!x._iterative)x._active=false;x._requestInFlight=false;if(x._requestIsQueued){x._requestIsQueued=false;u(x);}}}f.exports=t;},null);
__d('WebMessengerApp',['Arbiter','CSS','WebMessengerDetailViewControlManager','DOM','WebMessengerMasterViewControlManager','MercuryStateCheck','WebMessengerPageTitleControl','PageTransitions','WebMessengerPermalinks','WebMessengerShortcuts','SnowflakePermalinkUtils','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerStateStore','WebMessengerThreadMessagesAgent','URI','WebMessengerAdsControl','WebMessengerSubscriptionsHandler','WebMessengerWidthControl','WebMessengerTemplates','clickRefAction','cx','goURI','isWebMessengerURI','MercuryServerPayloadPreprocessor','MercuryThreadInformer','MercuryDeliveryState','MercuryParticipants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){if(c.__markCompiled)c.__markCompiled();var fa=c('MercuryServerPayloadPreprocessor').get(),ga=c('MercuryThreadInformer').get();c('MercuryDeliveryState').get();c('MercuryParticipants');e(['FBRTCMessageHandler'],function(pa){pa.init();});var ha,ia;function ja(pa,qa){var ra=qa&&qa.getQueryData().hasOwnProperty('theater'),sa=qa&&r.isPermalinkURI(qa);if(ra){ha=h.subscribe('PhotoSnowlift.CLOSE',ka.bind(null,pa),h.SUBSCRIBE_NEW);return false;}else if(sa){ia=h.subscribe('PhotoSnowflake.CLOSE',ka.bind(null,pa),h.SUBSCRIBE_NEW);return false;}if(!qa||!ea(qa)){oa(pa);return false;}p.processURI(qa,function(ta){if(ta){var ua=t.getCurrentStateData();if(ta.redirect){p.goNextURI(ta.master_state,ta.detail_state,ta.data,ta.replace);}else t.updateStateOnURI(ta.master_state,ta.detail_state,ta.data);o.transitionComplete();pa._adsControl.stateChanged(ua,t.getCurrentStateData());return;}oa(pa);da(qa);});return true;}function ka(pa){o.registerHandler(ja.bind(null,pa),6);if(ha){ha.unsubscribe();ha=null;}if(ia){ia.unsubscribe();ia=null;}}function la(){var pa=t.getCurrentStateData();u.setLastSeen(pa.folder,pa.thread_id);}function ma(pa,qa,ra,sa,ta,ua){y.engage();ka(this);h.inform('chat/set_does_page_occlude_tabs',true,h.BEHAVIOR_PERSISTENT);h.inform('chat/set_show_tab_unread_ui',false,h.BEHAVIOR_PERSISTENT);var va=new v();va;t.setStandaloneMode(ua);fa.handleUpdate(qa);m.get();k.empty(pa);var wa=aa[':fb:web-messenger:page-skeleton'].build();k.setContent(pa,wa.getRoot());if(t.getStandaloneMode())i.addClass(document.body,"_k0_");q.registerGeneralShortcuts();this._masterViewManager=new l(wa.getNode('masterView'));this._detailViewManager=new j(wa.getNode('detailView'));this._pageTitleControl=new n();sa&&k.prependContent(wa.getRoot(),sa);if(t.getStandaloneMode()){this._widthControl=null;this._masterViewManager.resizeTo(null);this._detailViewManager.resizeTo(null);}else this._widthControl=new z(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),ta);this._adsControl=x.init();var xa=ra?new w(ra):p.getDefaultURI();ja(this,xa);ba('web_messenger').set_namespace('web_messenger');y.addSubscriptions(ga.subscribe('threads-deleted',function(ya,za){var ab=t.getCurrentStateData().thread_id,bb=t.getCurrentDetailState();if(bb==s.DETAIL.RECENT_MESSAGES&&za[ab]){t.updateDetailState(s.DETAIL.RECENT_MESSAGES,{thread_id:null});}else la();}),t.subscribe(s.STATE_CHANGE_EVENT,la));e(['MercuryBrowserAlerts'],function(ya){y.addSubscriptions(ga.subscribe('messages-received',function(za,ab){for(var bb in ab){var cb=ab[bb];for(var db=0;db<cb.length;db++)ya.messageReceived(cb[db]);}}));ya.subscribe('before-alert',function(za,event){if(event.threadID==na())event.cancelAlert();});});}function na(){var pa=t.getCurrentDetailState(),qa=t.getCurrentStateData();if(pa==s.DETAIL.RECENT_MESSAGES||pa==s.DETAIL.SEARCH_CONTEXT)return qa.thread_id;return null;}function oa(pa){var qa=true;e(['ChatTabActions'],function(ra){qa&&ra.persistLocalState();});y.release();h.inform('chat/set_does_page_occlude_tabs',false,h.BEHAVIOR_PERSISTENT);h.inform('chat/set_show_tab_unread_ui',true,h.BEHAVIOR_PERSISTENT);pa._masterViewManager.destroy();pa._detailViewManager.destroy();qa=false;}f.exports=ma;},null);