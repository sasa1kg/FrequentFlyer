/*!CK:1722564209!*//*1452013859,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ZrL6x"]); }

__d('BugBar',['Event','fbt','AsyncRequest','AsyncDialog','CSS','DOM','DataCollector','Input','BanzaiScribe','BanzaiODS','SimpleXUIDialog','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t={};Object.assign(t,{_nub:null,_nubClasses:['bugNubInfo','bugNubWarning','bugNubFatal'],_taskTags:[],_taskSubscribers:[],_savedInput:null,_form:null,_duplicate_task_title:null,addMetadata:function(u){n.addMetadata(u);},getMetadata:function(){return n.getMetadata();},addTaskSubscribers:function(u){t._taskSubscribers=t._taskSubscribers.concat(u);},getTaskSubscribers:function(){return t._taskSubscribers;},addTaskTags:function(u){t._taskTags=t._taskTags.concat(u);},getTaskTags:function(){return t._taskTags;},reset:function(){n.reset();t._taskTags=[];},cancel:function(){var u=t._dialog;delete t._dialog;t.reset();if(u)u.hide();},initForm:function(u){var v=u.form;this._form=u.form;this.initFormField(v.logs);this.initFormField(v.metadata);setTimeout(t.setProductAreaFocus,0);},initFormField:function(u){var v;if(u.name=="logs"){try{v=n._collectLogs();u.value=JSON.stringify(v);}catch(w){q.bumpEntityKey('flytrap','client_log_failed');p.log('flytrap',w.message);}}else if(u.name=="metadata")try{v=n._collectMetadata();u.value=JSON.stringify(v);}catch(w){q.bumpEntityKey('flytrap','metadata_log_failed');p.log('flytrap',w.message);}},initNub:function(u){this._nub=u;},initScreenshotUploader:function(u){var v=m.scry(t._dialog.getRoot(),'button');u.setSubmitButtons(v);},setProductAreaFocus:function(){var u=m.scry(document.body,'select#product_category');u&&u.length&&u[0].focus();},taskCreated:function(u,v){this.cancel();r.show(v,u);},subscribeSubmit:function(u,v){t._dialog=u;u.subscribe(['submit'],(function(){if(this._form.duplicate_task_id){var w=this._form.duplicate_task_id.value;if(w){var x="Another report of bug: "+this._duplicate_task_title;if(!o.isEmpty(v))x=x+"\n\nAdditional description: "+v.value;o.setValue(v,x);}}if(o.getValue(v).length<4){l.show(s('bug_report_warning'));m.setContent(s('bug_report_warning'),i._("Please provide more details about the problem you are experiencing."));return false;}if(this._form.product_category_id.value=='100977986739334'){l.show(s('bug_report_warning'));m.setContent(s('bug_report_warning'),i._("Please select a product."));return false;}}).bind(this));},fillSavedDescription:function(u){u=s(u);this._savedInput=this._savedInput||"Sorry, we lost your original description :(";m.setContent(u,this._savedInput);},hide:function(){if(t._dialog){l.hide(t._dialog.getRoot());return true;}return false;},unhide:function(){if(t._dialog){l.show(t._dialog.getRoot());var u=JSON.parse(this._form.debuginfo.value);u.additionalmetadata=u.additionalmetadata||{};Object.assign(u.additionalmetadata,t.getMetadata());this._form.debuginfo.value=JSON.stringify(u);return true;}return false;},openBugDialog:function(u){if(t._dialog)return false;var v=new j(u);k.send(v,function(w){w.subscribe('cancel',t.cancel);});},registerMeToo:function(u,v,w,x,y){h.listen(u,'click',(function(event){l.show(s('bug_report_warning'));m.setContent(s('bug_report_warning'),['When you submit this bug report, it will be merged into task ',m.create('a',{href:y},"#"+w+": "+x),'. '+'It is optional to include a description. Please hit submit!']);this._form.duplicate_task_id.value=w;this._duplicate_task_title=x;}).bind(this));},setNubLevel:function(u){if(this._nub){this._nubClasses.forEach((function(v){l.removeClass(this._nub,v);}).bind(this));l.addClass(this._nub,this._nubClasses[u]);}}});f.exports=t;},null);